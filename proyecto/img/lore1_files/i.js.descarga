(function() { function bxBootstrap() {
	if (!(window.bouncex&&bouncex.website)) {
		var pushedData = [];
		if(window.bouncex && bouncex.push && bouncex.length){
			pushedData = bouncex;
		}
		window.bouncex = {};
		bouncex.pushedData = pushedData;
		bouncex.website = {"id":2252,"cookie_name":"bounceClientVisit2252","domain":"avis.com","ct":"bind_to_domain","ally":0,"ei":0,"tcjs":"","cjs":"(function () {\n//KK: frontend frameworks fix  \n  if ( window.angular ) {\n    var ele = angular.element(document.querySelector('body')),\n        rootScope = ele.injector() ? ele.injector().get('$rootScope') : false,\n        initBx;\n    if ( rootScope ) {\n        rootScope.$on( '$locationChangeSuccess', function(event, next, current) {\n            // document.body.appendChild(bouncex.local_storage_frame);\n            clearTimeout(initBx);\n            initBx = setTimeout(function(){                init_vars();\n                bouncex.cookie.vpv++;\n                bouncex.pa = 0;\n                setBounceCookie();\n                for (var ca_id in bouncex.campaigns) {\n                    if (bouncex.campaigns.hasOwnProperty(ca_id)) {\n                        bouncex.destroy_ad(ca_id);\n                    }\n                }\n                bouncex.body = jQuery('body').eq(0);\n                bouncex.calling_url = encodeURIComponent(window.location.href);\n                bouncex.reload_campaigns();\n                bouncex.utk.init();\n            }, 600);\n        });\n    } else {\n        //console.log('bouncex: check rootscope');\n    }\n  }\n})(); \n\n// clicktale integration 6/8/2018, old integrations have this in pre-activation and will overwrite this\nbouncex.clicktaleReport = function(label) {\n    // check old format (new format has \"BounceX: Impression [label]\")\n    var oldFormat = label.indexOf('BounceX: ') !== 0;\n    if (oldFormat) {\n        label = 'BounceX: ' + label;\n        label = label.replace('BounceX: Impression', 'BounceX: Impression ');\n        label = label.replace('BounceX: Click', 'BounceX: Click ');\n        label = label.replace('BounceX: Submit', 'BounceX: Submit ');\n        label = label.replace('  ', ' '); // inconsistent spaces in campaigns;\n    }\n\n    if (window.ClicktaleIntegrationExperienceHandler) {\n        ClicktaleIntegrationExperienceHandler(label);\n    }\n};\n","force_https":false,"waypoints":false,"content_width":0,"gai":"UA-6997633-3","swids":"","sd":0,"ljq":"auto","campaign_id":0,"is_preview":false,"aco":{"first_party_limit":"3500","local_storage":"1"},"cmp":{"gdpr":0,"gmp":0,"whitelist_check":0},"burls":[],"ple":false,"fbe":true,"mas":2,"map":1,"gar":true,"ete":0,"ettm":true,"etjs":"","dge":false,"bxidLoadFirst":false,"gbi_enabled":0,"gbi":{"rblocks":null},"bpush":false,"pt":null,"els":null,"vars":[{"name":"logged_in","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function () {\n\tvar customer = JSON.parse(sessionStorage.getItem('ngStorage-customer'));\n\tif (customer) {\n\t\treturn customer.userState === 'AUTHENTICATED' && customer.membershipStatus === 'Preferred';\n\t} else if (jQuery('.my-logout').length > 0) {\n\t\treturn true;\n\t}\n})();","trigger":""},{"name":"ever_logged_in","polling":"none","persist":"permanent","page_types":[],"testmode":false,"default":"false","code":"bouncex.vars.logged_in ? true : null;","trigger":""},{"name":"vehicle_type_selected","polling":"none","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"(function () {\n\tvar reservation = JSON.parse(sessionStorage.getItem('ngStorage-reservationModel'));\n\tif (reservation && typeof reservation.selectedCar\t!== 'undefined' && typeof reservation.selectedCar[0] !== 'undefined'){\n\t\treturn reservation.selectedCar[0].carGroup;\n\t}\n})();","trigger":""},{"name":"airport","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function(){ \n\tvar sourceIsAirport = (/airport/i).test(jQuery('#vehicleTeaser').find('.source').find('.location-info').get(0).innerText);\n\tvar destinationIsAirport = (/airport/i).test(jQuery('#vehicleTeaser').find('.destination').find('.location-info').get(0).innerText);\n\tif (sourceIsAirport && destinationIsAirport ) {\n\t\treturn 'round';\n\t}\n\tif ( destinationIsAirport ) {\n\t\treturn 'return';\n\t}\n\tif (sourceIsAirport ) {\n\t\treturn 'pickup';\n\t}\n})();","trigger":""},{"name":"round_trip","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function(){ \n\tvar context = JSON.parse(sessionStorage.getItem('customClientContext'));\n\tif (context && context.dol && context.pul) {\n\t\treturn context.dol === context.pul;\n\t}\n})();","trigger":""},{"name":"length_of_rental","polling":"all","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function(){ \n\tvar context = JSON.parse(sessionStorage.getItem('customClientContext'));\n\tif (context && context.lor) {\n\t\treturn context.lor;\n\t}\n})();","trigger":""},{"name":"booking_days_out","polling":"all","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function(){ \n\tvar context = JSON.parse(sessionStorage.getItem('customClientContext'));\n\tif (context && context.pickupDatetime) {\n\t\tvar secondDate = new Date(context.pickupDatetime);\n\t\tvar firstDate = new Date();\n\t\treturn Math.round(Math.abs((firstDate.getTime() - secondDate.getTime())/(24*60*60*1000)));\n\t}\n})();","trigger":""},{"name":"ancillaries_selected","polling":"all","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function() {\n\tif (window.location.href.indexOf('reservation#/extras') !== -1) {\n\t\tvar selected = [];\n\t\tjQuery('.reservation-extras').find('.checkbox-custom:checked').filter( function(){\n\t\t\tselected.push(jQuery(this).attr('id').replace('chk',''));\n\t\t});\n\t\treturn (selected.length === 0) ? false : selected.join(', ');\n\t}\n})();\n","trigger":""},{"name":"ancillaries_disabled","polling":"all","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function() {\n\tif (window.location.href.indexOf('reservation#/extras') !== -1) {\n\t\tvar selected = [];\n\t\tjQuery('#vehicleTeaser').find('.reservation-extras').find('.checkbox-custom:disabled').filter( function(){\n\t\t\tselected.push(jQuery(this).attr('id').replace('chk',''));\n\t\t});\n\t\treturn (selected.length === 0) ? false : selected.join();\n\t}\n})();","trigger":""},{"name":"econ_more_standard","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function() {\n    if (window.location.href.indexOf('reservation#/extras') !== -1) {\n        var econ = jQuery('#vehicleTeaser').find('.vehicle-availability').find('.step2dtl').find('h3[ng-bind=\\'car.carGroup\\']').filter(function() {\n            return jQuery(this).text() === 'Standard';\n        }).parent().parent().parent().find('.payamntr').find('span').text();\n        var standard = jQuery('#vehicleTeaser').find('.vehicle-availability').find('.step2dtl').find('h3[ng-bind=\\'car.carGroup\\']').filter(function() {\n            return jQuery(this).text() === 'Economy';\n        }).parent().parent().parent().find('.payamntr').find('span').text();\n        return (parseInt(econ) > parseInt(standard));\n    }\n})();\n","trigger":""},{"name":"carclass_selected","polling":"none","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"(function () {\n\tvar reservation = JSON.parse(sessionStorage.getItem('ngStorage-reservationModel'));\n\tif (reservation && typeof reservation.selectedCar\t!== 'undefined' && typeof reservation.selectedCar[0] !== 'undefined'){\n\t\treturn reservation.selectedCar[0].carClass;\n\t}\n})();","trigger":""},{"name":"ibx_test","polling":"none","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"location.href.indexOf('ibx_test')>=0 || null;","trigger":""},{"name":"cart","polling":"none","persist":"permanent","page_types":[],"testmode":false,"default":"false","code":"null;","trigger":""},{"name":"private_safari","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"sessionStorage.length === 0;","trigger":""},{"name":"two_pay_options","polling":"all","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"(function() {\n\tif (window.location.href.indexOf('/vehicles') > -1) {\n\t\treturn jQuery('#res-vehicles-pay-later').length > 0 && jQuery('#res-vehicles-pay-now').length > 0;\n\t}\n})();","trigger":""},{"name":"mag_branch","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function() {\n\tvar context = JSON.parse(sessionStorage.getItem('customClientContext'));\n\tif (context && context.pul) {\n\t\tvar magBranchCodes = ['MCO','TPA','DEN','PHX','LAX','FLL','DAL','MDW','BWI','HOU','RSW','OAK','SMF','BNA','SJC','ABQ','ONT','STL','SEA','PDX'];\n\t\treturn magBranchCodes.indexOf(context.pul) > -1;\n\t}\n})();","trigger":""},{"name":"ancillary_requested","polling":"none","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"null;","trigger":""},{"name":"tab_branch","polling":"none","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"(function () {\n\tvar productList = JSON.parse(sessionStorage.getItem('ngStorage-productList'));\n\tif (productList && productList.length > 0){\n\t\tfor (var i = 0; i < productList.length; i++) {\n\t\t\tif (typeof productList[i].code !== 'undefined' && productList[i].code === 'TAB') {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n})();","trigger":""},{"name":"biz_traveler","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function(){ \n\tvar context = JSON.parse(sessionStorage.getItem('customClientContext'));\n\tif (context && context.pickupDatetime && context.dropoffDatetime) {\n\t\tvar pickupDay = new Date(context.pickupDatetime).getDay();\n\t\tvar dropoffDay = new Date(context.dropoffDatetime).getDay();\n\t\tif ( ( 0 < pickupDay && pickupDay < 6 ) && ( 0 < dropoffDay && dropoffDay < 6 ) ) {\n\t\t\treturn true;\n\t\t}\n\t}\n})();","trigger":""},{"name":"awd_applied","polling":"all","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function() {\n  /* car selection page */\n  var context = JSON.parse(sessionStorage.getItem('customClientContext'));\n  var discountNumberVisible = context && context.discountNumber && context.discountNumber.length > 0;\n  /* home and reservation pages */\n  var discountInput = jQuery('#AWD, #awd').first().val();\n  var discountInputApplied = discountInput ? discountInput.length > 0 : false;\n  var awdApplied = /(?!AWD:)\\w+?\\d+/.test(jQuery('.discount-summary-section:contains(AWD)').text());\n\n  return discountNumberVisible || discountInputApplied || awdApplied || false;\n})();","trigger":""},{"name":"weekend_traveler","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function(){ \n    var context = JSON.parse(sessionStorage.getItem('customClientContext'));\n    if (context && context.pickupDatetime && context.dropoffDatetime) {\n        var pickupDay = new Date(context.pickupDatetime).getDay();\n        var dropoffDay = new Date(context.dropoffDatetime).getDay();\n        if ( ( pickupDay === 0 || pickupDay === 6 ) && ( dropoffDay === 0 || dropoffDay === 6 ) ) {\n            return true;\n        }\n    }\n})();","trigger":""},{"name":"onsite_submit","polling":"none","persist":"permanent","page_types":[],"testmode":false,"default":"false","code":"(window.location.pathname.indexOf('/offers/') !== -1 && bouncex.ibx._getparam('flag', window.location.hash).toLowerCase() === \"success\");","trigger":""},{"name":"corp_awd_applied","polling":"all","persist":"permanent","page_types":[],"testmode":false,"default":"false","code":"(function () {\n\tvar reservation = JSON.parse(sessionStorage.getItem('ngStorage-reservationModel'));\n\tif (reservation && typeof reservation.corporateAWD !== 'undefined' && reservation.corporateAWD){\n\t\treturn reservation.corporateAWD;\n\t}\n})();","trigger":""},{"name":"ancillary_selected_confirmation","polling":"all","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function () {\n\tvar reservation = JSON.parse(sessionStorage.getItem('ngStorage-reservationModel'));\n\tif (reservation && typeof reservation.selectedInsurances !== 'undefined' && typeof reservation.selectedProducts !== 'undefined') {\n\t\tvar insurances = reservation.selectedInsurances;\n\t\tvar products = reservation.selectedProducts;\n\t\tvar ret = [];\n\t\tfor (var i = 0; i < products.length; i++) {\n\t\t\tif( products[i].code !== 'undefined' ) {\n\t\t\t\tret.push(products[i].code);\n\t\t\t}\n\t\t}\n\t\tfor (var j = 0; j < insurances.length; j++) {\n\t\t\tif( insurances[j].code !== 'undefined' ) {\n\t\t\t\tret.push(insurances[j].code);\n\t\t\t}\n\t\t}\n\t\tif (ret.length > 0) {\n\t\t\treturn ret.join();\n\t\t}\n\t}\n})();","trigger":""},{"name":"ancillary_disabled_confirmation","polling":"all","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function(){\n\tvar productList = JSON.parse(sessionStorage.getItem('ngStorage-productList'));\n\tvar insuranceList = JSON.parse(sessionStorage.getItem('ngStorage-insuranceList'));\n\tif (productList && insuranceList) {\n\t\tvar ancillaries = productList.concat(insuranceList);\n\t\tvar disabledAncillaries = [];\n\t\tfor (var i = 0; i < ancillaries.length; i++) {\n\t\t\tif (ancillaries[i].disabled === true) {\n\t\t\t\tdisabledAncillaries.push(ancillaries[i].code);\n\t\t\t}\n\t\t}\n\t\tif (disabledAncillaries.length > 0) {\n\t\t  return disabledAncillaries.join();\n\t\t}\n\t}\n})();","trigger":""},{"name":"res_passed","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"null;","trigger":""},{"name":"search_date","polling":"all","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function() {\n    var $pickUpDateField = jQuery('[message-id=fDate]');\n    \n    if ($pickUpDateField.length > 0 && $pickUpDateField.val()) {\n        var pickUpDateString = $pickUpDateField.val();\n        var pickUpDate = new Date(pickUpDateString);\n        var textMonths = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n        var month = textMonths[pickUpDate.getMonth()];\n        var dayOfMonth = pickUpDate.getDate().toString();\n        var ordinalSuffix=(function(day){\n          switch(day){\n            case '1': case '21': case '31':\n              return 'st';\n            case '2': case '22':\n              return 'nd';\n            case '3': case '23':\n              return 'rd';\n            default:\n              return 'th';\n          }\n        })(dayOfMonth);\n    return month + ' ' + dayOfMonth + ordinalSuffix;\n  }\n})()","trigger":""},{"name":"valid_wizard_num","polling":"all","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"(function() {\n  var reservation = JSON.parse( sessionStorage.getItem(\"ngStorage-reservationModel\"));\n  if ( reservation && typeof reservation.WizardNumberUnmasked !== \"undefined\" && reservation.WizardNumberUnmasked) {\n    return reservation.WizardNumberUnmasked.length > 0;\n  }\n})();\n","trigger":""},{"name":"todays_date","polling":"none","persist":"no","page_types":[],"testmode":false,"default":0,"code":"(function(){\n  var textMonths = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n  var today = new Date();\n  var month = textMonths[today.getMonth()];\n  var dayOfMonth = today.getDate().toString();\n  var ordinalSuffix = (function(day){\n    switch(day){\n      case '1': case '21': case '31':\n        return 'st';\n      case '2': case '22':\n        return 'nd';\n      case '3': case '23':\n        return 'rd';\n      default:\n        return 'th';\n    }\n  })(dayOfMonth);\n  \n  return month + ' ' + dayOfMonth + ordinalSuffix;\n})();","trigger":""},{"name":"pickup_location","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"jQuery('.source .location-info').contents().filter(function(){return this.nodeType == 3}).text().trim().replace(/\\s+/g, ' ');","trigger":""},{"name":"pickup_date_time","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"jQuery('.source .day-time-info').text().trim();","trigger":""},{"name":"length_of_rental_hrs","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"0","code":"(function(){\n\tvar parsed = JSON.parse(sessionStorage.getItem('customClientContext'));\n\tvar startD = parsed.pickupDatetime.replace('T', ' ');\n\tvar endD = parsed.dropoffDatetime.replace('T', ' ');\n\tvar d = Date.parse(startD)\n\tvar d1 = Date.parse(endD)\n\treturn (d1 - d)/36e5;\n})();","trigger":""},{"name":"dropoff_location","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"jQuery('.destination .location-info').contents().filter(function(){return this.nodeType == 3}).text().trim().replace(/\\s+/g, ' ');","trigger":""},{"name":"pickupdropoff_pair","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function(){\n  var parsed = JSON.parse(sessionStorage.getItem('customClientContext'));\n  if(parsed.dol !== undefined){\n    return parsed.pul + \",\"+ parsed.dol;\n  }else{\n    return false;\n  }\n})();","trigger":""},{"name":"ldw_price","polling":"none","persist":"no","page_types":[],"testmode":false,"default":"0","code":"jQuery('.extra-package-lists:contains(\"Cover The Car (LDW)\")').find('.costPerday').text();","trigger":"pageload"},{"name":"pickup_location_polling","polling":"all","persist":"visit","page_types":[],"testmode":false,"default":"","code":"jQuery('#PicLoc_value').val().match(/.*\\(([^\\]\\[]*)\\)/) ? jQuery('#PicLoc_value').val().match(/.*\\(([^\\]\\[]*)\\)/)[1] : null;","trigger":""},{"name":"dropoff_location_polling","polling":"all","persist":"visit","page_types":[],"testmode":false,"default":"","code":"jQuery('#DropLoc_value').val().match(/.*\\(([^\\]\\[]*)\\)/)  ? jQuery('#DropLoc_value').val().match(/.*\\(([^\\]\\[]*)\\)/) [1] : null;","trigger":""},{"name":"vehicle_selected_price","polling":"all","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"jQuery('.col-sm-5.summary .pull-right').first().text().replace(/[^0-9\\.]/g,'') || null;","trigger":""},{"name":"lowest_price_vehicle","polling":"all","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"(function(){\n  var vehiclePrices = jQuery('.paynow.col-xs-6 price'),\n      price = [];\n      \n  vehiclePrices.each(function(){\n\t  price.push(jQuery(this).text().replace(/[^0-9\\.]/g,''));\n  });\n  \n  price.sort(function(a,b){\n  \treturn a -b;\n  });\n  \n  return price[0];\n})();","trigger":""},{"name":"coupon_code_applied","polling":"all","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"(function(){\n    if(window.location.href.indexOf('reservation#/time-and-place') > -1){\n        return jQuery('#coupon').val() && !jQuery('.platform-error-message.error:contains(\"Your discount code is invalid\")').is(':visible') ? true : false;\n    }\n    return null;\n})();","trigger":""},{"name":"awd_type","polling":"none","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"bouncex.utils.gtmLookup('discountNumberType') || null;","trigger":"pageload"},{"name":"searchdate_date","polling":"all","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"(function(){\n    var $date = jQuery('.ui-datepicker-startdate').closest('td'),\n        month = Number($date.attr('data-month')) + 1,\n        day = $date.text().length === 1 ? '0' + $date.text() : $date.text();\n    return $date.length > 0 ? Number($date.attr('data-year') + (month >= 10 ? month : '0' + month ) + day) : null;\n})();","trigger":"pageload"},{"name":"pickup_state","polling":"all","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"bouncex.utils.gtmLookup('pulstate') || null;","trigger":"pageload"},{"name":"num_viewing_nonstatic","polling":"none","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"Math.floor(Math.random() * (90-50+1)) + 50;","trigger":"pageload"},{"name":"airport_pickup_location","polling":"all","persist":"no","page_types":[],"testmode":false,"default":"false","code":"(function() {\n    var airportFlag = window.google_tag_manager && gtmid && google_tag_manager[gtmid] && google_tag_manager[gtmid].dataLayer.get('airpflag');\n    \n    if(airportFlag === 'Airport Location') {\n        picLocText = !!jQuery('#PicLoc_value').val() ? jQuery('#PicLoc_value').val() : google_tag_manager[gtmid].dataLayer.get('Successful location searches');\n\n        if(picLocText) {\n            picLocSplit = picLocText.split(',');\n            if (picLocSplit) {\n                return picLocSplit[0].replace(/\\b(?:apo|airprt|airpt)\\b/i, 'Airport');\n            }\n        } \n\n        var $location = jQuery('.source .location-info');\n        if($location.length > 0 && !jQuery('.modal-popup.reservation-modal.renter-summary-detail').is(':visible')) {\n            var locationSplit = $location.text().split(',');\n            return locationSplit.length > 0 ? locationSplit[0].trim().replace(/\\b(?:apo|airprt)\\b/i, 'Airport') : false;\n        }\n    }\n\treturn false;\n})();","trigger":"pageload"},{"name":"awd_number","polling":"all","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"jQuery('#awd').val() || null;","trigger":"pageload"},{"name":"drop_off_date","polling":"all","persist":"visit","page_types":[],"testmode":false,"default":"false","code":"(function() {\n  var returnDate = jQuery('input#to').val();\n\n  if (returnDate.length) {\n    var dateArr = returnDate.split('/'), year = dateArr[2], month = dateArr[0], day = dateArr[1];\n    return year+month+day;\n  }\n\n  return null;\n})();","trigger":"pageload"},{"name":"coupon_applied","polling":"all","persist":"no","page_types":[],"testmode":false,"default":"false","code":"!!JSON.parse(window.sessionStorage.getItem(\"customClientContext\")).coupon || jQuery('#coupon.ng-not-empty.ng-valid').length > 0;","trigger":"pageload"}],"dgu":"pixel.cdnwidget.com","dgp":false,"ba":{"enabled":0,"fbte":0},"biu":"assets.bounceexchange.com","bau":"api.bounceexchange.com","beu":"events.bouncex.net","ibx":{"tjs":"/*\nKK: validateItem is altered to not need itemUrl (there are none for cars)\ncart.init is altered to override update cart (need extra metadata on cart even)\ntrackItem altered to auto save items into localStorage for ISR\n */\n\nbouncex.util = {\n\n\taddNamespace: function(obj, name) {\n\t\tvar namespacedObj = {};\n\t\tfor (var k in obj) {\n\t\t\tif (obj.hasOwnProperty(k)) {\n\t\t\t\tvar namespacedKey = k;\n\t\t\t\tif (k.indexOf(':') === -1) {\n\t\t\t\t\tnamespacedKey = name + ':' + k;\n\t\t\t\t}\n\t\t\t\tnamespacedObj[namespacedKey] = obj[k];\n\t\t\t}\n\t\t}\n\t\treturn namespacedObj;\n\t},\n\n\tgetOrigin: function() {\n\t\treturn window.location.origin || window.location.protocol + '//' + window.location.hostname + (window.location.port ? (':' + window.location.port) : '');\n\t},\n\n\t//copied from bouncex.ibx\n\tgetParam: function(name, qstring) {\n\t\tvar param_string = qstring ? ('?' + qstring) : window.location.href;\n\t\tname = name.replace(/[\\[]/,\"\\\\\\[\").replace(/[\\]]/,\"\\\\\\]\");\n\t\tvar regexS = \"[\\\\?&#]\"+name+\"=([^&#]*)\";\n\t\tvar regex = new RegExp( regexS );\n\t\tvar results = regex.exec( param_string );\n\t\tif( results == null ) return \"\";\n\t\telse return decodeURIComponent(results[1]);\n\t},\n\n\tgetTimeMs: function() {\n\t\treturn (new Date().getTime());\n\t},\n\n\tisValidInteger: function(val) {\n\t\t// returns true for 0, '0', 1, '1'. False for '', undefined\n\t\treturn !isNaN(parseInt(val));\n\t},\n\n\t//copied from bouncex.ibx\n\tisValidEmail: function(email) {\n\t\tvar regex = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n\t\treturn regex.test(email);\n\t},\n\n\tisValidUrl: function(url, type) {\n\t\t//JKMD: type could differentiate between absolute/relative, allow mailto links, etc\n\t\tvar regex = /^(http|https):\\/\\/(([a-zA-Z0-9$\\-_.+!*'(),;:&=]|%[0-9a-fA-F]{2})+@)?(((25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])(\\.(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])) {3})|localhost|([a-zA-Z0-9\\-\\u00C0-\\u017F]+\\.)+([a-zA-Z]{2,}))(:[0-9]+)?(\\/(([a-zA-Z0-9$\\-_.+!*'(),;:@&=]|%[0-9a-fA-F]{2})*(\\/([a-zA-Z0-9$\\-_.+!*'(),;:@&=]|%[0-9a-fA-F]{2})*)*)?(\\?([a-zA-Z0-9$\\-_.+!*'(),;:@&=\\/?]|%[0-9a-fA-F]{2})*)?(\\#([a-zA-Z0-9$\\-_.+!*'(),;:@&=\\/?]|%[0-9a-fA-F]{2})*)?)?$/;\n\t\treturn regex.test(url);\n\t},\n\n\tmakeQuerystring: function(o) {\n\t\tvar a=[],s='';\n\t\tfor(var k in o) {\n\t\t\tif(!o.hasOwnProperty(k)) continue;\n\t\t\ta.push(k+'='+encodeURIComponent(o[k]));\n\t\t}\n\t\treturn a.join('&');\n\t},\n\n\tmergeObject: function () {\n\t\tvar o = {};\n\t\tfor (var k in arguments) {\n\t\t\tvar a = arguments[k];\n\t\t\tif (typeof a == 'object') {\n\t\t\t\tfor (var k in a) {\n\t\t\t\t\tif (a.hasOwnProperty(k)) o[k] = a[k];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn o;\n\t}\n};\n\nbouncex.util.cookies = {\n\n\tdomain: window.bouncex.cookie_domain,\n\n\tcreate: function(obj){\n\t\tdefaults = {\n\t\t\tname : '',\n\t\t\tvalue : '',\n\t\t\tdomain : false,\n\t\t\tdays : 14\n\t\t};\n\t\tobj = bouncex.util.mergeObject(defaults, obj);\n\n\t\tif (!obj.name || !obj.value) { return false; }\n\n\t\tvar date = new Date();\n\t\tdate.setTime(date.getTime() + obj.days * 24 * 60 * 60 * 1e3);\n\t\tvar exp = '; expires=' + date.toGMTString();\n\n\t\tvar cookieString = obj.name + '=' + obj.value + exp + '; path=/;';\n\t\tif (obj.domain){\n\t\t\tcookieString += 'domain=' + obj.domain + ';';\n\t\t}\n\t\tdocument.cookie = cookieString;\n\t},\n\n\tdestroy: function (name) {\n\t\tthis.create({\n\t\t\tname : name,\n\t\t\tdays : -1,\n\t\t});\n\t},\n\n\tread: function (name) {\n\t\t//return this.multi.get(name);\n\t\tvar t = name + \"=\", vars = document.cookie.split(\";\");\n\t\tfor (var r = 0; r < vars.length; r++) {\n\t\t\tvar i = vars[r];\n\t\t\twhile (i.charAt(0) == \" \")i = i.substring(1, i.length);\n\t\t\tif (i.indexOf(t) == 0)return i.substring(t.length, i.length);\n\t\t}\n\t\treturn null;\n\t}\n};\n\n// if utk is already defined persist whatever listeners it has before wipe\nvar previousListeners = bouncex.utk && bouncex.utk.listeners;\n\nbouncex.utk = {\n\t\n\tlisteners: previousListeners || {},\n\n\taddMetadata: function(obj) {\n\t\tvar m = this.getMetadata();\n\t\treturn bouncex.util.mergeObject(obj, m);\n\t},\n\n\tgetMetadata: function() {\n\t\treturn {\n\t\t\t'page:type': this.getPageType(),\n\t\t\t'customer:hasconverted': (bouncex.cookie.lc?1:0)\n\t\t};\n\t},\n\n\tgetPageType: function() {\n\t\treturn \"\";\n\t},\n\n\thoverItem: function(obj) {\n\t\tvar defaults = {\n\t\t\teventName: 'hover item',\n\t\t\titemTracking: false,\n\t\t\tselector: '',\n\t\t\tmaxItems: 5,\n\t\t\ttimeoutMs: 1000,\n\t\t\tgetItemData: function(el) { return null; },\n\t\t};\n\n\t\tobj = bouncex.util.mergeObject(defaults, obj);\n\n\t\t//validation here\n\t\tif (!obj.selector) { return null; }\n\n\t\t//register the tracker\n\t\tobj.stop = removeHoverTracking;\n\t\tvar trackerId = bouncex.utk.register(obj);\n\t\tvar timeout;\n\t\tvar ids = [];\n\n\t\tfunction onMouseenter() {\n\t\t\tclearTimeout(timeout);\n\t\t\tvar el = this;\n\t\t\ttimeout = setTimeout(function() {\n\t\t\t\tvar item = obj.getItemData(el);\n\t\t\t\tif (!item.id) { return; }\n\t\t\t\t//if not already tracked\n\t\t\t\tif (ids.indexOf(item.id) === -1) {\n\t\t\t\t\t//add id to list of tracked items\n\t\t\t\t\tids.push(item.id);\n\t\t\t\t\t//track the event\n\t\t\t\t\tvar itemEventData = { eventName: obj.eventName, item: item };\n\t\t\t\t\tbouncex.utk.trackItemInteraction(itemEventData);\n\t\t\t\t\t//track the item\n\t\t\t\t\tif (obj.itemTracking) {\n\t\t\t\t\t\tbouncex.utk.trackItem(item);\n\t\t\t\t\t}\n\t\t\t\t\t//check limits\n\t\t\t\t\tif (ids.length >= obj.maxItems) {\n\t\t\t\t\t\tremoveHoverTracking();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, obj.timeoutMs);\n\t\t}\n\n\t\tfunction onMouseleave() {\n\t\t\tclearTimeout(timeout);\n\t\t}\n\n\t\tfunction addHoverTracking() {\n\t\t\tjQuery(document).on('mouseenter.bx-tracking-hover.' + trackerId, obj.selector, onMouseenter);\n\t\t\tjQuery(document).on('mouseleave.bx-tracking-hover.' + trackerId, obj.selector, onMouseleave);\n\t\t}\n\n\t\tfunction removeHoverTracking() {\n\t\t\tjQuery(document).off('mouseenter.bx-tracking-hover.' + trackerId);\n\t\t\tjQuery(document).off('mouseleave.bx-tracking-hover.' + trackerId);\n\t\t\tclearTimeout(timeout);\n\t\t}\n\n\t\taddHoverTracking();\n\t\treturn trackerId;\n\t},\n\n\tisIdentified: function(){\n\t\treturn !!(bouncex.cookie.uid || bouncex.getBounceCookie('__ibxu'));\n\t},\n\n\tquickviewItem: function(obj) {\n\t\tvar defaults = {\n\t\t\teventName: 'view item',\n\t\t\titemTracking: false,\n\t\t\tselector: '',\n\t\t\tgetItemData: function(el) { return null; }\n\t\t};\n\n\t\tobj = bouncex.util.mergeObject(defaults, obj);\n\t\t//validation here\n\t\tif (!obj.selector) { return null; }\n\n\t\tvar prevVisible = false,\n\t\t\tvisible;\n\n\t\treturn bouncex.utk.setInterval({\n\t\t\tcallback: function() {\n\t\t\t\tvisible = jQuery(obj.selector).is(':visible');\n\t\t\t\tif (visible && !prevVisible) {\n\t\t\t\t\tvar item = obj.getItemData(obj.selector);\n\n\t\t\t\t\tvar itemEventData = { eventName: obj.eventName, item: item };\n\t\t\t\t\tbouncex.utk.trackItemInteraction(itemEventData);\n\t\t\t\t\t//track the item\n\t\t\t\t\tif (obj.itemTracking) {\n\t\t\t\t\t\tbouncex.utk.trackItem(item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tprevVisible = visible;\n\t\t\t}\n\t\t});\n\t},\n\n\trequestEmail: function(obj) {\n\t\t//JKMD: bouncex.push right now automatically adds namespacing, which would mess up \"campaignid\"\n\t\tparams = {};\n\t\tfor (var k in obj) {\n\t\t\tif (obj.hasOwnProperty(k)){\n\t\t\t\tparams[k.toLowerCase()] = obj[k];\n\t\t\t}\n\t\t}\n\t\tevent_stream_report('requestemail', params);\n\t},\n\n\t//JKMD: long-term plan is to put all of our polling into a single setInterval\n\tsetInterval: function(obj) {\n\t\tvar defaults = {\n\t\t\tmilliseconds: 1000,\n\t\t\tcallback: function() { return null; }\n\t\t};\n\t\tobj = bouncex.util.mergeObject(defaults, obj);\n\t\tvar intervalId = setInterval(obj.callback, obj.milliseconds);\n\n\t\tobj.stop = removeInterval;\n\t\tvar trackerId = bouncex.utk.register(obj);\n\t\tfunction removeInterval() {\n\t\t\tclearInterval(intervalId);\n\t\t}\n\t\treturn trackerId;\n\t},\n\n\ttrackItem: function(item) {\n\t\tif (typeof(item.id) === 'string'){\n\t\t\titem.id = item.id.trim().toLowerCase();\n\t\t}\n\t\tif (!this.validateItem(item)) {\n\t\t\t//bouncex.log('item failed validation', item);\n\t\t\treturn false;\n\t\t}\n\t\t//save items for ISR\n\t\ttry {\n\t\t\tvar savedItems = JSON.parse(localStorage.getItem('bxTracked')) || [];\n\t\t\tsavedItems.push(item);\n\t\t\tlocalStorage.setItem('bxTracked',JSON.stringify(savedItems));\n\t\t} catch(e){}\n\t\titem = bouncex.util.addNamespace(item, 'item');\n\t\tbouncex.push(['item', item]);\n\t},\n\n\ttrackItemInteraction: function(obj) {\n\t\tvar id = obj.item.id;\n\t\tif (typeof(id) === 'string'){\n\t\t\tid = id.trim().toLowerCase();\n\t\t}\n\t\tvar o = { 'item:id': id };\n\t\to = this.addMetadata(o);\n\t\tbouncex.push([obj.eventName, o]);\n\t},\n\n\ttrackListPage: function(obj){\n\t\tvar defaults = {\n\t\t\teventName: 'view ' + this.getPageType(),\n\t\t\tmaxItems: 6,\n\t\t\tselector: '',\n\t\t\ttitle: '',\n\t\t\turl: jQuery('link[rel=canonical]').attr('href') || window.location.href.split('?')[0],\n\t\t\titemTracking : false,\n\t\t\tgetItemData: function(el) { return null;},\n\t\t\textraEventData: {}\n\t\t};\n\n\t\tobj = bouncex.util.mergeObject(defaults, obj);\n\n\t\tvar items = jQuery(obj.selector);\n\t\tif (!items || !items.length){\n\t\t\treturn false;\n\t\t}\n\t\tvar itemsTracked = 0;\n\t\tvar itemIds = [];\n\t\tfor (var i = 0; i < items.length && itemsTracked < obj.maxItems; i++) {\n\t\t\tvar item = obj.getItemData(items[i]);\n\t\t\tif (item.id){\n\t\t\t\tif (typeof(item.id) === 'string'){\n\t\t\t\t\titem.id = item.id.trim().toLowerCase();\n\t\t\t\t}\n\t\t\t\t// add id to list\n\t\t\t\titemIds.push(item.id);\n\t\t\t\tif (obj.itemTracking){\n\t\t\t\t\t//track full item\n\t\t\t\t\tthis.trackItem(item);\n\t\t\t\t}\n\t\t\t\titemsTracked++;\n\t\t\t}\n\t\t}\n\n\t\tvar o = {'items:ids' : itemIds.join(','), 'page:url' : obj.url};\n\t\tif (obj.title){\n\t\t\to['page:title'] = obj.title;\n\t\t}\n\t\to = this.addMetadata(o);\n\t\to = bouncex.util.mergeObject(o, obj.extraEventData);\n\t\tbouncex.push([obj.eventName, o]);\n\t},\n\n\ttrackUser: function(user) {\n\t\tif (!user.email && !user.emailHash) {\n\t\t\treturn false;\n\t\t}\n\t\tif (user.email && !bouncex.util.isValidEmail(user.email)){\n\t\t\treturn false;\n\t\t}\n\t\tvar params = bouncex.util.addNamespace(user, 'user');\n\t\tif (user.email) {\n\t\t\tparams['user:email'] = user.email;\n\t\t}\n\t\tif (user.emailHash) {\n\t\t\tparams['user:emailhash'] = user.emailHash;\n\t\t}\n\t\tif (user.campaignId) {\n\t\t\tparams['campaignid'] = user.campaignId;\n\t\t}\n\t\tparams['user:gcr'] = (bouncex && bouncex.cookie) ? bouncex.cookie.gcr : 99;\n\t\tparams['agent'] = 'js';\n\t\tparams['eq'] = 1;\n\n\t\tevent_stream_report('user', params);\n\n\t\tbouncex.cookie.uid = 1;\n\t\tsetBounceCookie();\n\t\t//legacy support\n\t\tbouncex.util.cookies.create({\n\t\t\tname: '__ibxu',\n\t\t\tvalue : '1',\n\t\t\tdomain : '.' + bouncex.util.cookies.domain,\n\t\t\tdays : 365,\n\t\t});\n\n\t},\n\n\tvalidateItem: function(item) {\n\t\tif (!item) { return false; }\n\t\tif (!item.id) { return false; }\n\t\tif (!item.copy) { return false; }\n\t\tif (!item.imageurl || !bouncex.util.isValidUrl(item.imageurl)) { return false; }\n\t\t// if (!item.url || !bouncex.util.isValidUrl(item.url)) { return false; }\n\t\treturn true;\n\t},\n\n\tviewItem: function(obj) {\n\t\tvar defaults = {\n\t\t\teventName: 'view item',\n\t\t\titemTracking: true,\n\t\t\tgetItemData: function() { return null; }\n\t\t};\n\n\t\tobj = bouncex.util.mergeObject(defaults, obj);\n\n\t\tvar item = obj.getItemData();\n\n\t\tif (obj.itemTracking) {\n\t\t\tthis.trackItem(item);\n\t\t}\n\n\t\tif (item.id) {\n\t\t\tvar itemEventData = { eventName: obj.eventName, item: item };\n\t\t\tbouncex.utk.trackItemInteraction(itemEventData);\n\t\t} else {\n\t\t\t//bouncex.log('no item id', obj.eventName, item);\n\t\t}\n\t},\n\n\t//keeping track of the listeners inside tracking\n\tregister: function(obj) {\n\t\tvar id = bouncex.util.getTimeMs() + Math.random();\n\t\tbouncex.utk.listeners[id] = obj;\n\t\treturn id;\n\t},\n\n\t//remove single tracker\n\tstop: function(id) {\n\t\tif (bouncex.utk.listeners.hasOwnProperty(id)) {\n\t\t\tbouncex.utk.listeners[id].stop();\n\t\t\tdelete bouncex.utk.listeners[id];\n\t\t}\n\t},\n\n\t//remove all listeners\n\tstopAll: function() {\n\t\tfor (var id in bouncex.utk.listeners) {\n\t\t\tbouncex.utk.stop(id);\n\t\t}\n\t}\n};\n\nbouncex.utk.cart = {\n\n\tgetCart: function() {\n\t\tif (this.state) {\n\t\t//cached here once we look it up or save\n\t\t\treturn this.state;\n\t\t}else if (this.config.storeCartVariable && bouncex.vars[this.config.storeCartVariable]) {\n\t\t//look up from cvar if it exists\n\t\t\tthis.state = JSON.parse(bouncex.vars[this.config.storeCartVariable]);\n\t\t\treturn this.state;\n\t\t}else {\n\t\t\treturn {};\n\t\t}\n\t},\n\n\tgetCount: function(){\n\t\treturn bouncex.vars[this.config.cartCountVariable];\n\t},\n\n\tinferCount: function(cart) {\n\t\t// return cart.count if specified and valid\n\t\tif (bouncex.util.isValidInteger(cart.count)) {\n\t\t\treturn parseInt(cart.count);\n\t\t} else if (cart.items) {\n\t\t\t// deduce from items length (using qty property if specified)\n\t\t\tvar count = 0;\n\t\t\tfor (var i = 0; i < cart.items.length; i++) {\n\t\t\t\tvar qty = parseInt(cart.items[i].qty) || 1;\n\t\t\t\tcount += qty;\n\t\t\t}\n\t\t\treturn count;\n\t\t}else if (bouncex.util.isValidInteger(this.getCount())){\n\t\t\treturn parseInt(this.getCount());\n\t\t}else{\n\t\t\treturn 0;\n\t\t}\n\t},\n\n\tinit: function(obj) {\n\t\tvar defaults = {\n\t\t\t// lastReplenishment: false,\n\t\t\tstoreCartVariable: 'cart',\n\t\t\tcartCountVariable: 'cart_qty',\n\t\t\tmaxVariableSize: 400,\n\t\t\tstoreValues: ['count', 'items'],\n\t\t\tmaxItems: 10\n\t\t};\n\t\tobj = bouncex.util.mergeObject(defaults, obj);\n\t\tthis.config = obj;\n\n\t\t//JKMD: should we do this via init, or just override explicitly...?\n\t\tthis.update = obj.update || this.update;\n\t\tthis.replenish = obj.replenish || this.replenish;\n\t\tthis.validateReplenishment = obj.validateReplenishment || this.validateReplenishment;\n\t\tthis.reportReplenishment = obj.reportReplenishment || this.reportReplenishment;\n\n\t\tthis.reportReplenishment();\n\t\tthis.initFromQuerystring();\n\t},\n\n\tinitFromQuerystring: function() {\n\t\tvar bx_cart = bouncex.util.getParam('bx_cart');\n\t\tvar ibx_cart = bouncex.util.getParam('ibx_cart');\n\t\tvar legacy = false;\n\t\tvar cart = {};\n\n\t\tif (bx_cart) {\n\t\t\t//JKMD: support base64\n\t\t\tif (bx_cart.charAt(0) !== '{') {\n\t\t\t\tbx_cart = atob(bx_cart);\n\t\t\t}\n\t\t\tcart = JSON.parse(bx_cart);\n\t\t} else if (ibx_cart) {\n\t\t\tcart = { value: ibx_cart };\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.validateReplenishment(cart)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.save(cart);\n\t\treturn this.replenish(cart);\n\t},\n\n\treplenish: function(cart) {\n\t\treturn null;\n\t},\n\n\tsave: function(cart) {\n\t\tif (!cart) { return false; }\n\t\tthis.state = cart;\n\t\tif (this.config.storeCartVariable) {\n\t\t\tvar storedCart = {};\n\t\t\tif (cart.count === 0) {\n\t\t\t\t// if count is 0, don't store any other info\n\t\t\t\tstoredCart = { count: 0 };\n\t\t\t}else{\n\t\t\t\t//store values specified in settings\n\t\t\t\tfor (var i = 0; i < this.config.storeValues.length; i++) {\n\t\t\t\t\tvar k = this.config.storeValues[i];\n\t\t\t\t\tif (cart.hasOwnProperty(k)) {\n\t\t\t\t\t\tstoredCart[k] = cart[k];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar cartString = JSON.stringify(storedCart);\n\t\t\tif (cartString.length <= this.config.maxVariableSize) {\n\t\t\t\tbouncex.setv(this.config.storeCartVariable, cartString);\n\t\t\t\tsetBounceCookie();\n\t\t\t}\n\t\t}\n\t},\n\n\ttrack: function(cart) {\n\t\tvar trackCart = bouncex.util.mergeObject(cart);\n\t\tif (trackCart.items) trackCart.items = JSON.stringify(trackCart.items);\n \t\tif (trackCart.ids) trackCart.ids = trackCart.ids.join(',');\n\t\ttrackCart = bouncex.util.addNamespace(trackCart, 'cart');\n\t\tbouncex.push(['cart', trackCart]);\n\t},\n\n\tupdate: function (obj) {\n\t\tvar cart = {};\n\n\t\tif (obj.newItem) {\n\t\t\t//if partial, merge new item with stored items\n\t\t\tvar oldCart = this.getCart();\n\t\t\tvar allItems = oldCart.items || [];\n\t\t\tallItems.push(obj.newItem);\n\t\t\tobj.items = allItems;\n\t\t}\n\n\t\t// pass relevant properties to cart\n\t\tcart.count = obj.count;\n\t\tif (obj.items && obj.items.length) { cart.items = obj.items; }\n\t\tif (obj.ids && obj.ids.length) { cart.ids = obj.ids; }\n\t\tif (obj.token) { cart.token = obj.token; }\n\t\tif (obj.value) { cart.value = obj.value; }\n\n\n\t\t//set count\n\t\tcart.count = this.inferCount(cart);\n\n\t\t// remove items from beginning of items array if over limit\n\t\tif (this.config.maxItems && cart.items && cart.items.length > this.config.maxItems) {\n\t\t\tcart.items = cart.items.slice(cart.items.length - this.config.maxItems);\n\t\t}\n\n\t\t//auto parse ids from items variable if no ids specified\n\t\tif (!cart.ids && cart.items) {\n\t\t\tcart.ids = [];\n\t\t\tfor (var i = 0; i < cart.items.length; i++) {\n\t\t\t\tif (cart.items[i].id) {\n\t\t\t\t\tcart.ids.push(cart.items[i].id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// save in cart.state, and in cvar if specified\n\t\tthis.save(cart);\n\t\t//track cart\n\t\tthis.track(cart);\n\t\t//fire add to cart event if new item or addToCart flag\n\t\tif (obj.newItem || obj.addToCart){\n\t\t\tbouncex.push(['add to cart', bouncex.utk.getMetadata()]);\n\t\t}\n\t},\n\n\tvalidateReplenishment: function(cart) {\n\t\tvar cartCount = bouncex.utk.cart.getCount();\n\t\tif (bouncex.util.isValidInteger(cartCount) && cartCount > 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!cart) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!cart.value && !cart.token && !cart.items) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\treportReplenishment: function() {\n\t\tvar bx_replen = bouncex.util.getParam('bx_replen');\n\t\tif (bx_replen) {\n\t\t\tsetTimeout(function(){\n\t\t\t\tvar cartCount = bouncex.utk.cart.getCount();\n\t\t\t\tbouncex.push(['cart replenish', {'cart:count': cartCount, 'cart:success': cartCount > 0}]);\n\t\t\t}, 1100);\n\t\t}\n\t}\n};\n\n\n/* SITE SPECIFIC */\n\nbouncex.utk.getUserCountry = function() {\n\tif ( sessionStorage.customClientContext) {\n\t\treturn JSON.parse(sessionStorage.customClientContext).geoLocationCountry;\n\t}\n\treturn false;\n};\n\nbouncex.utk.getPageType = function() {\n\tif (window.location.href.indexOf('/reservation#') > -1) {\n\t\tvar hash = window.location.hash;\n\t\tif ( hash.indexOf('vehicles') > -1 || hash.indexOf('extras') > -1 || hash.indexOf('review-and-book') > -1) {\n\t\t\treturn 'reservation';\n\t\t}\n\t}\n};\n\n\nbouncex.utk.createDeeplink = function(track) {\n\tvar reservationInfo;\n\tif ( sessionStorage['ngStorage-reservationModel'] ) {\n\t\treservationInfo = JSON.parse(sessionStorage['ngStorage-reservationModel']);\n\t}\n\n\tif ( reservationInfo ) {\n\n\t\tvar pickUpDate = reservationInfo.pickUpDate ? reservationInfo.pickUpDate.split('-') : false,\n\t\tpickUpTime = reservationInfo.pickUpTime ? reservationInfo.pickUpTime.split(/:|\\s/g) : false,\n\t\treturnDate = reservationInfo.dropDate ? reservationInfo.dropDate.split('-') : false,\n\t\treturnTime = reservationInfo.dropTime ? reservationInfo.dropTime.split(/:|\\s/g) : false,\n\t\tpossibleSteps = {\n\t\t\t'vehicles': 3,\n\t\t\t'extras': 4,\n\t\t\t'review-and-book': 5\n\t\t},\n\t\tstepCode = false;\n\t\tfor (var step in possibleSteps) {\n\t\t\tif (window.location.hash.indexOf(step) > -1){\n\t\t\t\tstepCode = possibleSteps[step];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif ( stepCode && pickUpDate && pickUpTime && returnDate && returnTime) {\n\t\t\tvar accountType = reservationInfo.corporateAWD ? 'B' : 'L',\n\t\t\t\tpickUpHour = pickUpTime[2] === 'PM' && pickUpTime[0] != 12 ? parseInt(pickUpTime[0]) + 12 : pickUpTime[0];\n\t\t\t\tif (pickUpTime[0] == 12 && pickUpTime[2] === 'AM') {\n\t\t\t\t\tpickUpHour = parseInt(pickUpTime[0]) - 12;\n\t\t\t\t}\n\t\t\t\tpickupTimestamp = new Date(pickUpDate[0], pickUpDate[1] -1, pickUpDate[2], pickUpHour, pickUpTime[1], '00').getTime(),\n\n\t\t\tqp = {\n\t\t\t\t'STEP_CODE': stepCode,\n\t\t\t\t'PICKUP_DAY': pickUpDate[2],\n\t\t\t\t'PICKUP_MONTH': pickUpDate[1] -1,\n\t\t\t\t'PICKUP_YEAR': pickUpDate[0],\n\t\t\t\t'PICKUP_HOUR': pickUpTime[0],\n\t\t\t\t'PICKUP_MINUTE': pickUpTime[1],\n\t\t\t\t'PICKUP_AM_PM': pickUpTime[2], \n\t\t\t\t'RETURN_DAY': returnDate[2],\n\t\t\t\t'RETURN_MONTH': returnDate[1] -1,\n\t\t\t\t'RETURN_YEAR': returnDate[0],\n\t\t\t\t'RETURN_HOUR': returnTime[0],\n\t\t\t\t'RETURN_MINUTE': returnTime[1],\n\t\t\t\t'RETURN_AM_PM': returnTime[2], \n\t\t\t\t'PICKUP_LOCATION_CODE': reservationInfo.pickInfo,\n\t\t\t\t'RETURN_LOCATION_CODE': reservationInfo.dropInfo,\n\t\t\t\t'COUNTRY_OF_RESIDENCE_CODE': reservationInfo.personalInfoRQ ? reservationInfo.personalInfoRQ.residency : false,\n\t\t\t\t'AGE': reservationInfo.personalInfoRQ ? reservationInfo.personalInfoRQ.age : false,\n\t\t\t\t'CAR_GROUP_CODE': reservationInfo.userSelectedCar,\n\t\t\t\t'AWD_NUMBER': reservationInfo.coupon ? reservationInfo.coupon.discountNumber : false,\n\t\t\t\t'BUSINESS_LEISURE': accountType,\n\t\t\t},\n\t\t\tqueryParams = 'DEFAULT_OPTIONS=true&RENTAL_ONEWAY=' + !!reservationInfo.dropInfo,\n\t\t\trequiredParams = ['PICKUP_DAY', 'PICKUP_MONTH', 'PICKUP_YEAR', 'PICKUP_HOUR', 'PICKUP_MINUTE', 'PICKUP_AM_PM', 'RETURN_DAY', 'RETURN_MONTH', 'RETURN_YEAR', 'RETURN_HOUR', 'RETURN_MINUTE', 'RETURN_AM_PM', 'PICKUP_LOCATION_CODE'],\n\t\t\treportCart = true,\n\t\t\tancillaryItems = false;\n\t\t\tif ( (stepCode > 3 && !qp['CAR_GROUP_CODE']) || (accountType === 'B' && !qp['AWD_NUMBER']) ) {\n\t\t\t\treportCart = false;\n\t\t\t} else {\n\t\t\t\tfor ( var param in qp ) {\n\t\t\t\t\tvar paramVal = qp[param];\n\t\t\t\t\tif ( paramVal ) {\n\t\t\t\t\t\tqueryParams = queryParams + '&' + param + '=' + paramVal;\n\t\t\t\t\t} else if ( requiredParams.indexOf(param) > -1){\n\t\t\t\t\t\treportCart = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( reportCart ) {\n\t\t\t\treservationInfo.selectedInsurances.forEach(function(insurance){\n\t\t\t\t\tqueryParams = queryParams + '&' + insurance.code + '_ACCEPT=true';\n\t\t\t\t});\n\t\t\t\treservationInfo.selectedProducts.forEach(function(product){\n\t\t\t\t\tif ( product.code === 'RSN' || product.code === 'XMR') {\n\t\t\t\t\t\tqueryParams = queryParams + '&' + product.code + '_ACCEPT=true';\n\t\t\t\t\t} else if ( product.code === 'GPS' ) {\n\t\t\t\t\t\tqueryParams = queryParams + '&AVIS_ASSIST=true';\n\t\t\t\t\t} else if ( product.code === 'CSS') {\n\t\t\t\t\t\tqueryParams = queryParams + '&CHILD_SAFETY_SEAT=true&CHILD_SAFETY_SEAT_QUANTITY=' + product.quantity;\n\t\t\t\t\t} else if ( product.code === 'CBS' ) {\n\t\t\t\t\t\tqueryParams = queryParams + '&CHILD_BOOSTER_SEAT=true&CHILD_BOOSTER_SEAT_QUANTITY=' + product.quantity;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (bouncex.testmode.bxdev && (reservationInfo.selectedProducts.length > 0 || reservationInfo.selectedInsurances.length > 0)) {\n\t\t\t\t\tancillaryItems = true;\n\t\t\t\t}\n\n\t\t\t\tif ( track ) {\n\t\t\t\t\tbouncex.utk.cart.update({\n\t\t\t\t\t\ttoken: queryParams,\n\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\tpickupTimestamp: pickupTimestamp,\n\t\t\t\t\t\tstep: stepCode,\n\t\t\t\t\t\tcarCode: qp['CAR_GROUP_CODE'] || '',\n\t\t\t\t\t\taccountType: accountType,\n\t\t\t\t\t\thasconverted: (bouncex.cookie.lc?1:0),\n\t\t\t\t\t\tancillaryItems: ancillaryItems,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttoken: queryParams,\n\t\t\t\t\t\ttimestamp: pickupTimestamp\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\nbouncex.utk.init = function() {\n\t//Cancel any existing listeners. Crucial for Angular sites\n\tbouncex.utk.stopAll();\n\n\tvar pageType = bouncex.utk.getPageType(),\n\t\tuserCountry = bouncex.utk.getUserCountry();\n\t\n\tbouncex.utk.cart.init({\n\t\tstoreCartVariable: 'cart',\n\t\tmaxVariableSize: 800,\n\t\tstoreValues: ['token', 'pickupTimestamp', 'step', 'accountType'],\n\t\tupdate: function (cart) {\n\t\t\t// save in cart.state, and in cvar if specified\n\t\t\tthis.save(cart);\n\t\t\t//track cart\n\t\t\tthis.track(cart);\n\t\t\t//fire add to cart every time cart reported\n\t\t\tbouncex.push(['add to cart', bouncex.utk.getMetadata()]);\n\t\t},\n\t\treplenish: function(cart) {\n\t\t\t//checks if reservation is more than three hours away to handle clicking through old emails + buffer for timezone\n\t\t\tvar year = bouncex.util.getParam('PICKUP_YEAR', cart.token),\n\t\t\t\tmonth = bouncex.util.getParam('PICKUP_MONTH', cart.token),\n\t\t\t\tday = bouncex.util.getParam('PICKUP_DAY', cart.token),\n\t\t\t\thour = bouncex.util.getParam('PICKUP_HOUR', cart.token),\n\t\t\t\tminute = bouncex.util.getParam('PICKUP_MINUTE', cart.token),\n\t\t\t\tampm = bouncex.util.getParam('PICKUP_AM_PM', cart.token),\n\t\t\t\tpickupHour = ampm === 'PM' ? parseInt(hour) + 12 : hour,\n\t\t\t\tthreeHours = 1.08e+7,\n\t\t\t\tnow = Date.now(),\n\t\t\t\treservationTimestamp = new Date(year, month, day, pickupHour, minute, '00').getTime();\n\t\t\tif ( reservationTimestamp - now > threeHours ) {\n\t\t\t\ttry {\n\t\t\t\t\tvar stepCode = cart.token.match(/STEP_CODE=(\\d)/)[1];\n\t\t\t\t\tsessionStorage.setItem('bx_replen', stepCode);\n\t\t\t\t\t//console.log('success')\n\t\t\t\t} catch(e){}\n\t\t\t\t\n\t\t\t\t//KK the two below comments should both should be removed if Avis fixes\n\t\t\t\tvar cartToken = cart.token;\n\t\t\t\t//fixes Xwhatever not loading correctly on stepcode 4\n\t\t\t\tif ( bouncex.util.getParam('CAR_GROUP_CODE',cartToken).length == 2 ) {\n\t\t\t\t\tcartToken = cartToken.replace(/STEP_CODE=(\\d)/, 'STEP_CODE=3');\n\t\t\t\t}\n\t\t\t\t//fixes no bouncex on stepcode 5\n\t\t\t\tcartToken = cartToken.replace('STEP_CODE=5', 'STEP_CODE=4');\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\twindow.location.href = 'http://www.avis.com/car-rental/reservation/initialize-reservation.ac?' + cartToken;\n\t\t\t\t}, 300);\n\t\t\t} else {\n\t\t\t\tbouncex.setv('res_passed', true);\n \t\t\t\tbouncex.reload_campaigns();\n\t\t\t\tbouncex.push(['cart replenish', {'cart:success': 'NA', 'cart:reason': 'reservation less than three hours'}]);\n\t\t\t}\n\t\t},\n\t\treportReplenishment: function() {\n\t\t\tvar replenStep = sessionStorage.getItem('bx_replen');\n\t\t\tif ( replenStep ) {\n\t\t\t\tsessionStorage.removeItem('bx_replen');\n\t\t\t\tvar success = true,\n\t\t\t\t\tfailReason = false,\n\t\t\t\t\tcurrentStep = parseInt(jQuery('.step-progress-bar li.active .step-number').text().trim()) + 1;\n\t\t\t\tif ( jQuery('.res-PageError').is(':visible') ) {\n\t\t\t\t\tsuccess = false;\n\t\t\t\t\tfailReason = jQuery('.res-PageError:visible').text().trim();\n\t\t\t\t} else if ( window.location.href.indexOf('reservation#/vehicles') > -1 && !jQuery('.available-car-box').length ) {\n\t\t\t\t\tsuccess = false;\n\t\t\t\t\tfailReason = 'no cars';\n\t\t\t\t} else if ( window.location.href.indexOf('reservation#/oneclick') > -1 ) {\n\t\t\t\t\tsuccess = false;\n\t\t\t\t\tfailReason = 'bad step';\n\t\t\t\t} else if ( replenStep != currentStep ) {\n\t\t\t\t\tsuccess = false;\n\t\t\t\t\tfailReason = 'should be step ' + replenStep + ' on step ' + currentStep;\n\t\t\t\t}\n\t\t\t\tbouncex.push(['cart replenish', {'cart:success': success, 'cart:reason': failReason}]);\n\t\t\t\t// if ( failReason ) {\n\t\t\t\t// \twindow.location.href = 'https://www.avis.com/';\n\t\t\t\t// }\n\t\t\t}\n\t\t}\n\t});\n\t\n\t//tracking only if user in US\n\tif ( userCountry && userCountry === 'US' && window.location.hostname.indexOf('avis.com') > -1 ) {\n\t\tif (pageType === 'reservation'){\n\t\t\tbouncex.utk.createDeeplink(true);\n\t\t\tif ( window.location.href.indexOf('#/vehicles') > -1 ) {\n\t\t\t\tlocalStorage.removeItem('bxTracked');\n\t\t\t\tbouncex.utk.trackListPage({\n\t\t\t\t\t\tselector: '.featured-car-box, .available-car-box',\n\t\t\t\t\t\ttitle: 'Vehicles',\n\t\t\t\t\t\titemTracking : true,\n\t\t\t\t\t\tgetItemData: function(el) { \n\t\t\t\t\t\t\tvar $item = jQuery(el),\n\t\t\t\t\t\t\t\tname = $item.find('.featurecartxt').text().trim();\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tid: name.replace(/\\s/g, '_'),\n\t\t\t\t\t\t\t\tcopy: name,\n\t\t\t\t\t\t\t\timageurl: bouncex.util.getOrigin() + $item.find('img').attr('src'),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n};\n\nbouncex.utk.init();\n","cjs":"","miw":1,"mibcx":1,"te":1,"cart_rep":{"get":"","set":""},"ulpj":{"et_rid":"espemailid"},"cus":"","miw_exclude":""},"etjson":null,"osre":true,"osru":"osr.bouncex.net/v1/osr/items","checkDfp":false,"spa":0,"spatm":1,"preinit_cjs":"","cpnu":"cpn.bouncex.net"}
;
		bouncex.tag = 'tag3';
		bouncex.$ = window.jQuery;
		bouncex.env = 'production';
		bouncex.restrictedTlds = {"casl":{"ca":1},"gdpr":{"ad":1,"al":1,"at":1,"ax":1,"ba":1,"be":1,"bg":1,"by":1,"xn--90ais":1,"ch":1,"cy":1,"cz":1,"de":1,"dk":1,"ee":1,"es":1,"eu":1,"fi":1,"fo":1,"fr":1,"uk":1,"gb":1,"gg":1,"gi":1,"gr":1,"hr":1,"hu":1,"ie":1,"im":1,"is":1,"it":1,"je":1,"li":1,"lt":1,"lu":1,"lv":1,"mc":1,"md":1,"me":1,"mk":1,"xn--d1al":1,"mt":1,"nl":1,"no":1,"pl":1,"pt":1,"ro":1,"rs":1,"xn--90a3ac":1,"ru":1,"su":1,"xn--p1ai":1,"se":1,"si":1,"sj":1,"sk":1,"sm":1,"ua":1,"xn--j1amh":1,"va":1,"tr":1}};
		bouncex.push = function(pushData) {
			bouncex.pushedData.push(pushData);
		}
		var script = document.createElement('script');
		script.setAttribute('src', '//assets.bounceexchange.com/assets/smart-tags/versioned/ijs_all_modules_39acc74793e6458b0a0d0c48dba47677.js');

		document.body.appendChild(script);
	}
}
if (document.readyState === "loading") {
	document.addEventListener("DOMContentLoaded", bxBootstrap);
} else {
	bxBootstrap();
}})();