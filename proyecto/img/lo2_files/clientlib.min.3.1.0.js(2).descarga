(function(){angular.module("reservation").controller("ConfirmationController",a);
a.$inject=["$q","ftpService","$scope","$timeout","$rootScope","$location","$state","$stateParams","$sce","$controller","anchorSmoothScroll","getDataService","vehicleService","locationService","locationTermsConditionsService","$window","lookupService","optionalService","reviewService","reservationModelService","emailService","$validation","carRentalConstant","confirmationService","gaService","authenticationService","$filter","utilityService","storageService","confirmCancelService","BackButtonFactory"];
function a(X,u,G,Q,x,al,Z,an,af,P,ac,aj,av,d,ae,N,F,R,au,H,ao,ak,K,w,r,I,aq,b,S,ai,B){x.emailRedirectingPath=true;
if(N.jsProfileConfigFlag==="true"){N.startTime.confirmationPage=performance.now()
}P("ExceptionHandlerController",{$scope:G});
x.chkRedeemedRes=false;
window.dataLayer=[];
var v=this;
v.pageName=Z.current.name;
v.domain=N.domain;
v.emailFlag=x.$progressbar.$previousState.name;
v.cancelModify=true;
v.prepaycancelReservation=false;
v.refundcancelReservation=false;
v.prepaycancelReservationAUNZ=false;
v.modifyConfirmation=K.resFlowModify;
v.getcouponquantity="";
v.chkRedeemedRes=false;
v.reservationModel=H.getReservationModel();
v.lookupModel=H.lookupModel;
v.forwardEmailModel=H.forwardEmailModel;
v.openNewWindow=j;
v.replaceWindow=p;
v.isConcurTrip=E;
v.multiCurrencyFlag=false;
v.tripItModel=H.tripItModel;
v.tripItAddedFlag=false;
v.tripItMessage="";
v.tripItError=false;
v.expiredccMessage="";
v.autoAddTripit=i;
v.enrollTripit=t;
v.pickUpLocationLink="";
v.dropOffLocationLink="";
v.userAge="";
v.currencySymbol="";
v.disableModifyCancel=false;
x.keyDropPath="";
x.mapModalPath="";
v.confmessage=false;
v.keyDroptermsNc=false;
v.showUpsellMessageError=false;
v.keyDropTnC=m;
v.reservation={};
v.insuranceDisplay=[];
v.confirmation={reservationSummary:{rateSummary:{selectedInsurances:undefined}}};
v.productUpsellCode;
v.protectionUpsellCode;
v.oneClickURLMessage=false;
v.showUpsellMessage=false;
v.productUpsellError=false;
v.accordionStatus={mileage:false};
v.gstOnNoShowFee="";
v.gstOnCancelFee="";
v.cancelFee="";
v.currency="";
v.noShowFee="";
v.rentalLocationCountry="";
v.pastPickUpReservation=false;
v.resAmt_greaterthan_cancelAmt=false;
v.resAmt_lessthan_cancelAmt=false;
v.resAmt_greaterthan_noShowAmt=false;
v.resAmt_lessthan_noShowAmt=false;
v.cancelFeeGreaterThanPrepaidAmount=false;
v.cancelFeeLessOrEqualThanPrepaidAmount=false;
v.proactiveChat=false;
v.showProactiveChatBtn=(angular.isDefined(S.getStorageData("proactiveChatStatus"))&&ABG.getMobileOperatingSystem()==="unknown")?true:false;
v.hideSmallBiz=ah;
v.callProactiveChat=s;
v.resetEmailForm=O;
v.clearForwardDetails=q;
v.modifyTimePlace=W;
v.modifyVehicle=D;
v.modifyExtras=A;
v.modifyPersonalInfo=am;
v.addToCalendar=o;
v.printReservationDetails=C;
v.checkCoupon=aw;
v.checkInstructionList=n;
v.checkMaxiRentalError=h;
v.checkMaxiRentalErrorFlag=false;
v.checkEmailFlag=M;
v.checkCancelReservation=k;
v.checkModify=ag;
v.checkCostControl=f;
v.checkIATA=e;
v.checkRefund=at;
v.redirecturl=J;
v.printConfirmation=c;
v.cancelOrNoShowFeeMessage=ad;
v.amazonBenefitsKey=Dictionary.I18n.get("lbl.global.amazonBenefits");
v.forwardEmail={validated:false,globaErrorFlag:false,globalError:"",submit:function(ax){ak.validate(ax).success(v.forwardEmail.validationSuccess).error(v.forwardEmail.validationError)
},validationSuccess:function(){x.requestInProgress=true;
var ax={rqHeader:{locale:internalLocale},confirmationNum:v.confirmation.reservationSummary.confirmationNumber,lastName:v.confirmation.reservationSummary.personalInfo.lastName.value,emailId:v.forwardEmailModel.emailId.toLowerCase()};
if(v.forwardEmailModel.emailId.toLowerCase()==v.forwardEmailModel.confirmEmailId.toLowerCase()){var ay=ao.forwardEmail(ax);
ay.then(function(az){x.requestInProgress=false;
v.forwardMessage=az;
ak.resetError("vm.forwardEmailModel.emailId",true);
ak.resetError("vm.forwardEmailModel.confirmEmailId",true);
if(v.forwardMessage){jQuery(".confirmation-email").modal("toggle")
}v.fwdEmailId=v.forwardEmailModel.emailId.toLowerCase();
v.forwardEmail.globalError="";
v.forwardEmail.globaErrorFlag=false;
v.forwardEmailModel.emailId="";
v.forwardEmailModel.confirmEmailId=""
},function(az){x.requestInProgress=false
})
}else{ak.displayServiceError("vm.forwardEmailModel.confirmEmailId","emailmatch");
x.requestInProgress=false
}},validationError:function(ax){v.forwardEmail.globaErrorFlag=true;
if(1===ax.errorCount){v.forwardEmail.globalError=ax.MSG[0]
}else{if(1<ax.errorCount){v.forwardEmail.globalError=Dictionary.I18n.get("err.global.multi.errorMessage")
}}}};
v.addToTripIt={submit:function(ax){ak.validate(ax).success(v.addToTripIt.validationSuccess).error(v.addToTripIt.validationError)
},validationSuccess:function(){v.addToTripIt.add()
},validationError:function(ax){},add:function(){v.tripItModel.autoAdd="0";
v._callTripItService(v.tripItModel)
}};
v._productUpsellMessage=z;
v._displayTermsConditions=T;
v._expandDebitTerms=g;
v._emailUrlParams=l;
v._pageInit=y;
v._printData=ar;
v._processError=Y;
v._process=L;
v._constructLocationLinks=ab;
v._callTripItService=aa;
var ap=P("ConfirmationExnController",{$scope:G});
angular.extend(this,ap);
function z(){v.reservationModel=H.getReservationModel();
v.showUpsellMessage=false;
var ay=S.getStorageData("oneClickURLCode");
if(angular.isDefined(v.reservationModel)&&angular.isDefined(v.reservationModel.bookAgain)&&angular.isDefined(v.reservationModel.bookAgain.bookAgainFlow)&&v.reservationModel.bookAgain.bookAgainFlow){S.deleteStorageData("oneClickURLCode")
}if(v.reservationModel&&(v.pageName!=K.cancelBookingPage)){for(var ax=0;
ax<v.reservationModel.selectedProducts.length;
ax++){if((angular.isDefined(v.reservationModel.selectedProducts[ax].isCampaignBased)&&v.reservationModel.selectedProducts[ax].isCampaignBased)||(v.reservationModel.selectedProducts[ax].code==ay)){v.productUpsellCode=v.reservationModel.selectedProducts[ax].description;
v.reservationModel.selectedProducts[ax].isCampaignBased=false;
H.setReservationModel(v.reservationModel);
v.showUpsellMessage=true;
break
}}if(angular.isDefined(ay)){for(var ax=0;
ax<v.reservationModel.selectedInsurances.length;
ax++){if(N.brand==K.brandName.BUDGET&&v.reservationModel.selectedInsurances[ax].code=="LDW"){v.reservationModel.selectedInsurances[ax].code="CDW"
}if(v.reservationModel.selectedInsurances[ax].code==ay){v.protectionUpsellCode=v.reservationModel.selectedInsurances[ax].description;
H.setReservationModel(v.reservationModel);
v.oneClickURLMessage=true;
break
}}}}}function e(){if(angular.isDefined(v.confirmation)&&angular.isDefined(v.confirmation.reservationSummary)&&((v.confirmation.reservationSummary.iataNumber!=""&&v.confirmation.reservationSummary.iataNumber!=undefined&&v.confirmation.reservationSummary.prepayTxn==true)||(v.confirmation.reservationSummary.iataNumber!=""&&v.confirmation.reservationSummary.iataNumber!=undefined&&v.confirmation.reservationSummary.iataNumber!=K.systemInjectedIata&&v.confirmation.reservationSummary.prepayTxn==false))){return true
}else{return false
}}function f(){if((angular.isDefined(v.confirmation)&&angular.isDefined(v.confirmation.reservationSummary)&&(v.confirmation.reservationSummary.userState==K.userStateAuthenticated||v.confirmation.reservationSummary.userState==K.userStateRecognized))){return true
}else{return false
}}function ag(){if((v.pageName==K.cancelBookingPage)||(angular.isDefined(v.confirmation.reservationSummary)&&v.confirmation.reservationSummary.cancelledReservation)||(angular.isDefined(v.confirmation.reservationSummary)&&(v.confirmation.reservationSummary.permission==undefined||(v.confirmation.reservationSummary.permission.modify&&(v.confirmation.reservationSummary.permission.modify.visible==undefined||v.confirmation.reservationSummary.permission.modify.visible==="FALSE"))))){return true
}else{return false
}}function k(){if((v.pageName==K.cancelBookingPage)||(angular.isDefined(v.confirmation)&&angular.isDefined(v.confirmation.reservationSummary)&&(v.confirmation.reservationSummary.permission==undefined||(v.confirmation.reservationSummary.permission.cancel&&(v.confirmation.reservationSummary.permission.cancel.visible==undefined||v.confirmation.reservationSummary.permission.cancel.visible==="FALSE"))))){return true
}else{return false
}}function M(){var ax=false;
if(angular.isDefined(v.confirmation.instructionList)&&v.confirmation.instructionList.length>0){angular.forEach(v.confirmation.instructionList,function(az,ay){if(az.code==="090001"){ax=true
}})
}if(v.pageName==K.confirmationPage&&v.emailFlag&&!v.cancelModify&&!v.forwardMessage&&!v.reservationModel.displayControls.viewReservation&&ax===false){return true
}else{return false
}}function n(){if((v.pageName==K.cancelBookingPage)&&angular.isDefined(v.confirmation)&&(v.confirmation.instructionList==undefined||v.confirmation.instructionList.length<0)){return true
}else{return false
}}function h(){v.checkMaxiRentalErrorFlag=true;
return v.checkMaxiRentalErrorFlag
}function aw(){if((angular.isDefined(v.confirmation)&&angular.isDefined(v.confirmation.reservationSummary))&&((angular.isDefined(v.confirmation.reservationSummary.coupon)&&angular.isDefined(v.confirmation.reservationSummary.coupon.number)&&v.confirmation.reservationSummary.coupon.number!=""&&v.confirmation.reservationSummary.prepayTxn===true&&v.confirmation.reservationSummary.cancelledReservation===false)||(v.confirmation.reservationSummary.prepayTxn===true&&v.confirmation.reservationSummary.cancelledReservation===false))){return true
}else{return false
}}function at(){if(angular.isDefined(v.confirmation)&&angular.isDefined(v.confirmation.reservationSummary)&&angular.isDefined(v.confirmation.reservationSummary.permission)&&angular.isDefined(v.confirmation.reservationSummary.permission.refund)&&angular.isDefined(v.confirmation.reservationSummary.permission.refund.visible)&&v.confirmation.reservationSummary.permission.refund.visible=="TRUE"){return true
}else{return false
}}function j(ax){N.open(ax,"AEM","width=950,height=500","resizable=no","toolbar=no","location=no","status=no","menubar=no","scrollbars=yes")
}function p(ax){v.reservationModel=H.getReservationModel();
if(angular.isDefined(v.reservationModel)){v.reservationModel.displayControls.reservation=K.resFlowCreate;
H.setReservationModel(v.reservationModel)
}N.location.href=ax
}function E(){if(angular.isDefined(v.confirmation)&&angular.isDefined(v.confirmation.reservationSummary)&&angular.isDefined(v.confirmation.reservationSummary.tripAggregator)&&angular.isDefined(v.confirmation.reservationSummary.tripAggregator.concurMessage)&&angular.isDefined(v.confirmation.reservationSummary.tripAggregator.concurMessage.code==="05125")){return true
}else{return false
}}function O(){v.emailuserForm.$setUntouched();
v.emailuserForm.$setPristine();
angular.element('form[name="vm.emailuserForm"] input').removeClass("ng-invalid");
angular.element('form[name="vm.emailuserForm"] input').removeClass("platform-element-error");
v.forwardEmail.globaErrorFlag=false;
ak.resetError("vm.forwardEmailModel.emailId",true);
ak.resetError("vm.forwardEmailModel.confirmEmailId",true)
}function q(){angular.element(".platform-error-message").css("display","none");
ak.resetError("vm.forwardEmailModel.emailId",true);
ak.resetError("vm.forwardEmailModel.confirmEmailId",true)
}function o(){var ax={name:Dictionary.I18n.get("lbl.res.resconf.addtocalendar.name,"+brand)+": "+v.confirmation.reservationSummary.confirmationNumber,contact:Dictionary.I18n.get("lbl.res.resconf.addtocalendar.contact,"+brand)};
w.addToCalendar(ax,v.confirmation.reservationSummary)
}function W(){x.requestInProgress=!x.requestInProgress;
var ax=H.load(v.confirmation,false);
ax.then(function(aA){v.reservationModel=aA;
x.reservation=aA.displayControls.reservation;
var az="";
aj.addToAvailableVehicles(az);
var ay={lastName:v.reservationModel.personalInfoRQ.lastName,confirmationNumber:v.reservationModel.confirmationNumber,email:v.reservationModel.personalInfoRQ.email};
H.setLookUpModel(ay);
Z.go(K.step1aPageName)
},function(ay){x.requestInProgress=false
})
}function D(){x.requestInProgress=true;
var ax=H.load(v.confirmation,false);
ax.then(function(az){v.reservationModel=az;
if(v.reservationModel.rateRequestDropIndicator){Z.go(K.step1aPageName)
}else{x.reservation=az.displayControls.reservation;
if(v.reservationModel){v.reservationModel.selectedNonSupCPlist=[];
if(v.confirmation.reservationSummary&&v.confirmation.reservationSummary.rateSummary&&v.confirmation.reservationSummary.rateSummary.selectedNonSupCPlist){v.reservationModel.selectedNonSupCPlist=v.confirmation.reservationSummary.rateSummary.selectedNonSupCPlist
}}H.setReservationModel(v.reservationModel);
aj.resetAvailableVehicles();
var ay=av.load();
ay.then(function(aA){if((angular.isDefined(aA.errorList)&&aA.errorList.length>0)||(angular.isDefined(aA.warningList)&&aA.warningList.length>0)||(angular.isDefined(aA.fieldErrors)&&aA.fieldErrors.length>0)){Z.go(K.step1aPageName)
}else{Z.go(K.step2PageName)
}},function(aA){})
}},function(ay){})
}function A(){x.requestInProgress=true;
var ax=H.load(v.confirmation,false);
ax.then(function(ay){v.reservationModel=ay;
if(v.reservationModel.rateRequestDropIndicator){Z.go(K.step1aPageName)
}else{x.reservation=ay.displayControls.reservation;
if(v.reservationModel){v.reservationModel.selectedNonSupCPlist=[];
if(v.confirmation.reservationSummary&&v.confirmation.reservationSummary.rateSummary&&v.confirmation.reservationSummary.rateSummary.selectedNonSupCPlist){v.reservationModel.selectedNonSupCPlist=v.confirmation.reservationSummary.rateSummary.selectedNonSupCPlist
}v.reservationModel.displayControls.reservation=K.resFlowModify
}aj.resetAvailableVehicles();
aj.resetAvailableExtras();
H.setReservationModel(v.reservationModel);
Z.go(K.step3PageName)
}},function(ay){})
}function am(){x.requestInProgress=false;
var ax=H.load(v.confirmation,false);
v.reservationModel=H.getReservationModel();
ax.then(function(aA){v.reservationModel=aA;
if(v.reservationModel.rateRequestDropIndicator){Z.go(K.step1aPageName)
}else{x.reservation=aA.displayControls.reservation;
aA.displayControls.rdmApplied=true;
if(v.reservationModel){v.reservationModel.selectedNonSupCPlist=[];
if(v.confirmation.reservationSummary&&v.confirmation.reservationSummary.rateSummary&&v.confirmation.reservationSummary.rateSummary.selectedNonSupCPlist){v.reservationModel.selectedNonSupCPlist=v.confirmation.reservationSummary.rateSummary.selectedNonSupCPlist
}if(v.reservationModel.displayControls.reservation===K.resFlowModify){for(var az=0;
az<v.reservationModel.selectedProducts.length;
az++){var ay=v.reservationModel.selectedProducts[az].totalRedeemedPts;
if(ay>0&&v.chkRedeemedRes==false){v.chkRedeemedRes=true;
x.chkRedeemedRes=true
}}}}aj.resetAvailableVehicles();
H.setReservationModel(v.reservationModel);
au.load().then(function(aC){if((angular.isDefined(aC.errorList)&&aC.errorList.length>0)||(angular.isDefined(aC.warningList)&&aC.warningList.length>0)||(angular.isDefined(aC.fieldErrors)&&aC.fieldErrors.length>0)){Z.go(K.step1aPageName)
}else{if(angular.isDefined(aC.reservationSummary)){if(aC.reservationSummary.iataNumber==undefined){x.iataNum=false
}else{x.iataNum=true;
var aB=aC.reservationSummary.iataNumber;
if(aB==K.systemInjectedIata){v.reservationModel.iataNumber=""
}else{v.reservationModel.iataNumber=aB
}}}aC=aC.reservationSummary;
var aD=false;
if((aC.prepayTxn)||(aC.ccsection.visible=="TRUE"&&aC.payNowCheckBoxInd.visible=="FALSE"&&aC.prepayTxn===false)){aD=false
}else{if(aC.payNowCheckBoxInd.visible=="TRUE"){aD=false
}else{aD=true
}}if(aD){Z.go(K.step4PayLaterPageName)
}else{Z.go(K.step4PageName)
}}},function(aB){})
}},function(ay){})
}v.cancelReservation={submit:function(ax){ak.validate(ax).success(v.cancelReservation.validationSuccess).error(v.cancelReservation.validationError)
},validationSuccess:function(){x.requestInProgress=true;
v.cancelReservation.process()
},validationError:function(ax){},process:function(){var az=v.reservation.reservationSummary.confirmationNumber;
var ay=v.reservation.reservationSummary.personalInfo.lastName.value;
var ax=v.emailaddr;
ai.load(az,ay,ax).then(function(aA){v.model=aA;
if(angular.isDefined(aA.errorList)&&aA.errorList.length>0){B.process(aA.errorList[0].code);
x.requestInProgress=false
}else{if(undefined!=v.model.reservationSummary.loyaltyDetails){I.setLoyaltyDetails(I.setLoyaltyDetailsData(v.model));
x.$broadcast("loyaltyUpdated",v.model)
}S.deleteStorageData("upcomingReservations");
S.deleteStorageData("cancelledReservations");
aj.deleteConcurTripList();
jQuery(".getres-modal-cancel").modal("hide");
N.location.href=x.contextPath+"/"+x.locale+"/reservation"+htmlExtension+"#/cancel-confirmation"
}},function(aA){})
}};
function s(){v.proactiveChat=true;
$(".oo_feedback_float").hide();
$("#TPClientEmbeddedChatTriggerButton").click()
}function ah(){if(N.brand==K.brandName.BUDGET&&v.domain=="us"){$("#small-biz-modal").hide();
$(".smBiz-enroll-button").hide()
}}function c(){if(N.brand==K.brandName.PAYLESS&&(v.pageName==K.confirmationPage||v.pageName==K.cancelBookingPage)){C()
}else{angular.element(".print-modal").modal("show")
}}function C(){if(N.brand==K.brandName.PAYLESS){v.termsToPrintRequired=true
}var ax=rootpath+"/reservation/print-confirmation"+htmlExtension+"#/?tncrequired="+v.termsToPrintRequired+"&pageType="+((v.pageName===K.confirmationPage)?"confirm":"cancel");
v.tncRequired=v.termsToPrintRequired;
N.open(ax,"AEM","width=950,height=500,scrollbars=yes")
}function m(){v.keyDroptermsNc=true;
T()
}function T(){v.contentType=(v.confirmation.reservationSummary.prepayTxn===true)?K.txnTypePrePay:K.txnTypePostPay;
var ax=ae.load(v.contentType,v.confirmation.reservationSummary.pickLoc.locationCode);
ax.then(function(aA){v.CompleteTexNew=aA;
v._expandDebitTerms();
if(angular.isDefined(v.confirmation.reservationSummary.dropLoc)&&angular.isDefined(v.confirmation.reservationSummary.dropLoc.keyDrop==true)&&(v.keyDroptermsNc==true)){for(var az=0;
az<aA.length;
az++){if(aA[az].Id=="After Hours Return"){var aB=aA[az].Description;
var ay=aB.toString();
v.afterHourTnC=ay.replace(/<[^>]+>/gm,"");
break
}}}},function(ay){})
}function l(){if(d.readQueryString("resForm.confirmationNumber")!=null){v.conNum=d.readQueryString("resForm.confirmationNumber");
v.lastName=d.readQueryString("resForm.lastName.value")
}else{v.conNum=d.readQueryString("CONFIRM_NUM");
v.lastName=d.readQueryString("LAST_NAME")
}v.focusTerms=d.readQueryString("utm_campaign");
v.linkref=d.readQueryString("linkref");
if(angular.isDefined(v.conNum)){var ax={lastName:v.lastName,confirmationNumber:v.conNum,email:""};
H.setLookUpModel(ax)
}}function ad(){if(v.confirmation&&v.confirmation.reservationSummary&&N.brand!=K.brandName.PAYLESS&&v.confirmation.reservationSummary.prepayTxn&&v.confirmation.reservationSummary.prepayInfo&&v.confirmation.reservationSummary.permission.refund.visible=="FALSE"&&(v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="C"||v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="N")&&(v.confirmation.reservationSummary.prepayInfo.refundIndicator==K.RESAMT_LESSTHAN_NOSHOWAMT||v.confirmation.reservationSummary.prepayInfo.refundIndicator==K.RESAMT_LESSTHAN_CANCELAMT)&&(v.confirmation.reservationSummary.pickLoc.address.country.toUpperCase()==K.countryCodeAU||v.confirmation.reservationSummary.pickLoc.address.country.toUpperCase()==K.countryCodeNZ)){v.cancelFeeLessOrEqualThanPrepaidAmount=true;
v.rentalLocationCountry=v.confirmation.reservationSummary.pickLoc.address.country.toUpperCase()
}else{if(v.confirmation&&v.confirmation.reservationSummary&&N.brand!=K.brandName.PAYLESS&&v.confirmation.reservationSummary.prepayTxn&&v.confirmation.reservationSummary.prepayInfo&&v.confirmation.reservationSummary.permission.refund.visible=="FALSE"&&(v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="C"||v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="N")&&(v.confirmation.reservationSummary.prepayInfo.refundIndicator==K.RESAMT_GREATERTHAN_CANCELAMT||v.confirmation.reservationSummary.prepayInfo.refundIndicator==K.RESAMT_GREATERTHAN_NOSHOWAMT)&&(v.confirmation.reservationSummary.pickLoc.address.country.toUpperCase()==K.countryCodeAU||v.confirmation.reservationSummary.pickLoc.address.country.toUpperCase()==K.countryCodeNZ)){v.cancelFeeGreaterThanPrepaidAmount=true;
v.rentalLocationCountry=v.confirmation.reservationSummary.pickLoc.address.country.toUpperCase()
}}}function y(){x.requestInProgress=true;
H.setExpressReservationFlag(false);
S.deleteStorageData("bridgeResponse");
v.session=I.getSessionModel();
if(v.session&&(v.session.status===K.userStateAuthenticated||v.session.status===K.userStateRememberMe)){x.$emit("Profile.refreshReservation")
}var aB=d.readQueryString("utm_campaign");
v.focusTerms=aB;
v.emailFlag=(v.emailFlag==K.resSummaryPage)?false:true;
if(Z.current.name==K.confirmationPage||Z.current.name==K.displayConfirmationPage||Z.current.name==K.preCheckoutCompletePage){var aA=angular.isDefined(an.infoKey)?an.infoKey:"lookup";
if(an.infoKey==="lookup"&&N.brand===K.brandName.PAYLESS){v.confmessage=true
}if(Z.current.name==K.confirmationPage||Z.current.name==K.preCheckoutCompletePage){w.getData(aA).then(function(aC){if(an.infoKey=="02001"||an.infoKey=="02003"||an.infoKey=="02013"||an.infoKey=="02002"||an.infoKey=="02004"){v.confirmation=aC;
b.getErrorMessageByCode(an.infoKey).then(function(aD){v.confirmation.errorList=aD;
v.errorDisplayList=v.confirmation.errorList;
delete v.confirmation.reservationSummary.showSmallBiz;
v.emailFlag=false
},function(){})
}else{v.confirmation=aC
}v.reservation=aC;
v.emailaddr=(angular.isDefined(v.confirmation.reservationSummary)&&angular.isDefined(v.confirmation.reservationSummary.personalInfo)&&angular.isDefined(v.confirmation.reservationSummary.personalInfo.email))?v.confirmation.reservationSummary.personalInfo.email:"";
if(v.confirmation.reservationSummary.cancelledReservation){v.disableModifyCancel=true
}v._printData(aC);
v.rentalLocationCountry=aC.reservationSummary.pickLoc.address.country.toUpperCase()
})
}else{F.load().then(function(aC){v.confirmation=aC;
v.reservation=aC;
v._printData(aC)
})
}v.confirmation=aj.getConfirmationData();
v.cancelOrNoShowFeeMessage()
}else{v.confirmation=aj.getConfirmationData();
if(v.pageName==K.cancelBookingPage){var ay=H.getStorageData("cancelConfirmationData");
if(angular.isDefined(ay)&&angular.isDefined(ay.errorList)&&angular.isDefined(ay.errorList[0])){H.deleteSpecificStorageData("cancelConfirmationData")
}else{v.confirmation=ay;
if(angular.isDefined(v.confirmation)&&angular.isDefined(v.confirmation.reservationSummary)){v.userAge=w.getAge(v.confirmation.reservationSummary);
v.rentalLocationCountry=v.confirmation.reservationSummary.pickLoc.address.country.toUpperCase();
v.currencySymbol=aq("currencySymbol")(v.confirmation.reservationSummary.rateSummary.currencySymbol);
if(angular.isDefined(v.confirmation)&&angular.isDefined(v.confirmation.reservationSummary)&&angular.isDefined(v.confirmation.reservationSummary.prepayInfo)){v.gstOnNoShowFee=v.confirmation.reservationSummary.prepayInfo.gstOnNoShowFee;
v.gstOnCancelFee=v.confirmation.reservationSummary.prepayInfo.gstOnCancelFee;
v.cancelFee=v.confirmation.reservationSummary.prepayInfo.cancelFee;
v.currency=v.confirmation.reservationSummary.prepayInfo.currency;
v.noShowFee=v.confirmation.reservationSummary.prepayInfo.noShowFee
}}}}if($.isEmptyObject(v.confirmation)){if(v.pageName==K.cancelBookingPage){var ax=H.getLookUpModel();
if(angular.isDefined(ax)&&angular.isDefined(ax.confirmationNumber)){F.load().then(function(aD){if(angular.isDefined(ay)&&angular.isDefined(ay.errorList)&&angular.isDefined(ay.errorList[0])){aD.errorList=ay.errorList
}if((angular.isDefined(aD.instructionList)&&aD.instructionList.length>0)||(angular.isDefined(aD.errorList)&&aD.errorList.length>0)){v._processError(aD);
if(angular.isDefined(v.confirmation)&&angular.isDefined(v.confirmation.reservationSummary)){v.userAge=w.getAge(v.confirmation.reservationSummary)
}v.errorDisplayList=v.confirmation.instructionList
}else{var aC=G.processErrorMessage(aD);
v.confirmation=aC
}try{r.analyticsDimension(v.confirmation.reservationSummary,v.pageName,v.confirmation)
}catch(aE){}v._process()
},function(aC){})
}else{S.setStorageData("sessionErrMsg",Dictionary.I18n.get("err.global.travelSecurity.errorMessage"));
setTimeout(function(){N.location.href=contextPath+"/"+locale+"/reservation/view-modify-cancel"+htmlExtension
},10)
}}else{F.getData().then(function(aC){if((angular.isDefined(aC.instructionList)&&aC.instructionList.length>0)||(angular.isDefined(aC.errorList)&&aC.errorList.length>0)){v._processError(aC);
v.errorDisplayList=v.confirmation.errorList
}else{v.confirmation=aC;
if(angular.isDefined(v.confirmation&&v.confirmation.reservationSummary)){v.currencySymbol=aq("currencySymbol")(v.confirmation.reservationSummary.rateSummary.currencySymbol)
}}if(angular.isDefined(v.confirmation)&&angular.isDefined(v.confirmation.reservationSummary)){v.userAge=w.getAge(v.confirmation.reservationSummary)
}aj.addToConfirmationData(aC);
if(v.pageName==K.cancelBookingPage){try{r.analyticsDimension(v.confirmation.reservationSummary,v.pageName,v.confirmation)
}catch(aD){}}v._process()
},function(aC){})
}}else{if(angular.isUndefined(v.confirmation.length)&&H.getStorageData("cancelConfirmationData")){v.confirmation=H.getStorageData("cancelConfirmationData");
H.deleteSpecificStorageData("cancelConfirmationData")
}if(v.pageName==K.cancelBookingPage){try{r.analyticsDimension(v.confirmation.reservationSummary,v.pageName,v.confirmation)
}catch(az){}}v._process()
}}v._productUpsellMessage();
v.accordionStatus.mileage=false;
v.creditCardDetails=aj.getCreditCardData();
x.requestInProgress=false
}function Y(ay){var ax=G.processErrorMessage(ay);
v.confirmation=ax
}function ar(ax){if((angular.isDefined(ax.errorList)&&ax.errorList.length>0)){ax=G.processErrorMessage(v.confirmation);
v.errorDisplayList=ax.errorList
}if(v.confirmation.reservationSummary!=undefined&&angular.isDefined(v.confirmation.reservationSummary.rateSummary.currencySymbol)){v.currencySymbol=aq("currencySymbol")(v.confirmation.reservationSummary.rateSummary.currencySymbol)
}if(angular.isDefined(v.confirmation)&&angular.isDefined(v.confirmation.reservationSummary)){v.userAge=w.getAge(v.confirmation.reservationSummary)
}if(angular.isDefined(ax)&&angular.isDefined(ax.reservationSummary)&&angular.isDefined(ax.reservationSummary.walletType)&&ax.reservationSummary.walletType=="AMAZON"){if(partnerConfig.amazon.enablePartnerBenefit=="true"){amazon.Login.logout()
}}if(!v.confirmation||$.isEmptyObject(v.confirmation)||!v.confirmation.reservationSummary||v.confirmation.reservationSummary.cancelledReservation==true){F.getData().then(function(az){if(angular.isDefined(v.focusTerms)&&v.focusTerms!=null){if(v.focusTerms.indexOf("NonPrePay")!=-1&&az.reservationSummary.cancelledReservation==true){N.location.href=x.contextPath+"/"+x.locale+"/reservation/view-modify-cancel"+htmlExtension+"?utm_campaign="+v.focusTerms+"&resForm.confirmationNumber="+v.conNum+"&resForm.lastName.value="+v.lastName;
return
}}if((angular.isDefined(az.instructionList)&&az.instructionList.length>0)||(angular.isDefined(az.errorList)&&az.errorList.length>0)){v.confirmation=G.processErrorMessage(az);
if(angular.isDefined(az.instructionList)&&az.instructionList.length>0&&v.confirmation.reservationSummary.cancelledReservation==true&&v.focusTerms!=null){N.location.href=x.contextPath+"/"+x.locale+"/reservation"+htmlExtension+"#/cancel-confirmation?utm_campaign="+v.focusTerms;
return
}}v.confirmation=az;
v._process();
aj.addToConfirmationData(az);
try{r.analyticsDimension(az,"view",az)
}catch(aA){}},function(az){})
}else{if(v.confirmation&&v.confirmation.reservationSummary){v._process();
try{r.analyticsDimension(v.confirmation.reservationSummary,v.pageName,v.confirmation)
}catch(ay){}}}}function L(){x.requestInProgress=true;
v.insurances=H.getStorageData("insuranceList");
if(angular.isDefined(v.confirmation)&&angular.isDefined(v.confirmation.reservationSummary)&&angular.isDefined(v.confirmation.reservationSummary.rateSummary)&&angular.isDefined(v.confirmation.reservationSummary.rateSummary.selectedProducts)){v.products=v.confirmation.reservationSummary.rateSummary.selectedProducts
}var aB={};
if(angular.isDefined(aj.getSupportedOptions())){aB=aj.getSupportedOptions().supportedInsurances
}var ay=v.confirmation.reservationSummary.insuranceSummaryList;
v.insuranceDisplay=w.mergeInsurance(aB,ay);
if(N.brand==K.brandName.BUDGET&&angular.isDefined(v.confirmation.reservationSummary.ccSummary)){v.creditCardType=ABG.getCreditCardMap(v.confirmation.reservationSummary.ccSummary.type)
}else{if(angular.isDefined(v.confirmation.reservationSummary.ccSummary)&&angular.isDefined(v.confirmation.reservationSummary.ccSummary.type)){v.creditCardType=v.confirmation.reservationSummary.ccSummary.type
}}if(angular.isDefined(v.confirmation.reservationSummary.tripAggregator)){v.tripItAddedFlag=v.confirmation.reservationSummary.tripAggregator.tripitAddedFlag
}if(angular.isDefined(v.confirmation.reservationSummary&&v.confirmation.reservationSummary.prepayInfo&&v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator&&v.confirmation.reservationSummary.prepayTxn&&v.confirmation.reservationSummary.permission&&v.confirmation.reservationSummary.permission.cancel&&v.confirmation.reservationSummary.permission.cancel.visible&&v.confirmation.reservationSummary.permission.refund&&v.confirmation.reservationSummary.permission.refund.visible)&&(v.confirmation.reservationSummary.permission.cancel.visible==="TRUE"||v.confirmation.reservationSummary.permission.refund.visible==="TRUE")&&v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="C"){v.prepaycancelReservation=true
}if(angular.isDefined(v.confirmation.reservationSummary&&v.confirmation.reservationSummary.prepayInfo&&v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator&&v.confirmation.reservationSummary.prepayTxn&&v.confirmation.reservationSummary.permission&&v.confirmation.reservationSummary.permission.cancel&&v.confirmation.reservationSummary.permission.cancel.visible&&v.confirmation.reservationSummary.permission.refund&&v.confirmation.reservationSummary.permission.refund.visible)&&(v.confirmation.reservationSummary.permission.cancel.visible==="TRUE"||v.confirmation.reservationSummary.permission.refund.visible==="TRUE")&&(v.confirmation.reservationSummary.pickLoc.address.country.toUpperCase()==K.countryCodeAU||v.confirmation.reservationSummary.pickLoc.address.country.toUpperCase()==K.countryCodeNZ)){if(v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="C"&&v.confirmation.reservationSummary.prepayInfo.refundIndicator==K.RESAMT_GREATERTHAN_CANCELAMT){v.resAmt_greaterthan_cancelAmt=true
}if(v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="C"&&v.confirmation.reservationSummary.prepayInfo.refundIndicator==K.RESAMT_LESSTHAN_CANCELAMT){v.resAmt_lessthan_cancelAmt=true
}if(v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="N"&&v.confirmation.reservationSummary.prepayInfo.refundIndicator==K.RESAMT_GREATERTHAN_NOSHOWAMT){v.resAmt_greaterthan_noShowAmt=true
}if(v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="N"&&v.confirmation.reservationSummary.prepayInfo.refundIndicator==K.RESAMT_LESSTHAN_NOSHOWAMT){v.resAmt_lessthan_noShowAmt=true
}}if(angular.isDefined(v.confirmation.reservationSummary&&v.confirmation.reservationSummary.prepayInfo&&v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator&&v.confirmation.reservationSummary.prepayTxn&&v.confirmation.reservationSummary.permission&&v.confirmation.reservationSummary.permission.cancel&&v.confirmation.reservationSummary.permission.cancel.visible&&v.confirmation.reservationSummary.permission.refund&&v.confirmation.reservationSummary.permission.refund.visible)&&(v.confirmation.reservationSummary.permission.cancel.visible==="TRUE"||v.confirmation.reservationSummary.permission.refund.visible==="TRUE")&&v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="N"){v.refundcancelReservation=true
}if(angular.isDefined(v.confirmation.reservationSummary&&v.confirmation.reservationSummary.prepayInfo)){if(v.pageName==K.cancelBookingPage&&v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator=="C"&&!v.confirmation.reservationSummary.digitalWalletFlow){v.creditcardNumber=v.confirmation.reservationSummary.ccSummary.number;
v.cancelFee=v.confirmation.reservationSummary.prepayInfo.cancelFee
}else{if(v.pageName==K.cancelBookingPage&&v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator=="C"&&v.confirmation.reservationSummary.digitalWalletFlow){v.creditcardNumber=K.maskNumber+v.confirmation.reservationSummary.customerWalletGenericRS.paymentCard.ccNumberMasked;
v.cancelFee=v.confirmation.reservationSummary.prepayInfo.cancelFee
}}}if(angular.isDefined(v.confirmation.reservationSummary&&v.confirmation.reservationSummary.prepayInfo)){if(v.pageName==K.cancelBookingPage&&v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator=="N"&&!v.confirmation.reservationSummary.digitalWalletFlow){v.creditcardNumber=v.confirmation.reservationSummary.ccSummary.number;
v.cancelFee=v.confirmation.reservationSummary.prepayInfo.noShowFee
}else{if(v.pageName==K.cancelBookingPage&&v.confirmation.reservationSummary.prepayInfo.cancelOrNoShowIndicator=="N"&&v.confirmation.reservationSummary.digitalWalletFlow){v.creditcardNumber=K.maskNumber+v.confirmation.reservationSummary.customerWalletGenericRS.paymentCard.ccNumberMasked;
v.cancelFee=v.confirmation.reservationSummary.prepayInfo.noShowFee
}}}if(angular.isDefined(v.confirmation.reservationSummary&&v.confirmation.reservationSummary.prepayTxn&&v.confirmation.reservationSummary.permission)){if(v.pageName==K.cancelBookingPage&&v.confirmation.reservationSummary.prepayTxn&&angular.isDefined(v.confirmation.reservationSummary.permission)&&angular.isDefined(v.confirmation.reservationSummary.permission.cancel)&&v.confirmation.reservationSummary.permission.cancel.visible==="TRUE"&&v.confirmation.reservationSummary.prepayCancelInfo&&v.confirmation.reservationSummary.prepayCancelInfo.refundAmount){v.refund=v.confirmation.reservationSummary.prepayCancelInfo.refundAmount
}else{if(v.pageName==K.cancelBookingPage&&v.confirmation.reservationSummary.prepayTxn&&angular.isDefined(v.confirmation.reservationSummary.permission)&&angular.isDefined(v.confirmation.reservationSummary.permission.refund)&&v.confirmation.reservationSummary.permission.refund.visible==="TRUE"&&v.confirmation.reservationSummary.prepayCancelInfo&&v.confirmation.reservationSummary.prepayCancelInfo.refundAmount){v.refund=v.confirmation.reservationSummary.prepayCancelInfo.refundAmount
}}}v.reservationModel=H.getReservationModel();
if(angular.isDefined(v.reservationModel)){v.cancelModify=v.reservationModel.displayControls.cancelModify;
v.modifyConfirmation=v.reservationModel.displayControls.reservation
}var aA=H.getDataBeforeLogoClick();
if(angular.isDefined(aA)){var az=aA.prevPage;
if(K.confirmationPage===az){v.reservationModel.displayControls.reservation=aA.prevFlow;
v.modifyConfirmation=v.reservationModel.displayControls.reservation
}H.deleteDataBeforeLogoClick()
}if(v.confirmation.reservationSummary.earnPoints!=undefined){v.earnPoints=v.confirmation.reservationSummary.earnPoints
}if(v.confirmation.reservationSummary.ccSummary){if(v.confirmation.reservationSummary.ccSummary.expiryMsg){v.expiredccMessage=af.trustAsHtml(v.confirmation.reservationSummary.ccSummary.expiryMsg.message)
}else{if(v.confirmation.reservationSummary.ccSummary.credCardUpdate){v.expiredccMessage=af.trustAsHtml(v.confirmation.reservationSummary.ccSummary.credCardUpdate.message)
}}}if(v.confirmation.reservationSummary.ftpDetails&&v.confirmation.reservationSummary.ftpDetails.partnerCode&&v.confirmation.reservationSummary.ftpDetails.partnerCode!=""){var aC=u.getData();
aC.then(function(aD){v.ftp=aD;
if(v.confirmation.reservationSummary.ftpDetails.ftpBonusMiles==K.ftpNotApplicableLower){v.confirmation.reservationSummary.ftpDetails.ftpBonusMiles=K.ftpNotApplicable
}v.partnerName=b.getPartnerName(v.confirmation.reservationSummary.ftpDetails.partnerCode,v.ftp.partnersList,false)
},function(aD){})
}var ax=v.confirmation.reservationSummary.confirmationNumber;
v.userName=v.confirmation.reservationSummary.personalInfo.firstName.value;
if(v.reservationModel){H.setReservationModel(v.reservationModel)
}v._displayTermsConditions();
if(!v.cancelModify){v._constructLocationLinks()
}x.emailRedirectingPath=false;
x.requestInProgress=false
}function g(){if(angular.isDefined(v.focusTerms)&&v.focusTerms!=null&&((v.focusTerms.indexOf("terms")!=-1)||v.linkref=="fullterms")){ac.scrollTo("scrollPage")
}if(angular.isDefined(v.focusTerms)&&v.focusTerms!=null&&(v.focusTerms.indexOf("Debit")!=-1||v.linkref=="terms")){ac.scrollTo("scrollPage");
v.debit=Dictionary.I18n.get("lbl.res.resConf.debitCardPolicies");
v.indexCount;
for(var ax=0;
ax<v.CompleteTexNew.length;
ax++){if(v.CompleteTexNew[ax].Id==v.debit){v.indexCount=ax;
break
}}}}function ab(){if(angular.isDefined(v.confirmation.reservationSummary.pickLoc)&&angular.isDefined(v.confirmation.reservationSummary.pickLoc.address)&&angular.isDefined(v.confirmation.reservationSummary.pickLoc.address.country)&&angular.isDefined(v.confirmation.reservationSummary.pickLoc.address.state)&&angular.isDefined(v.confirmation.reservationSummary.pickLoc.address.city)&&angular.isDefined(v.confirmation.reservationSummary.pickLoc.locationCode)){var ay=v.confirmation.reservationSummary.pickLoc.address.city.toLowerCase().replace(/[^a-zA-Z]+/g,"-");
if(v.confirmation.reservationSummary.pickLoc.address.state.toLowerCase()==K.locationState){v.pickUpLocationLink=rootpath+"/locations/"+v.confirmation.reservationSummary.pickLoc.address.country.toLowerCase()+"/"+ay+"/"+v.confirmation.reservationSummary.pickLoc.locationCode.toLowerCase()+htmlExtension+"?shuttle=true"
}else{v.pickUpLocationLink=rootpath+"/locations/"+v.confirmation.reservationSummary.pickLoc.address.country.toLowerCase()+"/"+v.confirmation.reservationSummary.pickLoc.address.state.toLowerCase()+"/"+ay+"/"+v.confirmation.reservationSummary.pickLoc.locationCode.toLowerCase()+htmlExtension+"?shuttle=true"
}}if(angular.isDefined(v.confirmation.reservationSummary.dropLoc)&&angular.isDefined(v.confirmation.reservationSummary.dropLoc.address)&&angular.isDefined(v.confirmation.reservationSummary.dropLoc.address.country)&&angular.isDefined(v.confirmation.reservationSummary.dropLoc.address.state)&&angular.isDefined(v.confirmation.reservationSummary.dropLoc.address.city)&&angular.isDefined(v.confirmation.reservationSummary.dropLoc.locationCode)){var ax=v.confirmation.reservationSummary.dropLoc.address.city.toLowerCase().replace(/[^a-zA-Z]+/g,"-");
if(v.confirmation.reservationSummary.dropLoc.address.state.toLowerCase()==K.locationState){v.dropOffLocationLink=rootpath+"/locations/"+v.confirmation.reservationSummary.dropLoc.address.country.toLowerCase()+"/"+ax+"/"+v.confirmation.reservationSummary.dropLoc.locationCode.toLowerCase()+htmlExtension+"?shuttle=true"
}else{v.dropOffLocationLink=rootpath+"/locations/"+v.confirmation.reservationSummary.dropLoc.address.country.toLowerCase()+"/"+v.confirmation.reservationSummary.dropLoc.address.state.toLowerCase()+"/"+ax+"/"+v.confirmation.reservationSummary.dropLoc.locationCode.toLowerCase()+htmlExtension+"?shuttle=true"
}}else{v.dropOffLocationLink=v.pickUpLocationLink
}}function i(){var ax={};
ax.lastname=v.confirmation.reservationSummary.personalInfo.lastName.value;
ax.email=v.confirmation.reservationSummary.personalInfo.email;
ax.autoAdd="1";
v._callTripItService(ax)
}function aa(ax){w.addToTripIt(ax).then(function(ay){if(ay.errorList&&ay.errorList.length>0){v.tripItError=true;
v.tripItMessage=ay.errorList[0].message
}else{if(ay.message==K.tripItServiceMsgSuccess){v.tripItAddedFlag=true;
jQuery(".tripit-signin-modal").modal("hide");
var az={};
N.dataLayer=N.dataLayer||[];
az.event="errorCode";
az.tripIt="Reservation added successfully to tripIt";
dataLayer.push(az)
}}},function(ay){})
}function t(){N.location.href=x.contextPath+"/"+x.locale+"/reservation/tripit"+htmlExtension
}function J(ax){if(ax=="enrollment"){ABG.redirectPage(x.contextPath+"/"+x.locale+"/loyalty-profile/avis-preferred/enrollment"+htmlExtension)
}else{if(ax=="profile"){ABG.redirectPage(x.contextPath+"/"+x.locale+"/loyalty-profile/avis-preferred/dashboard/profile"+htmlExtension)
}else{if(ax=="login"){ABG.redirectPage(x.contextPath+"/"+x.locale+"/loyalty-profile/avis-preferred/login"+htmlExtension)
}}}}if(Z.current.name==K.displayConfirmationPage){v._emailUrlParams();
v.displayConfirmationPage=true;
if(I.getXsrfToken()||I.getSessionModel()){v.displayConfirmationPage=false;
v._pageInit()
}}else{v._pageInit()
}var U=x.$on("initSuccess",function(ay,ax){if(v.displayConfirmationPage){v._pageInit()
}});
jQuery(document).ready(function(){if(v.pageName==K.confirmationPage||v.pageName==K.cancelBookingPage||v.pageName==K.preCheckoutCompletePage){H.addGTMScript()
}})
}})();
(function(){angular.module("reservation").controller("ExtrasController",a);
a.$inject=["helpcontentService","reviewService","$sce","ftpService","$controller","$scope","$rootScope","$state","$window","$filter","optionalService","vehicleService","authenticationService","couponService","$validation","carRentalConstant","$timeout","reservationModelService","gaService","merchandisingService","storageService","recommendedDataService","utilityService","getDataService","bridgeService","ModalService","locationTermsConditionsService","reviewModifyService","ancillaryService"];
function a(ap,aW,ay,A,ac,Q,F,at,Z,aN,af,aZ,U,aV,aE,W,ae,T,x,M,ai,aP,c,aB,s,au,ax,aT,G){if(Z.jsProfileConfigFlag==="true"){Z.startTime.protectionCoverage=performance.now()
}ac("ExceptionHandlerController",{$scope:Q});
var E=this;
var aI=ac("CouponController",{$scope:Q});
angular.extend(this,aI);
E.session=U.getSessionModel();
E.insuranceCheckbox={};
E.productCheckbox={};
E.pointCheckbox={};
E.productCarUpsell={};
E.pointCarUpsell={};
E.insurancePackageSelected=false;
E.childSafetyExpanded=false;
E.couponcheckCarupsell=false;
E.selectedProductsCodeForExpansion={};
E.rateAmountShow=Z.rateAmountShow;
E.reservationModel=T.getReservationModel();
if(angular.isDefined(E.reservationModel)){E.reservationModel.initOptionalServiceFlag=true;
E.couponNumber=E.reservationModel.coupon.couponNumber;
if(E.pageName==W.step3PageName&&E.reservationModel.selectedProducts.length==0){E.reservationModel.initOptionalServiceFlag=false
}}E.pageName=at.current.name;
E.domain=Z.domain;
E.couponFlag=false;
var f=false;
E.showUpsellCampaign=false;
E.totalreedem=0;
E.displayFreedayFlag=false;
E.childSafetyExpanded=false;
E.childSafetyExpandedCheck=false;
E.rewardSelectDds=1;
E.couponCodeDisabled=false;
E.memberName="";
E.currencySymbol="";
E.freedaySectionDisplay=false;
E.bundleCheckbox=[];
E.showExtrasSavingsHeading=false;
E.cssDropDown={};
E.cssDropDownValues={CBS:[],CFS:[],CIS:[],CSB:[],CSS:[],BXM:[],BXS:[],BXL:[]};
var aw={prefferedPointsFlag:"",loyaltyDetails:"",pointProducts:"",displayFreedayFlag:"",freedaySectionDisplay:"",freeDayPoints:"",totalreedem:"",redeemableDays:"",pointCheckbox:"",frdProdFlag:false,redeemQty:0};
var P="";
var ar="";
var u="";
var t="";
var aa="";
E.subcontent="";
E.test=0;
E.rentalLocationCountry="";
E.insuranceDisplayCount={};
E.equipDisplayLen={};
E.servicesDisplaylen={};
E.hideTierBundles=Z.hideTierBundles;
E.showEquipmentSec=false;
E.servicestab1len={};
E.showCarousalArrow=false;
E.displayBundles=false;
E.servicestab2len={};
E.getLoginModalWindow=j;
E.notYou=aM;
E.initExtrasPage=av;
E.insuranceSelected=S;
E.pointSelected=Y;
E.productSelected=L;
E.pointSelectedvsFTP=r;
E.keepFTPEarning=X;
E.keepPointsSelection=a1;
E.subProductSelected=aU;
E.updateProtectionModal=aJ;
E.updateEquipmentModal=o;
E.cancelProtectionModal=p;
E.cancelEquipmentModal=aj;
E.cancelDiscountModal=h;
E.getncfmessage=m;
E.review=ag;
E.childSafetyExpand=aC;
E.handleUpsellSelection=aD;
E.analytics=am;
E.childSafetyModel=l;
E.scrollSetTop=aA;
E.updateFTP=aO;
E.loadHelpModal=R;
E.checkForPrfered=an;
E.checkForStep4=ao;
E.disablePtsPerDay=D;
E.disableExtraFromRecent=aG;
E.disableExtraFromNonRecent=aS;
E.showHideRecentExtras=v;
E.recentExtrasIndicator=aR;
E.couponRedeemed=false;
E.frdLessPoints=false;
E.closeCarModel=aH;
E.productUpsellCode;
E.showUpsellMessage=false;
E.closeModal=aQ;
E.bookAgainFTPCheck=O;
E.getPrepayTnCs=d;
E.createBundleExtrasList=az;
E.showExcludedProducts=n;
E.selectBundle=H;
E._productUpsellMessage=K;
E._recentExtrasReady=a0;
E._authenticationHandler=al;
E._merchandisingServiceListener=B;
E._setDataIntoSession=w;
E._handlePKGInsurance=y;
E._handleCSSDisplay=aF;
E._getFTPSectionMessage=q;
E._retainPointStatus=z;
E._validateFTPData=N;
E._reviewFtp=aq;
E._calculateFreedayPoints=g;
E._frwdSelected=e;
E.amazonBenefitsKey=Dictionary.I18n.get("lbl.global.amazonBenefits");
E._tierBundlesDisplay=ak;
var aL=ac("ExtrasExnController",{$scope:Q});
angular.extend(this,aL);
var I=false;
var aY=0;
var ah=0;
var ab=0;
function aH(){au.closeModal({type:"CarDetailsModify"})
}function K(){if(angular.isDefined(E.reservationModel)&&angular.isDefined(E.reservationModel.selectedProducts)){var i=af.productUpsellMessage(E.reservationModel.selectedProducts);
E.showUpsellMessage=i.showUpsellMessage;
E.productUpsellCode=i.productUpsellCode;
E.reservationModel.selectedProducts=i.selectedProducts;
T.setReservationModel(E.reservationModel)
}}function v(a2,a3,a4){if(E.prod&&E.prod.webHeader&&E.prod.webHeader.p13nDetailsMap){var a5=E.prod.webHeader.p13nDetailsMap
}else{return false
}if(E.reservationModel.displayControls.reservation!=W.resFlowCreate||(E.prod&&E.prod.reservationSummary.userState===W.userStateAnonymous)){return false
}var i=E._recentExtrasReady(a4);
if(a2&&a3&&a5&&i){if(a5.crmTopRentedAncillaries&&a5.crmTopRentedAncillaries.length>0){E.recentExtrasFlag="ancillaries";
return true
}else{if(a5.rentalCounterProducts&&a5.rentalCounterProducts.length>0&&i){E.recentExtrasFlag="rentalExtra";
return true
}}}else{if(a2&&a5&&i){if(a5.crmTopRentedAncillaries&&a5.crmTopRentedAncillaries.length>0){E.recentExtrasFlag="ancillaries";
return true
}}else{if(a3&&a5&&i){if(a5.rentalCounterProducts&&a5.rentalCounterProducts.length>0){E.recentExtrasFlag="rentalExtra";
return true
}}}}return false
}function a0(i){if(i){for(ab=0;
ab<i.length;
ab++){if(i[ab].ancillaries||i[ab].rentalExtra){return true
}}}return false
}function aR(i){if(E.recentExtrasFlag==="ancillaries"){return i.ancillaries
}else{return i.rentalExtra
}}function aG(i){if(i.productId===i.code+"chk_ext"||i.productId===i.code+"points_ext"||i.productId===i.code+"FTPpoints_ext"){return true
}else{return false
}}function aS(i){if(i.productId===i.code+"chk"||i.productId===i.code+"points"||i.productId===i.code+"FTPpoints"){return true
}else{return false
}}function D(i){if(((i.points+E.prod.reservationSummary.rateSummary.totalRdmPts>E.totalPoints||i.redeemable==false)&&(E.pointCheckbox[i.code]==undefined||E.pointCheckbox[i.code]==false))||E.redeemedRes){return true
}else{return false
}}function ao(){if(E.pageName==W.step4PageName||E.pageName==W.step4PayLaterPageName||E.pageName==W.bookAgainPayNowPage||E.pageName==W.bookAgainPayLaterPage){return true
}else{return false
}}function an(){if(E.pageName==W.step3PageName&&E.prod&&E.prod.reservationSummary.loyaltyDetails&&E.prod.reservationSummary.loyaltyDetails.loyaltyLogin&&E.prod.reservationSummary.loyaltyDetails.loyaltyLogin.visible=="TRUE"&&angular.isDefined(E.session)&&E.session.status==W.userStateRecognized&&!E.prod.reservationSummary.lockStatus){return true
}else{return false
}}function am(i){var a2={};
a2.event="analyticsVPV";
a2.vpvName="/vpv/linkClickPage-"+i+E.pageName;
dataLayer.push(a2)
}function aA(){document.body.scrollTop=0
}function j(){F.$broadcast("LoginActivity",{requestType:"Login",variance:"Small"})
}function aM(){var i={};
i=U.logout();
i.then(function(a2){if(angular.isDefined(a2.fieldErrors)&&a2.fieldErrors.length>0||(angular.isDefined(a2.errorList)&&a2.errorList.length>0)||(angular.isDefined(a2.warningList)&&a2.warningList.length>0)){Q.processErrorMessage(a2)
}else{Z.location.href=rootpath+"/home"+htmlExtension
}},function(a2){})
}function al(i){E.model=i;
if(at.current.name==W.step3PageName){if(i.reservationSummary.userState==W.userStateAuthenticated){af.load().then(function(a2){if(angular.isDefined(a2.fieldErrors)&&a2.fieldErrors.length>0||(angular.isDefined(a2.errorList)&&a2.errorList.length>0)){Q.processErrorMessage(a2)
}else{E.session=U.getSessionModel();
E.initExtrasPage()
}},function(a2){})
}else{E.loginValidated=true;
E.loginFormPageError=Dictionary.I18n.get("err.prof.login.authenticationFailedAction")
}}}F.$on("Profile.successAuthentication",function(a2,i){E._authenticationHandler(i)
});
function l(){E.content=!I;
E.subcontent="mdlsubsafety"
}function k(i){return $.grep(E.ftp.partnersList,function(a2){return a2.partnerId==i
})
}function av(){E.loadingSpinner=true;
E._productUpsellMessage();
E.loyaltyDetails=U.getLoyaltyDetails();
var i=af.getData();
i.then(function(a7){var bb=ai.getStorageData("oneClickURLCode");
if(bb!=null&&bb!=""){ai.deleteStorageData("oneClickURLCode")
}var a4=ai.getStorageData("bridgeResponse");
if(a4!=null&&a4!=""&&angular.isDefined(a4.errorList)&&a4.webHeader.viewIndicator==="4"){a4=Q.processErrorMessage(a4);
a7.errorList=a4.errorList
}if(angular.isDefined(a7.fieldErrors)&&a7.fieldErrors.length>0||(angular.isDefined(a7.errorList)&&a7.errorList.length>0)||(angular.isDefined(a7.warningList)&&a7.warningList.length>0)||(angular.isDefined(a7.instructionList)&&a7.instructionList.length>0)){a7=Q.processErrorMessage(a7);
if(angular.isDefined(a7.fieldErrors)&&a7.fieldErrors.length>0||(angular.isDefined(a7.errorList)&&a7.errorList.length>0)){E.errorList=a7.errorList
}if(angular.isDefined(a7.warningList)&&a7.warningList.length>0){E.warningList=a7.warningList
}if(angular.isDefined(a7.instructionList)&&a7.instructionList.length>0){E.instructionList=a7.instructionList
}}E.prod=a7;
var bg=["us","ca","au","nz"];
var bc=["au","nz"];
if(angular.isDefined(E.prod.domainConfig)&&angular.isDefined(E.prod.domainConfig.rentLoc)&&angular.isDefined(E.prod.domainConfig.cor)){if((F.isAnonymous&&E.reservationModel.displayControls.reservation==="create")&&(ABG.arrayHasObject(Z.domain.toLowerCase(),bc))&&(ABG.arrayHasObject(E.prod.domainConfig.rentLoc.toLowerCase(),bc))&&(ABG.arrayHasObject(E.prod.domainConfig.cor.toLowerCase(),bg))){E.showUpsellCampaign=true
}}if(angular.isDefined(a7.reservationSummary.vehicle)&&angular.isDefined(a7.reservationSummary.vehicle.classDescription)){E.carDescription=a7.reservationSummary.vehicle.classDescription
}ae(function(){F.$broadcast("couponRedeemRemoval",a7)
},100);
E.insurances=a7.reservationSummary.insuranceSummaryList;
E.products=a7.reservationSummary.productSummaryList;
var bd=G.process(a7.reservationSummary);
E.ancillaryProductsList=bd.ancillaryProductsList;
E.insuranceDisplayCount=bd.insuranceDisplayCount;
E.displayTabsList=bd.displayTabsList;
E.equipDisplayLen=bd.equipDisplayLen;
E.servicesDisplaylen=bd.servicesDisplaylen;
E.servicestab1len=bd.servicestab1len;
E.servicestab2len=bd.servicestab2len;
E.pointProducts=a7.reservationSummary.pointProducts;
E.reservationModel.ccsection=a7.reservationSummary.ccsection;
E.reservationModel.payNowCheckBoxInd=a7.reservationSummary.payNowCheckBoxInd;
E.reservationModel.coupon.discountNumber=a7.reservationSummary.awdNumber;
if(angular.isDefined(a7.reservationSummary.discountSummaryList)){E.reservationModel.discountSummaryList=a7.reservationSummary.discountSummaryList;
var a6="";
angular.forEach(E.reservationModel.discountSummaryList,function(bi,bh){if(bi.selected){a6=bi.discountNumber
}else{a6=a7.reservationSummary.awdNumber
}});
E.reservationModel.coupon.discountNumber=a6
}else{E.reservationModel.coupon.discountNumber=a7.reservationSummary.awdNumber
}if(angular.isDefined(a7.reservationSummary.amazonLinked)){E.reservationModel.amazonLinked=a7.reservationSummary.amazonLinked
}if(angular.isDefined(a7.reservationSummary.amazonLinkingSupported)){E.reservationModel.amazonLinkingSupported=a7.reservationSummary.amazonLinkingSupported
}if(E.reservationModel.coupon!=undefined){P=E.reservationModel.coupon.couponNumber;
t=E.reservationModel.coupon.couponQuantity;
ar=E.reservationModel.coupon.discountNumber;
aa=E.reservationModel.rentalType
}if(E.prod.unavailProductMsg||E.prod.unavailInsuranceMsg||E.prod.reservationSummary.productDropMsg){E.droppedProdAndInsuranceList=aT.droppedData(E.prod)
}if(E.prod.reservationSummary.couponRateCode){u=E.prod.reservationSummary.couponRateCode
}else{u=""
}if((E.prod.reservationSummary.loyaltyDetails!=undefined&&E.prod.reservationSummary.loyaltyDetails.points>0)&&(E.prod.reservationSummary.pickLoc.address.country=="US"||E.prod.reservationSummary.pickLoc.address.country=="CA"||E.prod.reservationSummary.pickLoc.address.country=="PR"||E.prod.reservationSummary.pickLoc.address.country=="VI")){E.displayFreedayFlag=true
}if(W.resFlowCreate===E.reservationModel.displayControls.reservation&&(a7.reservationSummary.userState===W.userStateAuthenticated||a7.reservationSummary.userState===W.userStateRecognized)){E._merchandisingServiceListener(E,a7)
}E.prefferedPointsFlag=false;
var a5=0;
var a9=angular.copy(E.products);
var a3=angular.copy(E.pointProducts);
var a2=angular.copy(E.insurances);
E._setDataIntoSession(a9,a3,a2);
E._handlePKGInsurance();
E._handleCSSDisplay();
E._tierBundlesDisplay();
E.rentalLocationCountry=a7.reservationSummary.pickLoc.address.country.toUpperCase();
if(angular.isDefined(a7.reservationSummary.rateSummary)&&angular.isDefined(a7.reservationSummary.rateSummary.couponRedeemRemoval)&&angular.isDefined(a7.reservationSummary.rateSummary.couponRedeemRemoval.code)){E.couponRedeemed=true
}if(angular.isDefined(a7.reservationSummary.pointProducts)&&angular.isDefined(a7.reservationSummary.pointProducts.freeDay)&&angular.isDefined(a7.reservationSummary.pointProducts.freeDay.freeDayLessPoints)){E.frdLessPoints=a7.reservationSummary.pointProducts.freeDay.freeDayLessPoints
}E.couponcheck=angular.isDefined(E.prod.reservationSummary.coupon);
E.couponcheckCarupsell=(angular.isDefined(E.prod.reservationSummary.coupon)&&angular.isDefined(E.prod.reservationSummary.coupon.number));
if((E.prod.reservationSummary.prepayTxn)||(E.prod.reservationSummary.ccsection&&E.prod.reservationSummary.ccsection.visible=="TRUE"&&E.prod.reservationSummary.payNowCheckBoxInd&&E.prod.reservationSummary.payNowCheckBoxInd.visible=="FALSE"&&E.prod.reservationSummary.prepayTxn===false)){E.isPayLaterOnlyReservation=false
}else{if(E.prod.reservationSummary.payNowCheckBoxInd.visible=="TRUE"&&(!E.reservationModel.prepayOpted&&!E.reservationModel.prepayProcessIndicator&&!(E.rentalLocationCountry==W.countryCodeAU.toUpperCase()||E.rentalLocationCountry==W.countryCodeNZ.toUpperCase()))){E.isPayLaterOnlyReservation=false
}else{E.isPayLaterOnlyReservation=true
}}E.getncfmessage();
E.currencySymbol=aN("currencySymbol")(a7.reservationSummary.rateSummary.currencySymbol);
aw.reservationModel=angular.copy(E.reservationModel);
var ba=af.handleLoyalty(E.prod.reservationSummary,aw,E.pointCheckbox,E.productCheckbox,"EXTRAS",E.products);
E.prefferedPointsFlag=ba.prefferedPointsFlag;
E.loyaltyDetails=ba.loyaltyDetails;
E.pointProducts=ba.pointProducts;
E.displayFreedayFlag=ba.displayFreedayFlag;
E.freedaySectionDisplay=ba.freedaySectionDisplay;
E.redeemableDays=ba.redeemableDays;
E.freeDayPoints=ba.freeDayPoints;
E.totalreedem=ba.totalReedemPoints;
E.pointCheckbox=ba.pointCheckbox;
E.productCheckbox=ba.productCheckbox;
if(ba.selectedProducts){E.reservationModel.selectedProducts=ba.selectedProducts
}a5=ba.redeemQty;
var bf=af.displayCarUpsell(E.pointProducts);
E.priceUPS=bf.priceUPS;
E.redeemableUPS=bf.redeemableUPS;
E.pointsUPS=bf.pointsUPS;
if(!(E.prod.reservationSummary.ancillaryBundleSummary&&E.prod.reservationSummary.ancillaryBundleSummary.length>0&&"INBOUND_BASIC"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"INBOUND_ALL"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"GUIDED_RES"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"LAST_MINUTE"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName)&&(!angular.isDefined(E.insurances))){E.showEquipmentSec=true
}if((E.prod.reservationSummary.ancillaryBundleSummary&&E.prod.reservationSummary.ancillaryBundleSummary.length>0&&"INBOUND_BASIC"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"INBOUND_ALL"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"GUIDED_RES"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"LAST_MINUTE"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName)&&angular.isDefined(E.insurances)&&angular.isDefined(E.products)||(!(E.prod.reservationSummary.ancillaryBundleSummary&&E.prod.reservationSummary.ancillaryBundleSummary.length>0&&"INBOUND_BASIC"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"INBOUND_ALL"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"GUIDED_RES"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"LAST_MINUTE"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName)&&angular.isDefined(E.insurances)&&angular.isDefined(E.products))||((E.prod.reservationSummary.ancillaryBundleSummary&&E.prod.reservationSummary.ancillaryBundleSummary.length>0&&"INBOUND_BASIC"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"INBOUND_ALL"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"GUIDED_RES"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"LAST_MINUTE"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName)&&!angular.isDefined(E.insurances)&&angular.isDefined(E.products))||(E.prod.reservationSummary.ancillaryBundleSummary&&E.prod.reservationSummary.ancillaryBundleSummary.length>0&&"INBOUND_BASIC"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"INBOUND_ALL"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"GUIDED_RES"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"LAST_MINUTE"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName)&&angular.isDefined(E.insurances)&&!angular.isDefined(E.products)){E.showCarousalArrow=true
}if(E.prod.reservationSummary.ancillaryBundleSummary&&E.prod.reservationSummary.ancillaryBundleSummary.length>0&&"INBOUND_BASIC"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"INBOUND_ALL"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"GUIDED_RES"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName&&"LAST_MINUTE"!==E.prod.reservationSummary.ancillaryBundleSummary[0].bundleName){E.displayBundles=true
}E.Tabactive=G.getCurrentActiveTab(E.displayTabsList);
if(a7.reservationSummary.ftpDetails&&a7.reservationSummary.ftpDetails.visible=="TRUE"){var be=A.getData();
be.then(function(bh){E.ftp=bh;
if(a7.reservationSummary.ftpDetails.partnerCode!=W.ftpNotApplicableLower){E.reservationModel.ftpDetails.partnerCode=a7.reservationSummary.ftpDetails.partnerCode
}else{E.reservationModel.ftpDetails.partnerCode=""
}if(angular.isDefined(a7.reservationSummary.ftpDetails.ftpNumber)&&a7.reservationSummary.ftpDetails.ftpNumber.toLowerCase()!=W.ftpNotApplicableLower){E.reservationModel.ftpDetails.ftpNumber=a7.reservationSummary.ftpDetails.ftpNumber
}else{E.reservationModel.ftpDetails.ftpNumber=""
}E.reservationModel.ftpDetails.ftpBonusMiles=a7.reservationSummary.ftpDetails.ftpBonusMiles;
if(a7.reservationSummary.ftpDetails.messages){E._getFTPSectionMessage(a7.reservationSummary.ftpDetails.messages)
}},function(bh){})
}T.setReservationModel(E.reservationModel);
E._retainPointStatus();
setTimeout(function(){var bh=(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Tablet PC|Opera Mini/i.test(navigator.userAgent))?"focus":"hover";
jQuery('a.popOver[data-toggle="popover"], a.steptwoinfo[data-toggle="popover"], a.info-icon[data-toggle="popover"]').attr("data-trigger",bh);
jQuery('[data-toggle="popover"]').popover();
jQuery(".hide-on-load").removeClass("hide-on-load")
},100);
if(E.pageName==W.step3PageName){try{x.analyticsDimension(E.prod.reservationSummary,E.pageName,E.prod)
}catch(a8){}}E.loadingSpinner=false
},function(a2){})
}function B(i,a2){M.promisesExecution(a2,"extras").then(function(a3){i.products=a3.reservationSummary.productSummaryList;
if(a3.webHeader.p13nDetailsMap.rentalCounterProducts){var a4=T.getReservationModel();
a4.recentExtras=a3.webHeader.p13nDetailsMap.rentalCounterProducts;
T.setReservationModel(a4)
}})
}E.initExtrasPage();
function d(){E.contentType=(E.prod.reservationSummary.prepayTxn===true)?W.txnTypePrePay:W.txnTypePostPay,E.promise=ax.load(E.contentType,E.prod.reservationSummary.pickLoc.locationCode);
E.promise.then(function(i){E.tempDescription=i
},function(i){})
}function m(){if(angular.isDefined(E.prod.reservationSummary.rateSummary.disclosureFeeMsg)){E.ncfmessage=E.prod.reservationSummary.rateSummary.disclosureFeeMsg.values[0]
}}function J(a3,a4){for(var a2=0;
a2<=a4;
a2++){E.cssDropDownValues[a3].push({selectId:a2,selectName:a2})
}}function aF(){angular.forEach(E.products,function(a3){if(a3.selected===true){E.productCheckbox[a3.code]=true
}if(a3.subProducts!=undefined){var i=a3.subProducts;
angular.forEach(i,function(a4){J(a4.code,a4.displayQuantity);
if(a4.selected===true){E.pointCheckbox[a3.code]=false;
E.productCheckbox[a3.code]=true;
E.childSafetyExpanded=true;
E.selectedProductsCodeForExpansion[a3.code]=true;
E.cssDropDown[a4.code]=a4.quantity;
E.productCheckbox[a4.code]=true;
E.subProductInclusionMessage=a4.productMessage.message
}else{E.cssDropDown[a4.code]=0
}})
}});
for(var a2=0;
a2<E.reservationModel.selectedProducts.length;
a2++){if(E.reservationModel.selectedProducts[a2].code=="CSSG"){E.subProductSelected();
break
}}}function ak(){var a2,a3=[],a4=T.getReservationModel();
if(angular.isDefined(E.prod.reservationSummary.ancillaryBundleSummary)){E.selectedBundleName=aX(E.prod.reservationSummary.ancillaryBundleSummary);
a4.selectedBundleName=E.selectedBundleName;
E.showExtrasSavingsHeading=b(E.prod.reservationSummary.ancillaryBundleSummary);
for(a2=0;
a2<E.prod.reservationSummary.ancillaryBundleSummary.length;
a2++){a3[a2]=E.prod.reservationSummary.ancillaryBundleSummary[a2].bundleName
}a4.bundleNameList=a3;
T.setReservationModel(a4)
}}function z(){if((E.reservationModel.selectedProducts).length>0){var i;
angular.forEach(E.reservationModel.selectedProducts,function(a2,a3){if(E.reservationModel.selectedProducts[a3].redeemedQty==undefined||E.reservationModel.selectedProducts[a3].redeemedQty<1){E.productCheckbox[E.reservationModel.selectedProducts[a3].code]=true;
E.pointCheckbox[E.reservationModel.selectedProducts[a3].code]=false
}if(E.reservationModel.selectedProducts[a3].redeemedQty!=undefined&&E.reservationModel.selectedProducts[a3].redeemedQty>0){E.pointCheckbox[E.reservationModel.selectedProducts[a3].code]=true;
E.productCheckbox[E.reservationModel.selectedProducts[a3].code]=false
}})
}}function w(a3,i,a2){T.setStorageData("insuranceList",a2);
T.setStorageData("productList",a3);
T.setStorageData("pointProductList",i)
}function y(){angular.forEach(E.insurances,function(a2){if(a2.selected){E.insuranceCheckbox[a2.code]=true;
var i=false;
angular.forEach(E.reservationModel.selectedInsurances,function(a3){if(a2.code==a3.code){i=true
}});
if(!i){E.reservationModel.selectedInsurances.push(a2)
}}if(a2.selected&&a2.code===W.insuranceCodePKG){E.insurancePackageSelected=true
}})
}function S(a3,i){if($("#PKGchk").length>0){if((E.insuranceCheckbox.PEP&&E.insuranceCheckbox.ALI&&E.insuranceCheckbox.PAI)||(E.insuranceCheckbox.PKG)){E.insuranceCheckbox.PKG=true;
E.insurancePackageSelected=true;
E.insuranceCheckbox.PEP=false;
E.insuranceCheckbox.ALI=false;
E.insuranceCheckbox.PAI=false;
E.reservationModel.selectedInsurances=[];
angular.forEach(E.insurances,function(a4){if(a4.code==W.insuranceCodePKG){a3=a4;
a3.selected=true
}});
E.reservationModel.selectedInsurances.push(a3)
}else{E.insurancePackageSelected=false
}}if(!E.insurancePackageSelected){a3.selected=E.insuranceCheckbox[i];
if(E.insuranceCheckbox[i]){E.reservationModel.selectedInsurances.push(a3)
}else{E.reservationModel=af.arrayPop(i,true,E.reservationModel)
}}T.setReservationModel(E.reservationModel);
if(E.pageName==W.step3PageName||E.pageName==W.modifyReservationPage){F.requestInProgress=true;
var a2=af.recalculate("false");
a2.then(function(a4){if(angular.isDefined(a4.fieldErrors)&&a4.fieldErrors.length>0||(angular.isDefined(a4.errorList)&&a4.errorList.length>0)){Q.processErrorMessage(a4)
}else{F.requestInProgress=false;
E.insurances=a4.reservationSummary.insuranceSummaryList;
E.products=a4.reservationSummary.productSummaryList;
E.prod=a4;
setTimeout(function(){jQuery('[data-toggle="popover"]').popover({trigger:"hover"});
if(CQ_Analytics.ProfileDataMgr){CQ_Analytics.ProfileDataMgr.fireEvent("update")
}},100)
}},function(a4){})
}}E.helpURL="";
function R(i){var a2=i.target.parentElement;
var a3=E.prod.reservationSummary.pickLoc.address.country;
E.helpURL=ap.getUrl(a2,a3)
}function O(i){if(i&&E.prod.reservationSummary.rebookFlow){if(angular.isDefined(E.prod.reservationSummary.ftpDetails.ftpNumber)){return true
}else{return false
}}else{if(!i&&E.prod.reservationSummary.rebookFlow){if(angular.isUndefined(E.prod.reservationSummary.ftpDetails.ftpNumber)){return true
}else{return false
}}}if(!i){return false
}else{return true
}}function r(a2,a3,a4,i){if(a4==W.productSectionFREEDAYS){if(E.prod.reservationSummary.ftpDetails.visible=="TRUE"){angular.element(".ftp-loyality-modal").modal("show");
E._productUpsellMessage()
}else{E._frwdSelected(a2)
}}E.couponCodeDisabled=af.disablecoupon(E.reservationModel);
E.productObjSelected=a2;
E.codeSelected=a3;
E.productSectionSelected=a4
}function a1(){if(E.productSectionSelected==W.productSectionCARUPSELL){E.handleUpsellSelection(E.productObjSelected,E.codeSelected)
}else{if(E.productSectionSelected==W.productSectionFREEDAYS){var i;
E._frwdSelected(i)
}else{E.pointSelected(E.productObjSelected,E.codeSelected);
E.couponCodeDisabled=af.disablecoupon(E.reservationModel)
}}}function n(a4){E.excludedProductsList=[];
var a3,a2;
if(a4){if(a4.productSummaryList&&a4.productSummaryList.length>0){for(a3=0;
a3<a4.productSummaryList.length;
a3++){if(a4.productSummaryList[a3].code!=W.equipmentCodeCSSG){if(a4.productSummaryList[a3].discountEligible==false||a4.productSummaryList[a3].discountEligible==""){E.excludedProductsList.push(a4.productSummaryList[a3].description)
}}else{for(a2=0;
a2<a4.productSummaryList[a3].subProducts.length;
a2++){if(a4.productSummaryList[a3].subProducts[a2].discountEligible==false||a4.productSummaryList[a3].subProducts[a2].discountEligible==""){E.excludedProductsList.push(a4.productSummaryList[a3].subProducts[a2].description)
}}}}}if(a4.insuranceSummaryList&&a4.insuranceSummaryList.length>0){for(a3=0;
a3<a4.insuranceSummaryList.length;
a3++){if(a4.insuranceSummaryList[a3].discountEligible==false||a4.insuranceSummaryList[a3].discountEligible==""){E.excludedProductsList.push(a4.insuranceSummaryList[a3].description)
}}}}}function e(i){F.requestInProgress=true;
if((angular.isDefined(E.pointProducts))&&null!=E.pointProducts.freeDay){i=E.pointProducts.freeDay
}var a2=af.frdSelected(E.pointProducts,E.freeDayPoints,E.pointCheckbox,"EXTRAS",i);
i=a2.productObj;
aY=i.redeemedQty;
ah=i.quantity;
E.pointCheckbox=a2.pointCheckbox;
E.productSelected(i,"FRD");
E.frdSelectedFlag=a2.frdSelectedFlag;
if(U.getLoyaltyDetails()!=undefined){E.freedayPresent=false;
E.loyaltyDetails=U.getLoyaltyDetails();
E.totalPointsFrd=parseInt(E.loyaltyDetails.points);
E.frdNoChnage=false
}}function X(){F.requestInProgress=true;
var i=af.disableLoyalty("true");
i.then(function(a2){if(angular.isDefined(a2.fieldErrors)&&a2.fieldErrors.length>0||(angular.isDefined(a2.errorList)&&a2.errorList.length>0)){Q.processErrorMessage(a2)
}else{F.requestInProgress=false;
E.products=a2.reservationSummary.productSummaryList;
E.pointProducts=a2.reservationSummary.pointProducts;
E.prod=a2;
E.displayFreedayFlag=false;
E.freedaySectionDisplay=af.getFreedaySectionDisplay(E.prod.reservationSummary)
}},function(a2){})
}function Y(a2,a3,i){if(E.pageName==W.step3PageName||E.pageName==W.modifyReservationPage){F.requestInProgress=true
}aY=1;
ah=1;
E.productSelected(a2,a3,"",i);
E.couponCodeDisabled=af.disablecoupon(E.reservationModel)
}function L(a2,a3,a8,a5){F.requestInProgress=true;
E.frdSelectedFlag=false;
E.reservationModel.isItalylocation=E.prod.reservationSummary.snowChainCountryIndicator;
E.reservationModel.issnowchainincluded=E.prod.reservationSummary.snowChainIncludedIndicator;
E._productUpsellMessage();
E.reservationModel.initOptionalServiceFlag=true;
if(angular.isDefined(a2.subProducts)&&a2.subProducts.length>0){E.selectedProductsCodeForExpansion[a3]=E.productCheckbox[a3]
}if(!E.productCheckbox[a3]&&angular.isDefined(a2.subProducts)&&a2.subProducts.length>0){E.productCheckbox[a3]=false;
F.requestInProgress=false;
af.unCheckCSSOption(a2);
for(var a4=0;
a4<a2.subProducts.length;
a4++){var a7=a2.subProducts[a4].code;
E.productCheckbox[a7]=false;
E.cssDropDown[a7]=0
}}else{T.setReservationModel(E.reservationModel);
var a6={pointCheckbox:E.pointCheckbox,productCheckbox:E.productCheckbox,cssDropDown:E.cssDropDown,products:E.products,redeemedQty:aY,childSafetyExpanded:E.childSafetyExpanded,frdSelectedFlag:E.frdSelectedFlag,freeDayPoints:E.freeDayPoints,loyaltyDetails:E.loyaltyDetails,totalPoints:E.totalPoints};
var ba=af.handleProducts(a2,a3,a8,a5,ah,a6);
E.reservationModel=T.getReservationModel();
E.pointCheckbox=ba.pointCheckbox;
E.productCheckbox=ba.productCheckbox;
E.cssDropDown=ba.cssDropDown;
E.products=ba.products;
E.childSafetyExpanded=ba.childSafetyExpanded;
E.freeDayPoints=ba.freeDayPoints;
E.loyaltyDetails=ba.loyaltyDetails;
E.totalPoints=ba.totalPoints;
ah=ba.quantity;
aY=ba.redeemedQty;
if(ba.flag){F.requestInProgress=false;
return
}}T.setReservationModel(E.reservationModel);
if(E.pageName==W.step3PageName||E.pageName==W.modifyReservationPage){var a9=af.recalculate("false");
a9.then(function(i){if(angular.isDefined(i.fieldErrors)&&i.fieldErrors.length>0||(angular.isDefined(i.errorList)&&i.errorList.length>0)){Q.processErrorMessage(i)
}else{F.requestInProgress=false;
E.products=i.reservationSummary.productSummaryList;
var bb=G.process(i.reservationSummary);
E.ancillaryProductsList=bb.ancillaryProductsList;
E.insurances=i.reservationSummary.insuranceSummaryList;
E.pointProducts=i.reservationSummary.pointProducts;
E.prod=Q.processErrorMessage(i);
if(E.prod.instructionList&&E.prod.instructionList.length>0){E.instructionList=E.prod.instructionList
}angular.forEach(E.instructionList,function(bc){if((E.instructionList)&&(E.instructionList.length>0)&&c.containsObject(bc.code,W.nonParticpatingBcd)){E.reservationModel.coupon.discountNumber=""
}});
T.setReservationModel(E.reservationModel);
if((angular.isDefined(E.prod.reservationSummary.coupon))&&E.prod.reservationSummary.coupon.disableCoupon===true){E.couponCodeDisabled=true
}else{E.couponCodeDisabled=false
}if(!E.frdSelectedFlag==false){E._calculateFreedayPoints()
}if(W.resFlowCreate===E.reservationModel.displayControls.reservation&&(i.reservationSummary.userState===W.userStateAuthenticated||i.reservationSummary.userState===W.userStateRecognized)){E._merchandisingServiceListener(E,i)
}ae(function(){angular.element('.f_head [data-toggle="popover"]').popover({trigger:"hover"});
angular.element(".popupDisabler").popover("disable");
angular.element(".popupEnabler").popover({trigger:"focus"});
if(CQ_Analytics.ProfileDataMgr){CQ_Analytics.ProfileDataMgr.fireEvent("update")
}},100)
}},function(i){})
}else{F.requestInProgress=false
}}function aD(a3,i){F.requestInProgress=true;
angular.forEach(E.reservationModel.selectedProducts,function(a4,a5){if(a4.code===i){E.reservationModel.selectedProducts.splice(a5,1)
}});
if(E.productCarUpsell[i]){a3.selected=true;
a3.redeemedQty=0;
a3.quantity=1;
E.reservationModel.selectedProducts.push(a3)
}else{if(E.pointCarUpsell[i]){E.totalPoints=parseInt(E.loyaltyDetails.points);
a3.selected=true;
a3.redeemedQty=1;
a3.quantity=1;
E.reservationModel.selectedProducts.push(a3)
}else{E.reservationModel=af.arrayPop(i,false,E.reservationModel)
}}E.reservationModel.pointProducts.carUpsell=a3;
T.setReservationModel(E.reservationModel);
if(E.pageName==W.step3PageName||E.pageName==W.modifyReservationPage){var a2=af.recalculate("false");
a2.then(function(a5){F.requestInProgress=false;
if(angular.isDefined(a5.fieldErrors)&&a5.fieldErrors.length>0||(angular.isDefined(a5.errorList)&&a5.errorList.length>0)){Q.processErrorMessage(a5)
}else{F.requestInProgress=false;
E.pointProducts=a5.reservationSummary.pointProducts;
E.prod=a5;
E.reservationModel.selectedCar=[];
E.reservationModel.selectedCar.push(E.prod.reservationSummary.vehicle);
if((angular.isDefined(E.prod.reservationSummary.coupon))&&E.prod.reservationSummary.coupon.disableCoupon===true){E.couponCodeDisabled=true
}if((angular.isDefined(E.pointProducts))&&null!=E.pointProducts.carUpsell){var a4=E.pointProducts.carUpsell;
E.priceUPS=0;
E.redeemableUPS=false;
E.pointsUPS=0;
if(a4.price!=undefined){E.priceUPS=a4.price
}else{E.priceUPS=0
}if(a4.redeemable==true){E.redeemableUPS=true;
E.pointsUPS=a4.points
}}if(F.isAuthenticated&&brand===carRentalConstants.brandName.AVIS){E._calculateFreedayPoints()
}}},function(a4){})
}}function g(){var i=af.calculateFreedayPoints(E.pointProducts,E.freeDayPoints);
E.noOfFreeDays=i.noOfFreeDays;
E.prefferedPointsFlag=i.prefferedPointsFlag;
E.redeemableDays=i.redeemableDays
}function aU(){if(E.childSafetyExpanded===false){E.childSafetyExpanded=true
}}function aJ(){F.requestInProgress=true;
T.setReservationModel(E.reservationModel);
var i=af.recalculate();
i.then(function(a3){if(angular.isDefined(a3.fieldErrors)&&a3.fieldErrors.length>0||(angular.isDefined(a3.errorList)&&a3.errorList.length>0)){F.requestInProgress=false;
Q.processErrorMessage(a3)
}else{var a2=aW.load();
a2.then(function(a4){E.insurances=a4.reservationSummary.insuranceSummaryList;
E.prod=a4;
at.go(E.pageName,{},{reload:true})
})
}au.closeModal({type:"protectionModify"})
},function(a2){})
}function o(){F.requestInProgress=true;
E._productUpsellMessage();
T.setReservationModel(E.reservationModel);
var i=af.recalculate();
i.then(function(a3){if(angular.isDefined(a3.fieldErrors)&&a3.fieldErrors.length>0||(angular.isDefined(a3.errorList)&&a3.errorList.length>0)){F.requestInProgress=false;
Q.processErrorMessage(a3)
}else{var a2=aW.load();
a2.then(function(a4){E.products=a4.reservationSummary.productSummaryList;
E.prodPoints=a4.reservationSummary.pointProducts;
E.prod=a4;
at.go(E.pageName,{},{reload:true})
})
}au.closeModal({type:"equipmentModify"})
},function(a2){})
}function p(){var i=T.getStorageData("insuranceList");
E.insurances=angular.copy(i);
E.reservationModel.selectedInsurances=[];
E.prod.reservationSummary.insuranceSummaryList=E.insurances;
angular.forEach(E.insurances,function(a3,a2){if(a3.selected){E.insuranceCheckbox[a3.code]=true;
E.reservationModel.selectedInsurances.push(a3)
}else{E.insuranceCheckbox[a3.code]=false
}});
au.closeModal({type:"protectionModify"})
}function h(){E.cancelDicountUtility(E,P,ar,u,t,aa)
}function aj(){var i=T.getStorageData("productList");
E.products=angular.copy(i);
E.reservationModel.selectedProducts=[];
E.prod.reservationSummary.productSummaryList=E.products;
angular.forEach(E.products,function(a4,a2){if(a4.code===W.equipmentCodeCSSG){var a3=false;
angular.forEach(a4.subProducts,function(a6,a5){if((a6.selected&&a6.redeemedQty&&a6.redeemedQty<1)||(a6.selected&&!a6.redeemedQty)){E.productCheckbox[a6.code]=true;
E.pointCheckbox[a6.code]=false;
E.cssDropDown[a6.code]=a6.quantity;
a3=true;
E.reservationModel.selectedProducts.push(a6)
}else{if(a6.selected&&a6.redeemedQty&&a6.redeemedQty>0){E.pointCheckbox[a6.code]=true;
E.productCheckbox[a6.code]=false;
E.cssDropDown[a6.code]=a6.quantity;
a3=true;
E.reservationModel.selectedProducts.push(a6)
}else{E.productCheckbox[a6.code]=false;
E.pointCheckbox[a6.code]=false;
E.cssDropDown[a6.code]=0
}}});
if(a3){E.productCheckbox[a4.code]=true
}else{E.productCheckbox[a4.code]=false
}}else{if((a4.selected&&a4.redeemedQty&&a4.redeemedQty<1)||(a4.selected&&!a4.redeemedQty)){E.productCheckbox[a4.code]=true;
E.pointCheckbox[a4.code]=false;
E.reservationModel.selectedProducts.push(a4)
}else{if(a4.selected&&a4.redeemedQty&&a4.redeemedQty>0){E.pointCheckbox[a4.code]=true;
E.productCheckbox[a4.code]=false;
E.reservationModel.selectedProducts.push(a4)
}else{E.productCheckbox[a4.code]=false;
E.pointCheckbox[a4.code]=false
}}}});
if(!E.productCheckbox.CSSG){E.productCheckbox.CSSG=false;
E.pointCheckbox.CSSG=false;
E.childSafetyExpanded=false
}au.closeModal({type:"equipmentModify"})
}function ag(){E.reservationModel.ftpDetails.partnerName="";
E._validateFTPData();
if(E.errorList.length<1){E._reviewFtp()
}}function aC(i){E.valChecked=false;
var a2;
angular.element(".childSafSubCont-wrap select").each(function(){a2=angular.element(this).val();
if(a2>1){E.valChecked=true;
return
}});
if(E.childSafetyExpanded==false){E.childSafetyExpanded=true
}else{if(E.valChecked==true){E.childSafetyExpandedCheck=true;
E.childSafetyExpanded=true;
angular.element("#warning-message").popover("show");
ae(function(){angular.element("#warning-message").popover("destroy")
},2000)
}else{E.childSafetyExpandedCheck=false;
E.childSafetyExpanded=false
}}}function q(a4){var a5=[];
var a3=[];
var i=[];
var a2=[];
angular.forEach(a4,function(a6){if(angular.equals(a6.type,"ERROR")){i.push(a6)
}else{if(angular.equals(a6.type,"WARNING")){a2.push(a6)
}else{a3.push(a6)
}}});
E.ftpSectInstrList=a3;
E.ftpSectErrList=i;
E.ftpSectWarList=a2
}function N(a5){var i=true;
var a3=true;
var a4=[];
var a2;
var a6=[];
if(E.reservationModel.ftpDetails.partnerCode==undefined||E.reservationModel.ftpDetails.partnerCode==""||E.reservationModel.ftpDetails.partnerCode=="n/a"){i=false;
E.reservationModel.ftpDetails.partnerCode=""
}if(E.reservationModel.ftpDetails.ftpNumber==undefined||E.reservationModel.ftpDetails.ftpNumber==""||E.reservationModel.ftpDetails.ftpNumber=="n/a"){a3=false;
E.reservationModel.ftpDetails.ftpNumber=""
}if(a5=="update"){if(a3&&!i){a4.push(Dictionary.I18n.get("err.res.step3.ftp.PartnerError"))
}else{if(i&&!a3){a4.push(Dictionary.I18n.get("err.res.step3.ftp.MemberError"))
}}}else{if(a3&&!i){a4.push(aE.displayServiceError("vm.reservationModel.ftpDetails.partnerCode","ftpInvalid"))
}else{if(i&&!a3){a4.push(aE.displayServiceError("vm.reservationModel.ftpDetails.ftpNumber","ftpInvalid"))
}}}if(1===a4.length){a2={message:a4[0]}
}if(a4.length!=0){a6.push(a2)
}E.errorList=a6
}function aq(){F.requestInProgress=true;
var i=aW.load();
i.then(function(a3){if(angular.isDefined(a3)){var a2=T.getExpressReservationFlag();
if(angular.isDefined(a3.webHeader)&&((a3.webHeader.viewIndicator=="5")||(a3.webHeader.viewIndicator=="6"))&&a2&&!a3.reservationSummary.prepayTxn){s.processResults(a3,{})
}else{if(angular.isDefined(a3.fieldErrors)&&a3.fieldErrors.length>0||(angular.isDefined(a3.errorList)&&a3.errorList.length>0)||(angular.isDefined(a3.warningList)&&a3.warningList.length>0)){F.requestInProgress=false;
a3=Q.processErrorMessage(a3);
if(angular.isDefined(a3.fieldErrors)&&a3.fieldErrors.length>0||(angular.isDefined(a3.errorList)&&a3.errorList.length>0)){E.errorList=a3.errorList;
Z.scroll(0,0)
}if(angular.isDefined(a3.warningList)&&a3.warningList.length>0){E.warningList=a3.warningList
}}else{F.requestInProgress=false;
if(a3.reservationSummary.ftpDetails&&a3.reservationSummary.ftpDetails.partnerCode&&a3.reservationSummary.ftpDetails.partnerCode!=""){if(E.ftp&&E.ftp.partnersList){var a4=[];
a4=k(a3.reservationSummary.ftpDetails.partnerCode);
if(a4.length>0){E.reservationModel.ftpDetails.partnerName=a4[0].partnerName
}else{E.reservationModel.ftpDetails.partnerName=""
}}}if(E.isPayLaterOnlyReservation){at.go(W.step4PayLaterPageName)
}else{at.go(W.step4PageName)
}}}}},function(a2){F.requestInProgress=false
})
}function aO(){E.reservationModel.ftpDetails.partnerName="";
E._validateFTPData("update");
if(E.errorList.length<1){F.requestInProgress=true;
var i=A.addFTP(E.reservationModel.ftpDetails.partnerCode,E.reservationModel.ftpDetails.ftpNumber);
i.then(function(a2){if(angular.isDefined(a2.fieldErrors)&&a2.fieldErrors.length>0||(angular.isDefined(a2.errorList)&&a2.errorList.length>0)||(angular.isDefined(a2.warningList)&&a2.warningList.length>0)){F.requestInProgress=false;
a2=Q.processErrorMessage(a2);
E.errorList=a2.errorList
}else{F.requestInProgress=false;
if(a2.reservationSummary.ftpDetails&&a2.reservationSummary.ftpDetails.partnerCode){if(E.ftp&&E.ftp.partnersList){var a3=[];
a3=k(a2.reservationSummary.ftpDetails.partnerCode);
if(a3.length>0){E.reservationModel.ftpDetails.partnerName=a3[0].partnerName
}else{E.reservationModel.ftpDetails.partnerName=""
}}}T.setReservationModel(E.reservationModel);
Z.location.reload()
}},function(a2){F.requestInProgress=false
})
}}function aQ(i){if(i==="ftpDetails"){if(E.reservationModel.bookAgain.bookAgainFlow){var a2=aB.getAvailableExtras();
if(angular.isDefined(a2.reservationSummary)&&angular.isDefined(a2.reservationSummary.ftpDetails)){if(angular.isDefined(a2.reservationSummary.ftpDetails.partnerCode)){E.reservationModel.ftpDetails.partnerCode=a2.reservationSummary.ftpDetails.partnerCode
}if(angular.isDefined(a2.reservationSummary.ftpDetails.ftpNumber)){E.reservationModel.ftpDetails.ftpNumber=a2.reservationSummary.ftpDetails.ftpNumber
}}else{E.reservationModel.ftpDetails.partnerCode="";
E.reservationModel.ftpDetails.ftpNumber=""
}}else{E.reservationModel.ftpDetails.partnerCode=aB.getAvailableExtras().reservationSummary.ftpDetails.partnerCode;
E.reservationModel.ftpDetails.ftpNumber=aB.getAvailableExtras().reservationSummary.ftpDetails.ftpNumber
}au.closeModal({type:"ftpDetails"})
}T.setReservationModel(E.reservationModel)
}function az(i){if(angular.isDefined(i)){var a2,a3=[];
E.bundleDescription={bundleName:"",bundleExtras:""};
if(angular.isDefined(i.bundledInsurances)){for(a2=0;
a2<i.bundledInsurances.length;
a2++){a3.push({description:i.bundledInsurances[a2].description,shortDescription:i.bundledInsurances[a2].shortDescription,additionalNote:i.bundledInsurances[a2].additionalnote})
}}if(angular.isDefined(i.bundledProducts)){for(a2=0;
a2<i.bundledProducts.length;
a2++){a3.push({description:i.bundledProducts[a2].description,shortDescription:i.bundledProducts[a2].shortDescription,additionalNote:i.bundledProducts[a2].additionalnote})
}}}E.bundleDescription.bundleName=i.bundleName;
E.bundleDescription.bundleExtras=a3
}function H(i){var a4,a3=T.getReservationModel();
if(a3&&a3.ancillaryBundlesData){a4=a3.ancillaryBundlesData;
a4.forEach(function(a5){if(a5.bundleName==i.bundleName){a5.selected=E.bundleCheckbox[i.bundleName]?E.bundleCheckbox[i.bundleName]:false
}else{a5.selected=false
}if(a3.selectedBundleName==a5.bundleName){a3=ad(a5,a3)
}aK(a5);
C(a5)
})
}if(E.bundleCheckbox[i.bundleName]){a3.selectedBundleName=i.bundleName
}else{a3.selectedBundleName=""
}T.setReservationModel(a3);
F.requestInProgress=true;
var a2=af.recalculate("false");
a2.then(function(a6){if(angular.isDefined(a6.fieldErrors)&&a6.fieldErrors.length>0||(angular.isDefined(a6.errorList)&&a6.errorList.length>0)){Q.processErrorMessage(a6)
}else{F.requestInProgress=false;
E.prod=a6;
if(angular.isDefined(E.prod.reservationSummary.ancillaryBundleSummary)){E.selectedBundleName=aX(E.prod.reservationSummary.ancillaryBundleSummary);
x.bundleSelectedtoAnalytics(E.selectedBundleName,E.prod);
a3.selectedBundleName=E.selectedBundleName;
T.setReservationModel(a3)
}E.products=E.prod.reservationSummary.productSummaryList;
E.insurances=E.prod.reservationSummary.insuranceSummaryList;
var a7=G.process(a6.reservationSummary);
E.ancillaryProductsList=a7.ancillaryProductsList;
var a5=af.handleLoyalty(E.prod.reservationSummary,aw,E.pointCheckbox,E.productCheckbox,"EXTRAS",E.products);
E.prefferedPointsFlag=a5.prefferedPointsFlag;
E.loyaltyDetails=a5.loyaltyDetails;
E.pointProducts=a5.pointProducts;
E.displayFreedayFlag=a5.displayFreedayFlag;
E.freedaySectionDisplay=a5.freedaySectionDisplay;
E.redeemableDays=a5.redeemableDays;
E.freeDayPoints=a5.freeDayPoints;
E.totalreedem=a5.totalReedemPoints;
E.pointCheckbox=a5.pointCheckbox;
E.productCheckbox=a5.productCheckbox
}},function(a5){})
}function ad(i,a2){if(i.protections&&i.protections.length>0){i.protections.forEach(function(a3){a2=af.arrayPop(a3,true,a2)
})
}if(i.equipment&&i.equipment.length>0){i.equipment.forEach(function(a3){a2=af.arrayPop(a3,false,a2)
})
}return a2
}function aK(i){if(i.equipment&&i.equipment.length>0){i.equipment.forEach(function(a2){E.pointCheckbox[a2]=i.selected;
E.productCheckbox[a2]=i.selected
})
}}function C(i){if(i.protections&&i.protections.length>0){i.protections.forEach(function(a2){E.insuranceCheckbox[a2]=i.selected
})
}}function aX(a2){var i;
for(ab=0;
ab<a2.length;
ab++){if(a2[ab].bundleDisplay.selected=="TRUE"){E.bundleCheckbox[a2[ab].bundleName]=true;
i=a2[ab].bundleName
}else{E.bundleCheckbox[a2[ab].bundleName]=false
}}return i
}function b(a2){var i;
for(i=0;
i<a2.length;
i++){if(a2[i].discountEligiblity){return true
}}return false
}jQuery(document).ready(function(){if(E.pageName==W.step3PageName){T.addGTMScript()
}F.requestInProgress=false;
$("body").on("shown.bs.modal",".modal.policies_Modal",function(i){E.getPrepayTnCs()
})
})
}})();
(function(){angular.module("reservation").controller("GlobalSummaryController",a);
a.$inject=["$controller","$scope","$timeout","$rootScope","$state","$window","$validation","getDataService","optionalService","authenticationService","vehicleService","couponService","$filter","carRentalConstant","reservationModelService","$compile","ModalService","storageService"];
function a(D,i,F,n,z,U,d,l,C,P,j,v,J,K,s,c,y,N){D("ExceptionHandlerController",{$scope:i});
var g=D("CouponController",{$scope:i});
angular.extend(this,g);
var w=this;
var k=false;
w.couponAwdSameflag=false;
w.multiCurrencyFlag=false;
w.ages=K.ageList;
w.couponCodeDisabled=false;
w.epIndicator=false;
w.enableBenefit=partnerConfig.amazon.enablePartnerBenefit;
w.reservationModel={personalInfoRQ:{residency:""}};
w.couponList={};
w.isBookAgainFlow=false;
w.requiresMemberID=false;
w.partnerPlaceholder="";
w.partnerLabel="";
w.modifyPersonalInfo=W;
w.modifyDiscountCodes=Y;
w.couponSwap=X;
w.getDefaultAwd=G;
w.getDefaultCouponCode=e;
w.removeError=B;
w.getMultiCoupon=A;
w.reloadModelValue=u;
w.setUserSelectedCurrencyNull=b;
w.scrollSetTop=x;
w.resFormpopupCancelClick=T;
w.analytics=M;
w.cancelModifyAge=O;
w.removeCoupon=S;
w.modifyModal=m;
w.modifyCarModal=h;
w.controlGuidedResFlow=L;
w.rentalSummaryApplyCoupon=E;
w.partnerDiscount=Z;
w.partnerValidation=f;
w.checkPartnerValidation=q;
w.checkPartnerMemberValidation=I;
w.updateDiscountNumber=Q;
w._summaryPageInit=t;
w._summaryPageProcess=r;
w._processErrorByType=o;
w._couponRedeemHandler=R;
w.pageName=z.current.name;
w._discountValidation=p;
var H=D("GlobalSummaryExnController",{$scope:i});
angular.extend(this,H);
function h(){n.requestInProgress=true;
var aa=l.getAvailableVehicles();
if(w.reservationModel.bookAgain.bookAgainFlow&&angular.equals({},aa)){j.getData("",true).then(function(ab){n.requestInProgress=false;
y.showModal({type:"CarDetailsModify",templateUrl:n.contextPath+"/"+n.locale+"/reservation.modify-car-model"+htmlExtension,controller:"VehicleListController",controllerAs:"vm"}).then(function(ac){ac.element.modal()
})
},function(ab){})
}else{if(w.reservationModel.isGuidedRes){z.go(K.step2PageName)
}else{if(angular.equals({},aa)){j.load().then(function(ab){n.requestInProgress=false;
y.showModal({type:"CarDetailsModify",templateUrl:n.contextPath+"/"+n.locale+"/reservation.modify-car-model"+htmlExtension,controller:"VehicleListController",controllerAs:"vm"}).then(function(ac){ac.element.modal()
})
},function(ab){})
}else{j.getData().then(function(ab){n.requestInProgress=false;
y.showModal({type:"CarDetailsModify",templateUrl:n.contextPath+"/"+n.locale+"/reservation.modify-car-model"+htmlExtension,controller:"VehicleListController",controllerAs:"vm"}).then(function(ac){ac.element.modal()
})
},function(ab){})
}}}}function m(ab){var aa="",ac="";
switch(ab){case"ftpDetails":aa="reservation.frequent-travel-program-modal";
ac="ExtrasController";
break;
case"protectionModify":aa="reservation.protection-modal";
ac="ExtrasController";
break;
case"equipmentModify":aa="reservation.equipment-modal";
ac="ExtrasController";
break;
default:aa="";
ac=""
}if(aa!=""&&ac!=""){y.showModal({type:ab,templateUrl:n.contextPath+"/"+n.locale+"/"+aa+htmlExtension,controller:ac,controllerAs:"vm"}).then(function(ad){F(function(){ad.element.modal("show")
},1);
j.infoToolTip()
})
}else{}}function x(){document.body.scrollTop=0
}function t(){w.isBookAgainFlow=s.isBookAgainFlow(w.pageName);
w.customer=P.getCustomerModel();
w.reservationModel=s.getReservationModel();
if(w.reservationModel){w._summaryPageProcess()
}else{var aa=j.getData();
aa.then(function(ab){var ac=s.load(ab,true);
ac.then(function(ad){w.reservationModel=ad;
w._summaryPageProcess()
})
})
}}function r(){var aa=U.countryList;
var ad=angular.fromJson(aa);
w.countryList=ad;
var ae="US";
var ab=w.reservationModel.promotionalCoupon;
if(ab!=null&&ab&&ab!=""){w.couponCodeDisabled=true;
if(w.reservationModel&&w.reservationModel.coupon&&w.reservationModel.coupon.couponNumber){w.reservationModel.coupon.couponNumber=""
}}if((w.reservationModel.selectedProducts).length>0){angular.forEach(w.reservationModel.selectedProducts,function(af,ag){if(w.reservationModel.selectedProducts[ag].redeemedQty!=undefined&&w.reservationModel.selectedProducts[ag].redeemedQty!="0"){w.couponCodeDisabled=true
}})
}if(angular.isDefined(w.customer)){ae=w.customer.cor;
w.reservationModel.displayControls.fieldDisable=true
}if(angular.isDefined(w.customer)&&angular.isDefined(w.customer.cor)&&(w.customer.cor=="US"||w.customer.cor=="CA")&&U.brand==K.brandName.AVIS&&angular.isDefined(w.customer.userState)&&w.customer.userState=="AUTHENTICATED"){w.epIndicator=true
}if(w.reservationModel&&w.reservationModel!=null&&w.reservationModel.personalInfoRQ.residency!==""){w.reservationModel.personalInfoRQ.residency=w.reservationModel.personalInfoRQ.residency;
ae=w.reservationModel.personalInfoRQ.residency
}var ac=w.countryList.indexOf(J("filter")(w.countryList,function(af){return af.code===ae
})[0]);
w.reservationModel.personalInfoRQ.residency=w.countryList[ac].code;
w.rentalSummaryApplyCoupon()
}function E(){if(w.reservationModel&&w.reservationModel.coupon&&w.reservationModel.coupon.couponNumber==""){w.couponList=l.getCouponList();
v.couponApply(w.couponList,w.reservationModel).then(function(aa){w.couponList=aa.couponList;
w.reservationModel=aa.reservationModel
})
}}function S(){n.requestInProgress=true;
if(angular.isDefined(w.response.reservationSummary.coupon)){w.reservationModel.coupon.couponNumber="";
j.load().then(function(aa){w.response=aa;
aa=w._processErrorByType(w.response);
if((angular.isDefined(aa.errorList)&&aa.errorList.length>0)||(angular.isDefined(aa.warningList)&&aa.warningList.length>0)){z.go(K.step1aPageName)
}else{z.go(K.step2PageName,{},{reload:true})
}},function(aa){})
}}function O(){var aa=Number(l.getAvailableExtras().reservationSummary.personalInfo.age.value);
w.reservationModel.personalInfoRQ.age=aa;
w.reservationModel.personalInfoRQ.residency=l.getAvailableExtras().reservationSummary.personalInfo.residency.value;
s.setReservationModel(w.reservationModel)
}function W(){n.requestInProgress=true;
w.reservationModel.selectedCar=[];
s.setReservationModel(w.reservationModel);
w.controlGuidedResFlow(false);
var aa=j.load();
aa.then(function(ab){if(angular.isDefined(ab.fieldErrors)&&ab.fieldErrors.length>0||(angular.isDefined(ab.errorList)&&ab.errorList.length>0)||(angular.isDefined(ab.warningList)&&ab.warningList.length>0)){z.go(K.step1aPageName)
}else{z.go(K.step2PageName)
}},function(ab){})
}function Y(){n.requestInProgress=true;
w.resFormPageError="";
var ab=w.couponSwap(w.reservationModel);
if(ab.length>0){c(angular.element(".platform-error-message"))(i);
c(angular.element("#discounterrors"))(i);
w.validated=true;
n.requestInProgress=false
}else{w.reservationModel.selectedRateType=w.reservationModel.coupon.discountNumber;
s.setReservationModel(w.reservationModel);
w.controlGuidedResFlow(false);
var aa=j.load();
aa.then(function(ad){if(angular.isDefined(ad.fieldErrors)&&ad.fieldErrors.length>0){ad=i.processErrorMessage(ad);
var ae=[];
var ac;
angular.forEach(ad.fieldErrors,function(af){if(af.field=="vm.reservationModel.coupon.discountNumber"||af.field=="vm.reservationModel.coupon.couponNumber"||af.field=="vm.reservationModel.coupon.couponRateCode"){ac={message:d.displayServiceError(af.field.replace("vm.","vmx."),af.classifier)};
w.reservationModel.displayControls.additionalInfo="displayDiscount"
}});
if(ad.fieldErrors.length>1){ac={message:Dictionary.I18n.get("err.res.mutliplemsg")}
}ae.push(ac);
w.errorDisplayList=ae
}else{if(angular.isDefined(ad.errorList)&&ad.errorList.length>0){z.go(K.step1aPageName)
}else{$("#modify-discounts").modal("hide");
$(".modal-backdrop").remove();
z.go(K.step2PageName,{},{reload:true})
}}},function(ac){})
}}function p(){}function X(af){var ae=[];
var ab;
var aa=af.coupon.discountNumber;
var ad=(af.coupon.couponNumber)?af.coupon.couponNumber:"";
ab=s.validateDiscountNumber(aa,ad,af,"Other");
if(ab){ae.push(ab)
}k=w._discountValidation();
ab=s.validateCouponCode(ad,aa,af,"Other",k);
if(ab){ae.push(ab)
}ab=s.validateMembeshipID(aa,af,"Other",w.requiresMemberID);
if(ab){ae.push(ab)
}if(ae.length==1){var ac=ae[0].message;
angular.element("#pageError").html("");
c(angular.element("#pageError").append(ac))(i)
}if(ae.length==2){w.resFormPageError=Dictionary.I18n.get("err.res.mutliplemsg")
}return ae
}function o(aa){aa=i.processErrorMessage(aa);
if(angular.isDefined(aa.fieldErrors)&&aa.fieldErrors.length>0){w.errorDisplayList=aa.fieldErrors;
w.infoError=false;
w.resFormPageInfo=""
}if((angular.isDefined(aa.errorList)&&aa.errorList.length>0)){w.validated=true;
w.errorDisplayList=aa.errorList;
return true
}return false
}function G(aa){var ab=s.getReservationModel();
ab.rentalType="";
w.reservationModel=ab;
s.setReservationModel(w.reservationModel);
if(angular.isDefined(aa)&&aa.length>0){w.DiscAWD=aa;
document.getElementById("awd").disabled=true
}else{if(angular.isDefined(document.getElementById("awd"))&&document.getElementById("awd").placeholder!=null){document.getElementById("awd").placeholder="AWD#"
}}}function e(aa){if(angular.isDefined(aa)&&aa.length>0){w.DiscCoupon=aa;
document.getElementById("coupon").disabled=true
}else{if(angular.isDefined(document.getElementById("coupon"))&&document.getElementById("coupon").placeholder!=null){document.getElementById("coupon").placeholder="Coupon Code"
}}}function B(){w.validated=false;
w.hideCoupons=false
}function A(){w.getMultiCouponUtility(w,true)
}function u(ab){var aa=false;
w.reservationModel.editRentalSummary=aa;
s.setReservationModel(w.reservationModel);
w.reservationModel=s.getReservationModel();
if(angular.isDefined(w.reservationModel.dropInfo)&&w.reservationModel.dropInfo!=w.reservationModel.pickInfo){w.reservationModel.diffLoc=true;
s.setReservationModel(w.reservationModel)
}else{w.reservationModel.diffLoc=false
}n.resModel=angular.copy(w.reservationModel);
i.$broadcast("angucomplete-alt:changeInput","PicLoc",w.reservationModel.pickUpLocation);
if($(window).width()>K.deviceTypeMobileWidth){$(".start-date-input").val(w.reservationModel.pickUpDateDisplay);
$(".end-date-input").val(w.reservationModel.dropDateDisplay);
$("#PicLoc_value").val(w.reservationModel.pickUpLocation.suggDescription);
if(w.reservationModel.pickUpLocation.suggCode!=w.reservationModel.dropLocation.suggCode){if(w.reservationModel.dropLocation.suggDescription){$("#DropLoc_value").val(w.reservationModel.dropLocation.suggDescription)
}else{$("#DropLoc_value").val(w.reservationModel.dropLocation.suggCode)
}i.$broadcast("angucomplete-alt:changeInput","DropLoc",w.reservationModel.dropLocation)
}else{F(function(){w.reservationModel.dropLocation="";
$("#DropLoc_value").val("");
i.$broadcast("angucomplete-alt:changeInput","DropLoc",w.reservationModel.dropLocation)
},1000)
}F(function(){$("#PicLoc_value").focus();
$("#PicLoc_value").blur();
$("#DropLoc_value").focus();
$("#DropLoc_value").blur()
},150)
}else{$(".start-date-input").datepicker("setDate",w.reservationModel.pickUpDateDisplay);
$(".end-date-input").datepicker("setDate",w.reservationModel.dropDateDisplay);
if(w.reservationModel.pickUpLocation.suggCode!=w.reservationModel.dropLocation.suggCode){$($("input[id=DropLoc_value]")[1]).val(w.reservationModel.dropLocation.suggDescription);
i.$broadcast("angucomplete-alt:changeInput","DropLoc",w.reservationModel.dropLocation)
}else{F(function(){w.reservationModel.dropLocation="";
$($("input[id=DropLoc_value]")[1]).val("");
i.$broadcast("angucomplete-alt:changeInput","DropLoc",w.reservationModel.dropLocation)
},1000)
}F(function(){$($("input[id=PicLoc_value]")[1]).focus();
$($("input[id=PicLoc_value]")[1]).blur();
$($("input[id=DropLoc_value]")[1]).focus();
$($("input[id=DropLoc_value]")[1]).blur()
},150)
}}jQuery(".step2-renter-summary-detail").on("hide.bs.modal",function(aa){n.$broadcast("widgetModifyReload",n.resModel)
});
function b(){var aa=s.getReservationModel();
aa.userSelectedCurrency="";
w.reservationModel=aa;
s.setReservationModel(w.reservationModel)
}w._summaryPageInit();
function T(){}function M(aa){var ab={};
ab.event="analyticsVPV";
ab.vpvName="/vpv/linkClickPage-"+aa+"LocationsModify";
dataLayer.push(ab)
}function L(aa){var ab=s.getReservationModel();
if(ab.isGuidedRes&&!aa){ab.isGuidedRes=false;
n.isGuidedRes=false
}else{if(aa){ab.isGuidedRes=true;
n.isGuidedRes=true
}}s.setReservationModel(ab)
}n.$on("learnwhypop",function(ab,ac){k=w._discountValidation();
var aa=j.learnWhyErrorMsg(w,ac,k);
w.title=aa.title;
w.errorMsg=aa.errorMsg;
w.reason=aa.reason;
jQuery(".generic-pop-modal").modal("show")
});
function R(aa){if(angular.isDefined(aa.reservationSummary.rateSummary)&&angular.isDefined(aa.reservationSummary.rateSummary.couponRedeemRemoval)&&angular.isDefined(aa.reservationSummary.rateSummary.couponRedeemRemoval.code)){c(angular.element("#couponRedeemRemoval").html(aa.reservationSummary.rateSummary.couponRedeemRemoval.message))(i)
}w.response=aa
}function Z(){w.partnerPlaceholder="";
w.partnerLabel="";
var aa=w.reservationModel.coupon.discountNumber;
if(angular.isDefined(aa)&&aa.length>=7&&aa.indexOf("AMAZON")===-1){n.requestInProgress=true;
var ab=j.partnerDiscountValidation(aa);
ab.then(function(ac){if(ac.fieldErrors){n.requestInProgress=false
}else{w.requiresMemberID=ac.awdSummary.requiresMemberID;
w.partnerName=ac.awdSummary.partnerName;
w.reservationModel.coupon.requiresMemberID=w.requiresMemberID;
w.reservationModel.partnerName=w.partnerName;
s.setReservationModel(w.reservationModel);
n.requestInProgress=false;
if(angular.isDefined(w.partnerName)&&w.requiresMemberID){w.partnerPlaceholder=w.partnerName+Dictionary.I18n.get("lbl.global.partnerMember,"+brand);
w.partnerLabel=Dictionary.I18n.get("lbl.global.partnerlabel,"+brand)+w.partnerName+Dictionary.I18n.get("lbl.global.partnerlabel1,"+brand);
w.reservationModel.partnerLabel=w.partnerLabel
}else{w.requiresMemberID=false
}}})
}}function f(){var aa=w.reservationModel.coupon.discountNumber;
var ab=w.reservationModel.discountSummaryList;
var ac=false;
if(angular.isDefined(ab)&&angular.isDefined(aa)){angular.forEach(ab,function(ae,ad){if(aa==ae.discountNumber){ac=true
}})
}if((ac)||(angular.isDefined(aa)&&aa.length<7)){w.requiresMemberID=false;
w.reservationModel.coupon.partnerMembershipId="";
w.response.reservationSummary.membershipId=null
}}function q(){if(w.reservationModel.NoPartnerMembershipID){w.reservationModel.coupon.partnerMembershipId="";
s.setReservationModel(w.reservationModel)
}d.resetError("vmx.reservationModel.coupon.partnerMembershipId",true)
}function I(){if(w.reservationModel.coupon.partnerMembershipId!=""&&w.reservationModel.NoPartnerMembershipID){w.reservationModel.NoPartnerMembershipID=false;
s.setReservationModel(w.reservationModel)
}}function Q(aa){w.reservationModel.coupon.discountNumber=aa.discountNumber;
w.showLearnWhyError=false;
w.customer.awdSummary.partnerName=null;
w.partnerName=null;
w.partnerDiscount()
}n.$on("couponRedeemRemoval",function(aa,ab){w._couponRedeemHandler(ab)
})
}})();
(function(){angular.module("reservation").controller("LookupController",a);
a.$inject=["$controller","$scope","$rootScope","$state","$window","$sce","utilityService","lookupService","storageService","authenticationService","$validation","carRentalConstant","reservationModelService","$stateParams","getDataService","$filter","rentalExtService"];
function a(e,u,j,x,s,q,w,o,i,r,v,f,m,B,k,t,l){e("ExceptionHandlerController",{$scope:u});
var A=this;
A.session=r.getSessionModel();
A.customer=r.getCustomerModel();
A.lookupModel=f.lookupModel;
A.brand=s.brand;
A._reserve=b;
var z="";
var c={};
var y={};
A.countryList={};
A.getLoginModalWindow=d;
A._initLookup=n;
A._validateBridgeflow=g;
A._cancelledReservation=C;
A._setResidency=p;
j.$on("initSuccess",function(D,E){if(i.sessionStorageSupport()===false){A.session=r.getSessionModel();
A.customer=r.getCustomerModel();
A.lookupModel=f.lookupModel;
A._initLookup()
}});
function d(){j.$broadcast("LoginActivity",{requestType:"Login",variance:"Small"})
}function n(){if(A.brand=="avis"){var G=s.countryList;
var D=angular.fromJson(G);
var F=D.countryInfoList;
A.countryList=F;
A._setResidency()
}A.sessionErrorMessage=i.getStorageData("sessionErrMsg");
m.deleteDataBeforeLogoClick();
if(A.sessionErrorMessage){var I=[];
var E={message:A.sessionErrorMessage};
I.push(E);
A.errorDisplayList=I;
$(".res-PageError .mainErrorText").text(A.sessionErrorMessage);
$(".res-PageError .mainErrorText").show();
i.deleteStorageData("sessionErrMsg")
}A.bridgeResponse=i.getStorageData("bridgeResponse");
if(angular.isDefined(A.bridgeResponse)&&angular.isDefined(A.bridgeResponse.errorList)){A._validateBridgeflow(A.bridgeResponse)
}if(angular.isDefined(A.session)&&(A.session.status==f.userStateRecognized||A.session.status==f.userStateAuthenticated||A.session.status===f.userStateRememberMe)&&!(brand==f.brandName.PAYLESS)){A.lookupModel.lastName=A.customer.lastName
}A.conNum=m.getUrlParameter("resForm.confirmationNumber");
A.lastName=m.getUrlParameter("resForm.lastName.value");
if(angular.isDefined(A.conNum)){A.lookupModel.lastName=A.lastName;
A.lookupModel.confirmationNumber=A.conNum;
m.setLookUpModel(A.lookupModel);
var H=o.load(A.country);
H.then(function(J){if(angular.isDefined(J.fieldErrors)&&J.fieldErrors.length>0||(angular.isDefined(J.warningList)&&J.warningList.length>0)){A.prod=u.processErrorMessage(J)
}},function(K){if(K&&K.fieldErrors){var J=u.processErrorMessage(K);
A.errorDisplayList=J;
j.requestInProgress=false
}else{A.errorDisplayList=K.errorList;
j.requestInProgress=false
}})
}A._cancelledReservation()
}function C(){if(B.infoKey){w.getErrorMessageByCode(B.infoKey).then(function(E){A.errorDisplayList=E
},function(){console.log("error in service")
});
var D=m.getLookUpModel();
A.lookupModel.lastName=D.lastName;
A.lookupModel.confirmationNumber=D.confirmationNumber;
A.lookupModel.email=D.email;
j.requestInProgress=false
}}function g(D){var F=[];
var E={};
var D=u.processErrorMessage(D);
if(D.errorList&&D.errorList.length>0){F.push(D.errorList[0])
}if(D.warningList&&D.warningList.length>0){F.push(D.warningList[0])
}A.errorDisplayList=F
}function b(){s.location.href=j.contextPath+"/"+j.locale+"/home"+htmlExtension
}A.CNValidation={lookupValidated:false,submit:function(D){A.errorDisplayList=[];
if(A.prod&&A.prod.warningList){A.prod.warningList=[]
}if(A.prod&&A.prod.errorList){A.prod.errorList=[]
}v.validate(D).success(A.CNValidation.validationSuccess).error(A.CNValidation.validationError)
},validationSuccess:function(){j.requestInProgress=true;
A.CNValidation.lookupValidated=false;
A.lookupPageError="";
A.errorDisplayList="";
var E={};
k.addToConfirmationData(E);
if(angular.isDefined(A.session)&&(A.session.status==f.userStateRecognized||A.session.status==f.userStateAuthenticated||A.session.status===f.userStateRememberMe)){var D=A.customer.lastName;
A.CNValidation.getReservationDetailsNew()
}else{if(B.infoKey!="14036"){A.CNValidation.getReservationDetails()
}else{A._cancelledReservation()
}}},validationError:function(D){j.requestInProgress=false;
A.errorDisplayList=ABG.getFormValidationError(D,false)
},getReservationDetails:function(){var D=A.lookupModel.lastName;
D.trim();
D=D.replace(/^[^a-z|^A-Z]*/,"");
D=D.replace(/\s\s+/g," ");
D=D.replace(/[^a-zA-Z0-9\-\s]/g,"");
A.lookupModel.lastName=D;
m.setLookUpModel(A.lookupModel);
var E=o.load(A.country);
E.then(function(H){if(angular.isDefined(H.fieldErrors)&&H.fieldErrors.length>0||(angular.isDefined(H.warningList)&&H.warningList.length>0)){A.prod=u.processErrorMessage(H);
j.requestInProgress=false
}else{if(angular.isDefined(H.instructionList)&&H.instructionList.length>0){if(H.instructionList[0].code=="05162"){s.location.href=j.contextPath+"/"+j.locale+"/reservation"+htmlExtension+"#/confirmation/lookup"
}else{if(H.instructionList[0].code=="14978"){s.location.href=j.contextPath+"/"+j.locale+"/reservation"+htmlExtension+"#/manage"
}else{s.location.href=j.contextPath+"/"+j.locale+"/reservation"+htmlExtension+"#/cancel-confirmation"
}}}else{if(angular.isDefined(H.errorList)&&H.errorList.length>0){var F=false;
angular.forEach(H.errorList,function(J){if(angular.equals(J.code,"05032")){F=true
}});
if(F==true){A.getEmail=H.reservationSummary.personalInfo.email;
s.location.href=j.contextPath+"/"+j.locale+"/reservation"+htmlExtension+"#/confirmation/lookup"
}else{A.prod=u.processErrorMessage(H);
j.requestInProgress=false
}}else{var G=r.setCustomerData(H);
r.setCustomerModel(G);
var I=r.setSessionData(H);
r.setSessionModel(I);
if(angular.isDefined(H.reservationSummary.personalInfo)&&angular.isDefined(H.reservationSummary.personalInfo.email)){A.getEmail=H.reservationSummary.personalInfo.email
}if(H.reservationSummary.permission&&H.reservationSummary.permission.modify&&H.reservationSummary.permission.modify.visible=="TRUE"){s.location.href=j.contextPath+"/"+j.locale+"/reservation"+htmlExtension+"#/manage"
}else{if(angular.isDefined(H.reservationSummary)&&angular.isDefined(H.reservationSummary.rentalType)&&H.reservationSummary.rentalType=="Open"&&angular.isDefined(H.reservationSummary.gateExitDone)&&H.reservationSummary.gateExitDone){l.fetchRentalDetails(H.reservationSummary.rentalAgreementNumber).then(function(J){if(angular.isDefined(J)&&angular.isUndefined(J.errorList)){s.location.href=j.contextPath+"/"+j.locale+"/rental/view-modify"+htmlExtension
}},function(K){if(K&&K.fieldErrors){var J=u.processErrorMessage(K);
A.errorDisplayList=J;
j.requestInProgress=false
}else{A.errorDisplayList=K.errorList;
j.requestInProgress=false
}})
}else{if(angular.isDefined(H.reservationSummary)&&angular.isDefined(H.reservationSummary.rentalType)&&H.reservationSummary.rentalType=="Open"&&angular.isDefined(H.reservationSummary.gateExitDone)&&!H.reservationSummary.gateExitDone){l.fetchRentalDetails(H.reservationSummary.rentalAgreementNumber).then(function(J){if(angular.isDefined(J)&&angular.isUndefined(J.errorList)){s.location.href=j.contextPath+"/"+j.locale+"/rental/view-modify"+htmlExtension
}},function(K){if(K&&K.fieldErrors){var J=u.processErrorMessage(K);
A.errorDisplayList=J;
j.requestInProgress=false
}else{A.errorDisplayList=K.errorList;
j.requestInProgress=false
}})
}else{s.location.href=j.contextPath+"/"+j.locale+"/reservation"+htmlExtension+"#/confirmation/lookup"
}}}}}}},function(G){if(G&&G.fieldErrors){var F=u.processErrorMessage(G);
A.errorDisplayList=F;
j.requestInProgress=false
}else{A.errorDisplayList=G.errorList;
j.requestInProgress=false
}})
},getReservationDetailsNew:function(){if(!(brand==f.brandName.PAYLESS)){A.lookupModel.lastName=A.customer.lastName
}A.lookupModel.confirmationNumber=A.lookupModel.confirmationNumber;
m.setLookUpModel(A.lookupModel);
var D=o.load(A.country);
D.then(function(F){if(angular.isDefined(F.fieldErrors)&&F.fieldErrors.length>0||(angular.isDefined(F.warningList)&&F.warningList.length>0)){A.prod=u.processErrorMessage(F);
j.requestInProgress=false
}else{if(angular.isDefined(F.instructionList)&&F.instructionList.length>0){if(F.instructionList[0].code=="05162"){s.location.href=j.contextPath+"/"+j.locale+"/reservation"+htmlExtension+"#/confirmation/lookup"
}else{if(F.instructionList[0].code=="14978"){s.location.href=j.contextPath+"/"+j.locale+"/reservation"+htmlExtension+"#/manage"
}else{s.location.href=j.contextPath+"/"+j.locale+"/reservation"+htmlExtension+"#/cancel-confirmation"
}}}else{if(angular.isDefined(F.errorList)&&F.errorList.length>0){if(angular.equals(F.errorList.code,"5306")){A.errorDisplayList=u.processErrorMessage(F).errorList;
j.requestInProgress=false
}else{var E=false;
angular.forEach(F.errorList,function(G){if(angular.equals(G.code,"05032")){E=true
}});
if(E==true){A.getEmail=F.reservationSummary.personalInfo.email;
s.location.href=j.contextPath+"/"+j.locale+"/reservation"+htmlExtension+"#/manage"
}else{A.prod=u.processErrorMessage(F);
j.requestInProgress=false
}}}else{A.getEmail=F.reservationSummary.personalInfo.email;
if(F.reservationSummary.permission&&F.reservationSummary.permission.modify&&F.reservationSummary.permission.modify.visible=="TRUE"){s.location.href=j.contextPath+"/"+j.locale+"/reservation"+htmlExtension+"#/manage"
}else{if(angular.isDefined(F.reservationSummary)&&angular.isDefined(F.reservationSummary.rentalType)&&F.reservationSummary.rentalType=="Open"&&angular.isDefined(F.reservationSummary.gateExitDone)&&F.reservationSummary.gateExitDone){l.fetchRentalDetails(F.reservationSummary.rentalAgreementNumber).then(function(G){if(angular.isDefined(G)&&angular.isUndefined(G.errorList)){s.location.href=j.contextPath+"/"+j.locale+"/rental/view-modify"+htmlExtension
}},function(G){A.errorDisplayList=G.errorList;
j.requestInProgress=false
})
}else{if(angular.isDefined(F.reservationSummary)&&angular.isDefined(F.reservationSummary.rentalType)&&F.reservationSummary.rentalType=="Open"&&angular.isDefined(F.reservationSummary.gateExitDone)&&!F.reservationSummary.gateExitDone){l.fetchRentalDetails(F.reservationSummary.rentalAgreementNumber).then(function(G){if(angular.isDefined(G)&&angular.isUndefined(G.errorList)){s.location.href=j.contextPath+"/"+j.locale+"/rental/view-modify"+htmlExtension
}},function(H){if(H&&H.fieldErrors){var G=u.processErrorMessage(H);
A.errorDisplayList=G;
j.requestInProgress=false
}else{A.errorDisplayList=H.errorList;
j.requestInProgress=false
}})
}else{s.location.href=j.contextPath+"/"+j.locale+"/reservation"+htmlExtension+"#/confirmation/lookup"
}}}}}}},function(F){if(F&&F.fieldErrors){var E=u.processErrorMessage(F);
A.errorDisplayList=E;
j.requestInProgress=false
}else{A.errorDisplayList=F.errorList;
j.requestInProgress=false
}})
}};
A._initLookup();
function p(){var E=s.countrySelect?s.countrySelect:"U S A";
if(s.countrySelect==="US"){E="U S A"
}if(angular.isDefined(A.countryList)){var D=A.countryList.indexOf(t("filter")(A.countryList,function(F){return F.name===E
})[0]);
A.country=A.countryList[D].code
}}var h=e("LookupExnController",{$scope:u});
angular.extend(this,h);
j.$on("Profile.successAuthentication",function(E,D){A.session=r.getSessionModel();
A.customer=r.getCustomerModel()
})
}})();
(function(){angular.module("reservation").controller("ModifyReservationController",a);
a.$inject=["ftpService","$scope","$rootScope","$state","$stateParams","$sce","$window","$controller","$filter","getDataService","locationTermsConditionsService","lookupService","optionalService","authenticationService","airlineService","confirmModifications","reviewModifyService","vehicleService","$validation","carRentalConstant","reservationModelService","reviewService","$timeout","helpcontentService","utilityService","storageService","confirmCancelService","emailService","confirmationService","BackButtonFactory","ancillaryService"];
function a(t,M,y,ao,az,au,X,ad,aD,aw,at,K,af,R,d,I,aH,aK,ax,S,Q,aI,ae,an,b,ai,av,aA,x,C,z){ad("ExceptionHandlerController",{$scope:M});
y.requestInProgress=true;
var aE={contentType:"",locCode:"",rqHeader:{locale:""}};
var Y=0;
var v={};
var e={};
var aE={};
var w=this;
w.domain=X.domain;
w.reservationModel=Q.getReservationModel();
w.customer=R.getCustomerModel();
w.session=R.getSessionModel();
w.model={};
w.insuranceCheckbox={};
w.productCheckbox={};
w.pointCheckbox={};
w.insurances={};
w.products={};
w.insurancePackageSelected=false;
w.response={};
w.prod;
w.loginValidated=false;
w.loginFormPageError="";
w.modifiedPickupDate="";
w.modifiedDropDate="";
w.modifiedFullPickupDate="";
w.modifiedFullDropDate="";
w.modifiedPhoneNumber="";
w.redeemedModifyRes=false;
w.CompleteTexNew={};
w.airlines={};
w.reviewModifications={};
w.redeemedRes=false;
w.modifyPageError="";
w.currencySymbol="";
w.frdProdArrayFLag=false;
w.freeDayPoints=0;
w.childSafetyExpanded=false;
w.selectedProductsCodeForExpansion={};
w.insuranceDisplayCount={};
w.equipDisplayLen={};
w.servicesDisplaylen={};
w.loyaltyLogin=false;
w.indicatorMap={email_id:"1",credit_id:"1",address_id:"1",phone_id:"1"};
w.emailaddr="";
w.accordionStatus={mileage:false};
w.lookupPageErrorCancelReservation="";
var aa=false;
var N="";
var aG="";
var n="";
w.processPageLoad=true;
w.displayBundles=false;
w.showEquipmentSec=false;
w.showCarousalArrow=false;
w.servicestab1len={};
w.servicestab2len={};
w.cssDropDown={};
var k=Dictionary.I18n.get("lbl.res.select");
w.cssDropDownValues={CBS:[{selectId:"",selectName:k}],CFS:[{selectId:"",selectName:k}],CIS:[{selectId:"",selectName:k}],CSB:[{selectId:"",selectName:k}],CSS:[{selectId:"",selectName:"Select"}],BXS:[{selectId:"",selectName:k}],BXM:[{selectId:"",selectName:k}],BXL:[{selectId:"",selectName:k}]};
w.proactiveChat=false;
w.showProactiveChatBtn=(angular.isDefined(ai.getStorageData("proactiveChatStatus"))&&ABG.getMobileOperatingSystem()==="unknown")?true:false;
w.callProactiveChat=s;
w.pageName=ao.current.name;
y.reservation=S.resFlowCreate;
w.rentalLocationCountry="";
w.getLoginModalWindow=g;
w.getDataInitiate=L;
w.getvehicleModify=ac;
w.modifyTimePlace=aj;
w.insuranceSelected=P;
w.productSelected=D;
w.pointSelectedvsFTP=q;
w.keepFTPEarning=T;
w.keepPointsSelection=aL;
w.pointSelected=U;
w.cancelModification=al;
w.loadHelpModal=O;
w.disablePtsPerDay=u;
w.selectingEmail=ab;
w.selectingPhoneNumber=ar;
w.couponCodeDisabled=false;
w.modifyExtras=B;
w.extrasCollapse=true;
w.printConfirmation=c;
w.printReservationDetails=F;
w.addToCalendar=o;
w.showModify=E;
w.showCancel=f;
w.checkRefund=aF;
w.checkCancelReservation=m;
w.pageInit=ay;
w.getModifyExtra=J;
w.redirectError=j;
w.validatePhoneNumber=aC;
w.cancelFeeGreaterThanPrepaidAmount=false;
w.cancelFeeLessOrEqualThanPrepaidAmount=false;
w.rentalLocationCountry="";
w.showCarousalArrow=false;
w._authenticationHandler=ak;
w._processModifyResPage=ag;
w._getAirlines=Z;
w._getFTPSectionMessage=p;
w._rentalOptionsCall=am;
w._validateFTPData=G;
w._handlePKG=W;
w.bookAgainFTPCheck=H;
w.showExcludedProducts=l;
w.cancelOrNoShowFeeMessage=aq;
w.amazonBenefitsKey=Dictionary.I18n.get("lbl.global.amazonBenefits");
y.$on("Profile.displayProactiveChat",function(aM,i){w.showProactiveChatBtn=true
});
function m(){if((w.pageName==S.cancelBookingPage)||(angular.isDefined(w.prod)&&angular.isDefined(w.prod.reservationSummary)&&(w.prod.reservationSummary.permission==undefined||(w.prod.reservationSummary.permission.cancel&&(w.prod.reservationSummary.permission.cancel.visible==undefined||w.prod.reservationSummary.permission.cancel.visible==="FALSE"))))){return true
}else{return false
}}function E(){if(w.prod.reservationSummary&&(!w.prod.reservationSummary.permission||!w.prod.reservationSummary.permission.modify||w.prod.reservationSummary.permission.modify.visible=="TRUE")){return true
}else{return false
}}function f(){if(w.prod.reservationSummary&&(!w.prod.reservationSummary.permission||!w.prod.reservationSummary.permission.cancel||w.prod.reservationSummary.permission.cancel.visible=="TRUE")){return true
}else{return false
}}function aF(){if(w.prod&&w.prod.reservationSummary&&w.prod.reservationSummary.permission&&w.prod.reservationSummary.permission.refund&&w.prod.reservationSummary.permission.refund.visible&&w.prod.reservationSummary.permission.refund.visible=="TRUE"){return true
}else{if(w.prod&&angular.isDefined(w.prod.reservationSummary)&&angular.isDefined(w.prod.reservationSummary.missedReservation)&&w.prod.reservationSummary.missedReservation==true){return true
}else{return false
}}}w.forwardEmail={validated:false,globaErrorFlag:false,globalError:"",submit:function(i){ax.validate(i).success(w.forwardEmail.validationSuccess).error(w.forwardEmail.validationError)
},validationSuccess:function(){y.requestInProgress=true;
var i={confirmationNum:w.prod.reservationSummary.confirmationNumber,lastName:w.prod.reservationSummary.personalInfo.lastName.value,emailId:w.forwardEmailModel.emailId.toLowerCase()};
if(w.forwardEmailModel.emailId.toLowerCase()==w.forwardEmailModel.confirmEmailId.toLowerCase()){var aM=aA.forwardEmail(i);
aM.then(function(aN){y.requestInProgress=false;
w.forwardMessage=aN;
ax.resetError("vm.forwardEmailModel.emailId",true);
ax.resetError("vm.forwardEmailModel.confirmEmailId",true);
if(w.forwardMessage){jQuery(".confirmation-email").modal("toggle")
}w.fwdEmailId=w.forwardEmailModel.emailId.toLowerCase();
w.forwardEmail.globalError="";
w.forwardEmail.globaErrorFlag=false;
w.forwardEmailModel.emailId="";
w.forwardEmailModel.confirmEmailId=""
},function(aN){y.requestInProgress=false
})
}else{ax.displayServiceError("vm.forwardEmailModel.confirmEmailId","emailmatch");
y.requestInProgress=false
}},validationError:function(i){w.forwardEmail.globaErrorFlag=true;
w.forwardEmail.globalError=ABG.getFormValidationError(i,false)[0].message
}};
var aJ=0;
var ah=0;
function H(i){if(i&&w.prod.reservationSummary.rebookFlow){if(angular.isDefined(w.prod.reservationSummary.ftpDetails)&&angular.isDefined(w.prod.reservationSummary.ftpDetails.ftpNumber)){return true
}else{return false
}}else{if(!i&&w.prod.reservationSummary.rebookFlow){if(angular.isUndefined(w.prod.reservationSummary.ftpDetails)||angular.isUndefined(w.prod.reservationSummary.ftpDetails.ftpNumber)){return true
}else{return false
}}}if(!i){return false
}else{return true
}}function ak(i){w.model=i;
if(i.reservationSummary.userState==S.userStateAuthenticated){var aM={};
if(w.model.reservationSummary.rateSummary.totalRdmPts!=undefined){aM=K.load()
}else{aM=af.recalculate("false")
}aM.then(function(aN){w.session=R.getSessionModel();
aw.addToReservationData(aN);
w.getDataInitiate()
},function(aN){})
}else{w.loginValidated=true;
w.loginFormPageError=Dictionary.I18n.get("err.prof.login.authenticationFailedAction")
}}y.$on("Profile.successAuthentication",function(aM,i){w._authenticationHandler(i)
});
function g(){y.$broadcast("LoginActivity",{requestType:"Login",variance:"Small"})
}function u(i){if(((i.points+w.prod.reservationSummary.rateSummary.totalRdmPts>w.totalPoints||i.redeemable==false)&&(w.pointCheckbox[i.code]==undefined||w.pointCheckbox[i.code]==false))||w.redeemedRes){return true
}else{return false
}}function L(){var i=ai.getStorageData("equipmentCSSList");
if(angular.isDefined(i)&&!aa){w._processModifyResPage(i);
ai.deleteStorageData("equipmentCSSList")
}else{K.getData(S.modifyReservationPage).then(function(aM){w.reservationModel=Q.getReservationModel();
if(w.reservationModel){w._processModifyResPage(aM)
}else{var aN=Q.load(aM,true);
aN.then(function(aO){w.reservationModel=aO;
w._processModifyResPage(aM)
})
}})
}w.accordionStatus.mileage=false
}function ag(aM){if(angular.isDefined(aM.reservationSummary)&&angular.isDefined(aM.reservationSummary.personalInfo)&&angular.isDefined(aM.reservationSummary.personalInfo.phoneNumbers)){angular.forEach(aM.reservationSummary.personalInfo.phoneNumbers,function(aR){if(aR.phoneNumber==aM.reservationSummary.personalInfo.phone){aR.selected=true
}else{aR.selected=false
}})
}if(aM.reservationSummary.flightInfo&&aM.reservationSummary.flightInfo.visible==="TRUE"){w._getAirlines()
}if(w.reservationModel){w.reservationModel.selectedNonSupCPlist=[];
if(aM.reservationSummary&&aM.reservationSummary.rateSummary&&aM.reservationSummary.rateSummary.selectedNonSupCPlist){w.reservationModel.selectedNonSupCPlist=aM.reservationSummary.rateSummary.selectedNonSupCPlist
}w.reservationModel.userState=aM.reservationSummary.userState
}w.insurances=aM.reservationSummary.insuranceSummaryList;
var i=w.insurances;
w.products=aM.reservationSummary.productSummaryList;
var aQ=w.products;
var aN=z.process(aM.reservationSummary);
w.ancillaryProductsList=aN.ancillaryProductsList;
w.insuranceDisplayCount=aN.insuranceDisplayCount;
w.displayTabsList=aN.displayTabsList;
w.equipDisplayLen=aN.equipDisplayLen;
w.servicesDisplaylen=aN.servicesDisplaylen;
w.servicestab1len=aN.servicestab1len;
w.servicestab2len=aN.servicestab2len;
if(!(aM.reservationSummary.ancillaryBundleSummary&&aM.reservationSummary.ancillaryBundleSummary.length>0&&"INBOUND_BASIC"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"INBOUND_ALL"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"GUIDED_RES"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"LAST_MINUTE"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName)&&(!angular.isDefined(w.insurances))){w.showEquipmentSec=true
}if((aM.reservationSummary.ancillaryBundleSummary&&aM.reservationSummary.ancillaryBundleSummary.length>0&&"INBOUND_BASIC"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"INBOUND_ALL"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"GUIDED_RES"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"LAST_MINUTE"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName)&&angular.isDefined(w.insurances)&&angular.isDefined(w.products)||(!(aM.reservationSummary.ancillaryBundleSummary&&aM.reservationSummary.ancillaryBundleSummary.length>0&&"INBOUND_BASIC"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"INBOUND_ALL"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"GUIDED_RES"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"LAST_MINUTE"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName)&&angular.isDefined(w.insurances)&&angular.isDefined(w.products))||((aM.reservationSummary.ancillaryBundleSummary&&aM.reservationSummary.ancillaryBundleSummary.length>0&&"INBOUND_BASIC"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"INBOUND_ALL"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"GUIDED_RES"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"LAST_MINUTE"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName)&&!angular.isDefined(w.insurances)&&angular.isDefined(w.products))||(aM.reservationSummary.ancillaryBundleSummary&&aM.reservationSummary.ancillaryBundleSummary.length>0&&"INBOUND_BASIC"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"INBOUND_ALL"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"GUIDED_RES"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"LAST_MINUTE"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName)&&angular.isDefined(w.insurances)&&!angular.isDefined(w.products)){w.showCarousalArrow=true
}if(aM.reservationSummary.ancillaryBundleSummary&&aM.reservationSummary.ancillaryBundleSummary.length>0&&"INBOUND_BASIC"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"INBOUND_ALL"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"GUIDED_RES"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName&&"LAST_MINUTE"!==aM.reservationSummary.ancillaryBundleSummary[0].bundleName){w.displayBundles=true
}w.Tabactive=z.getCurrentActiveTab(w.displayTabsList);
w.productsSelected=aM.reservationSummary.rateSummary.selectedProducts;
if(angular.isUndefined(w.productsSelected)||w.productsSelected.length==0){w.EquipmentServiceSelection=true
}w.insurancesSelected=aM.reservationSummary.rateSummary.selectedInsurances;
Q.setStorageData("insuranceList",i);
Q.setStorageData("productList",aQ);
w.reservationModel.selectedInsurances=[];
angular.forEach(i,function(aR){if(aR.selected){w.reservationModel.selectedInsurances.push(aR)
}});
angular.forEach(w.products,function(aU){if(!angular.isDefined(aU.price)){aU.price=Dictionary.I18n.get("res.step3.extras.market")
}if(aU.selected){if(aU.redeemedQty!=undefined&&aU.redeemedQty>0){if(aU.code=="FRD"){w.frdProdArrayFLag=true;
w.freeDayPoints=aU.redeemedQty
}w.pointCheckbox[aU.code]=true;
w.productCheckbox[aU.code]=false
}else{w.pointCheckbox[aU.code]=false;
w.productCheckbox[aU.code]=true
}aU.quantity="1";
var aT=false;
for(var aS=0;
aS<w.reservationModel.selectedProducts.length;
aS++){if(aU.code==w.reservationModel.selectedProducts[aS].code){aT=true
}}if(!aT){w.reservationModel.selectedProducts.push(aU)
}}if(aU.subProducts!=undefined){var aR=aU.subProducts;
angular.forEach(aR,function(aV){if(angular.isDefined(aV.selected)){w.selectedProductsCodeForExpansion[aU.code]=aV.selected
}A(aV.code,aV.displayQuantity);
if(aV.selected===true){if(aV.redeemedQty!=undefined&&aV.redeemedQty>0){w.pointCheckbox[aV.code]=true;
w.productCheckbox[aV.code]=false
}else{w.pointCheckbox[aV.code]=false;
w.productCheckbox[aV.code]=true
}w.childSafetyExpanded=true;
w.cssDropDown[aV.code]=aV.quantity;
w.productCheckbox[aU.code]=true
}else{w.cssDropDown[aV.code]=0
}})
}});
if(aM.reservationSummary.ftpDetails&&aM.reservationSummary.ftpDetails.visible=="TRUE"){var aO=t.getData();
aO.then(function(aR){w.ftp=aR;
if(aM.reservationSummary.ftpDetails.partnerCode!=S.ftpNotApplicableLower){w.reservationModel.ftpDetails.partnerCode=aM.reservationSummary.ftpDetails.partnerCode
}else{w.reservationModel.ftpDetails.partnerCode=""
}if(aM.reservationSummary.ftpDetails.ftpNumber!=S.ftpNotApplicableLower){w.reservationModel.ftpDetails.ftpNumber=aM.reservationSummary.ftpDetails.ftpNumber
}else{w.reservationModel.ftpDetails.ftpNumber=""
}w.reservationModel.ftpDetails.ftpBonusMiles=aM.reservationSummary.ftpDetails.ftpBonusMiles;
if(aM.reservationSummary.ftpDetails.messages){w._getFTPSectionMessage(aM.reservationSummary.ftpDetails.messages)
}},function(aR){})
}if(w.pageName==S.modifyReservationPage&&aM.reservationSummary.loyaltyDetails&&aM.reservationSummary.loyaltyDetails.loyaltyLogin&&aM.reservationSummary.loyaltyDetails.loyaltyLogin.visible=="TRUE"&&aM.reservationSummary.userState==S.userStateRecognized){w.loyaltyLogin=true
}else{w.loyaltyLogin=false
}w.response=aM;
w._rentalOptionsCall(aw,af,Q,aM);
angular.forEach(w.insurances,function(aR){if(aR.selected&&aR.code===S.insuranceList.pkg){w.insurancePackageSelected=true
}});
if(S.resFlowModify==w.reservationModel.displayControls.reservation){angular.forEach(w.products,function(aS){if(aS.selected){w.productCheckbox[aS.code]=true;
aS.quantity="1";
var aT=false;
for(Y=0;
Y<w.reservationModel.selectedProducts.length;
Y++){if(w.redeemedModifyRes==false){var aR=parseInt(w.reservationModel.selectedProducts[Y].totalRedeemedPts);
if(aR>0){w.redeemedModifyRes=true
}}}}})
}var aP=(w.response.reservationSummary.prepayTxn===true)?S.txnTypePrePay:S.txnTypePostPay;
var aO=at.load(aP,w.response.reservationSummary.pickLoc.locationCode);
aO.then(function(aR){if(angular.isDefined(aR.fieldErrors)&&aR.fieldErrors.length>0||(angular.isDefined(aR.errorList)&&aR.errorList.length>0)||(angular.isDefined(aR.warningList)&&aR.warningList.length>0)){M.processErrorMessage(aR)
}else{w.CompleteTexNew=aR
}},function(aR){});
y.requestInProgress=false;
w.reservationModel.costControl=aI.costControlData(aM.reservationSummary);
if(R.getHideRedemptionOption()==true){w.reviewModifications.modifyPageValidated=false
}}function A(aN,aO){for(var aM=0;
aM<=aO;
aM++){w.cssDropDownValues[aN].push({selectId:aM,selectName:aM})
}}w.helpURL="";
function O(i){var aM=i.target.parentElement;
var aN=w.prod.reservationSummary.pickLoc.address.country;
w.helpURL=an.getUrl(aM,aN)
}function ac(){aw.resetAvailableVehicles();
v=aK.load();
v.then(function(i){if(angular.isDefined(i.fieldErrors)&&i.fieldErrors.length>0||(angular.isDefined(i.errorList)&&i.errorList.length>0)||(angular.isDefined(i.warningList)&&i.warningList.length>0)){M.processErrorMessage(i)
}else{w.model=i;
aw.addToAvailableVehicles(i);
e=i;
y.reservation=S.resFlowModify;
if(aa){X.location.href=y.contextPath+"/"+y.locale+"/reservation"+htmlExtension+"#/vehicles"
}else{ao.go(S.step2PageName)
}}},function(i){})
}function p(aO){var aP=[];
var aN=[];
var i=[];
var aM=[];
angular.forEach(aO,function(aQ){if(angular.equals(aQ.type,"ERROR")){i.push(aQ)
}else{if(angular.equals(aQ.type,"WARNING")){aM.push(aQ)
}else{aN.push(aQ)
}}});
w.ftpSectInstrList=aN;
w.ftpSectErrList=i;
w.ftpSectWarList=aM
}w.reviewModifications={modifyPageValidated:true,submit:function(i){w.reviewModifications.modifyPageValidated=true;
ax.validate(i).success(w.reviewModifications.validationSuccess).error(w.reviewModifications.validationError)
},validationSuccess:function(){var i=false;
if(w.prod.reservationSummary.flightInfo&&angular.isDefined(w.prod.reservationSummary.flightInfo.mandatory)&&w.prod.reservationSummary.flightInfo.mandatory==="TRUE"){if(w.reservationModel.flightNumber===""){ax.displayServiceError("reservationModel.flightNumber","required");
i=true
}if(w.reservationModel.airlineCode===""){ax.displayServiceError("reservationModel.airlineCode","selectrequired");
i=true
}}w.reservationModel.flightNumber=w.reservationModel.flightNumber||"";
if(i===false){if(((w.reservationModel.airlineCode===""||w.reservationModel.airlineCode==null)&&w.reservationModel.flightNumber==="")||((w.reservationModel.airlineCode!==""&&w.reservationModel.airlineCode!=null)&&w.reservationModel.flightNumber=="")){i=false
}else{if((w.reservationModel.airlineCode===""||w.reservationModel.airlineCode==null)&&(angular.isDefined(w.reservationModel.flightNumber))){ax.displayServiceError("reservationModel.airlineCode","selectrequired");
i=true
}else{if((w.reservationModel.airlineCode!==""||w.reservationModel.airlineCode!=null)&&w.reservationModel.flightNumber===""){ax.displayServiceError("reservationModel.flightNumber","required");
i=true
}else{i=false
}}}}if(i===false){w.reviewModifications.modifyPageValidated=true;
w._validateFTPData();
if(w.errorList.length<1){w.reviewModifications.modifyRequest()
}}},validationError:function(i){w.reviewModifications.modifyPageValidated=false;
if(1===i.errorCount){w.modifyPageError=i.MSG[0]
}else{if(1<i.errorCount){w.modifyPageError=Dictionary.I18n.get("err.global.multi.errorMessage")
}}},modifyRequest:function(){if(angular.isDefined(aw)&&angular.isDefined(aw.getReservationData())&&angular.isDefined(aw.getReservationData().reservationSummary)){if(angular.isDefined(aw.getReservationData().reservationSummary)&&angular.isDefined(aw.getReservationData().reservationSummary.iataNumber)){w.reservationModel.iataNumber=aw.getReservationData().reservationSummary.iataNumber
}}if(angular.isDefined(w.prod.domainConfigControl)&&angular.isDefined(w.prod.domainConfigControl.displayElementMap)){w.reservationModel.displayElementMap=w.prod.domainConfigControl.displayElementMap
}Q.setStorageData("reservationModel",w.reservationModel);
if(w.reservationModel.wizardNumber!=""||(w.reservationModel.userState=="RECOGNIZED"||w.reservationModel.userState=="AUTHENTICATED")){var i={email_id:(angular.isDefined(w.indicatorMap.email_id)&&w.indicatorMap.email_id!="")?w.indicatorMap.email_id:"1",address_id:(angular.isDefined(w.indicatorMap.address_id)&&!(/^[a-zA-Z0-9]*$/.test(w.reservationModel.paymentRq.address.address1)))?w.indicatorMap.address_id:" ",phone_id:(angular.isDefined(w.indicatorMap.phone_id)&&!(/^[0-9]*$/.test(w.reservationModel.personalInfoRQ.phone)))?w.indicatorMap.phone_id:" ",credit_id:(angular.isDefined(w.indicatorMap.credit_id)&&!(/^[0-9]*$/.test(w.creditCardNumber)))?w.indicatorMap.credit_id:" "};
aw.addToIndicatorMap(i)
}v=aH.load();
v.then(function(aM){if(angular.isDefined(aM.fieldErrors)&&aM.fieldErrors.length>0||(angular.isDefined(aM.errorList)&&aM.errorList.length>0)||(angular.isDefined(aM.warningList)&&aM.warningList.length>0)){aM=M.processErrorMessage(aM);
if(angular.isDefined(aM.fieldErrors)&&aM.fieldErrors.length>0||(angular.isDefined(aM.errorList)&&aM.errorList.length>0)){w.errorList=aM.errorList
}if(angular.isDefined(aM.warningList)&&aM.warningList.length>0){w.warningList=aM.warningList
}}else{w.model=aM;
if(aM.reservationSummary.ftpDetails&&aM.reservationSummary.ftpDetails.partnerCode&&aM.reservationSummary.ftpDetails.partnerCode!=""){if(w.ftp&&w.ftp.partnersList){w.reservationModel.ftpDetails.partnerName=b.getPartnerName(aM.reservationSummary.ftpDetails.partnerCode,w.ftp.partnersList,false)
}}aw.addReviewModificationData(aM);
Q.setReservationModel(w.reservationModel);
if(aa){X.location.href=y.contextPath+"/"+y.locale+"/reservation"+htmlExtension+"#/review-modifications"
}else{ao.go(S.modifyReviewConfirmPage)
}}},function(aM){})
}};
w.cancelReservation={submit:function(i){ax.validate(i).success(w.cancelReservation.validationSuccess).error(w.cancelReservation.validationError)
},validationSuccess:function(){y.requestInProgress=true;
w.cancelReservation.process()
},validationError:function(i){},process:function(){var aN=w.prod.reservationSummary.confirmationNumber;
var aM=w.prod.reservationSummary.personalInfo.lastName.value;
var i=w.emailaddr;
av.load(aN,aM,i).then(function(aO){w.model=aO;
if(angular.isDefined(aO.errorList)&&aO.errorList.length>0){C.process(aO.errorList[0].code);
y.requestInProgress=false
}else{if(undefined!=w.model.reservationSummary.loyaltyDetails){R.setLoyaltyDetails(R.setLoyaltyDetailsData(w.model));
y.$broadcast("loyaltyUpdated",w.model)
}ai.deleteStorageData("upcomingReservations");
ai.deleteStorageData("cancelledReservations");
aw.deleteConcurTripList();
jQuery(".getres-modal-cancel").modal("hide");
X.location.href=y.contextPath+"/"+y.locale+"/reservation"+htmlExtension+"#/cancel-confirmation"
}},function(aO){})
}};
function s(){w.proactiveChat=true;
$(".oo_feedback_float").hide();
$("#TPClientEmbeddedChatTriggerButton").click()
}function G(){var i=true;
var aN=true;
var aO=[];
var aM;
var aP=[];
if(w.reservationModel.ftpDetails.partnerCode==undefined||w.reservationModel.ftpDetails.partnerCode==""){i=false
}if(w.reservationModel.ftpDetails.ftpNumber==undefined||w.reservationModel.ftpDetails.ftpNumber==""){aN=false
}if(aN&&!i){aO.push(ax.displayServiceError("vm.reservationModel.ftpDetails.partnerCode","ftpInvalid"))
}else{if(i&&!aN){aO.push(ax.displayServiceError("vm.reservationModel.ftpDetails.ftpNumber","ftpInvalid"))
}}if(1===aO.length){aM={message:aO[0]}
}if(aO.length!=0){aP.push(aM)
}w.errorList=aP
}function aj(){y.reservation="modify";
w.reservationModel.displayControls.fieldDisable=true;
w.reservationModel.displayControls.countryFieldDisable=true;
if(angular.isDefined(w.reservationModel.coupon)&&angular.isDefined(w.reservationModel.coupon.visible===false)){w.couponCodeDisabled=true;
w.reservationModel.coupon.couponNumber=""
}Q.setReservationModel(w.reservationModel);
if(aa){X.location.href=y.contextPath+"/"+y.locale+"/reservation"+htmlExtension+"#/time-and-place"
}else{ao.go("/make-a-reservation")
}}function B(){w.extrasCollapse=!w.extrasCollapse
}function P(aM,i){if($("#PKGchk").length>0){if((w.insuranceCheckbox.PEP&&w.insuranceCheckbox.ALI&&w.insuranceCheckbox.PAI)||(w.insuranceCheckbox.PKG)){w._handlePKG()
}else{w.insurancePackageSelected=false
}}if(!w.insurancePackageSelected){aM.selected=w.insuranceCheckbox[i];
if(w.insuranceCheckbox[i]){w.reservationModel.selectedInsurances.push(aM)
}else{if(!(w.insuranceCheckbox[i])){w.reservationModel=af.arrayPop(i,true,w.reservationModel)
}}}Q.setReservationModel(w.reservationModel);
y.requestInProgress=true;
v=af.recalculate("false");
v.then(function(aN){if(angular.isDefined(aN.fieldErrors)&&aN.fieldErrors.length>0||(angular.isDefined(aN.errorList)&&aN.errorList.length>0)){M.processErrorMessage(aN)
}else{y.requestInProgress=false;
w.insurances=aN.reservationSummary.insuranceSummaryList;
w.prod=aN;
w.response=aN
}},function(aN){})
}function W(){w.insuranceCheckbox.PKG=true;
w.insurancePackageSelected=true;
w.insuranceCheckbox.PEP=false;
w.insuranceCheckbox.ALI=false;
w.insuranceCheckbox.PAI=false;
w.reservationModel.selectedInsurances=[];
angular.forEach(w.insurances,function(i){if(i.code=="PKG"){insuranceObj=i;
insuranceObj.selected=true
}});
w.reservationModel.selectedInsurances.push(insuranceObj)
}function D(aM,aN,aS,aP){y.requestInProgress=true;
aM.selected=w.productCheckbox[aN];
aM.quantity="1";
w.reservationModel.initOptionalServiceFlag=true;
if(angular.isDefined(aM.subProducts)&&aM.subProducts.length>0){w.selectedProductsCodeForExpansion[aN]=w.productCheckbox[aN]
}if(!w.productCheckbox[aN]&&angular.isDefined(aM.subProducts)&&aM.subProducts.length>0){w.productCheckbox[aN]=false;
y.requestInProgress=false;
af.unCheckCSSOption(aM);
for(var aO=0;
aO<aM.subProducts.length;
aO++){var aR=aM.subProducts[aO].code;
w.productCheckbox[aR]=false;
w.cssDropDown[aR]=0
}}else{Q.setReservationModel(w.reservationModel);
var aQ={pointCheckbox:w.pointCheckbox,productCheckbox:w.productCheckbox,cssDropDown:w.cssDropDown,products:w.products,redeemedQty:w.redeemedQty,childSafetyExpanded:w.childSafetyExpanded,frdSelectedFlag:w.frdSelectedFlag,freeDayPoints:w.freeDayPoints,loyaltyDetails:w.loyaltyDetails,totalPoints:w.totalPoints};
var aU=af.handleProducts(aM,aN,aS,aP,ah,aQ);
w.pointCheckbox=aU.pointCheckbox;
w.productCheckbox=aU.productCheckbox;
w.cssDropDown=aU.cssDropDown;
w.products=aU.products;
w.redeemedQty=aU.redeemedQty;
w.childSafetyExpanded=aU.childSafetyExpanded;
w.freeDayPoints=aU.freeDayPoints;
w.loyaltyDetails=aU.loyaltyDetails;
w.totalPoints=aU.totalPoints;
ah=aU.quantity;
if(aU.flag){y.requestInProgress=false;
return
}}Q.setReservationModel(w.reservationModel);
y.requestInProgress=true;
var aT=af.recalculate("false");
aT.then(function(i){if(angular.isDefined(i.fieldErrors)&&i.fieldErrors.length>0||(angular.isDefined(i.errorList)&&i.errorList.length>0)){M.processErrorMessage(i);
y.requestInProgress=false
}else{y.requestInProgress=false;
w.products=i.reservationSummary.productSummaryList;
var aV=z.process(i.reservationSummary);
w.ancillaryProductsList=aV.ancillaryProductsList;
w.insurances=i.reservationSummary.insuranceSummaryList;
w.pointProducts=i.reservationSummary.pointProducts;
w.prod=M.processErrorMessage(i);
if(w.prod.instructionList&&w.prod.instructionList.length>0){w.instructionList=w.prod.instructionList
}angular.forEach(w.instructionList,function(aW){if((w.instructionList)&&(w.instructionList.length>0)&&b.containsObject(aW.code,S.nonParticpatingBcd)){w.reservationModel.coupon.discountNumber=""
}});
Q.setReservationModel(w.reservationModel)
}},function(i){})
}function q(aM,aN,aO,i){w.productObjSelected=aM;
w.codeSelected=aN;
w.productSectionSelected=aO
}function aL(){w.pointSelected(w.productObjSelected,w.codeSelected)
}function T(){y.requestInProgress=true;
var i=af.disableLoyalty("true");
i.then(function(aM){if(angular.isDefined(aM.fieldErrors)&&aM.fieldErrors.length>0||(angular.isDefined(aM.errorList)&&aM.errorList.length>0)){M.processErrorMessage(aM)
}else{y.requestInProgress=false;
w.products=aM.reservationSummary.productSummaryList;
w.pointProducts=aM.reservationSummary.pointProducts;
w.prod=aM;
w.displayFreedayFlag=false
}},function(aM){})
}function U(i,aM){i.selected=w.pointCheckbox[aM];
i.redeemedQty="1";
i.quantity="1";
if(w.pointCheckbox[aM]){w.reservationModel.selectedProducts.push(i)
}else{if(!(w.pointCheckbox[aM])){w.reservationModel=af.arrayPop(aM,false,reservationModel)
}}Q.setReservationModel(w.reservationModel);
v=af.recalculate("false");
v.then(function(aN){if(angular.isDefined(aN.fieldErrors)&&aN.fieldErrors.length>0||(angular.isDefined(aN.errorList)&&aN.errorList.length>0)){M.processErrorMessage(aN)
}else{w.products=aN.reservationSummary.productSummaryList;
w.prod=aN;
w.response=aN
}},function(aN){})
}function Z(){v=d.load();
v.then(function(i){if(angular.isDefined(i.fieldErrors)&&i.fieldErrors.length>0||(angular.isDefined(i.errorList)&&i.errorList.length>0)||(angular.isDefined(i.warningList)&&i.warningList.length>0)){M.processErrorMessage(i)
}else{if(angular.isDefined(w.prod.reservationSummary.flightInfo.mandatory)&&w.prod.reservationSummary.flightInfo.mandatory=="TRUE"&&angular.isDefined(i.flightInfoList)&&i.flightInfoList.length>1&&i.flightInfoList[0].airlineCode==S.notFlying){i.flightInfoList.shift()
}w.airlines=i
}},function(i){})
}function am(aO,i,aN,aM){w.prod=aM;
w.reservationModel=aN.getReservationModel();
aN.setReservationModel(w.reservationModel);
if((w.reservationModel.selectedProducts).length>0){angular.forEach(w.reservationModel.selectedProducts,function(aP,aQ){if(w.reservationModel.selectedProducts[aQ].redeemedQty!=undefined&&w.reservationModel.selectedProducts[aQ].redeemedQty!="0"){w.pointCheckbox[w.reservationModel.selectedProducts[aQ].code]=true
}else{if(w.reservationModel.selectedProducts[aQ].redeemedQty==undefined||w.reservationModel.selectedProducts[aQ].redeemedQty=="0"){w.productCheckbox[w.reservationModel.selectedProducts[aQ].code]=true
}}})
}if(w.prod.reservationSummary.rateSummary.totalRdmPts&&w.prod.reservationSummary.rateSummary.totalRdmPts>0){w.redeemedModifyRes=true;
w.redeemedRes=true;
w.chkRedeemedRes=true;
y.chkRedeemedRes=true
}w.currencySymbol=aD("currencySymbol")(w.prod.reservationSummary.rateSummary.currencySymbol)
}function al(i){y.requestInProgress=true;
w.reservationModel=Q.getReservationModel();
w.reservationModel.displayControls.reservation=S.resFlowModify;
w.reservationModel.displayControls.cancelModify=true;
I.load(i).then(function(aM){y.requestInProgress=false;
if(aa){X.location.href=y.contextPath+"/"+y.locale+"/reservation"+htmlExtension+"#/confirmation/"
}else{ao.go(S.confirmationPage)
}},function(aM){});
Q.setReservationModel(w.reservationModel);
y.requestInProgress=false
}function l(aO){w.excludedProductsList=[];
var aN,aM;
if(aO){if(aO.productSummaryList&&aO.productSummaryList.length>0){for(aN=0;
aN<aO.productSummaryList.length;
aN++){if(aO.productSummaryList[aN].code!=S.equipmentCodeCSSG){if(aO.productSummaryList[aN].discountEligible==false||aO.productSummaryList[aN].discountEligible==""){w.excludedProductsList.push(aO.productSummaryList[aN].description)
}}else{for(aM=0;
aM<aO.productSummaryList[aN].subProducts.length;
aM++){if(aO.productSummaryList[aN].subProducts[aM].discountEligible==false||aO.productSummaryList[aN].subProducts[aM].discountEligible==""){w.excludedProductsList.push(aO.productSummaryList[aN].subProducts[aM].description)
}}}}}if(aO.insuranceSummaryList&&aO.insuranceSummaryList.length>0){for(aN=0;
aN<aO.insuranceSummaryList.length;
aN++){if(aO.insuranceSummaryList[aN].discountEligible==false||aO.insuranceSummaryList[aN].discountEligible==""){w.excludedProductsList.push(aO.insuranceSummaryList[aN].description)
}}}}}function ab(i){w.reservationModel.personalInfoRQ.email=i.email;
w.indicatorMap.email_id=i.maskId;
aw.addToIndicatorMap(w.indicatorMap)
}function ar(i){w.reservationModel.personalInfoRQ.phone=angular.copy(i.phoneNumber);
w.reservationModel.personalInfoRQ.smsOptIn=(i.smsOptIn=="T")?true:false;
w.indicatorMap.phone_id=angular.copy(i.maskId);
aw.addToIndicatorMap(w.indicatorMap);
angular.forEach(w.prod.reservationSummary.personalInfo.phoneNumbers,function(aM){if(aM.phoneNumber==i.phoneNumber&&aM.maskId==i.maskId){aM.selected=true
}else{aM.selected=false
}})
}function c(){if(X.brand==S.brandName.PAYLESS){F()
}else{angular.element(".print-modal").modal("show")
}}function F(){if(X.brand==S.brandName.PAYLESS){w.termsToPrintRequired=true
}var i=rootpath+"/reservation/print-confirmation"+htmlExtension+"#/?tncrequired="+w.termsToPrintRequired+"&pageType=confirm";
w.tncRequired=w.termsToPrintRequired;
X.open(i,"AEM","width=950,height=500,scrollbars=yes")
}function o(){var i={name:Dictionary.I18n.get("lbl.res.resconf.addtocalendar.name,"+brand)+": "+w.prod.reservationSummary.confirmationNumber,contact:Dictionary.I18n.get("lbl.res.resconf.addtocalendar.contact,"+brand)};
x.addToCalendar(i,w.prod.reservationSummary)
}function j(i){if(ao.current.name!==S.step1aPageName){Q.setStorageData("pastDateError",i)
}}function J(){y.requestInProgress=true;
var i=Q.load(w.reservation,false);
i.then(function(aM){if(aM.rateRequestDropIndicator){X.location.href=y.contextPath+"/"+y.locale+"/reservation"+htmlExtension+"#/time-and-place"
}else{y.reservation=aM.displayControls.reservation;
K.getData().then(function(aN){w.reservation=aN;
w.availableTabs=aN.reservationSummary.getAvailableTabs;
w.reservationModel=Q.getReservationModel();
if(angular.isDefined(aN.fieldErrors)&&aN.fieldErrors.length>0||(angular.isDefined(aN.errorList)&&aN.errorList.length>0)||(angular.isDefined(aN.warningList)&&aN.warningList.length>0)){if(angular.isDefined(aN.errorList)&&aN.errorList.length>0&&aN.errorList[0].code=="02009"){w.getDataInitiate()
}else{aN=M.processErrorMessage(aN);
if(angular.isDefined(aN.fieldErrors)&&aN.fieldErrors.length>0||(angular.isDefined(aN.errorList)&&aN.errorList.length>0)){w.redirectError(aN.errorList)
}if(angular.isDefined(aN.warningList)&&aN.warningList.length>0){w.warningList=aN.warningList
}X.location.href=y.contextPath+"/"+y.locale+"/reservation"+htmlExtension+"#/time-and-place"
}}else{w.getDataInitiate()
}},function(aN){})
}},function(aM){})
}function h(i){if(angular.isDefined(i.reservationSummary)&&angular.isDefined(i.reservationSummary.permission)&&angular.isDefined(i.reservationSummary.permission.precheckout)&&angular.isDefined(i.reservationSummary.permission.precheckout.visible)){if(i.reservationSummary.permission.precheckout.visible==="TRUE"){X.location.href=contextPath+"/"+locale+"/reservation"+htmlExtension+"#/pre-checkout"
}else{X.location.href=contextPath+"/"+locale+"/reservation"+htmlExtension+"#/pre-checkout-confirmation"
}}}function ap(){if((angular.isDefined(az.lastName)&&angular.isDefined(az.confirmationNumber))||aa){if(!aa){var i={lastName:az.lastName,confirmationNumber:az.confirmationNumber,email:""};
Q.setLookUpModel(i)
}y.requestInProgress=true;
K.load().then(function(aO){var aN=Q.getUrlParameter(S.lookupActionParam);
if(angular.isDefined(aN)&&aN===S.lookupCheckout){h(aO)
}if(!aO.reservationSummary.cancelledReservation){if(az.errorKey){X.location.href=contextPath+"/"+locale+"/reservation"+htmlExtension+"#/confirmation/"+az.errorKey
}else{if(aa){w.reservation=aO;
if(angular.isDefined(w.reservation.reservationSummary)&&angular.isDefined(w.reservation.reservationSummary.personalInfo)&&angular.isDefined(w.reservation.reservationSummary.personalInfo.email)){w.emailaddr=w.reservation.reservationSummary.personalInfo.email;
w.rentalLocationCountry=w.reservation.reservationSummary.pickLoc.address.country.toUpperCase()
}if(angular.isDefined(aO.errorList)&&aO.errorList.length>0){y.requestInProgress=true;
var aP=aO.errorList[0].code;
X.location.href=y.contextPath+"/"+y.locale+"/"+S.endPointArray.VIEW_MODIFY_CANCEL+htmlExtension+"#/lookup/"+aP;
return
}J()
}else{X.location.href=contextPath+"/"+locale+"/reservation"+htmlExtension+"#/confirmation/lookup"
}}}else{w.lookupPageErrorCancelReservation=au.trustAsHtml(Dictionary.I18n.get("msg.res.resConf.alreadyCancelled"));
if(aa){w.reservation=aO;
w.disableModifyCancel=true;
if(angular.isDefined(n)&&n.indexOf("NonPrePay")!=-1){if(n.indexOf("NonPrePay")!=-1&&aO.reservationSummary.cancelledReservation==true){X.location.href=y.contextPath+"/"+y.locale+"/"+S.endPointArray.VIEW_MODIFY_CANCEL+htmlExtension+"?utm_campaign="+n+"&"+S.urlParamConfirmNumber+"="+N+"&"+S.urlParamLastName+"="+aG;
return
}}if((angular.isDefined(aO.instructionList)&&aO.instructionList.length>0)||(angular.isDefined(aO.errorList)&&aO.errorList.length>0)||(angular.isDefined(aO.warningList)&&aO.warningList.length>0)){w.reservation=M.processErrorMessage(aO);
if(angular.isDefined(aO.instructionList)&&aO.instructionList.length>0&&w.reservation.reservationSummary.cancelledReservation==true){X.location.href=y.contextPath+"/"+y.locale+"/reservation"+htmlExtension+"#/cancel-confirmation?utm_campaign="+n;
return
}}X.location.href=contextPath+"/"+locale+"/reservation"+htmlExtension+"#/cancel-confirmation"
}else{w.messageCancelError=true;
X.location.href=y.contextPath+"/"+y.locale+"/reservation.html#/view-modify-cancel"
}}y.requestInProgress=false
},function(aN){y.requestInProgress=false
})
}else{y.requestInProgress=true;
y.$progressbar.activeItem=5;
var aM=ai.getStorageData("equipmentCSSList");
if(angular.isDefined(aM)&&!aa){if(angular.isDefined(n)&&n.indexOf("NonPrePay")!=-1){if(n.indexOf("NonPrePay")!=-1&&data.reservationSummary.cancelledReservation==true){X.location.href=y.contextPath+"/"+y.locale+"/"+S.endPointArray.VIEW_MODIFY_CANCEL+htmlExtension+"?utm_campaign="+n+"&"+S.urlParamConfirmNumber+"="+N+"&"+S.urlParamLastName+"="+aG;
return
}}if((angular.isDefined(aM.instructionList)&&aM.instructionList.length>0)||(angular.isDefined(aM.errorList)&&aM.errorList.length>0)||(angular.isDefined(aM.warningList)&&aM.warningList.length>0)){w.reservation=M.processErrorMessage(aM);
if(angular.isDefined(aM.instructionList)&&aM.instructionList.length>0&&w.reservation.reservationSummary.cancelledReservation==true){X.location.href=y.contextPath+"/"+y.locale+"/reservation"+htmlExtension+"#/cancel-confirmation?utm_campaign="+n;
return
}}else{w.reservation=aM
}if(angular.isDefined(w.reservation.reservationSummary)&&angular.isDefined(w.reservation.reservationSummary.personalInfo)&&angular.isDefined(w.reservation.reservationSummary.personalInfo.email)){w.emailaddr=w.reservation.reservationSummary.personalInfo.email;
w.rentalLocationCountry=w.reservation.reservationSummary.pickLoc.address.country.toUpperCase()
}aw.addToConfirmationData(w.reservation);
aw.addToReservationData(w.reservation);
J()
}else{K.getData().then(function(aN){if(angular.isDefined(n)&&n.indexOf("NonPrePay")!=-1){if(n.indexOf("NonPrePay")!=-1&&aN.reservationSummary.cancelledReservation==true){X.location.href=y.contextPath+"/"+y.locale+"/"+S.endPointArray.VIEW_MODIFY_CANCEL+htmlExtension+"?utm_campaign="+n+"&"+S.urlParamConfirmNumber+"="+N+"&"+S.urlParamLastName+"="+aG;
return
}}if((angular.isDefined(aN.instructionList)&&aN.instructionList.length>0)||(angular.isDefined(aN.errorList)&&aN.errorList.length>0)||(angular.isDefined(aN.warningList)&&aN.warningList.length>0)){w.reservation=M.processErrorMessage(aN);
if(angular.isDefined(aN.instructionList)&&aN.instructionList.length>0&&w.reservation.reservationSummary.cancelledReservation==true){X.location.href=y.contextPath+"/"+y.locale+"/reservation"+htmlExtension+"#/cancel-confirmation?utm_campaign="+n;
return
}}else{w.reservation=aN
}if(angular.isDefined(w.reservation.reservationSummary)&&angular.isDefined(w.reservation.reservationSummary.personalInfo)&&angular.isDefined(w.reservation.reservationSummary.personalInfo.email)){w.emailaddr=w.reservation.reservationSummary.personalInfo.email;
w.rentalLocationCountry=w.reservation.reservationSummary.pickLoc.address.country.toUpperCase()
}aw.addToConfirmationData(w.reservation);
J()
},function(aN){y.requestInProgress=false
})
}}w.cancelOrNoShowFeeMessage()
}function aq(){if(w.reservation&&w.reservation.reservationSummary&&X.brand!=S.brandName.PAYLESS&&w.reservation.reservationSummary.prepayTxn&&w.reservation.reservationSummary.prepayInfo&&((w.reservation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="C"&&w.reservation.reservationSummary.permission.refund.visible=="FALSE")||(w.reservation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="N"&&w.reservation.reservationSummary.permission.refund.visible=="TRUE"))&&(w.reservation.reservationSummary.prepayInfo.refundIndicator==S.RESAMT_LESSTHAN_NOSHOWAMT||w.reservation.reservationSummary.prepayInfo.refundIndicator==S.RESAMT_LESSTHAN_CANCELAMT)&&(w.reservation.reservationSummary.pickLoc.address.country.toUpperCase()==S.countryCodeAU||w.reservation.reservationSummary.pickLoc.address.country.toUpperCase()==S.countryCodeNZ)){w.cancelFeeLessOrEqualThanPrepaidAmount=true;
w.rentalLocationCountry=w.reservation.reservationSummary.pickLoc.address.country.toUpperCase()
}else{if(w.reservation&&w.reservation.reservationSummary&&X.brand!=S.brandName.PAYLESS&&w.reservation.reservationSummary.prepayTxn&&w.reservation.reservationSummary.prepayInfo&&((w.reservation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="C"&&w.reservation.reservationSummary.permission.refund.visible=="FALSE")||(w.reservation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="N"&&w.reservation.reservationSummary.permission.refund.visible=="TRUE"))&&(w.reservation.reservationSummary.prepayInfo.refundIndicator==S.RESAMT_GREATERTHAN_CANCELAMT||w.reservation.reservationSummary.prepayInfo.refundIndicator==S.RESAMT_GREATERTHAN_NOSHOWAMT)&&(w.reservation.reservationSummary.pickLoc.address.country.toUpperCase()==S.countryCodeAU||w.reservation.reservationSummary.pickLoc.address.country.toUpperCase()==S.countryCodeNZ)){w.cancelFeeGreaterThanPrepaidAmount=true;
w.rentalLocationCountry=w.reservation.reservationSummary.pickLoc.address.country.toUpperCase()
}}}function r(){N=Q.getUrlParameter(S.urlParamConfirmNumber);
aG=Q.getUrlParameter(S.urlParamLastName);
n=Q.getUrlParameter(S.urlParamUtm_campaign);
var i={lastName:aG,confirmationNumber:N,email:""};
Q.setLookUpModel(i);
aa=true
}function ay(){N=Q.getUrlParameter(S.urlParamConfirmNumber);
if(N){r();
ap()
}else{ap()
}}function aC(aN){if(w.reservationModel.personalInfoRQ.smsOptIn||w.prod.reservationSummary.vehicleDeliveryFlag){if(!angular.isDefined(w.reservationModel.personalInfoRQ.phone)||w.reservationModel.personalInfoRQ.phone==""){ax.displayServiceError("vm.reservationModel.personalInfoRQ.phone","required",true)
}else{if(angular.isDefined(w.reservationModel.personalInfoRQ.phone)&&ax.validateField("vm.reservationModel.personalInfoRQ.phone",true,aN)){if(angular.isDefined(w.prod.reservationSummary)&&angular.isDefined(w.prod.reservationSummary.personalInfo)&&angular.isDefined(w.prod.reservationSummary.personalInfo.phoneNumbers)){for(var aM=0;
aM<w.prod.reservationSummary.personalInfo.phoneNumbers.length;
aM++){if(w.reservationModel.personalInfoRQ.phone==w.prod.reservationSummary.personalInfo.phoneNumbers[aM].phoneNumber){w.phoneMaskId=w.prod.reservationSummary.personalInfo.phoneNumbers[aM].maskId
}}}aI.phoneNumberValidation(w.reservationModel.personalInfoRQ.phone,w.phoneMaskId).then(function(aQ){if(angular.isDefined(aQ.fieldErrors)&&aQ.fieldErrors.length>0){var aR="";
for(var aP=0;
aP<aQ.fieldErrors.length;
aP++){if(aQ.fieldErrors[aP].fieldName=="phoneNumber"){aR="vm.reservationModel.personalInfoRQ.phone";
ax.displayServiceError(aR,"uscan")
}}}else{if(angular.isDefined(aQ.errorList)&&aQ.errorList.length>0){for(var aP=0;
aP<aQ.errorList.length;
aP++){var aO=aQ.errorList[aP];
if(aO.type==="ERROR"&&aO.code==="700020"){ax.displayServiceError("vm.reservationModel.personalInfoRQ.phone","required",true);
w.reservationModel.personalInfoRQ.phone="";
w.reservationModel.personalInfoRQ.smsOptIn=false
}else{if(aO.type==="ERROR"&&aO.code==="700022"){ax.displayServiceError("vm.reservationModel.personalInfoRQ.phone","maskedphonenumber",true);
w.reservationModel.personalInfoRQ.phone="";
w.reservationModel.personalInfoRQ.smsOptIn=false
}else{if(aO.type==="ERROR"&&aO.code==="86"){ax.displayServiceError("vm.reservationModel.personalInfoRQ.phone","uscan",true);
w.reservationModel.personalInfoRQ.phone="";
w.reservationModel.personalInfoRQ.smsOptIn=false
}}}}}}})
}else{ax.displayServiceError("vm.reservationModel.personalInfoRQ.phone","invalid",true)
}}}}if(R.getXsrfToken()||R.getSessionModel()){w.processPageLoad=false;
w.pageInit()
}y.$on("initSuccess",function(aM,i){if(w.processPageLoad){w.pageInit()
}});
var aB=ad("ModifyReservationExnController",{$scope:M});
angular.extend(this,aB)
}})();
(function(){angular.module("reservation").controller("ReviewModifyController",a);
a.$inject=["$scope","$rootScope","$state","$sce","$window","$filter","$controller","$q","storageService","getDataService","jsonCompare","confirmModifications","vehicleService","optionalService","reservationModelService","carRentalConstant","reviewModifyService","authenticationService","reviewService"];
function a(x,m,A,q,s,v,d,D,k,n,y,j,u,f,o,e,p,r,c){d("ExceptionHandlerController",{$scope:x});
m.reservation=e.resFlowCreate;
var C=this;
var t="";
C.reservationModel={};
C.reviewData={};
C.redeemedConfirmReviewRes=false;
C.mreview="0";
C.status={isOpen:true,isOpenmileageOption:false};
C.oldCurrencySymbol="";
C.newCurrencySymbol="";
C.couponCodeDisabled=false;
C.domain=s.domain;
C.modifyReservation=l;
C.getvehicleModify=z;
C.getModifyExtra=w;
C.getmodifyPersonelInfo=B;
C.modifyTimePlace=i;
C.couponApplicable=b;
C._pageInit=g;
function g(){C.reservationModel=o.getReservationModel();
var E=p.getData();
E.then(function(I){C.reviewData=I;
C.insurances=o.getStorageData("insuranceList");
y.jsonComparator(C.reviewData.reservationSummary,C.reviewData.oldReservationSummary,true,false);
C.oldCurrencySymbol=v("currencySymbol")(C.reviewData.oldReservationSummary.rateSummary.currencySymbol);
C.newCurrencySymbol=v("currencySymbol")(C.reviewData.reservationSummary.rateSummary.currencySymbol);
for(var H=0;
H<C.reservationModel.selectedProducts.length;
H++){if(C.reservationModel.selectedProducts[H].subProducts&&C.reservationModel.selectedProducts[H].subProducts.length>0){for(var G=0;
G<C.reservationModel.selectedProducts[H].subProducts.length;
G++){var F=parseInt(C.reservationModel.selectedProducts[H].subProducts[G].totalRedeemedPts);
if(F>0){C.redeemedConfirmReviewRes=true
}}}else{var F=parseInt(C.reservationModel.selectedProducts[H].totalRedeemedPts);
if(F>0){C.redeemedConfirmReviewRes=true
}}}C.status.isOpenmileageOption=true;
if(C.reviewData.reservationSummary&&C.reviewData.reservationSummary.rateSummary&&C.reviewData.reservationSummary.rateSummary.rateTerms&&C.reviewData.reservationSummary.rateSummary.rateTerms.length>0){angular.forEach(C.reviewData.reservationSummary.rateSummary.rateTerms,function(K,J){if(K.code=="05135"){t=true
}})
}if(C.reviewData.unavailProductMsg||C.reviewData.unavailInsuranceMsg||C.reviewData.reservationSummary.productDropMsg){C.droppedProdAndInsuranceList=p.droppedData(C.reviewData)
}m.requestInProgress=false
})
}function b(){if(C.reviewData.reservationSummary.vehicle.couponApplicable&&angular.isDefined(C.reviewData.reservationSummary.vehicle.payLaterRate)&&angular.isDefined(C.reviewData.reservationSummary.vehicle.payLaterRate.couponDiscountAmt)&&C.reviewData.reservationSummary.vehicle.payLaterRate.couponDiscountAmt!=0&&angular.isDefined(C.reviewData.reservationSummary.vehicle.payNowRate)&&angular.isDefined(C.reviewData.reservationSummary.vehicle.payNowRate.couponDiscountAmt)&&C.reviewData.reservationSummary.vehicle.payNowRate.couponDiscountAmt!=0){return true
}else{return false
}}function l(E){m.requestInProgress=true;
C.reservationModel=o.getReservationModel();
C.reservationModel.displayControls.reservation=e.resFlowModify;
var F=k.getStorageData("oneClickURLCode");
if(!E||"false"===E){if(F!=null&&F!=""){k.deleteStorageData("oneClickURLCode")
}C.reservationModel.displayControls.cancelModify=true
}else{C.reservationModel.displayControls.cancelModify=false
}j.load(E).then(function(H){if(H.errorList&&H.errorList.length>0){var G=false;
angular.forEach(H.errorList,function(J,I){if(J.code=="1112"){var K=n.getReviewData();
G=I;
K.errorList=H.errorList;
n.addToReviewData(K);
m.reservation=e.resFlowModify;
if(C.reviewData.reservationSummary.prepayTxn==true){A.go(e.step4PageName)
}else{A.go(e.step4PayLaterPageName)
}}H=x.processErrorMessage(H);
C.errorDisplayList=H.errorList;
if(G!==false){C.errorDisplayList.splice(G,1)
}m.requestInProgress=false
})
}else{if(undefined!=H.reservationSummary.loyaltyDetails){r.setLoyaltyDetails(r.setLoyaltyDetailsData(H));
m.$broadcast("loyaltyUpdated",H)
}k.deleteStorageData("upcomingReservations");
n.deleteConcurTripList();
A.go(e.confirmationPage)
}},function(G){});
o.setReservationModel(C.reservationModel)
}function z(){C.reservationModel.displayControls.reservation=e.resFlowModify;
n.resetAvailableVehicles();
var E=u.load();
E.then(function(F){if(angular.isDefined(F.fieldErrors)&&F.fieldErrors.length>0||(angular.isDefined(F.errorList)&&F.errorList.length>0)||(angular.isDefined(F.warningList)&&F.warningList.length>0)){x.processErrorMessage(F)
}else{C.model=F;
C.selectedcar=F;
m.reservation=e.resFlowModify;
A.go(e.step2PageName)
}},function(F){})
}function w(){C.reservationModel.displayControls.reservation=e.resFlowModify;
o.setReservationModel(C.reservationModel);
n.resetAvailableVehicles();
m.reservation=e.resFlowModify;
A.go(e.step3PageName)
}function B(){C.reservationModel.displayControls.reservation=e.resFlowModify;
o.setReservationModel(C.reservationModel);
n.resetAvailableVehicles();
c.load().then(function(F){if(angular.isDefined(F.fieldErrors)&&F.fieldErrors.length>0||(angular.isDefined(F.errorList)&&F.errorList.length>0)||(angular.isDefined(F.warningList)&&F.warningList.length>0)){x.processErrorMessage(F)
}else{m.iataNum=true;
var E=F.reservationSummary.iataNumber;
if(angular.isDefined(F.reservationSummary.ccSummary)){C.reservationModel.cardNumber=F.reservationSummary.ccSummary.number;
C.reservationModel.cardType=F.reservationSummary.ccSummary.type
}if(E==e.systemInjectedIata){C.reservationModel.iataNumber=""
}else{C.reservationModel.iataNumber=E
}m.reservation=e.resFlowModify;
if(C.reviewData.reservationSummary.prepayTxn==true){A.go(e.step4PageName)
}else{A.go(e.step4PayLaterPageName)
}}},function(E){})
}function i(){C.reservationModel.displayControls.fieldDisable=true;
C.reservationModel.displayControls.countryFieldDisable=true;
m.reservation=e.resFlowModify;
if(angular.isDefined(C.reservationModel.coupon)&&angular.isDefined(C.reservationModel.coupon.visible===false)){C.couponCodeDisabled=true;
C.reservationModel.coupon.couponNumber=""
}o.setReservationModel(C.reservationModel);
A.go(e.step1aPageName)
}C._pageInit();
var h=d("ReviewModifyExnController",{$scope:x});
angular.extend(this,h)
}})();
(function(){angular.module("reservation").controller("PrintConfirmationController",a);
a.$inject=["$scope","$rootScope","$state","$location","$controller","$timeout","$window","getDataService","locationTermsConditionsService","lookupService","carRentalConstant","confirmationService","authenticationService"];
function a(q,j,s,h,d,v,o,k,b,m,e,t,n){var u=this;
j.carRentalConstant=e;
u.printVersion=true;
u.pageName=s.current.name;
u.domain=o.domain;
u.confirmation={};
u.CompleteTexNew={};
u.modifiedPickupDate="";
u.modifiedDropDate="";
u.modifiedFullPickupDate="";
u.modifiedFullDropDate="";
u.modifiedPhoneNumber="";
u.insurances={};
u.products={};
u.insuranceDisplay=[];
u.customer=n.getCustomerModel();
u.checkCancelReservation=p;
u.checkInstructionList=i;
u.accordionStatus={baseRate:false,mileage:false,rental:false,discount:false,fees:false,cancelFeeC:false,cancelFeeN:false,tnc:false,rdmPts:false};
u.showUpsellMessageError=false;
u.amazonBenefitsKey=Dictionary.I18n.get("lbl.global.amazonBenefits");
var g="";
u._printInit=l;
function l(){u.tncRequired=h.search().tncrequired;
if(angular.isDefined(h.search().pageType)&&angular.equals(h.search().pageType,"confirm")){u.pageTitle=Dictionary.I18n.get("lbl.res.resConf.reservationConfirmation")
}else{u.pageTitle=Dictionary.I18n.get("lbl.res.resConf.cancelReservation");
g="VIEW_URL"
}t.getData(g).then(function(y){u.confirmation=y;
u.userAge=t.getAge(u.confirmation.reservationSummary);
u.insurances=u.confirmation.reservationSummary.rateSummary.selectedInsurances;
u.products=u.confirmation.reservationSummary.rateSummary.selectedProducts;
var x={};
if(angular.isDefined(k.getSupportedOptions())){x=k.getSupportedOptions().supportedInsurances
}var w=u.confirmation.reservationSummary.insuranceSummaryList;
u.insuranceDisplay=m.mergeInsurance(x,w);
if(u.tncRequired=="true"){var z=(u.confirmation.reservationSummary.prepayTxn===true)?e.txnTypePrePay:e.txnTypePostPay;
b.load(z,u.confirmation.reservationSummary.pickLoc.locationCode).then(function(A){u.CompleteTexNew=A;
c()
})
}else{c()
}r();
jQuery(".rate-terms-panel").addClass("panel-open");
jQuery(".rate-terms-panel .panel-heading").find(".pull-left.s-icon.arrow-right").removeClass("arrow-right").addClass("arrow-down");
jQuery(".rate-terms-panel .panel-collapse").addClass("in").css("height","auto");
jQuery(".confirmation-page-printversion .confirmation-booking-summary").css("margin-top",0)
},function(w){})
}function c(){if(!window.sessionStorage.getItem("print")){jQuery(".spinnerLoader").addClass("hidden");
v(function(){window.print()
},2000)
}window.sessionStorage.setItem("print",true)
}function p(){if(g==="VIEW_URL"){return true
}else{return false
}}function i(){return true
}function r(){u.accordionStatus={baseRate:true,mileage:true,rental:true,discount:true,fees:true,cancelFeeC:true,cancelFeeN:true,tnc:true,rdmPts:true}
}u._printInit();
var f=d("PrintConfirmationExnController",{$scope:q});
angular.extend(this,f)
}})();
(function(){angular.module("carRental").controller("ProgressBarController",a);
a.$inject=["$scope","$rootScope","$state","$controller","carRentalConstant","reservationModelService","confirmModifications","getDataService","helpcontentService"];
function a(p,o,c,d,e,n,f,m,k){var g=this;
g.isModifyFlow=false;
g.step1aPage=e.step1aPageName;
g.step2Page=e.step2PageName;
g.step3Page=e.step3PageName;
g.pageName=c.current.name;
var b=n.getReservationModel();
if(b){o.reservation=b.displayControls.reservation;
g.isBookAgainFlow=b.bookAgain.bookAgainFlow
}var j=n.getDataBeforeLogoClick();
if(angular.isDefined(j)){if(j.prevPage!=""&&j.prevPage!=e.step1aPageName){o.reservation=j.prevFlow;
n.deleteDataBeforeLogoClick()
}}g.isModifyFlow=o.reservation==e.resFlowModify;
g.chkRedeemedRes=o.chkRedeemedRes;
g.cancelModification=l;
g.loadHelpModal=i;
function i(q){o.$broadcast("loadHelpModal",q)
}function l(q){o.requestInProgress=true;
g.reservationModel=n.getReservationModel();
g.reservationModel.displayControls.reservation=e.resFlowModify;
g.reservationModel.displayControls.cancelModify=true;
f.load(q).then(function(r){c.go(e.confirmationPage)
},function(r){o.requestInProgress=false
});
n.setReservationModel(g.reservationModel)
}$(document).on("click",".step-progress-bar li.processed",function(){o.requestInProgress=true
});
p.$watch("$rootScope.reservation",function(){g.isModifyFlow=o.reservation==e.resFlowModify
});
var h=d("ProgressBarExnController",{$scope:p});
angular.extend(this,h)
}})();
(function(){angular.module("reservation").controller("ReviewController",a);
a.$inject=["$controller","$scope","$filter","$rootScope","$state","$window","$timeout","$locale","$sce","reviewService","confirmationService","airlineService","$validation","locationTermsConditionsService","reviewModifyService","vehicleService","authenticationService","optionalService","anchorSmoothScroll","couponService","carRentalConstant","storageService","reservationModelService","getDataService","gaService","helpcontentService","ftpService","datePickerInit","utilityService","ModalService"];
function a(ap,Y,bb,N,aJ,aj,ar,bv,aX,br,M,k,a2,aW,bm,bw,ab,au,aP,bn,ae,aA,aa,a0,G,aH,J,a4,b,aK){if(aj.jsProfileConfigFlag==="true"){aj.startTime.review=performance.now()
}ap("ExceptionHandlerController",{$scope:Y});
var a6=ap("CouponController",{$scope:Y});
angular.extend(this,a6);
N.requestInProgress=true;
window.dataLayer=[];
var bp="";
var bl=0;
var K={};
var aB="";
var v=false;
var aZ="";
var aQ=false;
var W="";
var aI="";
var D="";
var C="";
var ak="";
var bh={uName:"",password:"",enableLoyalty:true};
var bc={contentType:"",locCode:"",rqHeader:{locale:""}};
var aN={loyaltyDetails:"",pointProducts:"",displayFreedayFlag:"",freedaySectionDisplay:"",freeDayPoints:"",totalreedem:"",redeemableDays:"",pointCheckbox:"",frdProdFlag:false,redeemQty:0};
var m={restrictedCards:"",rentalLocation:""};
var L=this;
L.prod={};
L.model={};
L.loginModel={};
L.pageName=aJ.current.name;
L.helpURL="";
L.expMonths=[];
L.tempDescription={};
L.firstLastNameDisabled=false;
L.gebUserLastName=false;
L.chkObj={checkCanada:false};
L.step4Validated=false;
L.creditCardMdl=false;
L.displayEmailOptIn="";
L.chkObj.checkCanada="";
L.ccMaskingServiceError=false;
L.termsCheckError=false;
L.reservationModel={};
L.insurances=[];
L.products=[];
L.creditId="";
L.authRecognizepromoMails="";
L.creditIdCheck=false;
L.maskedCCNumber="";
L.flagCanada="";
L.airlines={};
L.countryList={};
L.statesForCountry={};
L.step4PageError="";
L.errorDisplayList=[];
L.confirmReservation={};
L.termsCondition={};
L.reservationModel.expiredCC=false;
L.reservationModel.digitalWalletFlow=false;
L.reservationModel.digitalWalletFlowModify=false;
L.reservationModel.digitalWalletClicked=false;
L.currencySymbol="";
L.ages=ae.ageList;
L.useCreditBox=false;
L.domain=aj.domain;
L.showCity=false;
L.showState=false;
L.showZipcode=false;
L.showSuburb=false;
L.visaImage=aj.visaImage;
L.showPayLaterTnC=aj.showPayLaterTnC?aj.showPayLaterTnC:false;
L.isBookAgainFlow=false;
L.freedaySectionDisplay=false;
L.prefferedPointsFlag=false;
var i=false;
var bu=0;
var az=0;
L.pointCheckbox={};
L.productCheckbox={};
var e=false;
L.rateAmountShow=aj.rateAmountShow;
L.paylessFlow=false;
L.ccFilled=false;
L.rentalLocationCountry="";
L.selectedAddress=a3;
L.brand=aj.brand;
L.addressDisplayList=[];
L.address="1";
L.nickName="";
L.phoneMaskId="";
L.epIndicator=false;
L.indicatorMap={email_id:"1",credit_id:"1",address_id:"1",phone_id:"1"};
L.domain=aj.domain.toUpperCase();
L.getLoginModalWindow=p;
L.selectingCreditCard=be;
L.notYou=a8;
L.checkEmailOptin=aC;
L.getPrepayTnCs=c;
L.getStatesForCountry=x;
L.termsCheckChanged=j;
L.onOptPrepay=T;
L.clearCCInfo=aF;
L.confirmBooking=aw;
L.getncfmessage=s;
L.reviewModifications=z;
L.confirmReservationSubmit=H;
L.printDiv=a5;
L.validatePhoneNumber=ba;
L.loadExpiredSection=at;
L.setWalletType=aR;
L.processMasterPassLightBox=o;
L.clearWallet=A;
L.onOptCC=aq;
L.toggleBoolean=R;
L.clickCCModifyIcon=ah;
L.loadHelpModal=Z;
L.cancelDiscountModal=q;
L.checkLockClass=aM;
L.checkCardNumber=h;
L.isUnderAgePrePay=n;
L.showLoginModal=bg;
L.showExpiringLoginModal=bk;
L.showExpiredLoginModal=L.showExpiredLoginModal;
L.creditCardNotRequired=ac;
L.analytics=aE;
L.gtmBlur=bf;
L.updateExpiredCard=aD;
L.editExpiredCard=ay;
L.checkCreditCardDisplay=bt;
L.checkNcfState=bd;
L.loadTermsAndCondition=ag;
L.dwVisaCheckoutReady=F;
L.checkCCtype=a9;
L.getCreditCardType=aU;
L.bookAgainVehicleRates=aV;
L.selectingEmail=ao;
L.selectingPhoneNumber=aS;
L.productUpsellCode="";
L.showUpsellMessage=false;
L.promoCouponMessage=bo;
L._productUpsellMessage=Q;
L._displayFunction=t;
L._onPageLoad=g;
L._getReviewData=av;
L._dataProcess=bj;
L._populateBillingInfoCountryList=aO;
L._loadMnthYrDropdown=ax;
L._getAddressList=r;
L._getReservationReview=bs;
L._getReservationReviewProcess=bi;
L._handleAnonymouspromoMail=aG;
L._handlePromoMail=bq;
L._handleCreditID=I;
L._handleYourInformation=P;
L._handlePrepay=aL;
L._handleCC=ai;
L._showCCtype=f;
L._reviewDataProcess=O;
L._getNcfPaylater=y;
L._getAirlines=am;
L._setCORAsBillingCountry=al;
L._validationSuccess=aT;
L._validationError=U;
L._calculateFreedayPoints=l;
L.modifyModal=E;
L.pointSelectedvsFTP=B;
L.keepFTPEarning=af;
L.keepPointsSelection=bx;
L.paylesscostControl=an;
L.paylessextnControl=a1;
L.showpaynowTnC="";
L.amazonBenefitsKey=Dictionary.I18n.get("lbl.global.amazonBenefits");
L.authRequest;
L.walletType;
L.setWalletType=aR;
L.loginAmazonPay=u;
L.loadWallentDiv=X;
L.loadAddress=w;
L.amazonBillingAgreementId;
L.showAmazonPayDetails=true;
L.loadAmazonPayButton=aY;
function Q(){L.reservationModel=aa.getReservationModel();
var by=au.productUpsellMessage(L.reservationModel.selectedProducts);
L.showUpsellMessage=by.showUpsellMessage;
L.productUpsellCode=by.productUpsellCode;
L.reservationModel.selectedProducts=by.selectedProducts;
aa.setReservationModel(L.reservationModel)
}function aE(by){var bz={};
bz.event="analyticsVPV";
bz.vpvName="/vpv/linkClickPage-"+by+L.pageName;
dataLayer.push(bz)
}function bt(){return br.checkCreditCardDisplay(L.reservationModel)
}function bo(){if(angular.isDefined(L.prod.reservationSummary)&&L.reservationModel.displayControls.reservation==ae.resFlowCreate&&L.prod.reservationSummary.promotionalCoupon!=undefined&&L.prod.reservationSummary.promotionalCoupon!=""){if(!L.prod.reservationSummary.digitalWalletFlow&&L.reservationModel.prepayProcessIndicator===true&&L.reservationModel.payNowCheckBoxInd.visible=="FALSE"){return true
}else{if(!L.prod.reservationSummary.digitalWalletFlow&&L.reservationModel.payNowCheckBoxInd.visible=="TRUE"&&L.creditCardMdl===true){return true
}else{return false
}}}}function bd(){return br.checkNcfState(L.prod,L.creditCardMdl)
}function ac(){return br.creditCardNotRequired(L.prod,L.creditCardMdl)
}function t(by){if(by==ae.countryCodeCA||by==ae.countryCodePR||by==ae.countryCodeUS||by==ae.countryCodeCX||by==ae.countryCodeCV||by==ae.countryCodeVI){L.showCity=true
}else{L.showCity=false
}if(by==ae.countryCodeAU||by==ae.countryCodeCA||by==ae.countryCodeUS||by==ae.countryCodeNZ){L.showState=true
}else{L.showState=false
}if(by==ae.countryCodeAU||by==ae.countryCodeNZ){L.showSuburb=true
}else{L.showSuburb=false
}if(L.showSuburb||L.showCity){L.showZipcode=true
}else{L.showZipcode=false
}}function aM(){return br.checkLockClass(L.prod)
}function h(by){return br.checkCardNumber(by,L.prod,L.reservationModel,L.creditIdCheck)
}function n(){return br.isUnderAgePrePay(L.prod,L.reservationModel)
}function bg(){return br.showLoginModal(L.prod)
}function bk(){return br.showExpiringLoginModal(L.prod)
}function d(){return br.showExpiredLoginModal(L.prod)
}function at(){if(L.prod.reservationSummary.ccSummary.expiredcc||L.prod.reservationSummary.ccSummary.expiringcc){if(L.reservationModel.expiredPaymentRq.cardType==null){L.reservationModel.expiredPaymentRq.cardType=L.prod.reservationSummary.ccSummary.type;
L.expiredCreditCardNumber=L.prod.reservationSummary.ccSummary.number
}if(angular.isDefined(L.prod.reservationSummary.ccSummary.expDate)&&L.expMonths.length>0){var bz=L.prod.reservationSummary.ccSummary.expDate.split("/");
var by=L.expMonths.indexOf(bb("filter")(L.expMonths,function(bA){return bA.key==bz[0]
})[0]);
L.reservationModel.expiredPaymentRq.expMonth=L.expMonths[by].key;
L.reservationModel.expiredPaymentRq.expYear=bz[2]
}aQ=true
}else{L.reservationModel.expiredPaymentRq.cardType="";
L.expiredCreditCardNumber="";
aQ=false
}}function aD(by){if(by===null||by===""){L.expiredCreditCardNumber=L.prod.reservationSummary.ccSummary.number
}else{L.expiredCreditCardNumber=by;
L.creditCardNumber=L.expiredCreditCardNumber
}}function ay(by){a2.resetError("vm.expiredCreditCardNumber",true);
L.reservationModel.ccExpiredAuthUserEdit=true;
L.expiredCreditCardNumber=null
}function ag(){N.requestInProgress=true;
var by=br.getTermsConditionModel(L.reservationModel);
br.getSmsTermsAndCondition(by).then(function(bz){L.termsCondition=bz;
$(".reservation-flow-sms .modal-body").scrollTop(0);
N.requestInProgress=false
},function(){L.termsCondition={};
N.requestInProgress=false
})
}function g(){jQuery("body").off("click");
jQuery("body").on("click","#bluetxt",function(){jQuery(".step4-termstxt").children(".terms-condition-section").toggleClass("collapse")
});
angular.element("#cardnumber").val("");
angular.element("#securitycode").val("");
L._getReviewData();
L.customerData=ab.getCustomerModel();
L._productUpsellMessage()
}function bj(){angular.extend(L.loginModel,bh);
ab.setHideRedemptionOption(false);
L.reservationModel=aa.getReservationModel();
L.reservationModel.addAuthUserEdit=false;
L.reservationModel.addAuthCardEdit=false;
if(L.reservationModel.displayControls.reservation==ae.resFlowCreate){if(L.reservationModel.personalInfoRQ.lastNameTemp!=undefined&&L.reservationModel.personalInfoRQ.lastNameTemp!=""){L.reservationModel.personalInfoRQ.lastName=L.reservationModel.personalInfoRQ.lastNameTemp
}}var bz=a0.getConfirmationData();
if(bz&&bz.errorList&&bz.errorList.length>0){angular.forEach(bz.errorList,function(bA){if(bA.code=="1112"){bz=Y.processErrorMessage(bz);
L.errorDisplayList=bz.errorList
}})
}if(L.reservationModel!=undefined&&L.reservationModel.prepayProcessIndicator){L.creditCardMdl=L.reservationModel.prepayProcessIndicator
}if(L.prod.reservationSummary.gebUser&&L.prod.reservationSummary.ccsection.visible){L.creditCardMdl=true
}L._populateBillingInfoCountryList();
L._loadMnthYrDropdown();
if(angular.isDefined(L.prod.reservationSummary)&&angular.isDefined(L.prod.reservationSummary.addresses)){L._getAddressList(L.prod.reservationSummary.addresses)
}if(L.reservationModel.confirmationNumber==""||(L.reservationModel.confirmationNumber!=""&&L.reservationModel.paymentRq.address.country=="")){L.reservationModel.paymentRq.address.country=L.reservationModel.personalInfoRQ.residency
}L.getStatesForCountry(L.reservationModel.paymentRq.address.country,"onload");
if(L.reservationModel.coupon!=undefined){W=L.reservationModel.coupon.couponNumber;
C=L.reservationModel.coupon.couponQuantity;
aI=L.reservationModel.coupon.discountNumber;
ak=L.reservationModel.rentalType
}L.ratecodeNumberTemp=L.reservationModel.coupon.couponRateCode;
var by=L.prod.reservationSummary.userState==ae.userStateAuthenticated;
if(by){if(L.prod.reservationSummary.ccSummary&&L.prod.reservationSummary.ccSummary.number){L._handleCC()
}else{L.reservationModel.ccAuthUserEdit=true;
L.creditIdCheck=true
}}if(angular.isDefined(L.prod.reservationSummary)&&angular.isDefined(L.prod.reservationSummary.addresses)&&L.prod.reservationSummary.addresses.length>=1){angular.forEach(L.countryList,function(bA){if(bA.code==L.prod.reservationSummary.addresses[0].country){L.country=bA.name
}});
angular.forEach(L.prod.reservationSummary.addresses,function(bA){if(bA.primary==true){L.reservationModel.paymentRq.address.address1=bA.address1;
L.reservationModel.paymentRq.address.address2=bA.address2;
L.reservationModel.paymentRq.address.address3=bA.address3;
L.reservationModel.paymentRq.address.city=bA.city;
L.reservationModel.paymentRq.address.state=bA.state;
L.reservationModel.paymentRq.address.zipCode=bA.zipCode
}})
}}function ba(bz){if(L.reservationModel.personalInfoRQ.smsOptIn||L.prod.reservationSummary.vehicleDeliveryFlag){if(!angular.isDefined(L.reservationModel.personalInfoRQ.phone)||L.reservationModel.personalInfoRQ.phone==""){a2.displayServiceError("vm.reservationModel.personalInfoRQ.phone","required",true)
}else{if(angular.isDefined(L.reservationModel.personalInfoRQ.phone)&&a2.validateField("vm.reservationModel.personalInfoRQ.phone",true,bz)){if(angular.isDefined(L.prod.reservationSummary)&&angular.isDefined(L.prod.reservationSummary.personalInfo)&&angular.isDefined(L.prod.reservationSummary.personalInfo.phoneNumbers)){for(var by=0;
by<L.prod.reservationSummary.personalInfo.phoneNumbers.length;
by++){if(L.reservationModel.personalInfoRQ.phone==L.prod.reservationSummary.personalInfo.phoneNumbers[by].phoneNumber){L.phoneMaskId=L.prod.reservationSummary.personalInfo.phoneNumbers[by].maskId
}}}br.phoneNumberValidation(L.reservationModel.personalInfoRQ.phone,L.phoneMaskId).then(function(bC){if(angular.isDefined(bC.fieldErrors)&&bC.fieldErrors.length>0){var bD="";
for(var bB=0;
bB<bC.fieldErrors.length;
bB++){if(bC.fieldErrors[bB].fieldName=="phoneNumber"){bD="vm.reservationModel.personalInfoRQ.phone";
a2.displayServiceError(bD,"uscan")
}}L.reservationModel.personalInfoRQ.phone="";
L.reservationModel.personalInfoRQ.smsOptIn=false
}else{if(angular.isDefined(bC.errorList)&&bC.errorList.length>0){for(var bB=0;
bB<bC.errorList.length;
bB++){var bA=bC.errorList[bB];
if(bA.type==="ERROR"&&bA.code==="700020"){a2.displayServiceError("vm.reservationModel.personalInfoRQ.phone","required",true);
L.reservationModel.personalInfoRQ.phone="";
L.reservationModel.personalInfoRQ.smsOptIn=false
}else{if(bA.type==="ERROR"&&bA.code==="700022"){a2.displayServiceError("vm.reservationModel.personalInfoRQ.phone","maskedphonenumber",true);
L.reservationModel.personalInfoRQ.phone="";
L.reservationModel.personalInfoRQ.smsOptIn=false
}else{if(bA.type==="ERROR"&&bA.code==="86"){a2.displayServiceError("vm.reservationModel.personalInfoRQ.phone","uscan",true);
L.reservationModel.personalInfoRQ.phone="";
L.reservationModel.personalInfoRQ.smsOptIn=false
}}}}}}})
}else{a2.displayServiceError("vm.reservationModel.personalInfoRQ.phone","invalid",true)
}}}}function ax(){var by=ABG.loadMonthAndYear();
L.expMonths=by.expMonths;
L.expYears=by.expYears
}function q(){L.cancelDicountUtility(L,W,aI,D,C,ak)
}function Z(by){var bz=by.target.parentElement;
var bA=L.prod.reservationSummary.pickLoc.address.country;
L.helpURL=aH.getUrl(bz,bA)
}function bs(bz){if(bz!=undefined&&bz!=""){L._getReservationReviewProcess(bz)
}else{var by=br.getData();
by.then(function(bA){L._getReservationReviewProcess(bA)
})
}}function bi(by){L.reservationModel.costControl=br.costControlData(by.reservationSummary);
L.paylessFlow=L.paylessextnControl();
if(L.paylessFlow==true){L.reservationModel.costControl=L.paylesscostControl()
}aZ=by.reservationSummary.promoMails;
if(by.reservationSummary.displayEmailOptIn!=undefined){L.displayEmailOptIn=by.reservationSummary.displayEmailOptIn.visible
}var bA=aA.getStorageData("bridgeResponse");
if(bA!=null&&bA!=""&&angular.isDefined(bA.errorList)&&bA.webHeader.viewIndicator==="5"){bA=Y.processErrorMessage(bA);
by.errorList=bA.errorList
}if(by.reservationSummary.userState==ae.userStateAnonymous){L._handleAnonymouspromoMail()
}else{L._handlePromoMail()
}if(by.identityProofMsg!=undefined&&by.identityProofMsg.code!=undefined){L.identityProofMsg=by.identityProofMsg.message
}if(by.fraudDetectionMsg!=undefined&&by.fraudDetectionMsg.code!=undefined){L.fraudDetectionMsg=by.fraudDetectionMsg.message
}if((angular.isDefined(by.fieldErrors)&&by.fieldErrors.length>0)||(angular.isDefined(by.errorList)&&by.errorList.length>0)){}else{L.currencySymbol=bb("currencySymbol")(by.reservationSummary.rateSummary.currencySymbol);
L.annonymousPromoMails=by.reservationSummary.promoMails;
if(by.reservationSummary){if(by.reservationSummary.ccSummary.expiringcc==true||by.reservationSummary.ccSummary.expiredcc==true){if(by.reservationSummary.userState==ae.userStateAuthenticated){L.loadExpiredSection()
}}L.secureCode="";
L.prod.reservationSummary.ftpDetails=by.reservationSummary.ftpDetails;
if(angular.isDefined(L.prod.reservationSummary.ccSummary)&&angular.isDefined(by.reservationSummary.ccSummary)){if(angular.isDefined(by.reservationSummary.ccSummary.expiredcc)&&angular.isDefined(by.reservationSummary.ccSummary.expiringcc)){L.prod.reservationSummary.ccSummary.expiredcc=by.reservationSummary.ccSummary.expiredcc;
L.prod.reservationSummary.ccSummary.expiringcc=by.reservationSummary.ccSummary.expiringcc
}}L.prod.reservationSummary.rateSummary.rateTerms=by.reservationSummary.rateSummary.rateTerms;
L.prod.reservationSummary.rateSummary.surcharges=by.reservationSummary.rateSummary.surcharges;
if(by.reservationSummary.ftpDetails&&by.reservationSummary.ftpDetails.visible=="TRUE"){if(by.reservationSummary.ftpDetails.partnerCode!=ae.ftpNotApplicable){L.reservationModel.ftpDetails.partnerCode=by.reservationSummary.ftpDetails.partnerCode
}else{L.reservationModel.ftpDetails.partnerCode=""
}if(by.reservationSummary.ftpDetails.ftpNumber!=ae.ftpNotApplicableLower){L.reservationModel.ftpDetails.ftpNumber=by.reservationSummary.ftpDetails.ftpNumber
}else{L.reservationModel.ftpDetails.ftpNumber="";
L.prod.reservationSummary.ftpDetails.ftpNumber=ae.ftpNotApplicable
}if(by.reservationSummary.ftpDetails.ftpBonusMiles==ae.ftpNotApplicableLower){L.prod.reservationSummary.ftpDetails.ftpBonusMiles=ae.ftpNotApplicable
}L.reservationModel.ftpDetails.ftpBonusMiles=by.reservationSummary.ftpDetails.ftpBonusMiles;
if(L.reservationModel&&L.reservationModel.ftpDetails&&L.reservationModel.ftpDetails.partnerName){if(L.reservationModel.ftpDetails.partnerName==""){L.partnerName=ae.ftpNotApplicable
}else{L.partnerName=L.reservationModel.ftpDetails.partnerName
}}else{var bz=J.getData();
bz.then(function(bB){L.ftp=bB;
if(L.ftp&&L.ftp.partnersList){var bC=[];
bC=br.getPartnerName(L.prod.reservationSummary.ftpDetails.partnerCode,L.ftp);
if(bC.length>0){L.partnerName=bC[0].partnerName
}else{L.partnerName=ae.ftpNotApplicable
}}},function(bB){})
}}}}}function a1(){}function an(){}function p(by){N.$broadcast("LoginActivity",{requestType:"Login",variance:"Small"})
}function a8(){K=ab.logout();
K.then(function(by){if(angular.isDefined(by.fieldErrors)&&by.fieldErrors.length>0||(angular.isDefined(by.errorList)&&by.errorList.length>0)||(angular.isDefined(by.warningList)&&by.warningList.length>0)){Y.processErrorMessage(by)
}else{aj.location.href=rootpath+"/home"+htmlExtension
}},function(by){})
}function I(){if(L.prod.reservationSummary.coupon!=undefined&&L.prod.reservationSummary.coupon.creditId!=undefined&&L.prod.reservationSummary.coupon.creditId.length>0){L.creditId=L.prod.reservationSummary.coupon.creditId[0]
}if(L.creditId){if(L.creditId===ae.creditCardTypeMasterId){var by={coupononcc:ae.cardExpressions.CM};
a2.setExpression(by);
L.prod.reservationSummary.coupon.creditCardType=ae.creditCardTypeMaster;
L.useCreditBox=true
}else{if(L.creditId===ae.creditCardTypeVisaId){var by={coupononcc:ae.cardExpressions.CX};
a2.setExpression(by);
L.prod.reservationSummary.coupon.creditCardType=ae.creditCardTypeVisa;
L.useCreditBox=true
}else{if(L.creditId===ae.creditCardTypeAmericanId){var by={coupononcc:ae.cardExpressions.CA};
a2.setExpression(by);
L.prod.reservationSummary.coupon.creditCardType=ae.creditCardTypeAmerican;
L.useCreditBox=true
}else{if(L.creditId===ae.creditCardTypeDiscoverId){var by={coupononcc:ae.cardExpressions.CS};
a2.setExpression(by);
L.prod.reservationSummary.coupon.creditCardType=ae.creditCardTypeDiscover;
L.useCreditBox=true
}else{if(L.creditId===ae.creditCardTypeJcbId){var by={coupononcc:ae.cardExpressions.CJ};
a2.setExpression(by);
L.prod.reservationSummary.coupon.creditCardType=ae.creditJcb;
L.useCreditBox=true
}else{if(L.creditId===ae.creditCardTypeDinerId){var by={coupononcc:ae.cardExpressions.CD};
a2.setExpression(by);
L.prod.reservationSummary.coupon.creditCardType=ae.creditCardTypeDiner;
L.useCreditBox=true
}}}}}}}}function P(){L.reservationModel.personalInfoRQ.firstName=L.prod.reservationSummary.personalInfo.firstName.value;
L.reservationModel.personalInfoRQ.lastName=L.prod.reservationSummary.personalInfo.lastName.value;
L.reservationModel.personalInfoRQ.smsOptIn=(L.prod.reservationSummary.personalInfo.smsOptIn==="T")?true:false;
if(L.reservationModel.displayControls.reservation==ae.resFlowModify){L.reservationModel.personalInfoRQ.email=L.prod.reservationSummary.personalInfo.email;
L.reservationModel.personalInfoRQ.phone=angular.copy(L.prod.reservationSummary.personalInfo.phone)
}else{L.reservationModel.personalInfoRQ.email=L.prod.reservationSummary.personalInfo.email;
L.reservationModel.personalInfoRQ.phone=angular.copy(L.prod.reservationSummary.personalInfo.phone)
}if(L.prod.reservationSummary&&!L.prod.reservationSummary.onlineId){L.firstLastNameDisabled=true
}if(L.prod.reservationSummary.gebUser){L.gebUserLastName=true;
if(L.reservationModel.displayControls.reservation==ae.resFlowCreate){L.firstLastNameDisabled=false
}}if(L.prod.reservationSummary.personalInfo.firstName.editable=="TRUE"){L.firstLastNameDisabled=false
}if(angular.isDefined(L.prod.reservationSummary.personalInfo.phoneNumbers)){angular.forEach(L.prod.reservationSummary.personalInfo.phoneNumbers,function(by){if(by.phoneNumber==L.prod.reservationSummary.personalInfo.phone&&by.maskId=="1"){by.selected=true;
if(L.prod.reservationSummary.vehicleDeliveryFlag){L.validatePhoneNumber()
}}else{by.selected=false
}})
}}function aL(){L.getPrepayTnCs(ae.txnTypePrePayOnly);
L.prod.reservationSummary.amountPrepaid=L.prod.reservationSummary.prepayInfo.amount;
L.prod.reservationSummary.cancelFee=L.prod.reservationSummary.prepayInfo.cancelFee;
L.prod.reservationSummary.noShowFee=L.prod.reservationSummary.prepayInfo.noShowFee;
L.reservationModel.cancelFee=L.prod.reservationSummary.prepayInfo.cancelFee;
L.reservationModel.noShowFee=L.prod.reservationSummary.prepayInfo.noShowFee;
L.reservationModel.prepayOpted=true
}function ai(){var bC=aj.addr_prefill_disable;
L.creditIdCheck=(L.creditId==""||L.creditId==L.prod.reservationSummary.ccSummary.type);
if(aj.brand==ae.brandName.PAYLESS&&angular.equals(N.reservation,ae.resFlowCreate)){L.creditIdCheck=false
}if(L.creditIdCheck){L.reservationModel.paymentRq.cardType=L.prod.reservationSummary.ccSummary.type;
if(L.prod.reservationSummary.ccSummary.expDate!=undefined&&L.expMonths.length>0){var bB=L.prod.reservationSummary.ccSummary.expDate.split("/");
var bz=L.expMonths.indexOf(bb("filter")(L.expMonths,function(bD){return bD.key==bB[0]
})[0]);
L.reservationModel.paymentRq.expMonth=L.expMonths[bz].key;
L.reservationModel.paymentRq.expYear=bB[2];
if(L.prod.reservationSummary.ccSummary.expiredcc||L.prod.reservationSummary.ccSummary.expiringcc||L.prod.reservationSummary.ccSummary.expiryMsg){L.reservationModel.expiredPaymentRq.expMonth=L.expMonths[bz].key;
L.reservationModel.expiredPaymentRq.expYear=bB[2]
}}}else{L.prod.reservationSummary.ccSummary.type="";
L.prod.reservationSummary.ccSummary.number="";
L.ccMaskingServiceError=false
}L.creditCardNumber=L.prod.reservationSummary.ccSummary.number;
L.cardNickname=L.prod.reservationSummary.ccSummary.nickName;
var by=L.creditCardNumber.match(/(\d+)/g);
L.cardNumberLastDigit=by[0];
L.reservationModel.paymentRq.cardType=L.prod.reservationSummary.ccSummary.type;
if(L.prod.reservationSummary.ccoCardType){var bA=L._showCCtype(L.prod.reservationSummary.ccoCardType,L.prod.reservationSummary.ccSummary.type);
if(bA){L.reservationModel.paymentRq.cardType=bA
}}if(bC!="true"){L.reservationModel.paymentRq.address=L.prod.reservationSummary.address
}if(L.prod.reservationSummary.ccSummary.expiredcc||L.prod.reservationSummary.ccSummary.expiringcc||L.prod.reservationSummary.ccSummary.expiryMsg){L.expiredCreditCardNumber=L.prod.reservationSummary.ccSummary.number;
L.reservationModel.expiredPaymentRq.cardType=L.prod.reservationSummary.ccSummary.type
}}function bq(){L.authRecognizepromoMails=L.prod.reservationSummary.promoMails;
var by=br.handlePromoMail(L.authRecognizepromoMails,L.prod);
if(L.reservationModel.emailOptinFlag!==""){L.chkObj.checkCanada=L.reservationModel.emailOptinFlag
}else{L.chkObj.checkCanada=by.checkCanada
}L.flagCanada=by.flagCanada
}function aG(){var by=br.handleAnonymouspromoMail(aZ);
if(L.reservationModel.emailOptinFlag!==""){L.chkObj.checkCanada=L.reservationModel.emailOptinFlag
}else{L.chkObj.checkCanada=by.checkCanada
}L.flagCanada=by.flagCanada
}function av(){if(aJ.current.name===ae.bookAgainPayNowPage||aJ.current.name===ae.bookAgainPayLaterPage){N.$progressbar.activeItem=4
}L.isBookAgainFlow=aa.isBookAgainFlow(L.pageName);
br.getData().then(function(by){L.reservationModel=aa.getReservationModel();
L.reservationModel.creditcard=false;
if(L.reservationModel.displayControls.reservation==ae.resFlowModify&&L.reservationModel.iataNumber!=""){N.iataNum=true
}if(L.reservationModel){L._reviewDataProcess(by)
}else{var bz=aa.load(by,true);
bz.then(function(bA){L.reservationModel=bA;
L._reviewDataProcess(by)
})
}},function(by){})
}function O(bz){if(L.pageName==ae.step4PageName||L.pageName==ae.step4PayLaterPageName){try{G.analyticsDimension(bz.reservationSummary,L.pageName,bz)
}catch(bB){}}L.prod=bz;
if(L.prod.reservationSummary.coupon!=undefined&&L.prod.reservationSummary.coupon.creditId!=undefined&&L.prod.reservationSummary.coupon.creditId.length>0){L.creditId=L.prod.reservationSummary.coupon.creditId[0]
}setTimeout(function(){m.restrictedCards=L.creditId;
m.rentalLocation=bz.reservationSummary.pickLoc.address.country;
N.$broadcast("setReviewCreditCard",m)
},100);
L.rentalLocationCountry=bz.reservationSummary.pickLoc.address.country.toUpperCase();
if(angular.isDefined(bz.reservationSummary.vehicle)&&angular.isDefined(bz.reservationSummary.vehicle.classDescription)){L.carDescription=bz.reservationSummary.vehicle.classDescription
}if(angular.isDefined(L.reservationModel)&&angular.isDefined(L.reservationModel.displayControls)&&angular.isDefined(L.reservationModel.displayControls.reservation)&&L.reservationModel.displayControls.reservation!=ae.resFlowModify&&angular.isDefined(bz.reservationSummary)&&angular.isDefined(bz.reservationSummary.walletType)&&bz.reservationSummary.walletType=="AMAZON"){if(angular.isDefined(bz)&&angular.isDefined(bz.reservationSummary)&&angular.isDefined(bz.reservationSummary)&&angular.isDefined(bz.reservationSummary.pickLoc)&&angular.isDefined(bz.reservationSummary.pickLoc.address)&&angular.isDefined(bz.reservationSummary.pickLoc.address.country)&&bz.reservationSummary.pickLoc.address.country=="US"&&angular.isDefined(bz.reservationSummary.dropLoc)&&angular.isDefined(bz.reservationSummary.dropLoc.address)&&angular.isDefined(bz.reservationSummary.dropLoc.address.country)&&bz.reservationSummary.dropLoc.address.country=="US"){L.prod.reservationSummary.digitalWalletFlow=true;
L.walletType=bz.reservationSummary.walletType;
var bG=setInterval(function(){if(angular.isDefined(window.OffAmazonPayments)&&angular.isDefined(window.OffAmazonPayments.Widgets)&&angular.isDefined(window.OffAmazonPayments.Widgets.AddressBook)){clearInterval(bG);
w()
}},500)
}else{L.walletType=bz.reservationSummary.walletType;
A()
}}else{L.showAmazonPayDetails=false
}if(L.prod.unavailProductMsg||L.prod.unavailInsuranceMsg||L.prod.reservationSummary.productDropMsg){L.droppedProdAndInsuranceList=bm.droppedData(L.prod)
}if(L.isBookAgainFlow){aN.reservationModel=angular.copy(L.reservationModel);
var bE=au.handleLoyalty(L.prod.reservationSummary,aN,L.pointCheckbox,L.productCheckbox,"EXTRAS",L.products);
L.prefferedPointsFlag=bE.prefferedPointsFlag;
L.loyaltyDetails=bE.loyaltyDetails;
L.pointProducts=bE.pointProducts;
L.displayFreedayFlag=bE.displayFreedayFlag;
L.freedaySectionDisplay=bE.freedaySectionDisplay;
L.freeDayPoints=bE.freeDayPoints;
L.totalreedem=bE.totalReedemPoints;
L.redeemableDays=bE.redeemableDays;
L.pointCheckbox=bE.pointCheckbox;
L.productCheckbox=bE.productCheckbox;
L.frdProdFlag=bE.frdProdFlag;
if(bE.selectedProducts){L.reservationModel.selectedProducts=bE.selectedProducts
}L.products=bz.reservationSummary.productSummaryList
}var by=aA.getStorageData("bridgeResponse");
if(by!=null&&by!=""&&angular.isDefined(by.errorList)&&by.webHeader.viewIndicator==="5"){by=Y.processErrorMessage(by);
L.errorDisplayList=by.errorList;
angular.forEach(by.errorList,function(bK,bJ){if(angular.equals(bK.code,"1112")){ar(function(){a2.displayServiceError("vm.reservationModel.iataNumber","optional")
},1)
}})
}var bF=aa.getExpressReservationFlag();
L.errFlag=false;
if((angular.isDefined(bz.fieldErrors)&&bz.fieldErrors.length>0)||(angular.isDefined(bz.errorList)&&bz.errorList.length>0)){if(bz.errorList){L.errorDisplayList=bz.errorList;
angular.forEach(bz.errorList,function(bK,bJ){if(angular.equals(bK.code,"1112")){ar(function(){a2.displayServiceError("vm.reservationModel.iataNumber","optional")
},1)
}})
}L.errFlag=true
}if(L.errFlag==false||bF){L.insurances=bz.reservationSummary.insuranceSummaryList;
L.products=bz.reservationSummary.productSummaryList;
L.prod=bz;
L.reservationModel.ccsection=bz.reservationSummary.ccsection;
L.reservationModel.payNowCheckBoxInd=bz.reservationSummary.payNowCheckBoxInd;
if(angular.isDefined(L.prod.reservationSummary.pickLoc.emeaLocation)&&L.prod.reservationSummary.pickLoc.emeaLocation&&angular.isDefined(L.prod.reservationSummary.rateSummary.nonCancellationFeeApplicable)&&L.prod.reservationSummary.rateSummary.nonCancellationFeeApplicable===true){L.useCreditBox=true
}if(aj.brand==ae.brandName.BUDGET&&angular.isDefined(L.prod.reservationSummary.rateSummary.nonCancellationFeeApplicable)&&L.prod.reservationSummary.rateSummary.nonCancellationFeeApplicable===true){L.useCreditBox=true
}if((angular.isDefined(L.prod.domainConfigControl.displayElementMap.showcreditCardInfo)&&L.prod.domainConfigControl.displayElementMap.showcreditCardInfo.visible===true)&&(!(angular.isDefined(L.prod.reservationSummary.walletType)&&angular.equals(L.prod.reservationSummary.walletType,"AMAZON")))){L.useCreditBox=true;
L.reservationModel.creditcard=true
}if(angular.isDefined(L.prod.reservationSummary)&&angular.isDefined(L.prod.reservationSummary.rateSummary)&&angular.isDefined(L.prod.reservationSummary.rateSummary.nonCancellationFeeApplicable)&&angular.equals(L.prod.reservationSummary.rateSummary.nonCancellationFeeApplicable,true)&&(N.isAuthenticated===true)){L.useCreditBox=true
}if((angular.isDefined(L.prod.reservationSummary)&&angular.isDefined(L.prod.reservationSummary.rateSummary)&&angular.isDefined(L.prod.reservationSummary.rateSummary.nonCancellationFeeApplicable)&&angular.equals(L.prod.reservationSummary.rateSummary.nonCancellationFeeApplicable,true))&&(!(angular.isDefined(L.prod.reservationSummary.walletType)&&angular.equals(L.prod.reservationSummary.walletType,"AMAZON")))){L.reservationModel.creditcard=true
}L._getNcfPaylater(L.prod);
L.getCreditCardType(L.prod);
if(angular.isDefined(bz.reservationSummary)&&angular.isDefined(bz.reservationSummary.flightInfo)&&bz.reservationSummary.flightInfo.visible==="TRUE"){L._getAirlines()
}var bA=L.prod.reservationSummary.userState==ae.userStateRecognized;
var bI=L.prod.reservationSummary.userState==ae.userStateAuthenticated;
var bH=(L.prod.reservationSummary.prepayTxn!=undefined&&L.prod.reservationSummary.prepayTxn);
var bD=L.prod.reservationSummary.userState==ae.userStateRememberMe;
L._getReservationReview(bz);
L._handleCreditID();
if(angular.isDefined(L.prod.reservationSummary)&&L.prod.reservationSummary.digitalWalletFlow&&L.reservationModel.prepayOpted){L.reservationModel.digitalWalletFlow=L.prod.reservationSummary.digitalWalletFlow;
L.reservationModel.digitalWalletClicked=true;
L.creditCardMdl=true;
jQuery(".credit-card-details").show();
if(L.reservationModel.prepayOpted==true&&!v){L.getPrepayTnCs(ae.txnTypePrePayOnly);
v=true
}else{if(L.showPayLaterTnC==="true"){L.getPrepayTnCs(ae.txnTypePostPay);
v=false
}}}else{if(L.reservationModel.prepayOpted){L.reservationModel.digitalWalletFlow=false;
L.useCreditBox=L.reservationModel.prepayOpted
}}if(L.prod.reservationSummary.customerWalletGenericRS){if(L.prod.reservationSummary.customerWalletGenericRS.errorList){L.errorDisplayList=L.prod.reservationSummary.customerWalletGenericRS.errorList
}}L._dataProcess();
if(!bH){L.policyPostpayTxnType=true
}if(bH){L._handlePrepay()
}else{if(L.showPayLaterTnC==="true"){L.getPrepayTnCs(ae.txnTypePostPay)
}}if(bA||bI||bD||L.prod.reservationSummary.gebUser||L.prod.reservationSummary.userState=="PARTNER_AUTHENTICATED"){L._handleYourInformation()
}if(!(L.prod.reservationSummary.coupon&&L.prod.reservationSummary.coupon.creditId)){var bC={coupononcc:ae.noCouponCreditCardExp};
a2.setExpression(bC)
}if(L.prod.reservationSummary.coupon&&L.prod.reservationSummary.coupon.visible){L.reservationModel.coupon.visible=L.prod.reservationSummary.coupon.visible
}if(L.prod.reservationSummary.iataNumber){L.reservationModel.iataNumber=L.prod.reservationSummary.iataNumber
}if(angular.isDefined(L.prod.customerInfo)&&angular.isDefined(L.prod.customerInfo.cor)&&(L.prod.customerInfo.cor=="US"||L.prod.customerInfo.cor=="CA")&&L.brand=="avis"&&angular.isDefined(L.prod.customerInfo.userState)&&L.prod.customerInfo.userState=="AUTHENTICATED"){L.epIndicator=true
}if(angular.isDefined(L.prod.domainConfigControl)&&angular.isDefined(L.prod.domainConfigControl.displayElementMap)){L.reservationModel.displayElementMap=L.prod.domainConfigControl.displayElementMap
}aa.setReservationModel(L.reservationModel);
L.reservationModel=aa.getReservationModel();
L.dwVisaCheckoutReady()
}if(L.reservationModel.digitalWalletFlowModify){L.creditCardMdl=true;
jQuery(".credit-card-details").show();
L.onOptPrepay(true)
}}function s(){if(angular.isDefined(L.prod.reservationSummary.rateSummary.disclosureFeeMsg)){L.ncfmessage=L.prod.reservationSummary.rateSummary.disclosureFeeMsg.values[0]
}}function aU(by){if(angular.isDefined(by)&&angular.isDefined(by.reservationSummary)&&angular.isDefined(by.reservationSummary.ccSummary)&&L.reservationModel.displayControls.reservation===ae.resFlowModify&&(L.pageName==ae.step4PageName)){L.modifyCreditCardType=ABG.getCreditCardMap(by.reservationSummary.ccSummary.type)
}}function y(by){if(angular.isDefined(by.reservationSummary.ccSummary)&&angular.isDefined(by.reservationSummary.rateSummary.nonCancellationFeeApplicable)&&angular.equals(by.reservationSummary.rateSummary.nonCancellationFeeApplicable,true)&&angular.equals(N.reservation,"modify")){L.splitdata=[];
if(by.reservationSummary.ccSummary){if(angular.isDefined(by.reservationSummary.ccSummary.expDate)){L.splitdata=by.reservationSummary.ccSummary.expDate.split("/")
}L.creditCardNumber=by.reservationSummary.ccSummary.number;
L.reservationModel.paymentRq.cardType=by.reservationSummary.ccSummary.type
}L.reservationModel.paymentRq.expYear=L.splitdata.length>0?L.splitdata[2]:"";
if(by.reservationSummary.address){L.reservationModel.paymentRq.address=by.reservationSummary.address
}}else{if((angular.isDefined(L.prod.domainConfigControl.displayElementMap.showcreditCardInfo)&&L.prod.domainConfigControl.displayElementMap.showcreditCardInfo.visible===true)&&angular.equals(N.reservation,"modify")){L.splitdata=[];
if(by.reservationSummary.ccSummary){if(angular.isDefined(by.reservationSummary.ccSummary.expDate)){L.splitdata=by.reservationSummary.ccSummary.expDate.split("/");
L.reservationModel.paymentRq.expYear=L.splitdata.length>0?L.splitdata[1]:""
}L.creditCardNumber=by.reservationSummary.ccSummary.number;
L.reservationModel.paymentRq.cardType=by.reservationSummary.ccSummary.type;
if(angular.isDefined(L.creditCardNumber)){L.ccFilled=true
}}if(by.reservationSummary.address){L.reservationModel.paymentRq.address=by.reservationSummary.address
}}}}function a9(){if(aj.brand==ae.brandName.BUDGET||(angular.isDefined(L.prod.domainConfigControl.displayElementMap.showcreditCardInfo)&&L.prod.domainConfigControl.displayElementMap.showcreditCardInfo.visible===true)){var by=L.reservationModel.paymentRq.cardType;
var bz={credircard:ae.cardExpressions[by]};
a2.setExpression(bz);
if(a2.validateCCOCreditcard("vm.creditCardNumber")===false){a2.resetError("vm.creditCardNumber")
}}}function f(bA,bz){if(bA&&bz){var by=bA.indexOf(bb("filter")(bA,function(bB){return bB.code==bz
})[0]);
return bA[by].code
}}function c(by){if(L.policyPostpayTxnType&&by!=ae.txnTypePrePayOnly){L.contentType=ae.txnTypePostPay
}else{L.contentType=ae.txnTypePrePayOnly
}K=aW.load(L.contentType,L.reservationModel.pickInfo);
K.then(function(bz){if((angular.isDefined(bz.fieldErrors)&&bz.fieldErrors.length>0)||(angular.isDefined(bz.errorList)&&bz.errorList.length>0)||(angular.isDefined(bz.instructionList)&&bz.instructionList.length>0)){}else{L.tempDescription=bz
}})
}function am(){K=k.load();
K.then(function(by){if(angular.isDefined(by.fieldErrors)&&by.fieldErrors.length>0||(angular.isDefined(by.errorList)&&by.errorList.length>0)||(angular.isDefined(by.warningList)&&by.warningList.length>0)){Y.processErrorMessage(by)
}else{if(angular.isDefined(L.prod.reservationSummary.flightInfo.mandatory)&&L.prod.reservationSummary.flightInfo.mandatory=="TRUE"&&angular.isDefined(by.flightInfoList)&&by.flightInfoList.length>1&&by.flightInfoList[0].airlineCode==ae.notFlying){by.flightInfoList.shift()
}L.airlines=by;
if(angular.isDefined(L.airlines.flightInfoList)&&angular.isDefined(L.reservationModel.airlineCode)&&L.airlines.flightInfoList[0].airlineCode!="WI"&&L.reservationModel.airlineCode=="WI"){L.reservationModel.airlineCode=null
}}},function(by){})
}function aO(){var by=aj.countryList;
L.countryList=angular.fromJson(by?by:{});
L._setCORAsBillingCountry()
}function al(){L.customer=ab.getCustomerModel();
var by="";
if(L.customer&&L.customer.userState!="PARTNER_AUTHENTICATED"){by=L.customer.cor
}else{if(L.reservationModel&&L.reservationModel.personalInfoRQ&&L.reservationModel.personalInfoRQ.residency!==""){by=L.reservationModel.personalInfoRQ.residency
}}var bz=L.countryList.indexOf(bb("filter")(L.countryList,function(bA){return bA.code===by
})[0]);
L.reservationModel.personalInfoRQ.residency=L.countryList[bz].code
}function ao(by){L.reservationModel.personalInfoRQ.email=by.email;
L.indicatorMap.email_id=by.maskId;
L.reservationModel.emailOptinFlag=false;
L.chkObj.checkCanada=false;
a0.addToIndicatorMap(L.indicatorMap)
}function aS(by){L.reservationModel.personalInfoRQ.phone=angular.copy(by.phoneNumber);
L.reservationModel.personalInfoRQ.smsOptIn=(by.smsOptIn=="T")?true:false;
L.indicatorMap.phone_id=angular.copy(by.maskId);
a0.addToIndicatorMap(L.indicatorMap);
angular.forEach(L.prod.reservationSummary.personalInfo.phoneNumbers,function(bz){if(bz.phoneNumber==by.phoneNumber&&bz.maskId==by.maskId){bz.selected=true
}else{bz.selected=false
}});
setTimeout(function(){a2.resetError("vm.reservationModel.personalInfoRQ.phone",false)
},100);
if(L.prod.reservationSummary.vehicleDeliveryFlag){L.validatePhoneNumber()
}}function x(by,bA){if(bA=="onchange"){L.reservationModel.paymentRq.address.address1="";
L.reservationModel.paymentRq.address.address2="";
L.reservationModel.paymentRq.address.address3="";
L.reservationModel.paymentRq.address.suburb="";
L.reservationModel.paymentRq.address.city="";
L.reservationModel.paymentRq.address.state="";
L.reservationModel.paymentRq.address.zipCode=""
}if(L.countryList&&by!=undefined&&by!=""&&(by===ae.countryCodeAU||by===ae.countryCodeCA||by===ae.countryCodeUS)){var bz=L.countryList.indexOf(bb("filter")(L.countryList,function(bB){return bB.code===by
})[0]);
L.statesForCountry=L.countryList[bz].stateList
}L._displayFunction(by)
}function j(){if(L.step4Validated&&!L.reservationModel.paymentRq.acceptTerms){L.termsCheckError=true
}L.termsCheckError=false
}function a5(bB,bA){var bz=$("#terms-condition-txt").html();
var by=window.open("","PrintTC","height=400,width=800,scrollbars=yes");
if(angular.isDefined(bA)&&bA){by.document.write("<html><head><title>"+Dictionary.I18n.get("lbl.res.checkout.tnc.printPageTitle")+"</title>")
}else{by.document.write("<html><head><title>"+Dictionary.I18n.get("lbl.res.checkout.tnc.paylaterPrintPageTitle")+"</title>")
}by.document.write("</head><body>");
by.document.write("</body></html>");
angular.element(by.document.body).html(bz);
by.document.close();
by.print()
}function H(by){L.step4Validated=false;
document.getElementById("submit_button").disabled=true;
a2.validate(by).success(L._validationSuccess).error(L._validationError)
}function aT(){L.reservationModel.personalInfoRQ.firstName=ABG.getQualifiedName(L.reservationModel.personalInfoRQ.firstName);
L.step4Validated=false;
L.step4PageError="";
L.errorDisplayList=[];
L.confirmBooking()
}function U(by){L.step4Validated=true;
document.getElementById("submit_button").disabled=false;
if(!L.reservationModel.paymentRq.acceptTerms){L.termsCheckError=true
}L.errorDisplayList=[];
if(!L.reservationModel.paymentRq.acceptTerms){L.secureCode="";
if(L.expiredSecureCode){L.expiredSecureCode=""
}}var bz=by.errorCount;
if(1===bz){L.step4PageError=aX.trustAsHtml(by.MSG[0]);
L.secureCode="";
$(window).scrollTop(0)
}else{if(1<bz){L.step4PageError=Dictionary.I18n.get("err.global.multi.errorMessage");
L.secureCode="";
$(window).scrollTop(0)
}}}function T(by){a2.resetError("vm.secureCode",true);
L.expiredSpan=!L.expiredSpan;
L.reservationModel.prepayOpted=by;
if(L.reservationModel.prepayOpted==true&&!v){L.showpaynowTnC=true;
L.getPrepayTnCs(ae.txnTypePrePayOnly);
v=true
}else{if(L.showPayLaterTnC==="true"){L.getPrepayTnCs(ae.txnTypePostPay);
L.showpaynowTnC=false;
v=false
}}if(L.reservationModel.prepayOpted==false){L.showpaynowTnC=false
}L.creditCardMdl=by;
if(!L.creditCardMdl){L.useCreditBox=L.creditCardMdl
}L._handleCreditID()
}function aq(by){a2.resetError("vm.secureCode",true);
if(L.reservationModel.prepayOpted==true&&!v){L.getPrepayTnCs(ae.txnTypePrePayOnly);
v=true
}else{if(L.showPayLaterTnC==="true"){L.getPrepayTnCs(ae.txnTypePostPay);
v=false
}}L.useCreditBox=by;
L.reservationModel.digitalWalletClicked=false
}function aC(){L.reservationModel.emailOptinFlag=L.chkObj.checkCanada
}function aF(by){if(L.prod.reservationSummary.ccSummary.expiredcc||L.prod.reservationSummary.ccSummary.expiringcc){if(L.reservationModel.ccExpiredAuthUserEdit==true||L.ccMaskingServiceError==true){L.expiredCreditCardNumber="";
L.reservationModel.expiredPaymentRq.cardType="";
L.ccMaskingServiceError=false
}else{if((L.prod.reservationSummary.ccSummary.expiredcc||L.prod.reservationSummary.ccSummary.expiringcc)&&L.reservationModel.ccAuthUserEdit&&L.prod.reservationSummary.rateSummary.nonCancellationFeeApplicable){L.creditCardNumber="";
L.reservationModel.paymentRq.cardType=""
}else{if((L.prod.reservationSummary.ccSummary.expiredcc||L.prod.reservationSummary.ccSummary.expiringcc)&&!L.reservationModel.ccAuthUserEdit&&L.prod.reservationSummary.rateSummary.nonCancellationFeeApplicable){L.creditCardNumber=L.prod.reservationSummary.ccSummary.number;
L.reservationModel.paymentRq.cardType=L.prod.reservationSummary.ccSummary.type
}else{L.expiredCreditCardNumber=L.prod.reservationSummary.ccSummary.number;
L.reservationModel.expiredPaymentRq.cardType=L.prod.reservationSummary.ccSummary.type
}}}}else{if(L.reservationModel.ccAuthUserEdit==true||L.reservationModel.addAuthCardEdit==true||L.ccMaskingServiceError==true){L.creditCardNumber="";
L.reservationModel.paymentRq.cardType="";
L.ccMaskingServiceError=false;
L.nickName=""
}else{L.creditCardNumber=L.prod.reservationSummary.ccSummary.number;
L.reservationModel.paymentRq.cardType=L.prod.reservationSummary.ccSummary.type
}}if(L.isBookAgainFlow){aq(by)
}if(angular.isDefined(L.prod.reservationSummary.ccSummary.number)&&L.ccFilled==true){L.ccFilled=false
}}function aw(){N.requestInProgress=true;
document.getElementById("submit_button").disabled=true;
L.reservationModel.promoMail=L.chkObj.checkCanada;
L.reservationModel.displayBusinessClubOptIn=(L.buisnessOptIn==true)?true:false;
if(L.reservationModel.displayControls.reservation===ae.resFlowCreate&&L.prod.reservationSummary.gebUser){L.reservationModel.personalInfoRQ.residency=L.prod.reservationSummary.address.country
}var bz={cardNumber:L.creditCardNumber,secureCode:L.secureCode,expiredSecureCode:L.expiredSecureCode,expiredCreditCardNumber:L.expiredCreditCardNumber,saveCreditCard:L.saveCreditCard};
if(L.reservationModel.saveAddress==true){L.reservationModel.paymentRq.address.address1=L.address1;
L.reservationModel.paymentRq.address.address2=L.address2;
L.reservationModel.paymentRq.address.address3=L.address3;
L.reservationModel.paymentRq.address.city=L.city;
L.reservationModel.paymentRq.address.state=L.state;
L.reservationModel.paymentRq.address.zipCode=L.zipCode;
L.indicatorMap.address_id=" "
}if(L.saveCreditCard==true){L.reservationModel.paymentRq.nickName=L.nickName,L.reservationModel.paymentRq.creditCardToken=""
}angular.forEach(L.countryList,function(bA){if(bA.name==L.reservationModel.paymentRq.address.country){L.reservationModel.paymentRq.address.country=bA.code
}});
if(L.reservationModel.wizardNumber!=""){var by={email_id:(angular.isDefined(L.indicatorMap.email_id)&&L.indicatorMap.email_id!="")?L.indicatorMap.email_id:"1",address_id:(angular.isDefined(L.indicatorMap.address_id)&&!(/^[a-zA-Z0-9]*$/.test(L.reservationModel.paymentRq.address.address1)))?L.indicatorMap.address_id:" ",phone_id:(angular.isDefined(L.indicatorMap.phone_id)&&!(/^[0-9]*$/.test(L.reservationModel.personalInfoRQ.phone)))?L.indicatorMap.phone_id:" ",credit_id:(angular.isDefined(L.indicatorMap.credit_id)&&!(/^[0-9]*$/.test(L.creditCardNumber)))?L.indicatorMap.credit_id:" ",epIndicator:L.epIndicator};
a0.addToIndicatorMap(by)
}if(angular.isDefined(L.prod.reservationSummary.digitalWalletFlow)&&angular.isDefined(L.amazonBillingAgreementId)){L.reservationModel.digitalWalletFlow=L.prod.reservationSummary.digitalWalletFlow;
L.reservationModel.billingAgreementId=L.amazonBillingAgreementId
}a0.addToCreditCardData(bz);
aa.setReservationModel(L.reservationModel);
if(L.reservationModel.displayControls.reservation===ae.resFlowModify){L.reviewModifications();
return
}K=M.load();
K.then(function(bD){if(angular.isDefined(bD)){N.requestInProgress=false;
if(angular.isDefined(bD.fieldErrors)&&bD.fieldErrors.length>0){L.secureCode="";
var bE=[];
var bB;
angular.forEach(bD.fieldErrors,function(bF,bG){if(angular.equals(bF.field,"vm.reservationModel.paymentRq.cardType")){bB={message:a2.displayServiceError("vm.creditCardNumber","invalidcard")}
}else{bB={message:a2.displayServiceError(bF.field,bF.classifier)}
}});
if(bD.fieldErrors.length>1){bB={message:Dictionary.I18n.get("err.res.mutliplemsg")}
}bE.push(bB);
L.errorDisplayList=bE;
$(window).scrollTop(0);
document.getElementById("submit_button").disabled=false
}else{if(angular.isDefined(bD.errorList)&&bD.errorList.length>0){bD=Y.processErrorMessage(bD);
angular.forEach(bD.errorList,function(bI,bG){if(angular.equals(bI.code,"1112")){a2.displayServiceError("vm.reservationModel.iataNumber","optional")
}else{if(angular.equals(bI.code,"10103")){ab.setHideRedemptionOption(true);
var bH=aj.location.pathname+"#/extras";
bD.errorList[bG].message=Dictionary.I18n.get("10103",[bH])
}else{if(angular.equals(bI.code,"239")){var bF={message:a2.displayServiceError("vm.reservationModel.flightNumber","flightnomessage")}
}}}});
if(angular.isDefined(bD.couponErrorList)){L.couponErrorList=bD.couponErrorList
}L.errorDisplayList=bD.errorList;
L.secureCode="";
if(L.expiredSecureCode){L.expiredSecureCode=""
}L.ccMaskingServiceError=true;
if(angular.isDefined(L.creditCardNumber)){L.chinaUnionCard=false;
var bC=null;
bC=L.creditCardNumber.substring(0,8);
if((bC>=62400000&&bC<=62699999)||(bC>=62820000&&bC<=62889999)||(bC>=62212600&&bC<=62292599)){L.chinaUnionCard=true
}var bA=L.creditCardNumber;
L.maskedCCNumber=bA.replace(/.(?=.{4})/g,"x")
}N.requestInProgress=false;
document.getElementById("submit_button").disabled=false;
$(window).scrollTop(0)
}else{L.model=bD;
if(angular.isDefined(bD.reservationSummary)&&angular.isDefined(bD.reservationSummary.userState)&&bD.reservationSummary.userState!=ae.userStateAnonymous){ab.setCustomerModel(ab.setCustomerData(bD))
}if(undefined!=L.model.reservationSummary.loyaltyDetails&&L.model.reservationSummary.userState==ae.userStateAuthenticated){ab.setLoyaltyDetails(ab.setLoyaltyDetailsData(L.model));
N.$broadcast("loyaltyUpdated",bD)
}if(L.reservationModel.displayControls.reservation===ae.resFlowCreate){aA.deleteStorageData("upcomingReservations");
a0.deleteConcurTripList();
aJ.go(ae.confirmationPage)
}}}setTimeout(function(){if(CQ_Analytics.ProfileDataMgr){CQ_Analytics.ProfileDataMgr.fireEvent("update")
}},100)
}},function(bA){document.getElementById("submit_button").disabled=false
})
}function bf(bA,by,bB){if(bB=="text"){var bz=bA?"Filled In":"Skipped"
}else{if(bB=="check"){var bz=bA?"Checked In":"Skipped"
}else{if(bB=="drop"){var bz=bA?"Selected":"Not Selected"
}}}dataLayer.push({event:"trackEvent",eventCategory:"Tracking Form: confirmationForm",eventLabel:by,eventAction:bz})
}function z(){if(angular.isDefined(L.chkObj)){L.reservationModel.promoMail=L.chkObj.checkCanada
}aa.setReservationModel(L.reservationModel);
L.reservationModel.displayControls.reservationFlow=ae.resFlowModify;
K=bm.load();
K.then(function(by){if((angular.isDefined(by.fieldErrors)&&by.fieldErrors.length>0)||(angular.isDefined(by.errorList)&&by.errorList.length>0)){by=Y.processErrorMessage(by);
L.errorDisplayList=by.errorList;
document.getElementById("submit_button").disabled=false;
N.requestInProgress=false
}else{L.model=by;
aJ.go(ae.modifyReviewConfirmPage)
}},function(by){})
}function u(){var by=setInterval(function(){if(angular.isDefined(window.OffAmazonPayments)&&angular.isDefined(window.OffAmazonPayments.Widgets)&&angular.isDefined(window.OffAmazonPayments.Widgets.AddressBook)){clearInterval(by);
w()
}},500)
}function aY(){var bz;
var by=aj.environmentBaseURL+contextPath+"/"+aj.locale+"/reservation"+htmlExtension+"#/review-and-book";
if(enableAmazonPay=="true"){OffAmazonPayments.Button("AmazonPayButtonMethod",sellerId,{type:"PwA",color:"gold",size:"medium",authorization:function(){var bA={scope:"profile payments:widget payments:shipping_address payments:instrument_descriptor payments:autopay_consent",response_type:"token",popup:1};
bz=amazon.Login.authorize(bA,by)
},onError:function(bA){A()
}})
}}function w(){if(enableAmazonPay=="true"){new OffAmazonPayments.Widgets.AddressBook({sellerId:sellerId,agreementType:"BillingAgreement",onReady:function(by){if(angular.isUndefined(L.walletType)){aR("AMAZON")
}L.amazonBillingAgreementId=by.getAmazonBillingAgreementId();
X()
},onAddressSelect:function(by){},design:{designMode:"responsive"},onError:function(by){A()
}}).bind("addressBookWidgetDiv")
}}function X(){if(enableAmazonPay=="true"){if(angular.isDefined(L.amazonBillingAgreementId)){new OffAmazonPayments.Widgets.Wallet({sellerId:sellerId,amazonBillingAgreementId:L.amazonBillingAgreementId,onPaymentSelect:function(by){},design:{designMode:"responsive"},onError:function(by){A()
}}).bind("walletWidgetDiv")
}}}function aR(by,bz){L.useCreditBox=false;
K=br.setWalletType(by);
K.then(function(bB){if(bB.errorList&&bB.errorList.length>0){L.errorDisplayList=Y.processErrorMessage(bB.errorList)
}else{if(bz){bz()
}}L.secureCode="";
L.reservationModel.prepayOpted=true;
L.reservationModel.digitalWalletClicked=true;
try{if(sessionStorage.setItem("avis","avis")||typeof sessionStorage.setItem("avis","avis")=="undefined"){sessionStorage.removeItem("avis");
aj.sessionStorage.walletClicked=true
}}catch(bA){aj.sessionStorage.walletClicked=false
}if(L.reservationModel.prepayOpted==true&&!v){L.getPrepayTnCs(ae.txnTypePrePayOnly);
v=true
}else{if(L.showPayLaterTnC==="true"){L.getPrepayTnCs(ae.txnTypePostPay);
v=false
}}if(by=="AMAZON"){document.location.reload(true)
}},function(bA){})
}function A(){K=br.clearWallet();
K.then(function(by){if(by.errorList&&by.errorList.length>0){L.errorDisplayList=Y.processErrorMessage(by.errorList)
}else{if(angular.isDefined(L.walletType)&&L.walletType=="AMAZON"){if(partnerConfig.amazon.enablePartnerBenefit=="true"){amazon.Login.logout()
}window.location=aj.environmentBaseURL+contextPath+"/"+aj.locale+"/reservation"+htmlExtension+"#/review-and-book"
}document.location.reload(true)
}L.secureCode="";
L.reservationModel.digitalWalletClicked=false
},function(by){});
L.reservationModel.digitalWalletFlowModify=true
}function F(){if(angular.isDefined(L.prod.reservationSummary.prepayInfo)){var by="";
if(aj.brand===ae.brandName.AVIS){by="avis"
}else{if(aj.brand===ae.brandName.BUDGET){by="avisbudget"
}}V.init({apikey:aj.visaApi,dataLevel:ae.visaData,externalProfileId:by,paymentRequest:{currencyCode:L.prod.reservationSummary.prepayInfo.currency,total:L.prod.reservationSummary.prepayInfo.amount}});
V.on("payment.success",function(bz){var bB=JSON.stringify(bz);
var bA=JSON.parse(bB);
window.location.href=apiurl+"/res-checkout/walletData?callID="+bA.callid
});
V.on("payment.cancel",function(bz){});
V.on("payment.error",function(bA,bB){var bz=JSON.stringify(bB);
var bC=JSON.parse(bz);
L.errorDisplayList=Y.processErrorMessage(bC)
})
}}function o(){K=br.getMasterPassToken();
K.then(function(by){var bz=by;
if(bz.errorList&&bz.errorList.length>0){L.errorDisplayList=Y.processErrorMessage(bz.errorList)
}else{MasterPass.client.checkout({requestToken:bz.requestToken,callbackUrl:bz.callbackUrl,merchantCheckoutId:bz.merchantCheckoutId,cancelCallback:bz.cancelCallback,suppressShippingAddressEnable:bz.suppressShippingAddressEnable,allowedCardTypes:"master,visa",loyaltyEnabled:bz.loyaltyEnabled,requestBasicCheckout:false,version:bz.version})
}},function(by){})
}function ah(){L.creditIdCheck=false;
L.reservationModel.ccAuthUserEdit=true;
L.ccMaskingServiceError=true;
L.clearCCInfo();
L.reservationModel.ccAuthUserEdit=false
}function R(){L.isToggled=!L.isToggled;
if(!L.isToggled){L.reservationModel.expiredCC=false
}else{L.reservationModel.expiredCC=true
}}N.$on("Profile.successAuthentication",function(bC,bz){L.model=bz;
L.prod=bz;
aa.loadPersonalInfo(L.reservationModel,bz.reservationSummary);
L._handleCC();
L._getReservationReview();
if(L.prod.reservationSummary.ccSummary){var by=[];
if(angular.isDefined(L.prod.reservationSummary.ccSummary.supportedCctypes)){for(var bB=0;
bB<L.prod.reservationSummary.ccSummary.supportedCctypes.length;
bB++){by.push({code:L.prod.reservationSummary.ccSummary.supportedCctypes[bB],name:ABG.getCreditCardMap(L.prod.reservationSummary.ccSummary.supportedCctypes[bB])})
}L.prod.reservationSummary.ccoCardType=by
}var bA=L._showCCtype(L.prod.reservationSummary.ccSummary.supportedCctypes,L.prod.reservationSummary.ccSummary.type);
if(bA){L.reservationModel.paymentRq.cardType=bA
}}if(L.model.reservationSummary.ccSummary.expiringcc==true||L.model.reservationSummary.ccSummary.expiredcc==true){if(L.model.reservationSummary.userState==ae.userStateAuthenticated){L.loadExpiredSection()
}}});
N.$on("loadHelpModal",function(bz,by){L.loadHelpModal(by)
});
function aV(){aJ.go(ae.bookAgainVehiclePage)
}L._onPageLoad();
var a7=ap("ReviewExnController",{$scope:Y});
angular.extend(this,a7);
jQuery(document).ready(function(){if(L.pageName==ae.step4PageName||L.pageName==ae.step4PayLaterPageName){aa.addGTMScript()
}N.requestInProgress=false
});
function E(bz){var by="",bA="";
switch(bz){case"ftpDetails":by="reservation.frequent-travel-program-modal";
bA="ExtrasController";
break;
case"protectionModify":by="reservation.protection-modal";
bA="ExtrasController";
break;
case"equipmentModify":by="reservation.equipment-modal";
bA="ExtrasController";
break;
default:by="";
bA=""
}if(by!=""&&bA!=""){aK.showModal({type:bz,templateUrl:N.contextPath+"/"+N.locale+"/"+by+htmlExtension,controller:bA,controllerAs:"vm"}).then(function(bB){bB.element.modal();
bw.infoToolTip()
})
}else{}}function S(){if(L.prod.reservationSummary.rebookFlow&&angular.isUndefined(L.prod.reservationSummary.ftpDetails.ftpNumber)&&(L.prod.reservationSummary.ftpDetails.ftpNumber!="n/a"||L.prod.reservationSummary.ftpDetails.ftpNumber!="N/A")){return false
}return true
}function B(bz,bB,bD,by){if(bD==ae.productSectionFREEDAYS){if(L.prod.reservationSummary.ftpDetails.visible=="TRUE"&&S()){angular.element(".ftp-loyality-modal").modal("show")
}else{N.requestInProgress=true;
var bz;
if((angular.isDefined(L.pointProducts))&&null!=L.pointProducts.freeDay){bz=L.pointProducts.freeDay
}var bA=au.frdSelected(L.pointProducts,L.freeDayPoints,L.pointCheckbox,"EXTRAS",bz);
L.frdSelectedFlag=bA.frdSelectedFlag;
bu=bA.redeemedQty;
az=bA.quantity;
if(L.pageName==ae.bookAgainPayNowPage||L.pageName==ae.bookAgainPayLaterPage){var bC=au.recalculate("false");
bC.then(function(bF){if(angular.isDefined(bF.fieldErrors)&&bF.fieldErrors.length>0||(angular.isDefined(bF.errorList)&&bF.errorList.length>0)){Y.processErrorMessage(bF)
}else{var bE=br.load();
bE.then(function(bG){L.pointProducts=bF.reservationSummary.pointProducts;
if(L.frdSelectedFlag){L._calculateFreedayPoints()
}if(L.pageName===ae.bookAgainPayNowPage){aJ.go(ae.bookAgainPayNowPage,{},{reload:true})
}else{aJ.go(ae.bookAgainPayLaterPage,{},{reload:true})
}})
}},function(bE){})
}else{N.requestInProgress=false
}if(ab.getLoyaltyDetails()!=undefined){L.freedayPresent=false;
L.noOfFreeDays;
L.loyaltyDetails=ab.getLoyaltyDetails();
L.totalPointsFrd=parseInt(L.loyaltyDetails.points);
L.frdNoChange=false
}}}L.productObjSelected=bz;
L.codeSelected=bB;
L.productSectionSelected=bD
}function l(){var by=au.calculateFreedayPoints(L.pointProducts,L.freeDayPoints);
L.noOfFreeDays=by.noOfFreeDays;
L.prefferedPointsFlag=by.prefferedPointsFlag;
L.redeemableDays=by.redeemableDays
}function af(by){N.requestInProgress=true;
var bz=au.disableLoyalty("true",by);
bz.then(function(bA){if(angular.isDefined(bA.fieldErrors)&&bA.fieldErrors.length>0||(angular.isDefined(bA.errorList)&&bA.errorList.length>0)){Y.processErrorMessage(bA)
}else{N.requestInProgress=false;
aN.displayFreedayFlag=false;
au.setFreedaySectionDisplay(bA.reservationSummary);
aJ.go(L.pageName,{},{reload:true})
}},function(bA){})
}$("body").on("shown.bs.modal",".modal.policies_Modal",function(by){L.getPrepayTnCs()
});
function bx(by,bz){L.productSectionSelected=bz;
if(L.productSectionSelected==ae.productSectionFREEDAYS){au.frdSelected(L.pointProducts,L.freeDayPoints,L.pointCheckbox);
var bA=au.recalculate("false",by);
bA.then(function(bB){if(angular.isDefined(bB.fieldErrors)&&bB.fieldErrors.length>0||(angular.isDefined(bB.errorList)&&bB.errorList.length>0)){Y.processErrorMessage(bB)
}else{N.requestInProgress=false;
L.products=bB.reservationSummary.productSummaryList;
L.pointProducts=bB.reservationSummary.pointProducts;
L.prod=Y.processErrorMessage(bB);
if(L.prod.instructionList&&L.prod.instructionList.length>0){L.instructionList=L.prod.instructionList
}aJ.go(L.pageName,{},{reload:true})
}},function(bB){})
}}function a3(by){if(by=="1"){angular.forEach(L.countryList,function(bz){if(bz.code==L.prod.reservationSummary.addresses[0].country){L.reservationModel.paymentRq.address.country=bz.name
}});
angular.forEach(L.prod.reservationSummary.addresses,function(bz){if(bz.primary==true){L.reservationModel.paymentRq.address.address1=bz.address1;
L.reservationModel.paymentRq.address.address2=bz.address2;
L.reservationModel.paymentRq.address.address3=bz.address3;
L.reservationModel.paymentRq.address.city=bz.city;
L.reservationModel.paymentRq.address.state=bz.state;
L.reservationModel.paymentRq.address.zipCode=bz.zipCode;
L.indicatorMap.address_id=bz.maskId
}})
}else{if(by=="2"){angular.forEach(L.countryList,function(bz){if(bz.code==L.prod.reservationSummary.addresses[1].country){L.reservationModel.paymentRq.address.country=bz.name
}});
angular.forEach(L.prod.reservationSummary.addresses,function(bz){if(bz.primary==false){L.reservationModel.paymentRq.address.address1=bz.address1;
L.reservationModel.paymentRq.address.address2=bz.address2;
L.reservationModel.paymentRq.address.address3=bz.address3;
L.reservationModel.paymentRq.address.city=bz.city;
L.reservationModel.paymentRq.address.state=bz.state;
L.reservationModel.paymentRq.address.zipCode=bz.zipCode;
L.indicatorMap.address_id=bz.maskId
}})
}}}function r(by){angular.forEach(by,function(bz){var bA={code:"",description:""};
if(bz.maskId=="1"){bA.code="1";
bA.description="Primary Address";
L.addressDisplayList.push(bA)
}if(bz.maskId=="2"){bA.code="2";
bA.description="Secondary Address";
L.addressDisplayList.push(bA)
}});
return L.addressDisplayList
}function be(bB){L.creditCardNumber=bB.number;
L.cardNickname=bB.nickName;
var by=L.creditCardNumber.match(/(\d+)/g);
L.cardNumberLastDigit=by[0];
L.reservationModel.paymentRq.cardType=bB.type;
L.reservationModel.paymentRq.creditCardToken=bB.creditCardToken;
L.indicatorMap.credit_id=bB.maskId;
if(!L.prod.reservationSummary.prepayTxn&&!L.creditCardMdl){jQuery(".payment-method-field").toggle()
}if(bB.expDate!=undefined&&L.expMonths.length>0){var bA=bB.expDate.split("/");
var bz=L.expMonths.indexOf(bb("filter")(L.expMonths,function(bC){return bC.key==bA[0]
})[0]);
L.reservationModel.paymentRq.expMonth=L.expMonths[bz].key;
L.reservationModel.paymentRq.expYear=bA[2];
bB.expMonth=L.expMonths[bz].key;
bB.expYear=bA[2]
}br.ccExpiryCall(bB).then(function(bC){L.prod=bC;
if(bC.reservationSummary.ccSummary.expiringcc==true||bC.reservationSummary.ccSummary.expiredcc==true){if(bC.reservationSummary.userState==ae.userStateAuthenticated){L.loadExpiredSection()
}}if(angular.isDefined(L.prod.reservationSummary.ccSummary)&&angular.isDefined(bC.reservationSummary.ccSummary)){if(angular.isDefined(bC.reservationSummary.ccSummary.expiredcc)&&angular.isDefined(bC.reservationSummary.ccSummary.expiringcc)){L.prod.reservationSummary.ccSummary.expiredcc=bC.reservationSummary.ccSummary.expiredcc;
L.prod.reservationSummary.ccSummary.expiringcc=bC.reservationSummary.ccSummary.expiringcc
}}})
}if(angular.isDefined(window.enableAmazonPay)&&window.enableAmazonPay=="true"){var ad=setInterval(function(){if(angular.isDefined(window.OffAmazonPayments)&&angular.isDefined(window.OffAmazonPayments.Widgets)&&angular.isDefined(window.OffAmazonPayments.Widgets.AddressBook)){clearInterval(ad);
L.loadAmazonPayButton()
}},500)
}}})();
(function(){angular.module("reservation").controller("SummaryController",a);
a.$inject=["$controller","$sce","$scope","$window","$timeout","$state","$stateParams","$rootScope","storageService","confirmCancelService","reservationModelService","lookupService","optionalService","$validation","carRentalConstant","getDataService","authenticationService","BackButtonFactory","reviewModifyService"];
function a(d,r,y,t,H,D,F,l,k,b,n,q,h,z,f,m,s,p,o){if(D.current.name==f.resSummaryPage){jQuery(".getres-modal-cancel").modal("show")
}d("ExceptionHandlerController",{$scope:y});
l.requestInProgress=true;
var E=this;
E.reservation={};
E.cancelReservation={};
E.messageCancelError=false;
E.lookupPageErrorCancelReservation="";
E.emailaddr="";
E.modifiedFullPickupDate="";
E.modifiedFullDropDate="";
E.disableModifyCancel=false;
E.processPageLoad=true;
var w=false;
var v="";
var u="";
var C="";
E.viewReservation=g;
E.getModifyExtra=x;
E.showModify=B;
E.showCancel=G;
E.showRefund=i;
E.redirectError=J;
E.cancelFeeGreaterThanPrepaidAmount=false;
E.cancelFeeLessOrEqualThanPrepaidAmount=false;
E.rentalLocationCountry="";
E._emailUrlRediections=e;
E._resSummaryInit=c;
E.cancelOrNoShowFeeMessage=I;
function B(){if(E.reservation.reservationSummary&&(!E.reservation.reservationSummary.permission||!E.reservation.reservationSummary.permission.modify||E.reservation.reservationSummary.permission.modify.visible=="TRUE")){return true
}else{return false
}}function G(){if(E.reservation.reservationSummary&&(!E.reservation.reservationSummary.permission||!E.reservation.reservationSummary.permission.cancel||E.reservation.reservationSummary.permission.cancel.visible=="TRUE")){return true
}else{return false
}}function i(){if(E.reservation.reservationSummary&&t.brand!=f.brandName.PAYLESS&&((E.reservation.reservationSummary.permission&&E.reservation.reservationSummary.permission.refund&&E.reservation.reservationSummary.permission.refund.visible&&E.reservation.reservationSummary.permission.refund.visible=="TRUE")||(angular.isDefined(E.reservation.reservationSummary.missedReservation)&&E.reservation.reservationSummary.missedReservation==true))){return true
}else{if(angular.isDefined(E.reservation.reservationSummary)&&angular.isDefined(E.reservation.reservationSummary.missedReservation)&&E.reservation.reservationSummary.missedReservation==true){return true
}else{return false
}}}function I(){if(E.reservation&&E.reservation.reservationSummary&&t.brand!=f.brandName.PAYLESS&&E.reservation.reservationSummary.prepayTxn&&E.reservation.reservationSummary.prepayInfo&&((E.reservation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="C"&&E.reservation.reservationSummary.permission.refund.visible=="FALSE")||(E.reservation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="N"&&E.reservation.reservationSummary.permission.refund.visible=="TRUE"))&&(E.reservation.reservationSummary.prepayInfo.refundIndicator==f.RESAMT_LESSTHAN_NOSHOWAMT||E.reservation.reservationSummary.prepayInfo.refundIndicator==f.RESAMT_LESSTHAN_CANCELAMT)&&(E.reservation.reservationSummary.pickLoc.address.country.toUpperCase()==f.countryCodeAU||E.reservation.reservationSummary.pickLoc.address.country.toUpperCase()==f.countryCodeNZ)){E.cancelFeeLessOrEqualThanPrepaidAmount=true;
E.rentalLocationCountry=E.reservation.reservationSummary.pickLoc.address.country.toUpperCase()
}else{if(E.reservation&&E.reservation.reservationSummary&&t.brand!=f.brandName.PAYLESS&&E.reservation.reservationSummary.prepayTxn&&E.reservation.reservationSummary.prepayInfo&&((E.reservation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="C"&&E.reservation.reservationSummary.permission.refund.visible=="FALSE")||(E.reservation.reservationSummary.prepayInfo.cancelOrNoShowIndicator==="N"&&E.reservation.reservationSummary.permission.refund.visible=="TRUE"))&&(E.reservation.reservationSummary.prepayInfo.refundIndicator==f.RESAMT_GREATERTHAN_CANCELAMT||E.reservation.reservationSummary.prepayInfo.refundIndicator==f.RESAMT_GREATERTHAN_NOSHOWAMT)&&(E.reservation.reservationSummary.pickLoc.address.country.toUpperCase()==f.countryCodeAU||E.reservation.reservationSummary.pickLoc.address.country.toUpperCase()==f.countryCodeNZ)){E.cancelFeeGreaterThanPrepaidAmount=true;
E.rentalLocationCountry=E.reservation.reservationSummary.pickLoc.address.country.toUpperCase()
}}}function e(){v=n.getUrlParameter(f.urlParamConfirmNumber);
u=n.getUrlParameter(f.urlParamLastName);
C=n.getUrlParameter(f.urlParamUtm_campaign);
if(v!=""){var K={lastName:u,confirmationNumber:v,email:""};
n.setLookUpModel(K);
w=true
}}function c(){l.requestInProgress=true;
var L=n.getUrlParameter(f.lookupActionParam);
if((angular.isDefined(F.lastName)&&angular.isDefined(F.confirmationNumber))||(L==f.lookupParam)||w){if(L==f.lookupParam){v=n.getUrlParameter(f.lookupConfNumber);
u=n.getUrlParameter(f.lookupLastName);
var K={lastName:u,confirmationNumber:v}
}else{if(!w){var K={lastName:F.lastName,confirmationNumber:F.confirmationNumber,email:""}
}}if(!w){n.setLookUpModel(K)
}q.load().then(function(M){angular.element(".summaryHold").removeClass("summaryHold");
if(!M.reservationSummary.cancelledReservation){if(F.errorKey){D.go(f.reservationSummaryError,{errorKey:F.errorKey},{reload:true})
}else{if(L==f.lookupParam||w){E.reservation=M;
if(angular.isDefined(E.reservation.reservationSummary)&&angular.isDefined(E.reservation.reservationSummary.personalInfo)&&angular.isDefined(E.reservation.reservationSummary.personalInfo.email)){E.emailaddr=E.reservation.reservationSummary.personalInfo.email
}if(angular.isDefined(M.errorList)&&M.errorList.length>0){l.requestInProgress=true;
var N=M.errorList[0].code;
t.location.href=l.contextPath+"/"+l.locale+"/"+f.endPointArray.VIEW_MODIFY_CANCEL+htmlExtension+"#/lookup/"+N;
return
}}else{D.go(f.resSummaryPage,{},{reload:true})
}}}else{E.lookupPageErrorCancelReservation=r.trustAsHtml(Dictionary.I18n.get("msg.res.resConf.alreadyCancelled"));
if(L==f.lookupParam){E.reservation=y.processErrorMessage(M);
E.disableModifyCancel=true
}else{if(L!=f.lookupParam&&w){E.reservation=M;
E.disableModifyCancel=true;
if(angular.isDefined(C)&&C.indexOf("NonPrePay")!=-1){if(C.indexOf("NonPrePay")!=-1&&M.reservationSummary.cancelledReservation==true){t.location.href=l.contextPath+"/"+l.locale+"/"+f.endPointArray.VIEW_MODIFY_CANCEL+htmlExtension+"?utm_campaign="+C+"&"+f.urlParamConfirmNumber+"="+v+"&"+f.urlParamLastName+"="+u;
return
}}if((angular.isDefined(M.instructionList)&&M.instructionList.length>0)||(angular.isDefined(M.errorList)&&M.errorList.length>0)||(angular.isDefined(M.warningList)&&M.warningList.length>0)){E.reservation=y.processErrorMessage(M);
if(angular.isDefined(M.instructionList)&&M.instructionList.length>0&&E.reservation.reservationSummary.cancelledReservation==true){t.location.href=l.contextPath+"/"+l.locale+"/reservation"+htmlExtension+"#/cancel-confirmation?utm_campaign="+C;
return
}}}else{E.messageCancelError=true;
t.location.href=l.contextPath+"/"+l.locale+"/reservation.html#/view-modify-cancel"
}}}l.requestInProgress=false
},function(M){l.requestInProgress=false
})
}else{l.requestInProgress=true;
l.$progressbar.activeItem=5;
q.getData().then(function(M){if(angular.isDefined(C)&&C.indexOf("NonPrePay")!=-1){if(C.indexOf("NonPrePay")!=-1&&M.reservationSummary.cancelledReservation==true){t.location.href=l.contextPath+"/"+l.locale+"/"+f.endPointArray.VIEW_MODIFY_CANCEL+htmlExtension+"?utm_campaign="+C+"&"+f.urlParamConfirmNumber+"="+v+"&"+f.urlParamLastName+"="+u;
return
}}if((angular.isDefined(M.instructionList)&&M.instructionList.length>0)||(angular.isDefined(M.errorList)&&M.errorList.length>0)||(angular.isDefined(M.warningList)&&M.warningList.length>0)){E.reservation=y.processErrorMessage(M);
if(angular.isDefined(M.instructionList)&&M.instructionList.length>0&&E.reservation.reservationSummary.cancelledReservation==true){t.location.href=l.contextPath+"/"+l.locale+"/reservation"+htmlExtension+"#/cancel-confirmation?utm_campaign="+C;
return
}}else{if(F.errorKey){M.errorList=[{type:"ERROR",code:F.errorKey}];
E.reservation=y.processErrorMessage(M)
}else{if(F.infoKey){M.instructionList=[{type:"ERROR",code:F.infoKey}];
E.reservation=y.processErrorMessage(M)
}else{E.reservation=M
}}}E.emailaddr=E.reservation.reservationSummary.personalInfo.email;
m.addToConfirmationData(E.reservation);
H(function(){angular.element(".summaryHold").removeClass("summaryHold");
l.requestInProgress=false
},400)
},function(M){l.requestInProgress=false
});
if(D.current.name===f.reservationSummaryCancel){jQuery(".getres-modal-cancel").modal()
}}E.cancelOrNoShowFeeMessage()
}function g(){l.requestInProgress=true;
q.getData().then(function(K){E.confirmation=K;
if(K.reservationSummary.cancelledReservation==true){t.location.href=l.contextPath+"/"+l.locale+"/reservation"+htmlExtension+"#/cancel-confirmation"
}else{if(angular.isDefined(K.fieldErrors)&&K.fieldErrors.length>0||(angular.isDefined(K.errorList)&&K.errorList.length>0)||(angular.isDefined(K.warningList)&&K.warningList.length>0)){if(angular.isDefined(K.errorList)&&K.errorList.length>0&&K.errorList[0].code=="02009"||"05032"){t.location.href=l.contextPath+"/"+l.locale+"/reservation"+htmlExtension+"#/confirmation/lookup"
}else{y.processErrorMessage(K);
l.requestInProgress=false
}}else{t.location.href=l.contextPath+"/"+l.locale+"/reservation"+htmlExtension+"#/confirmation/lookup"
}}})
}E.cancelReservation={submit:function(K){z.validate(K).success(E.cancelReservation.validationSuccess).error(E.cancelReservation.validationError)
},validationSuccess:function(){l.requestInProgress=true;
E.cancelReservation.process()
},validationError:function(K){},process:function(){var M=E.reservation.reservationSummary.confirmationNumber;
var L=E.reservation.reservationSummary.personalInfo.lastName.value;
var K=E.emailaddr;
b.load(M,L,K).then(function(N){E.model=N;
if(angular.isDefined(N.errorList)&&N.errorList.length>0){p.process(N.errorList[0].code);
l.requestInProgress=false
}else{if(undefined!=E.model.reservationSummary.loyaltyDetails){s.setLoyaltyDetails(s.setLoyaltyDetailsData(E.model));
l.$broadcast("loyaltyUpdated",E.model)
}k.deleteStorageData("upcomingReservations");
k.deleteStorageData("cancelledReservations");
m.deleteConcurTripList();
jQuery(".getres-modal-cancel").modal("hide");
t.location.href=l.contextPath+"/"+l.locale+"/reservation"+htmlExtension+"#/cancel-confirmation"
}},function(N){})
}};
function x(){l.requestInProgress=true;
var K=n.load(E.reservation,false);
K.then(function(L){if(L.rateRequestDropIndicator){t.location.href=l.contextPath+"/"+l.locale+"/reservation"+htmlExtension+"#/time-and-place"
}else{l.reservation=L.displayControls.reservation;
q.getData().then(function(M){E.reservation=M;
var N=h.loadSupportedExtras();
h.process(M,N).then(function(O){if(angular.isDefined(O.fieldErrors)&&O.fieldErrors.length>0||(angular.isDefined(O.errorList)&&O.errorList.length>0)||(angular.isDefined(O.warningList)&&O.warningList.length>0)){if(angular.isDefined(O.errorList)&&O.errorList.length>0&&O.errorList[0].code=="02009"){t.location.href=l.contextPath+"/"+l.locale+"/reservation"+htmlExtension+"#/manage"
}else{O=y.processErrorMessage(O);
if(angular.isDefined(O.fieldErrors)&&O.fieldErrors.length>0||(angular.isDefined(O.errorList)&&O.errorList.length>0)){E.redirectError(O.errorList)
}if(angular.isDefined(O.warningList)&&O.warningList.length>0){E.warningList=O.warningList
}t.location.href=l.contextPath+"/"+l.locale+"/reservation"+htmlExtension+"#/time-and-place"
}}else{t.location.href=l.contextPath+"/"+l.locale+"/reservation"+htmlExtension+"#/manage"
}},function(O){})
},function(M){})
}},function(L){})
}function J(K){if(D.current.name!==f.step1aPageName){n.setStorageData("pastDateError",K)
}}if(s.getXsrfToken()||s.getSessionModel()){E.processPageLoad=false;
A()
}l.$on("initSuccess",function(L,K){if(E.processPageLoad){A()
}});
function A(){var L=n.getUrlParameter(f.urlParamConfirmNumber);
if(L){var K=t.location.href;
K=K.replace("reservation-details","manage-reservation");
t.location.href=K
}else{t.location.href=l.contextPath+"/"+l.locale+"/reservation"+htmlExtension+"#/manage"
}}var j=d("SummaryExnController",{$scope:y});
angular.extend(this,j)
}})();
(function(){angular.module("carRental").controller("VehicleListController",a);
a.$inject=["$q","$scope","$sce","$rootScope","recommendedDataService","$state","$window","$filter","$validation","$timeout","$controller","optionalService","vehicleService","getDataService","couponService","carRentalConstant","brandConstant","reservationModelService","storageService","gaService","$compile","merchandisingService","authenticationService","geoservices","utilityService","reviewService","bridgeService","ModalService","datePickerInit","helpcontentService","locationTermsConditionsService","getCampaignDataService","$cookies"];
function a(aw,Q,aJ,I,a4,aA,ae,a2,aP,al,ai,am,bd,aO,a8,Y,aE,U,ar,B,aj,L,W,bb,b,a9,z,aC,aQ,ay,aG,af,i){if(ae.jsProfileConfigFlag==="true"){ae.startTime.vehicleAvailability=performance.now()
}var d=Q.$new();
ai("ExceptionHandlerController",{$scope:Q});
var G=this,ad="";
var aX=ai("CouponController",{$scope:Q});
angular.extend(this,aX);
var aa=aO.getCouponList();
G.ancillariesIncluded=[];
G.hideCoupons=false;
G.displayDiscount=false;
G.epIndicator=false;
G.underAge=false;
G.mode=true;
G.couponAwdSameflag=false;
G.mvtFlag=false;
G.response={};
G.mcouponID={};
G.resFormPageInfo="";
G.iconImage="";
G.selectedFilter="";
G.pageName=aA.current.name;
G.userCurrency="";
G.pageContent=[];
G.couponList={};
G.sortType="";
G.bonusMilesCouponCode=Y.bonusMilesCouponCode;
G.uniqueCurrencylist=[];
G.currencySymbol="";
G.couponNumberTemp="";
G.couponQuantityTemp="";
G.discountNumberTemp="";
G.ratecodeNumberTemp="";
G.rentalTypeTemp="";
G.errorDisplayList=[];
G.vehicleTypeInstruction="";
G.awdList="";
G.carList=[];
G.isRecomendedFlow=false;
G.displayTotalRate=false;
G.couponCodeDisabled=false;
G.helpURL="";
G.domain=ae.domain;
G.isBookAgainFlow=false;
G.extrasDescriptionList=[];
G.requiresMemberID=false;
G.partnerPlaceholder="";
G.partnerLabel="";
G.partnerDiscount=x;
G.customer=W.getCustomerModel();
G.partnerValidation=aY;
G.checkPartnerValidation=aq;
G.checkPartnerMemberValidation=C;
G.rentalLocationCountry="";
G.enableBenefit=partnerConfig.amazon.enablePartnerBenefit;
G.setMvtFlag=y;
bd.setSortBy();
bd.SortBy=bd.getSortBy();
G.rateAmountShow=ae.rateAmountShow;
G.loginWarningMsg=false;
G.amazonBenefitsKey=Dictionary.I18n.get("lbl.global.amazonBenefits");
G.pageControl={userSortOption:bd.SortBy.PRICE.code,sortPlaceHolder:bd.SortBy.PRICE.description,orderByAvailable:bd.SortBy.PRICE.sortExpression,orderByUnavailable:["+carAvailabilityCode","+carClass"],displayedVehicleType:Y.defaultDisplayedVehicleType,vehicleTypePlaceholder:Y.defaultVehicleTypeDesc,selectCarType:"",displayVehicleList:false,specialFeatureFiltered:false,visibleVehicleType:"",vehicleTypeLabel:"",vehicleTypeNotAvailable:false,locationControl:false,enableSortOption:false,isModifyVehicleModal:false,sortByList:[]};
G.selectedFeatures={list:[]};
G.awdIndicator={addDiscount:false,validCoupon:false,invalidAWD:false,lowest:false,leisure:false,corporate:false};
G.loadHelpModal=T;
G.filterVehicle=F;
G.sortVehicle=m;
G.applyCoupon=S;
G.applyCouponAndAwd=a7;
G.getAwdLabel=K;
G.discountCouponValidate=k;
G.getMultiCoupon=j;
G.selectVehicle=aF;
G.toggleDiscounts=ba;
G.toggleFilters=aI;
G.vehicleInfo=t;
G.vehicleFeaturedInfo=v;
G.selectCurrency=g;
G.enableLoading=R;
G.getFeatureCount=p;
G.getCarCountByClass=J;
G.removeError=aZ;
G.analytics=av;
G.reservationModel=U.getReservationModel();
G.checkModifyDiscount=o;
G.checkDiscount=A;
G.isPrepay=H;
G.setCurrencyList=N;
G.getAlternateLocation=P;
G.removeSelRateType=a5;
G.updateDiscountNumber=X;
G.redirectToVehicle=u;
G.showExtrasDetails=aD;
G.keyDropTnC=s;
G.keyDroptermsNc=true;
G.applyCouponCode=a0;
G.partnerLogin=ao;
G.assignSelectedVehicleType=aR;
G.updateView=aN;
G.closeRefineAndSortModal=r;
G.mobileSelectedVehicleType={};
G.closeCarModel=aV;
G.getPrepayTnCs=c;
G.amazonUserStatus="";
G.openExtrasModal=aL;
G._collapseSortFilter=aH;
G._defaultSortFilter=aW;
G._hideVehicleInfo=a3;
G._sortByFunc=w;
G._processErrorByType=aB;
G._resetModalVal=bc;
G._getVehicleHighlighter=M;
G._isSorted=ap;
G._isFiltered=e;
G._resetVehicleGrouping=ac;
G._getFeaturedVehicleClasses=aM;
G._resetPointSelection=D;
G._removeUPSSelection=O;
G._reviewCall=Z;
G._isModifyVehicleModal=l;
G._processVehiclesPage=h;
G._dataProcess=a6;
G._merchandisingServiceListener=E;
G._displaySoldoutInstruction=aT;
G._setVehicleTypeFilterDisplay=q;
G._setAwdOnPageLoad=ak;
G._resolveLocation=be;
G._searchLocationResponseHandler=ax;
G._loadVehicleData=ab;
G._processToExtras=f;
G.recognizedUserAmazonCall=aK;
G.closeLMBModal=aU;
G.checkForTruckDomain=aS;
function aU(){$("#closeModal").modal("hide")
}G._awdValidator=ah;
var a1=ai("VehicleListExnController",{$scope:Q});
angular.extend(this,a1);
function ao(bg){var bf=bg.currentTarget.attributes.name.nodeValue;
if(angular.isDefined(G.customer)&&angular.isDefined(G.customer.userState)&&G.customer.userState=="RECOGNIZED"&&angular.isDefined(G.customer.amazonLinked)&&!G.customer.amazonLinked){G.loginWarningMsg=true
}if(bf==Y.amazonLabel&&G.loginWarningMsg==false){setTimeout(W.redirectURLRules(bf),1)
}else{if(bf==Y.amazonLabel&&G.loginWarningMsg==true){G.recognizedUserAmazonCall(bf)
}}}function aK(bf){W.logout().then(function(bg){W.setLoginAuthenticate(false);
i.remove("resModelDisplayControls");
setTimeout(function(){W.redirectURLRules(bf)
},1)
},function(bg){I.requestInProgress=false
})
}function aV(){aC.closeModal({type:"CarDetailsModify"})
}function s(){G.keyDroptermsNc=true;
c()
}function ah(){}function c(){G.contentType=Y.txnTypePostPay;
var bf=aG.load(G.contentType,G.response.reservationSummary.pickLoc.locationCode);
bf.then(function(bi){G.tempDescription=bi;
if(angular.isDefined(G.response.reservationSummary.dropLoc)&&angular.isDefined(G.response.reservationSummary.dropLoc.keyDrop==true)&&(G.keyDroptermsNc==true)){for(var bh=0;
bh<bi.length;
bh++){if(bi[bh].Id=="After Hours Return"){var bj=bi[bh].Description;
var bg=bj.toString();
G.afterHourTnC=bg.replace(/<[^>]+>/gm,"");
break
}}}},function(bg){})
}I.mapModalPath="";
I.keyDropPath="";
function aR(bf){G.mobileSelectedVehicleType=bf;
G.pageControl.vehicleTypePlaceholder=bf.description+" ("+G.getCarCountByClass(bf.cargroup)+")";
if(jQuery(".allvehimodalformob")){jQuery(".allvehimodalformob").modal("hide")
}}function o(){if(G.response.rateTypes||(G.response.reservationSummary&&G.response.reservationSummary.coupon&&G.response.reservationSummary.coupon.number)||((G.response.errorList!=undefined&&G.response.errorList.length!=0)&&(!G.response.rateTypes)&&(G.reservationModel.coupon.discountNumber==""||G.reservationModel.coupon.discountNumber==undefined))){return true
}else{return false
}}function r(){var bf=false;
if(angular.isDefined(G.mobileSelectedVehicleType)&&angular.isDefined(G.reservationModel.vehicleType)&&!angular.equals(G.mobileSelectedVehicleType.code,G.reservationModel.vehicleType.code)){bf=true
}else{if(G._isSorted(G.isRecomendedFlow)){bf=true
}else{if(angular.isDefined(G.reservationModel.userSelectedCurrency)&&!angular.equals(G.reservationModel.userSelectedCurrency,G.response.reservationSummary.userSelectedCurrency)){bf=true
}else{if(angular.isDefined(G.reservationModel.rentalType)&&!angular.equals(G.reservationModel.rentalType,G.rentalTypeTemp)){bf=true
}else{if(angular.isDefined(G.reservationModel.coupon)&&angular.isDefined(G.reservationModel.coupon.couponNumber)&&!angular.equals(G.reservationModel.coupon.couponNumber,G.couponNumberTemp)){bf=true
}else{if(angular.isDefined(G.reservationModel.coupon)&&angular.isDefined(G.reservationModel.coupon.couponQuantity)&&!angular.equals(G.reservationModel.coupon.couponQuantity,G.couponQuantityTemp)){bf=true
}}}}}}if(bf){G.mobileSelectedVehicleType=G.reservationModel.vehicleType;
if(angular.isDefined(G.reservationModel.vehicleType)&&angular.equals(G.reservationModel.vehicleType,"")){G.pageControl.vehicleTypePlaceholder=Y.defaultVehicleTypeDesc+" ("+G.getCarCountByClass(G.reservationModel.vehicleType.cargroup)+")"
}else{G.pageControl.vehicleTypePlaceholder=G.reservationModel.vehicleType.description+" ("+G.getCarCountByClass(G.reservationModel.vehicleType.cargroup)+")"
}G.sortType=G.pageControl.userSortOption;
G.reservationModel.userSelectedCurrency=G.response.reservationSummary.userSelectedCurrency;
G.reservationModel.rentalType=G.rentalTypeTemp
}if(angular.isDefined(G.response.reservationSummary.awdNumber)&&!angular.equals(G.response.reservationSummary.awdNumber,"")){G.reservationModel.coupon.discountNumber=G.response.reservationSummary.awdNumber
}else{if(angular.isUndefined(G.response.reservationSummary.awdNumber)){G.reservationModel.coupon.discountNumber=""
}}if(angular.isDefined(G.response.reservationSummary.coupon)&&!angular.equals(G.response.reservationSummary.coupon.number,"")){G.reservationModel.coupon.couponNumber=G.response.reservationSummary.coupon.number;
G.reservationModel.coupon.couponQuantity=G.couponQuantityTemp;
if(G.pageContent.couponList&&G.pageContent.couponList.length>1&&G.reservationModel.coupon.couponNumber){G.reservationModel.coupon.isMultiCoupon=true
}else{G.reservationModel.coupon.isMultiCoupon=false
}}else{if(angular.isUndefined(G.response.reservationSummary.coupon)){G.reservationModel.coupon.couponNumber="";
G.reservationModel.coupon.couponQuantity="";
G.reservationModel.coupon.isMultiCoupon=false;
var bg=G.couponList={};
aO.setCouponList(bg)
}}}function T(bf){var bg=bf.target.parentElement;
var bh=G.response.reservationSummary.pickLoc.address.country;
G.helpURL=ay.getUrl(bg,bh)
}function aN(){if(!angular.equals({},G.mobileSelectedVehicleType)&&G.mobileSelectedVehicleType){G.filterVehicle(G.mobileSelectedVehicleType,false)
}else{G._collapseSortFilter()
}G.sortVehicle(G.sortType);
var bf=false;
if((angular.isDefined(G.response.reservationSummary.awdNumber)&&!angular.equals(G.response.reservationSummary.awdNumber,G.reservationModel.coupon.discountNumber))){bf=true
}else{if(angular.isUndefined(G.response.reservationSummary.awdNumber)&&!(angular.isUndefined(G.reservationModel.coupon.discountNumber)||angular.equals(G.reservationModel.coupon.discountNumber,""))){bf=true
}else{if((angular.isDefined(G.response.reservationSummary.coupon)&&G.reservationModel.coupon.couponNumber&&!angular.equals(G.response.reservationSummary.coupon.number,G.reservationModel.coupon.couponNumber.toUpperCase()))){bf=true
}else{if((angular.isUndefined(G.response.reservationSummary.coupon)&&!angular.equals(G.reservationModel.coupon.couponNumber,""))){bf=true
}else{if((angular.isDefined(G.response.reservationSummary.coupon)&&angular.isDefined(G.response.reservationSummary.coupon.instances)&&!angular.equals(G.reservationModel.coupon.couponQuantity,G.response.reservationSummary.coupon.instances))){bf=true
}else{if(angular.isDefined(G.response.reservationSummary.awdNumber)&&!(angular.isUndefined(G.reservationModel.coupon.discountNumber)||angular.equals(G.reservationModel.coupon.discountNumber,""))&&!angular.equals(G.reservationModel.coupon.discountNumber,G.response.reservationSummary.awdNumber)){bf=true
}else{if(angular.isDefined(G.response.reservationSummary.userSelectedCurrency)&&!angular.equals(G.reservationModel.userSelectedCurrency,G.response.reservationSummary.userSelectedCurrency)){bf=true
}else{if(angular.isDefined(G.reservationModel)&&angular.isDefined(G.reservationModel.coupon)&&angular.isDefined(G.reservationModel.coupon.couponRateCode)&&G.reservationModel.coupon.couponRateCode!=""){bf=true
}}}}}}}}if(bf){G.applyCoupon()
}}function A(){return bd.checkDiscount(G.response)
}function H(){var bf=(G.isRecomendedFlow||G.response.preferredBundleList)?true:false;
return bd.isPrepay(G.pageName,G.reservationModel,bf)
}function t(bf){bd.vehicleInfo(bf,I.deviceType,Y)
}function v(bf){bd.vehicleFeaturedInfo(bf,I.deviceType,Y)
}function F(bg,bh){G.selectedFilter=bg;
G.mobileSelectedVehicleType=bg;
G.selectedFilter.state=bh;
G.pageControl.specialFeatureFiltered=bh;
G.pageControl.displayedVehicleType=bg.code;
G.pageControl.visibleVehicleType=(bg.code===Y.defaultDisplayedVehicleType)?"":bg.description;
if(G.reservationModel.displayControls.filterVehicleSelect===true&&G.pageName==Y.step2PageName){G.pageControl.displayVehicleList=true
}else{G.pageControl.displayVehicleList=false
}G.pageControl.vehicleTypeNotAvailable=false;
if(bh){G.pageControl.vehicleTypePlaceholder=Dictionary.I18n.get("msg.res.specialFeature")
}else{G.pageControl.vehicleTypePlaceholder=bg.description+" ("+G.getCarCountByClass(bg.cargroup)+")"
}G.isFilterRecomDivider=true;
if(!(G._isSorted()||G._isFiltered(bh))){G._defaultSortFilter();
G.isFilterRecomDivider=false
}else{if(bh){G.response=bd.filterBySpeacialFeatures(G.response,G.selectedFeatures.list);
G.pageControl.orderByAvailable=bd.getSortExpression(G.pageControl.userSortOption)
}else{G.response=bd.filterByVehicleClass(G.response,bd.getVehicleClasses(bg.cargroup))
}}G._collapseSortFilter();
G._hideVehicleInfo();
G.reservationModel.vehicleType=bg;
U.setReservationModel(G.reservationModel);
var bf=function(bj){var bi=(I.deviceType===Y.deviceTypeMobile)?"focus":"hover";
jQuery('a.popOver[data-toggle="popover"], a.steptwoinfo[data-toggle="popover"], a.info-icon[data-toggle="popover"]').attr("data-trigger",bi)
};
al(function(){bf();
jQuery('[data-toggle="popover"]').popover()
},0)
}function m(bf){var bg=true;
if(bf!=undefined&&bf.code!==bd.SortBy.PRICE.code){bg=false
}if($(window).width()<Y.deviceTypeMobileWidth){G.pageControl.userSortOption=G.sortType;
G._sortByFunc(G.sortType)
}else{G.pageControl.userSortOption=bf.code;
G.pageControl.sortPlaceHolder=bf.description;
G._sortByFunc(bf.code)
}angular.element(".dropdown-menu").parent(".dropdown").removeClass("open");
G._hideVehicleInfo()
}function S(bf){if(bf!=undefined){var bh=U.getReservationModel();
bh.coupon.discountNumber=bf;
bh.displayControls.bannerSelectedAWD=true;
bh.selectedRateType="";
U.setReservationModel(bh)
}I.requestInProgress=true;
if(G.reservationModel.coupon.discountNumber==""){G.reservationModel.rentalType="";
G.reservationModel.partnerMembershipId="";
G.reservationModel.NoPartnerMembershipID=false
}U.setReservationModel(G.reservationModel);
var bg=G.discountCouponValidate(G.reservationModel);
if(bg.length>0){aj(angular.element(".platform-error-message"))(Q);
aj(angular.element("#discountAWDErrStep2"))(Q);
I.requestInProgress=false
}else{ab()
}}function a7(bg,bf){G.reservationModel.coupon.discountNumber=bg;
G.reservationModel.coupon.couponNumber=bf;
G.getMultiCoupon();
G.applyCoupon()
}function ab(){bd.load().then(function(bf){G.response=bf;
bf=G._processErrorByType(G.response);
if((angular.isDefined(bf.errorList)&&bf.errorList.length>0)||(angular.isDefined(bf.warningList)&&bf.warningList.length>0)){aA.go(Y.step1aPageName)
}else{if(G.reservationModel.bookAgain.bookAgainFlow){aA.go(Y.bookAgainVehiclePage,{},{reload:true})
}else{aA.go(Y.step2PageName,{},{reload:true})
}}},function(bf){})
}function y(){if(ae.brand==Y.brandName.AVIS){af.load("null","step2").then(function(bf){var bg=a4.getResolvedOffers(bf);
if(bg.resolvedOffers.length>0&&bg.resolvedOffers.indexOf("Step2 Best Rate Guaranteed")!=-1&&G.response.bundleFlow!="GUIDED_RES"){G.mvtFlag=true
}})
}}function K(bf){if(((!bf.rateTypes)&&(!bf.reservationSummary.coupon)&&(!bf.errorList))||((!bf.rateTypes)&&(!bf.reservationSummary.coupon)&&bf.errorList&&(G.reservationModel.coupon.discountNumber==""||G.reservationModel.coupon.discountNumber==undefined))){G.awdIndicator.addDiscount=true
}else{if((!bf.rateTypes)&&bf.reservationSummary.coupon&&bf.reservationSummary.coupon.number){G.awdIndicator.validCoupon=true
}else{if((!bf.rateTypes)&&bf.errorList&&G.reservationModel.coupon.discountNumber!=""){G.awdIndicator.invalidAWD=true
}else{if((bf.rateTypes&&bf.rateTypes[0]==Y.rateTypeLeisure)){G.awdIndicator.leisure=true
}else{if((bf.rateTypes&&bf.rateTypes[0]==Y.rateTypeLowest&&G.reservationModel.rentalType==Y.rateTypeLowest)||(bf.rateTypes&&bf.errorList&&bf.rateTypes[0]==Y.rateTypeLowest&&bf.reservationSummary.rentalType==Y.rateTypeLowest)){G.awdIndicator.lowest=true
}else{if(bf.rateTypes&&bf.rateTypes[1]==Y.rateTypeCorporate&&(bf.reservationSummary.rentalType==Y.rateTypeCorporate||bf.reservationSummary.rentalType==Y.businessText)){G.awdIndicator.corporate=true
}}}}}}}function k(bl){var bk=[];
var bh=bl.coupon.discountNumber;
var bj=(bl.coupon.couponNumber)?bl.coupon.couponNumber:"";
var bg=U.validateDiscountNumber(bh,bj,bl,"Step2");
if(bg){bk.push(bg)
}var bf=G._awdValidator();
bg=U.validateCouponCode(bj,bh,bl,"Step2",bf);
if(bg){bk.push(bg)
}bg=U.validateMembeshipID(bh,bl,"Step2",G.requiresMemberID);
if(bg){bk.push(bg)
}if(bk.length==1){var bi=bk[0].message;
angular.element("#vecPageError").html("");
aj(angular.element("#vecPageError").append(bi))(Q)
}if(bk.length==2){G.vecFormPageError=Dictionary.I18n.get("err.res.mutliplemsg")
}return bk
}function n(){var bf=(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Tablet PC|Opera Mini/i.test(navigator.userAgent))?"focus":"hover";
angular.element('a.popOver[data-toggle="popover"], a.steptwoinfo[data-toggle="popover"], a.info-icon[data-toggle="popover"]').attr("data-trigger",bf);
angular.element('[data-toggle="popover"]').popover().off("shown.bs.popover");
angular.element('[data-toggle="popover"]').popover().on("shown.bs.popover",function(bg){angular.element(".popover.in").find(".close-button, .closePopover").on("click",function(){angular.element(".popover.in").popover("hide")
})
});
angular.element(".close-button").popover("hide");
angular.element("body").off("click",'[data-dismiss-custom="modal"]');
angular.element("body").on("click",'[data-dismiss-custom="modal"]',function(){angular.element(this).closest(".modal").modal("hide")
})
}function j(){G.getMultiCouponUtility(G,false)
}function x(){G.partnerPlaceholder="";
G.partnerLabel="";
var bf=G.reservationModel.coupon.discountNumber;
var bg=G.reservationModel.discountSummaryList;
var bh=false;
if(angular.isDefined(bg)&&angular.isDefined(bf)){angular.forEach(bg,function(bk,bj){if(bf==bk.discountNumber){bh=true
}})
}if(angular.isDefined(bf)&&bf.length>=7&&G.reservationModel.NoPartnerMembershipID==false&&(!bh)&&bf.indexOf("AMAZON")===-1){I.requestInProgress=true;
if((angular.isDefined(G.reservationModel.coupon.partnerMembershipId)&&G.reservationModel.coupon.partnerMembershipId==null)||G.reservationModel.coupon.partnerMembershipId==""){var bi=bd.partnerDiscountValidation(bf);
bi.then(function(bj){if(bj.fieldErrors){I.requestInProgress=false
}else{G.requiresMemberID=bj.awdSummary.requiresMemberID;
G.partnerName=bj.awdSummary.partnerName;
G.reservationModel.coupon.requiresMemberID=G.requiresMemberID;
G.reservationModel.partnerName=G.partnerName;
U.setReservationModel(G.reservationModel);
I.requestInProgress=false;
if(angular.isDefined(G.partnerName)&&G.requiresMemberID){G.partnerPlaceholder=G.partnerName+Dictionary.I18n.get("lbl.global.partnerMember,"+brand);
G.partnerLabel=Dictionary.I18n.get("lbl.global.partnerlabel,"+brand)+G.partnerName+Dictionary.I18n.get("lbl.global.partnerlabel1,"+brand);
G.reservationModel.partnerLabel=G.partnerLabel
}else{G.requiresMemberID=false;
G.membershipID=""
}}})
}else{I.requestInProgress=false
}}}function aY(){var bf=G.reservationModel.coupon.discountNumber;
var bg=G.reservationModel.discountSummaryList;
var bh=false;
if(angular.isDefined(bg)&&angular.isDefined(bf)){angular.forEach(bg,function(bj,bi){if(bf==bj.discountNumber){bh=true
}})
}if((bh)||(angular.isDefined(bf)&&bf.length<7)){G.requiresMemberID=false;
G.reservationModel.coupon.partnerMembershipId="";
G.response.reservationSummary.membershipId=null;
if(angular.isDefined(G.customer)){G.customer.awdSummary.requiresMemberID=false
}}}function aq(){if(G.reservationModel.NoPartnerMembershipID){G.reservationModel.coupon.partnerMembershipId="";
U.setReservationModel(G.reservationModel)
}aP.resetError("vm.reservationModel.coupon.partnerMembershipId",true)
}function C(){if(G.reservationModel.coupon.partnerMembershipId!=""&&G.reservationModel.NoPartnerMembershipID){G.reservationModel.NoPartnerMembershipID=false;
U.setReservationModel(G.reservationModel)
}}function ba(){G._resetModalVal();
if(angular.isDefined(aa)&&aa.length>1&&G.reservationModel.coupon.couponNumber){G.reservationModel.coupon.isMultiCoupon=true;
G.pageContent.couponList=aa;
aO.setCouponList(G.pageContent.couponList)
}else{G.reservationModel.coupon.isMultiCoupon=false;
var bf=G.pageContent.couponList={};
aO.setCouponList(bf)
}G.displayDiscount=!G.displayDiscount;
if(G.pageControl.displayVehicleList){G.pageControl.displayVehicleList=false
}aP.resetError("vm.reservationModel.coupon.discountNumber");
aP.resetError("vm.reservationModel.coupon.couponNumber");
aP.resetError("vm.reservationModel.coupon.couponRateCode");
if(G.reservationModel.coupon.discountNumber==""){G.reservationModel.coupon.partnerMembershipId=""
}if(I.isRecognized&&(ae.brand==Y.brandName.AVIS||ae.brand==Y.brandName.BUDGET)){if(G.customer.awdSummary.partnerName===Y.USAAMember||G.customer.awdSummary.partnerName===Y.CostcoMember){G.partnerPlaceholder=G.customer.awdSummary.partnerName+Dictionary.I18n.get("lbl.global.partnerMember,"+brand);
G.partnerLabel=Dictionary.I18n.get("lbl.global.partnerlabel,"+brand)+G.customer.awdSummary.partnerName+Dictionary.I18n.get("lbl.global.partnerlabel1,"+brand)
}if(G.reservationModel.coupon.partnerMembershipId!=""&&angular.isDefined(G.response.customerInfo)){G.response.customerInfo.awdSummary.requiresMemberID=false
}else{if(G.reservationModel.coupon.partnerMembershipId==""&&G.reservationModel.NoPartnerMembershipID==true){G.response.customerInfo.awdSummary.requiresMemberID=false;
G.customer.awdSummary.requiresMemberID=false
}}}else{if(I.isAuthenticated&&angular.isDefined(G.response.customerInfo)&&angular.isDefined(G.response.customerInfo.awdSummary)&&(G.response.customerInfo.awdSummary.requiresMemberID)){G.response.customerInfo.awdSummary.requiresMemberID=false;
G.partnerName=null;
G.customer.awdSummary.requiresMemberID=false
}}}function bc(){if(G.reservationModel.coupon&&G.reservationModel.coupon.visible==false){G.reservationModel.coupon.couponNumber="";
U.setReservationModel(G.reservationModel)
}else{G.reservationModel.coupon.couponNumber=G.couponNumberTemp;
G.reservationModel.coupon.couponQuantity=G.couponQuantityTemp;
G.reservationModel.coupon.discountNumber=G.discountNumberTemp;
angular.forEach(G.response.instructionList,function(bf){if((G.response.instructionList)&&((G.response.instructionList.length>0)||(G.response.errorList.length>0))&&b.containsObject(bf.code,Y.nonParticpatingBcd)){G.reservationModel.coupon.discountNumber=""
}});
G.reservationModel.coupon.couponRateCode=G.ratecodeNumberTemp;
G.reservationModel.rentalType=G.rentalTypeTemp;
U.setReservationModel(G.reservationModel)
}}function aI(bf){if(G.pageControl.locationControl){G.pageControl.displayVehicleList=!G.pageControl.displayVehicleList;
if(G.displayDiscount){G.displayDiscount=false
}}else{return false
}}function N(bf){var bg=[];
angular.forEach(bf,function(bh){if(angular.isDefined(bh)){bg.push(bh)
}});
G.uniqueCurrencylist=a2("unique")(bg,"currency")
}function g(bf){angular.element(".dropdown-menu").parent(".vehSelectBox").removeClass("open");
var bg=U.getReservationModel();
bg.userSelectedCurrency=bf.trim();
G.reservationModel=bg;
U.setReservationModel(G.reservationModel);
if(I.deviceType!=Y.deviceTypeMobile){I.requestInProgress=true;
bd.load().then(function(bh){I.requestInProgress=false;
aA.go(Y.step2PageName,{},{reload:true})
},function(bh){})
}}function R(){if(angular.element(".wrapper")&&angular.element(".wrapper").length>0){angular.element(".wrapper").attr("style","display:block")
}if(jQuery(".allvehimodalformob")){jQuery(".allvehimodalformob").modal("hide")
}if(jQuery(".myModalVehicleDrpDwn")){jQuery(".myModalVehicleDrpDwn").modal("hide")
}al(function(){au()
},1000)
}function au(){if(angular.element(".wrapper")&&angular.element(".wrapper").length>0){angular.element(".wrapper").attr("style","display:none")
}}function p(bf){var bg={};
bg[bf]=true;
if(bf==="abg"||bf==="ABG"){bg.abgquantity={size:6,condition:">"}
}return(a2("customFeaturesFilter")(G.response.availableVehicles,bg)).length===0?true:false
}function J(bf){return bd.getCountByVehicleType(G.response,bf)
}function w(bg){if(!(G._isSorted()||G._isFiltered())){G._defaultSortFilter()
}else{if((G._getVehicleHighlighter()==bd.VehicleHighlighter.NEW)&&(!G._isFiltered()&&G._isSorted())){G._resetVehicleGrouping()
}else{if(G.pageControl.vehicleTypePlaceholder.indexOf(Y.defaultVehicleTypeDesc)>-1){G._resetVehicleGrouping()
}}}var bf=bd.getSortExpression(bg);
G.pageControl.orderByAvailable=bf;
if(bg=="MILAGE"){G.iconImage="mpg-seats-feat"
}else{if(bg=="SEAT"){G.iconImage="four-seats-feat"
}}}function aW(){var bf=G._getFeaturedVehicleClasses();
var bg;
if(G.isRecomendedFlow){bg=G.response.recommendation.filterVehicles;
bf=G.response.recommendation.featureVehicles
}G._resetVehicleGrouping(bf,bg)
}function av(bf){var bg={};
bg.event="analyticsVPV";
bg.vpvName="/vpv/linkClickPage-"+bf+G.pageName;
dataLayer.push(bg)
}function aF(bg,bf,bj){if(!bf){G.reservationModel.prepayOpted=false
}if(angular.isDefined(bg.bundle)&&angular.isDefined(bg.bundle[0].bundleType)&&(bg.bundle[0].bundleType=="LAST_MINUTE"||bg.bundle[0].bundleType=="GUIDED_RES"||bg.bundle[0].bundleType=="INBOUND_ALL"||bg.bundle[0].bundleType=="INBOUND_BASIC")){var bi=(bf===true)?"payNowRate":"payLaterRate";
if(bj){G.reservationModel.rateCode=bj[bi].rateCode
}else{G.reservationModel.rateCode=bg.bundle[0][bi].rateCode
}}else{G.reservationModel.rateCode=bf?bg.prepayRateCode:bg.rateCode
}I.requestInProgress=true;
G.reservationModel.selectedCar=[];
G.reservationModel.carClass=bg.carClass;
G.reservationModel.couponAppliedCar=bg.couponApplicable;
G.reservationModel.prepayProcessIndicator=bf;
G.reservationModel.selectedCar.push(bg);
U.setReservationModel(G.reservationModel);
if(Y.resFlowCreate===G.reservationModel.displayControls.reservation){U.updateClientContext("carClass",bg.carClass);
var bh="";
if(angular.isDefined(bg.bundle)&&angular.isDefined(bg.bundle[0].bundleType)&&(bg.bundle[0].bundleType=="LAST_MINUTE"||bg.bundle[0].bundleType=="GUIDED_RES"||bg.bundle[0].bundleType=="INBOUND_ALL"||bg.bundle[0].bundleType=="INBOUND_BASIC")){bh=bg.bundle[0].bundleType
}if(!ABG.arrayHasObject(bh,["LAST_MINUTE","GUIDED_RES","INBOUND_ALL","INBOUND_BASIC"])){L.ancillaryBundlePromisesExecution().then(function(bk){G.reservationModel=U.getReservationModel();
G._processToExtras()
},function(bk){am.setAncillaryBundlesData("");
G._processToExtras()
})
}else{am.setAncillaryBundlesData("");
G._processToExtras()
}}else{am.setAncillaryBundlesData("");
G._processToExtras()
}}function f(){G._resetPointSelection();
G._removeUPSSelection();
G.reservationModel.pointProducts.carUpsell="";
G._resetModalVal();
var bf=G.reservationModel.selectedCar[0];
if(angular.isDefined(bf.bundle)&&ABG.arrayHasObject(bf.bundle[0].bundleType,["LAST_MINUTE","GUIDED_RES","INBOUND_ALL","INBOUND_BASIC"])){G.reservationModel=am.processSupportedExtras(G.reservationModel,G.response.preferredBundleList);
am.setAncillaryPrefferredBundlesData(bf.bundle[0].bundleType)
}U.setReservationModel(G.reservationModel);
if(G.reservationModel.bookAgain.bookAgainFlow&&G.pageName!=Y.bookAgainPayNowPage&&G.pageName!=Y.bookAgainPayLaterPage){G._reviewCall()
}else{am.load().then(function(bi){var bh=U.getExpressReservationFlag();
if(angular.isDefined(bi.webHeader)&&((bi.webHeader.viewIndicator=="4")||(bi.webHeader.viewIndicator=="5")||(bi.webHeader.viewIndicator=="6"))&&bh&&!bi.reservationSummary.prepayTxn){z.processResults(bi,{})
}else{if(angular.isDefined(bi.errorList)&&bi.errorList.length>0){G.errorDisplayList=Q.processErrorMessage(bi).errorList;
var bg=["05126","05127","05128","14437","14438","14439","14440","14441","14442","14443","14444","14075","30014","10019","10020","19074","14528"];
angular.forEach(bi.errorList,function(bk,bl){if(b.containsObject(bk.code,bg)){G.reservationModel.forceRateCodeDisplay=false
}});
I.requestInProgress=false
}else{var bj=U.getReservationModel();
if(bj.bookAgain.bookAgainFlow||G.pageName==Y.step4PageName||G.pageName==Y.step4PayLaterPageName){G._reviewCall()
}else{if(angular.isDefined(ae.SKIP_STEP3_FLOW)&&angular.isDefined(bf.bundle)&&ae.SKIP_STEP3_FLOW[bf.bundle[0].bundleType]==="true"){if((bf.bundle[0].bundleType==="INBOUND_ALL"||bf.bundle[0].bundleType==="INBOUND_BASIC")&&ABG.arrayHasObject(bi.reservationSummary.rateSummary.rateCode.toLowerCase(),Y.EnableStep3RateCode)){aA.go(Y.step3PageName,{},{reload:true})
}else{G._reviewCall()
}}else{aA.go(Y.step3PageName,{},{reload:true})
}}if(angular.isDefined(bi.reservationSummary.previousRateShopList)){W.setPreviousRateDetails(bi.reservationSummary.previousRateShopList)
}}}},function(bg){I.requestInProgress=false
})
}}function Z(){I.requestInProgress=true;
var bf=a9.load(G.pageName);
bf.then(function(bg){if(G.pageName==Y.step4PageName||G.pageName==Y.step4PayLaterPageName){if(bg.reservationSummary.payNowCheckBoxInd.visible=="FALSE"&&bg.reservationSummary.ccsection.visible=="FALSE"||(!G.reservationModel.prepayOpted&&!G.reservationModel.prepayProcessIndicator&&(G.rentalLocationCountry==Y.countryCodeAU.toUpperCase()||G.rentalLocationCountry==Y.countryCodeNZ.toUpperCase()))){aA.go(Y.step4PayLaterPageName,{},{reload:true})
}else{aA.go(Y.step4PageName,{},{reload:true})
}}else{if(G.reservationModel.bookAgain.bookAgainFlow){I.requestInProgress=false;
var bh=a9.payNowCheckBox(bg);
if(!bh){aA.go(Y.bookAgainPayNowPage,{},{reload:true})
}else{if(bh){aA.go(Y.bookAgainPayLaterPage,{},{reload:true})
}}}if(bg.reservationSummary.payNowCheckBoxInd.visible=="FALSE"&&bg.reservationSummary.ccsection.visible=="FALSE"){aA.go(Y.step4PayLaterPageName,{},{reload:true})
}else{aA.go(Y.step4PageName,{},{reload:true})
}}})
}function O(){var bf=[];
if((G.reservationModel.selectedProducts).length>0){angular.forEach(G.reservationModel.selectedProducts,function(bg,bh){if(G.reservationModel.selectedProducts[bh].code!="UPS"){bf.push(G.reservationModel.selectedProducts[bh])
}});
G.reservationModel.selectedProducts=bf
}}function aZ(){G.validated=false;
if(!G.reservationModel.coupon.discountNumber||G.reservationModel.rentalType==Y.rateTypeLeisure){G.reservationModel.corporateAWD=false
}if(!G.reservationModel.coupon.couponQuantity){G.reservationModel.hideCoupons=false
}G.resFormPageInfoBool=false;
G.resFormPageInfo=""
}function l(){if((G.pageName==Y.step3PageName)||(G.pageName==Y.step4PageName)||(G.pageName==Y.step4PayLaterPageName)||(G.pageName==Y.bookAgainPayNowPage)||(G.pageName==Y.bookAgainPayLaterPage)){return true
}else{return false
}}function h(){G.reservationModel=U.getReservationModel();
G.isBookAgainFlow=U.isBookAgainFlow(G.pageName);
if(G.isBookAgainFlow){aQ.datePickerInitFun(I.deviceType,"");
if(G.pageName===Y.bookAgainVehiclePage){aO.resetAvailableExtras()
}}var bf=G._getVehicleHighlighter();
var bg=ar.getStorageData("vehicleTypeList");
if(bg!=""&&bg!=undefined&&!$.isEmptyObject(bg)){aO.addToVehicleType(bg);
ar.deleteStorageData("vehicleTypeList")
}bd.getData(bf).then(function(bh){if(G.reservationModel){G._dataProcess(bh)
}else{var bi=U.load(bh,true);
bi.then(function(bj){G.reservationModel=bj;
G._dataProcess(bh)
})
}I.$broadcast("Profile.refreshCustomerInfo")
},function(bh){})
}function E(bf,bg){L.promisesExecution(bg,"vehicles").then(function(bh){bf.response=bh;
if(bh.featuredVehicles){bh.featuredVehicles.forEach(function(bj){if(bj.calloutDescription){bj.calloutDescription=aJ.trustAsHtml(bj.calloutDescription)
}})
}if(bh.filteredVehicles){bh.filteredVehicles.forEach(function(bj){if(bj.calloutDescription){bj.calloutDescription=aJ.trustAsHtml(bj.calloutDescription)
}})
}var bi=bh.reservationSummary.pickLoc.address.country;
bf.isRecomendedFlow=true;
bf.isFilterRecomDivider=false;
bf.pageControl.sortByList=bd.getSortByOptions(bi);
if(bh.isSortRecommended){bf.pageControl.sortByList=bd.getSortByOptions(bi,true);
if(bf.pageControl.sortByList){bf.sortType=bf.pageControl.sortByList[bf.pageControl.sortByList.length-1].code
}bf.pageControl.userSortOption=bd.SortBy.RECOMMENDED.code;
bf.pageControl.sortPlaceHolder=bd.SortBy.RECOMMENDED.description;
bf.pageControl.orderByAvailable=bd.getSortExpression(bf.pageControl.userSortOption)
}bf._displaySoldoutInstruction();
al(function(){n()
},1)
})
}function aT(){if(G.reservationModel.vehicleType===""||G.reservationModel.vehicleType.code===Y.defaultDisplayedVehicleType){G.filterVehicle(G.response.carGroupList[0],false)
}else{if(G.reservationModel.vehicleType!==""&&G.reservationModel.vehicleType.code!==Y.defaultDisplayedVehicleType){if(G.getCarCountByClass(G.reservationModel.vehicleType.cargroup)===0){G.pageControl.vehicleTypeNotAvailable=true
}else{G.filterVehicle(G.reservationModel.vehicleType,false)
}if(!angular.equals(G.reservationModel.vehicleType.code,"all")){G.pageControl.displayVehicleList=true;
G.pageControl.vehicleTypePlaceholder=G.reservationModel.vehicleType.description+" ("+G.getCarCountByClass(G.reservationModel.vehicleType.cargroup)+")"
}}}}function a6(bi){G.response=bi;
G.setMvtFlag();
if(angular.isDefined(bi.showTotalRate)&&bi.showTotalRate.code==Y.showTotalRate){G.displayTotalRate=true;
if(angular.isDefined(bi.reservationSummary.gebUser)&&bi.reservationSummary.gebUser){G.displayTotalRate=false
}}if(bi.reservationSummary.ancillariesIncluded&&bi.reservationSummary.ancillariesIncluded.length>0){bd.includedExtas(bi).then(function(bm){G.ancillariesIncluded=bm.reservationSummary.ancillariesIncludedList
})
}if(angular.isDefined(bi.reservationSummary.personalInfo)&&angular.isDefined(bi.reservationSummary.personalInfo.residency.value)&&((bi.reservationSummary.personalInfo.residency.value).toLowerCase()=="us"||(bi.reservationSummary.personalInfo.residency.value).toLowerCase()=="ca")&&angular.isDefined(bi.reservationSummary.userState)&&bi.reservationSummary.userState=="AUTHENTICATED"&&ae.brand==Y.brandName.AVIS){G.epIndicator=true
}if(bi.bundleFlow==="LAST_MINUTE"&&angular.isDefined(ae.SKIP_STEP3_FLOW)&&ae.SKIP_STEP3_FLOW.ENABLE_LMB==="true"){an();
bd.getBundleDesciption(G.response).then(function(bm){G.response=bm
})
}else{if(bi.bundleFlow==="INBOUND"){bd.SortBy=bd.getBundleSortBy();
G.pageControl.orderByAvailable=bd.SortBy.PRICE.sortExpression
}}G.reservationModel.userSelectedCurrency=bi.reservationSummary.userSelectedCurrency;
G.rentalLocationCountry=bi.reservationSummary.pickLoc.address.country.toUpperCase();
if(G.pageName==Y.step2PageName){try{B.analyticsDimension(bi.reservationSummary,G.pageName,bi)
}catch(bj){}}var bk=bi.reservationSummary.pickLoc.address.country;
G.pageControl.enableSortOption=bd.isFilterAvailable(bk);
if(G.pageControl.enableSortOption){G.pageControl.sortByList=bd.getSortByOptions(bk,false);
G.sortType=G.pageControl.sortByList[0].code
}G.pageControl.locationControl=G.pageControl.enableSortOption&&bd.isFilterReady(bi.carGroupList);
if(G.pageControl.locationControl){G.pageControl.vehicleTypePlaceholder=bd.getVehicleType(bi,bi.carGroupList);
var bg=(G.reservationModel.vehicleType!=""&&G.pageName==Y.step2PageName)?G.reservationModel.vehicleType:bi.carGroupList[0];
if(bg.description!=Y.defaultVehicleTypeDesc){G.filterVehicle(bg,false)
}if(G.pageName==Y.step2PageName&&G.reservationModel.vehicleType!=""){G._setVehicleTypeFilterDisplay(bi)
}}if(G.reservationModel.vehicleType&&G.reservationModel.vehicleType!=""){G.mobileSelectedVehicleType=G.reservationModel.vehicleType
}else{if(bi.carGroupList!=undefined){G.mobileSelectedVehicleType=bi.carGroupList[0]
}}U.loadPickUpInfo(G.reservationModel,bi.reservationSummary);
U.loadDropOffInfo(G.reservationModel,bi.reservationSummary);
G._processErrorByType(bi);
if(angular.isDefined(bi.uasFlagForLicLoc)&&bi.uasFlagForLicLoc.code=="05019"&&G.pageName==Y.step2PageName){at()
}if(bi.reservationSummary.underAgeUser===true){G.underAge=true
}if(bi.reservationSummary.coupon!=undefined){G.couponNumberTemp=bi.reservationSummary.coupon.number
}G._setAwdOnPageLoad();
G.amazonUserStatus=W.amazonLoginStatus();
G.discountNumberTemp=G.reservationModel.coupon.discountNumber;
G.ratecodeNumberTemp=bi.reservationSummary.couponRateCode;
if(bi.reservationSummary.couponRateCode){G.ratecodeNumberTemp=bi.reservationSummary.couponRateCode
}else{G.ratecodeNumberTemp=""
}ag();
G.pageControl.isModifyVehicleModal=G._isModifyVehicleModal();
G.getAwdLabel(bi);
if(bi.reservationSummary.awdNumber!=undefined&&bi.rateTypes&&ae.brand===Y.brandName.AVIS){G.awdList=bd.getAwdList(bi.rateTypes,bi.reservationSummary.awdNumber)
}else{if(bi.reservationSummary&&G.reservationModel.coupon){G.reservationModel.coupon.isprofileBCD=false;
if(bi.reservationSummary.rateTypes&&bi.reservationSummary.selDiscountNum){if(angular.isDefined(bi.reservationSummary.awdNumber)&&bi.reservationSummary.awdNumber!=G.amazonBenefitsKey){G.reservationModel.coupon.isprofileBCD=true;
G.awdList=bd.getBcdList(bi.reservationSummary.rateTypes);
var bf=G.awdList.indexOf(a2("filter")(G.awdList,function(bm){return bm.value===bi.reservationSummary.selDiscountNum
})[0]);
if(angular.isUndefined(G.reservationModel.rentalType)){G.reservationModel.rentalType=""
}if(bf>-1&&G.awdList.length>0){G.reservationModel.selectedRateType=G.awdList[bf].value
}}}}}if(bi.reservationSummary.awdNumber&&bi.rateTypes){G.rentalTypeTemp=G.reservationModel.rentalType
}if(bi.currencies){G.setCurrencyList(bi.currencies)
}G.userCurrency=bi.reservationSummary.userSelectedCurrency;
if(U.getCouponDetails(bi)){G.currencySymbol=a2("currencySymbol")(bi.reservationSummary.coupon.currencySymbol);
G.couponNumberTemp=bi.reservationSummary.coupon.number;
G.pageContent.couponList=aO.getCouponList();
if(bi.reservationSummary.coupon.instances){G.reservationModel.coupon.couponQuantity=bi.reservationSummary.coupon.instances;
G.couponQuantityTemp=bi.reservationSummary.coupon.instances
}else{if(angular.isDefined(G.pageContent)&&angular.isDefined(G.pageContent.couponList)&&G.pageContent.couponList.length>1){G.reservationModel.coupon.couponQuantity=1;
G.couponQuantityTemp=1
}else{G.reservationModel.coupon.couponQuantity="";
G.reservationModel.coupon.isMultiCoupon=false;
G.couponQuantityTemp=""
}}G.applyCouponCode()
}I.requestInProgress=false;
angular.element(".stepTwoHOL").removeClass("stepTwoHOL");
G.oneClickSlecetedCarFlow=false;
G.oneClickSlecetedCarFlow=(angular.isDefined(U.getStorageData("oneClickSelectedCar")))?true:false;
var bl=U.getReservationModel();
if(angular.isDefined(G.response.preferredBundleList)&&angular.isDefined(G.response.preferredBundleList[0].bundle[0].bundleType)&&G.response.preferredBundleList[0].bundle[0].bundleType==="GUIDED_RES"){bl.isGuidedRes=true
}else{bl.isGuidedRes=false
}U.setReservationModel(bl);
G.reservationModel=bl;
if(Y.resFlowCreate===G.reservationModel.displayControls.reservation&&G.pageName==Y.step2PageName&&!G.oneClickSlecetedCarFlow&&!G.isBookAgainFlow&&G.response.bundleFlow==="NORMAL"&&(angular.isUndefined(G.response.preferredCarClass))){G._merchandisingServiceListener(G,bi)
}if((ae.brand===Y.brandName.AVIS||ae.brand===Y.brandName.BUDGET)&&Y.resFlowCreate===G.reservationModel.displayControls.reservation&&G.pageName==Y.step2PageName&&!G.isBookAgainFlow&&G.reservationModel&&G.reservationModel.pickUpLocation&&G.reservationModel.pickUpLocation.countryCode){af.loadBundles(G.reservationModel.pickUpLocation.countryCode)
}G.reservationModel.removeSelRateType=false;
aj(angular.element('a[piclocInfoMsg = "pickup"]'))(Q);
aj(angular.element('a[piclocInfoMsg = "return"]'))(Q);
if(ae.bundleExceptionText&&angular.isUndefined(G.response.preferredBundleList)&&bl.isGuidedRes){if(angular.isUndefined(G.response.instructionList)){G.response.instructionList=[]
}if(G.response&&G.response.instructionList&&G.response.instructionList.length>0){for(var bh=0;
bh<G.response.instructionList.length;
bh++){if(G.response.instructionList[bh].code==="05250"){G.response.instructionList[bh].message=ae.bundleExceptionText
}}}else{G.response.instructionList.push({message:ae.bundleExceptionText})
}}}function a0(){a8.couponApply(G.pageContent.couponList,G.reservationModel).then(function(bf){G.pageContent.couponList=bf.couponList;
G.reservationModel=bf.reservationModel
})
}function aD(bf){if(angular.isDefined(bf)){G.extrasDescriptionList=bf
}}function ak(){if(angular.isDefined(G.response.reservationSummary.discountSummaryList)){G.reservationModel.discountSummaryList=G.response.reservationSummary.discountSummaryList
}if(angular.isDefined(G.response.reservationSummary.amazonLinked)){G.reservationModel.amazonLinked=G.response.reservationSummary.amazonLinked
}if(angular.isDefined(G.response.reservationSummary.amazonLinkingSupported)){G.reservationModel.amazonLinkingSupported=G.response.reservationSummary.amazonLinkingSupported
}if(angular.isDefined(G.response.reservationSummary.awdNumber)&&!angular.equals(G.response.reservationSummary.awdNumber,"")){G.reservationModel.coupon.discountNumber=G.response.reservationSummary.awdNumber
}else{if(ae.brand===Y.brandName.AVIS&&!(angular.isDefined(G.customer)&&angular.isDefined(G.customer.userState)&&((G.customer.userState=="PARTNER_AUTHENTICATED")||(angular.isDefined(G.customer.amazonLinked)&&G.customer.amazonLinked)))){G.reservationModel.coupon.discountNumber=angular.isDefined(G.response.reservationSummary.awdNumber)?G.response.reservationSummary.awdNumber:""
}else{if(ae.brand===Y.brandName.BUDGET&&!(angular.isDefined(G.customer)&&((G.customer.userState=="PARTNER_AUTHENTICATED")||(angular.isDefined(G.customer.amazonLinked)&&G.customer.amazonLinked)))){G.reservationModel.coupon.discountNumber=angular.isDefined(G.response.reservationSummary.userEnteredBcd)?G.response.reservationSummary.userEnteredBcd:""
}else{if(angular.isUndefined(G.response.reservationSummary.awdNumber)){G.reservationModel.coupon.discountNumber=""
}}}}}function ag(){var bf="";
if(angular.isDefined(G.response.reservationSummary.coupon)&&G.response.reservationSummary.coupon.visible===false){bf=G.response.reservationSummary.coupon.number
}else{if(G.reservationModel.displayControls.reservation!=Y.resFlowCreate&&angular.isDefined(G.response.oldReservationSummary)&&angular.isDefined(G.response.oldReservationSummary.coupon)&&G.response.oldReservationSummary.coupon.visible===false){bf=G.response.oldReservationSummary.coupon.number
}else{bf=G.response.reservationSummary.promotionalCoupon
}}if(G.reservationModel.displayControls.reservation==Y.resFlowCreate&&bf&&bf.length>0){G.couponCodeDisabled=true;
G.reservationModel.coupon.couponNumber="";
if(angular.isDefined(G.response.reservationSummary.coupon)&&angular.isDefined(G.response.reservationSummary.coupon.visible)){G.reservationModel.coupon.visible=G.response.reservationSummary.coupon.visible;
G.reservationModel.promotionalCoupon=G.response.reservationSummary.coupon.number
}U.setReservationModel(G.reservationModel)
}else{if(G.reservationModel.displayControls.reservation!=Y.resFlowCreate&&bf&&bf.length>0&&angular.isDefined(G.response.reservationSummary.walletType)&&(G.response.reservationSummary.walletType=="VISA"||G.response.reservationSummary.walletType=="VISA_CHECKOUT")){G.couponCodeDisabled=true;
G.reservationModel.coupon.couponNumber="";
if(angular.isDefined(G.response.reservationSummary.coupon)&&angular.isDefined(G.response.reservationSummary.coupon.visible)){G.reservationModel.coupon.visible=G.response.reservationSummary.coupon.visible;
G.reservationModel.promotionalCoupon=G.response.reservationSummary.coupon.number
}U.setReservationModel(G.reservationModel)
}}}function q(bg){var bi=G.reservationModel.vehicleType;
var bf=G.reservationModel.vehicleType.code;
G.carList=bd.populateCarList(bg,bg.carGroupList,bf);
var bh=bd.getSelectedCarGruop(bi,bg.carGroupList);
if(G.getCarCountByClass(bh)===0){G.pageControl.vehicleTypeNotAvailable=true;
G.vehicleTypeInstruction=aJ.trustAsHtml(Dictionary.I18n.get("msg.res.step2.vehiclesold1,"+brand))
}if(!angular.equals(bi.code,"all")){G.pageControl.displayVehicleList=true
}}function at(){angular.element(document).find(".disruptive-messaging").modal({backdrop:"static"})
}function an(){angular.element(document).find(".lmb-modal").modal({backdrop:"static"})
}function ac(bg,bf){G.response=bd.groupAvailableVehicles(G.response,bg,false,bf)
}function ap(){var bf;
if(G.response.isSortRecommended&&G.pageName==Y.step2PageName){bf=(G.pageControl.userSortOption!=bd.SortBy.RECOMMENDED.code)?true:false
}else{bf=(G.pageControl.userSortOption!=bd.SortBy.PRICE.code)?true:false
}return bf
}function e(bg){var bf=false;
if($(window).width()<Y.deviceTypeMobileWidth){bf=((G.mobileSelectedVehicleType&&G.mobileSelectedVehicleType.cargroup&&G.mobileSelectedVehicleType.cargroup.length>0)||(G.selectedFeatures.list.length>0||bg))?true:false
}else{bf=((G.selectedFilter&&G.selectedFilter.cargroup.length>0)||(G.selectedFeatures.list.length>0||bg))?true:false
}return bf
}function aM(){var bf;
if(G._getVehicleHighlighter()==bd.VehicleHighlighter.NEW){bf=[G.reservationModel.selectedCar[0].carClass]
}else{if(Y.resFlowModify===G.reservationModel.displayControls.reservation&&angular.isDefined(G.response.oldReservationSummary)){bf=[G.response.oldReservationSummary.vehicle.carClass]
}else{if(G.reservationModel.selectedCarClass!=""&&G.reservationModel.selectedCarAvailability!=""){var bg=U.getStorageData("oneClickSelectedCar").carClass;
bf=[bg]
}else{if(angular.isDefined(G.response.preferredCarClass)&&G.response.preferredCarClass!=""){bf=[G.response.preferredCarClass]
}}}}if(G.response.errorList&&G.response.errorList.code==="05129"){bf=[]
}return bd.getVehicleClasses(bf)
}function M(){var bf;
if(aA.current.name!=Y.step2PageName&&aA.current.name!==Y.bookAgainPage&&aA.current.name!==Y.bookAgainVehiclePage){bf=bd.VehicleHighlighter.NEW
}return bf
}function aH(){if(angular.element("#vehicleModal")){angular.element("#vehicleModal").modal("hide")
}if(angular.element(".allvehimodalformob")){angular.element(".allvehimodalformob").modal("hide")
}if(angular.element(".myModalVehicleDrpDwn")){angular.element(".myModalVehicleDrpDwn").modal("hide")
}}function a3(){var bg=jQuery(".avilablecar.available-car-box");
bg.find(".avlcarimagetab img").removeClass("slide-left");
bg.removeClass("bg-grey");
bg.find(".vehicleinfo").removeClass("icon-remove").text(Dictionary.I18n.get("msg.res.VehicleAvailability.viewVehicleInfo"));
bg.find(".available-car-fac").addClass("hidden").removeClass("bg-grey");
var bf=jQuery(".featuredcar.featured-car-box");
bf.find(".ftrcarimage img").removeClass("slide-left");
bf.removeClass("bg-grey");
bf.find(".vehicleinfo").removeClass("icon-remove").text(Dictionary.I18n.get("msg.res.VehicleAvailability.viewVehicleInfo"));
bf.find(".featured-car-fac").addClass("hidden").removeClass("bg-grey")
}function aB(bf){bf=Q.processErrorMessage(bf);
return bf
}function D(){var bf=[];
if((G.reservationModel.selectedProducts).length>0){angular.forEach(G.reservationModel.selectedProducts,function(bg,bh){if(!G.reservationModel.selectedProducts[bh].redeemedQty||G.reservationModel.selectedProducts[bh].redeemedQty==0){bf.push(G.reservationModel.selectedProducts[bh])
}});
G.reservationModel.selectedProducts=bf
}}G._processVehiclesPage();
I.$on("learnwhyerror",function(bh,bi){var bf=G._awdValidator();
var bg=bd.learnWhyErrorMsg(G,bi,bf);
G.title=bg.title;
G.errorMsg=bg.errorMsg;
G.reason=bg.reason;
jQuery(".generic-err-modal").modal("show")
});
function P(){ad="";
if(angular.equals(G.pageControl.selectCarType,"")){aP.displayServiceError("vm.pageControl.selectCarType","selectrequired")
}else{aO.resetLocationSearchData();
bb.getDisplayAvailForVehicleType(G.pageControl.selectCarType).then(function(bf){if(angular.isDefined(bf.noAvailableLoc)&&angular.equals(bf.noAvailableLoc.code,"05136")){G.vehicleTypeInstruction=aJ.trustAsHtml(bf.noAvailableLoc.message);
if(jQuery(".selectedVehicleTypeNotAvailable")){jQuery(".selectedVehicleTypeNotAvailable").modal("hide")
}}else{ad="VEHICLETYPE";
if(I.mapModalPath===""){I.mapModalPath=location.pathname.replace(".html","")+".map-modal"+htmlExtension
}else{G._resolveLocation()
}if(I.keyDropPath===""){I.keyDropPath=location.pathname.replace(".html","")+".keydrop-modal"+htmlExtension
}}},function(){})
}}I.$on("LocationControllerLoaded",function(bg,bf){if(ad==="VEHICLETYPE"){G._resolveLocation()
}});
function be(){var bf={requestFrom:"vehicleType",selectedCarType:G.pageControl.selectCarType,resolvePosition:1};
I.$broadcast("searchLocation.request",bf);
if(jQuery(".selectedVehicleTypeNotAvailable")&&angular.equals(I.deviceType,Y.deviceTypeDesktop)){jQuery(".selectedVehicleTypeNotAvailable").modal("hide")
}}function ax(bh,bf){if(angular.isDefined(bf)&&angular.equals(bf.event,"SELECT")&&angular.equals(bf.requestFrom,"vehicleType")){I.requestInProgress=true;
var bk=U.getReservationModel(),bi=false;
var bg=function(){bk.pickUpLocation={};
bk.pickInfo=bf.locCode;
bk.pickUpLocation.suggCode=bf.locCode;
bk.pickUpLocation.suggDescription=bf.description;
bk.pickUpLocation.originalObject={order:"1"}
};
var bj=function(){bk.dropLocation=bk.pickUpLocation;
bk.dropInfo=bk.pickInfo
};
if(angular.equals(bk.pickUpLocation.suggCode,bk.dropLocation.suggCode)){bi=true
}bg();
if(bi){bj()
}U.setReservationModel(bk);
bd.load().then(function(bl){bl=Q.processErrorMessage(bl);
if(angular.isDefined(bl.warningList)&&bl.warningList.length>0&&(angular.equals(bl.warningList[0].code,"157")||angular.equals(bl.warningList[0].code,"158")||angular.equals(bl.warningList[0].code,"161"))){I.$emit("searchLocation.soldOutNotification",bf)
}else{G.reservationModel=bk;
G.response=bl;
G._displaySoldoutInstruction();
az();
I.requestInProgress=false
}})
}else{if(angular.isDefined(bf)&&angular.equals(bf.event,"CLOSE")&&angular.equals(bf.requestFrom,"vehicleType")){az()
}}}function a5(bf){if(ae.brand===Y.brandName.BUDGET){if(angular.isDefined(G.reservationModel.coupon.discountNumber)&&(G.reservationModel.coupon.discountNumber===""||(G.reservationModel.coupon.discountNumber.length>=7&&Y.discountValidation.test(G.reservationModel.coupon.discountNumber)))&&bf){G.reservationModel.removeSelRateType=true
}}}$("body").on("shown.bs.modal",".modal.policies_Modal",function(bf){G.getPrepayTnCs()
});
I.$on("searchLocation.response",function(bg,bf){G._searchLocationResponseHandler(bg,bf)
});
var az=function(){jQuery(".modal.mapModal").modal("hide");
$(".modal.mapModal").on("hidden.bs.modal",function(){I.mapModalPath=""
})
};
jQuery(document).ready(function(){if(G.pageName==Y.step2PageName){U.addGTMScript()
}al(function(){jQuery(".callout-description span").append('<div class="campaign-triangle"></div>')
},4000)
});
function u(){aO.resetBookAgainVehicle();
var bf=U.getReservationModel();
bf.bookAgain.bookAgainFlow=false;
U.setReservationModel(bf);
ab()
}function X(bf){G.reservationModel.coupon.discountNumber=bf.discountNumber;
G.showLearnWhyError=false;
G.customer.awdSummary.partnerName=null;
G.partnerName=null;
G.partnerDiscount()
}I.$on("Partner.partnerInfo",function(bf,bg){if(angular.isDefined(bg)){G.amazonUserStatus=W.amazonLoginStatus()
}});
function aL(bf){G.selectedCarExtrasDetail=bf
}function aS(){if(brand==Y.brandName.BUDGETTRUCK&&(domain==Y.countryCodeAU.toLowerCase()||domain==Y.countryCodeNZ.toLowerCase())){return false
}else{return true
}}}})();
(function(){angular.module("carRental").controller("CampaignController",a);
a.$inject=["$scope","$state","$filter","$rootScope","language","$validation","carRentalConstant","$controller","reservationModelService","optionalService","getDataService","confirmationService"];
function a(n,q,l,h,p,o,c,b,j,e,i,r){var s=this;
s.checkBannerAWD=g;
s.checkBannerCoupon=g;
s.checkBannerAwdCoupon=m;
s.showHide=u;
s.promoCampaign=k;
var d=j.getReservationModel();
function u(v){if(v.length>7){v=v.substring(0,5)+v.substring(6)
}if(angular.isDefined(n.$parent.vm.response.reservationSummary)&&((angular.isDefined(n.$parent.vm.response.reservationSummary.awdNumber)&&n.$parent.vm.response.reservationSummary.awdNumber===v)||!angular.isDefined(n.$parent.vm.response.reservationSummary.awdNumber)&&n.$parent.vm.reservationModel.displayControls.reservation==="create")){return true
}else{return false
}}function g(v,w){if(v.length>7){v=v.substring(0,5)+v.substring(6)
}if(angular.isDefined(n.$parent.vm.response.reservationSummary)&&angular.isDefined(n.$parent.vm.response.reservationSummary.awdNumber)){var x=n.$parent.vm.response.reservationSummary.awdNumber
}if(angular.isDefined(n.$parent.vm.response.reservationSummary)&&angular.isDefined(n.$parent.vm.response.reservationSummary.awdNumber)){if((n.$parent.vm.response.reservationSummary.awdNumber!=v&&w==c.buttonTextRedeem)||(n.$parent.vm.response.reservationSummary.awdNumber===v&&w==c.buttonTextApplied)){return true
}else{return false
}}else{if(w==c.buttonTextRedeem){return true
}else{return false
}}}function t(v,w){if(angular.isDefined(n.$parent.vm.response.reservationSummary)&&angular.isDefined(n.$parent.vm.response.reservationSummary.coupon)){return true
}else{if(w==c.buttonTextRedeem){return true
}else{return false
}}}function m(w,v,x){if(w!==""&&v!==""){return(g(w,x)&&t(v,x))
}else{if(w!==""){return g(w,x)
}else{if(v!==""){return t(v,x)
}}}}function k(y){h.requestInProgress=true;
y=l("uppercase")(y);
if(q.current.name===c.confirmationPage){r.productUpsellOneClickModify(y).then(function(A){if(angular.isDefined(A.fieldErrors)&&A.fieldErrors.length>0||(angular.isDefined(A.errorList)&&A.errorList.length>0)){n.$parent.processErrorMessage(A)
}else{if(angular.isDefined(A.webHeader)&&angular.isDefined(A.webHeader.viewIndicator)&&A.webHeader.viewIndicator!="7"){n.$parent.vm.productUpsellError=true
}else{if(angular.isDefined(A.reservationSummary)&&angular.isDefined(A.reservationSummary.rateSummary)){d.selectedProducts=[];
for(var z=0;
z<A.reservationSummary.rateSummary.selectedProducts.length;
z++){d.selectedProducts.push(A.reservationSummary.rateSummary.selectedProducts[z])
}}for(var z=0;
z<d.selectedProducts.length;
z++){if(d.selectedProducts[z].code===l("uppercase")(y)){d.selectedProducts[z].isCampaignBased=true;
j.setReservationModel(d);
break
}}}q.go(c.confirmationPage,{},{reload:true})
}})
}else{var v=j.getStorageData("productList");
var x;
for(var w=0;
w<v.length;
w++){if(v[w].code===y){x=v[w];
x.selected=true;
x.productId=x.productId+"chk";
x.quantity=1;
break
}}d.selectedProducts.push(x);
j.setReservationModel(d);
e.recalculate("true").then(function(A){if(angular.isDefined(A.fieldErrors)&&A.fieldErrors.length>0||(angular.isDefined(A.errorList)&&A.errorList.length>0)){n.$parent.processErrorMessage(A)
}else{for(var z=0;
z<d.selectedProducts.length;
z++){if(d.selectedProducts[z].code===l("uppercase")(y)){d.selectedProducts[z].isCampaignBased=true;
j.setReservationModel(d);
break
}}if(q.current.name===c.step3PageName){q.go(c.step3PageName,{},{reload:true})
}else{if(q.current.name===c.step4PageName){i.addToReviewData(A);
q.go(c.step4PageName,{},{reload:true})
}else{if(q.current.name===c.step4PayLaterPageName){i.addToReviewData(A);
q.go(c.step4PayLaterPageName,{},{reload:true})
}}}}},function(z){h.requestInProgress=false
})
}}var f=b("CampaignExnController",{$scope:n});
angular.extend(this,f)
}})();
(function(){angular.module("carRental").controller("BookAgainController",a);
a.$inject=["$controller","$sce","$scope","$state","$rootScope","getDataService","vehicleService","carRentalConstant","reservationModelService"];
function a(d,k,m,c,l,j,n,e,i){var f=this;
f.pageName=c.current.name;
f.response={};
var b;
var o;
f._loadVehicleFeatures=g;
f.vehicleInfo=h;
function g(){b=i.getReservationModel();
if(angular.isUndefined(b)){b=i.bookingModel;
b.bookAgain.bookAgainFlow=true
}i.setReservationModel(b);
o=n.getRebookVehicleData();
o.then(function(p){f.response=p;
b.pickInfo=f.response.reservationSummary.pickLoc.locationCode;
b.dropInfo=f.response.reservationSummary.dropLoc.locationCode;
b.coupon.discountNumber=f.response.reservationSummary.awdNumber;
i.setReservationModel(b)
},function(p){})
}function h(p){n.vehicleInfo(p,l.deviceType,e)
}f._loadVehicleFeatures()
}})();
(function(){angular.module("reservation").controller("PreCheckOutController",a);
a.$inject=["$scope","$rootScope","$validation","$window","$filter","$controller","$state","$stateParams","carRentalConstant","reservationModelService","getDataService","preCheckOutService","accountUtilityService","$timeout","helpcontentService","authenticationService","myProfileService","geoservices","$sce","reviewService"];
function a(k,p,b,G,B,x,w,H,C,u,n,d,D,z,q,E,h,v,f,c){p.requestInProgress=true;
var o=this;
o.preCheckFormValidation=false;
o.preCheckPageError="";
o.preCheckData={};
o.countryList={};
o.statesForCountry={};
o.countryListForDriverLicense={};
o.customer={};
o.accountModel={};
o.reservationModel={};
o.termsCondition={};
o.pageInit=l;
o.populateBillingInfoCountryList=F;
o.getStatesForCountry=J;
o.validatePhoneNumber=s;
o.populateCountryListForDriverLicense=g;
o.getStatesForDL=K;
o.loadHelpModal=t;
o._displayFunction=r;
o.submitForm=y;
o.loadCalendarDropdown=A;
o.checkForPartnerCustomerInfo=i;
o.loadTermsAndCondition=j;
o._validationSuccess=I;
o._validationError=m;
o._setCORAsBillingCountry=e;
o.disabledField={address:false,driverLicense:false,DOB:false,phone:false,optIn:false};
x("ExceptionHandlerController",{$scope:k});
function l(){u.addGTMScript();
if(w.current.name===C.preCheckoutSuccess){n.addToConfirmationData({})
}d.getData().then(function(M){o.preCheckData=M;
o.reservationModel=u.getReservationModel();
if(w.current.name===C.preCheckoutForm){o.populateCountryListForDriverLicense();
o.populateBillingInfoCountryList();
o.checkForPartnerCustomerInfo();
o.loadCalendarDropdown();
o.getStatesForCountry(o.reservationModel.paymentRq.address.country);
o.getStatesForDL(o.reservationModel.paymentRq.address.country,o.countryListForDriverLicense)
}var L=o.preCheckData.reservationSummary.userState==C.userStateAuthenticated;
if(angular.isDefined(o.preCheckData.customerInfo)&&angular.isDefined(o.preCheckData.customerInfo.dlSummary)){o.reservationModel.dlSummary={};
o.customer=o.preCheckData.customerInfo;
o.accountModel=h.getAccountData(o.customer);
angular.merge(o.reservationModel.dlSummary,o.accountModel.dlSummary)
}else{o.reservationModel.dlSummary={country:o.reservationModel.paymentRq.address.country}
}if(angular.isDefined(o.reservationModel)&&angular.isDefined(o.reservationModel.paymentRq)&&angular.isDefined(o.reservationModel.paymentRq.address.address1)&&o.reservationModel.paymentRq.address.address1!=""&&o.reservationModel.prepayProcessIndicator){o.disabledField.address=true
}if(angular.isDefined(o.reservationModel)&&angular.isDefined(o.reservationModel.dlSummary)&&angular.isDefined(o.reservationModel.dlSummary.dlNumber)&&o.reservationModel.dlSummary.dlNumber!=""){o.disabledField.driverLicense=true
}p.requestInProgress=false
})
}function i(){if(angular.isDefined(o.preCheckData)&&angular.isDefined(o.preCheckData.partnerCustomerInfo)&&!angular.equals({},o.preCheckData.partnerCustomerInfo)){o.hasPartnerInfo=true
}else{o.hasPartnerInfo=false
}}function F(){var L=G.countryOfResidence;
o.countryList=angular.fromJson(L?L:{});
o._setCORAsBillingCountry()
}function e(){o.customer=E.getCustomerModel();
var L="";
if(o.customer&&o.customer.userState!="PARTNER_AUTHENTICATED"){L=o.customer.cor
}else{if(o.reservationModel&&o.reservationModel.paymentRq&&o.reservationModel.paymentRq.address&&o.reservationModel.paymentRq.address.country&&o.reservationModel.paymentRq.address.country!=""){L=o.reservationModel.paymentRq.address.country
}else{if(o.reservationModel&&o.reservationModel.personalInfoRQ&&o.reservationModel.personalInfoRQ.residency&&o.reservationModel.personalInfoRQ.residency!==""){L=o.reservationModel.personalInfoRQ.residency
}else{L="US"
}}}var M=o.countryList.indexOf(B("filter")(o.countryList,function(N){return N.code===L
})[0]);
o.reservationModel.paymentRq.address.country=o.countryList[M].code
}function J(L){if(o.countryList&&L!=undefined&&L!=""&&(L===C.countryCodeAU||L===C.countryCodeCA||L===C.countryCodeUS)){var M=o.countryList.indexOf(B("filter")(o.countryList,function(N){return N.code===L
})[0]);
o.statesForCountry=o.countryList[M].stateList
}o._displayFunction(L)
}function g(){o.countryListForDriverLicense=D.getCountryList(o.preCheckData,G.countryOfResidence);
if(angular.isDefined(o.preCheckData)&&angular.isDefined(o.preCheckData.customerInfo)&&angular.isDefined(o.preCheckData.customerInfo.dlSummary)&&angular.isDefined(o.preCheckData.customerInfo.dlSummary.country)){o.statesForDL=D.getStateListBasedOnCounty(o.preCheckData.customerInfo.dlSummary.country,o.countryListForDriverLicense).statesForDL
}if(o.statesForDL&&angular.isDefined(o.preCheckData.partnerCustomerInfo)&&angular.isDefined(o.preCheckData.partnerCustomerInfo.dlSummary)&&angular.isDefined(o.preCheckData.partnerCustomerInfo.dlSummary.state)&&o.preCheckData.customerInfo.dlSummary.state!==""){var L=o.statesForDL.indexOf(B("filter")(o.statesForDL,function(M){return(M.stateCode.toUpperCase()===o.preCheckData.partnerCustomerInfo.dlSummary.state.toUpperCase()||M.stateName.toUpperCase()===o.preCheckData.partnerCustomerInfo.dlSummary.state.toUpperCase())
})[0]);
if(L>-1){o.disableDLState=true;
o.accountModel.dlSummary.state=o.statesForDL[L].stateCode
}}if(o.countryListForDriverLicense&&angular.isDefined(o.preCheckData.customerInfo)&&angular.isDefined(o.preCheckData.customerInfo.dlSummary)&&angular.isDefined(o.preCheckData.customerInfo.dlSummary.dlNumber)&&o.preCheckData.customerInfo.dlSummary.dlNumber!==""){o.showDOBField=false
}else{o.showDOBField=true
}}function K(M,N){var L={};
if(angular.isDefined(N)&&N.length>0){L=D.getStateListBasedOnCounty(M,N)
}else{L=D.getStateListBasedOnCounty(M,o.countryList)
}o.statesForDL=L.statesForDL
}function A(){var O=o.hasPartnerInfo?(angular.isDefined(o.preCheckData.partnerCustomerInfo.minAge)?o.preCheckData.partnerCustomerInfo.minAge:C.ageLimit.lower):C.ageLimit.lower;
var N=D.loadCalendarDropdown(O);
o.monthsList=N.monthsList;
o.yearsList=N.yearsList;
o.datesList=N.datesList;
if(angular.isDefined(o.preCheckData.customerInfo)&&angular.isDefined(o.preCheckData.customerInfo.dlSummary)&&angular.isUndefined(o.preCheckData.customerInfo.dlSummary.dlNumber)){if(angular.isDefined(o.preCheckData.partnerCustomerInfo)&&angular.isDefined(o.preCheckData.partnerCustomerInfo.dob)&&angular.isDefined(o.monthsList)&&o.monthsList!=""&&o.monthsList.length>0&&angular.isDefined(o.accountModel)){var M=o.preCheckData.customerInfo.dob.split("/");
var L=o.monthsList.indexOf(B("filter")(o.monthsList,function(P){return P.key==M[0]
})[0]);
if(angular.isDefined(L)&&L!=-1){o.reservationModel.dobMonth=o.monthsList[L].key
}o.reservationModel.dobDate=M[1];
o.reservationModel.dobYear=M[2]
}}}function s(M){if(o.reservationModel.personalInfoRQ.smsOptIn){if(!angular.isDefined(o.reservationModel.personalInfoRQ.phone)||o.reservationModel.personalInfoRQ.phone==""){b.displayServiceError("vm.reservationModel.personalInfoRQ.phone","required",true)
}else{if(angular.isDefined(o.reservationModel.personalInfoRQ.phone)&&b.validateField("vm.reservationModel.personalInfoRQ.phone",true,M)){for(var L=0;
L<o.preCheckData.reservationSummary.personalInfo.phoneNumbers.length;
L++){if(o.reservationModel.personalInfoRQ.phone==o.preCheckData.reservationSummary.personalInfo.phoneNumbers[L].phoneNumber){o.phoneMaskId=o.preCheckData.reservationSummary.personalInfo.phoneNumbers[L].maskId
}}d.phoneNumberValidation(o.reservationModel.personalInfoRQ.phone,o.phoneMaskId).then(function(P){if(angular.isDefined(P.fieldErrors)&&P.fieldErrors.length>0){var Q="";
for(var O=0;
O<P.fieldErrors.length;
O++){if(P.fieldErrors[O].fieldName=="phoneNumber"){Q="vm.reservationModel.personalInfoRQ.phone";
b.displayServiceError(Q,"uscan")
}}}else{if(angular.isDefined(P.errorList)&&P.errorList.length>0){for(var O=0;
O<P.errorList.length;
O++){var N=P.errorList[O];
if(N.type==="ERROR"&&N.code==="700020"){b.displayServiceError("vm.reservationModel.personalInfoRQ.phone","required",true);
o.reservationModel.personalInfoRQ.phone="";
o.reservationModel.personalInfoRQ.smsOptIn=false
}else{if(N.type==="ERROR"&&N.code==="700022"){b.displayServiceError("vm.reservationModel.personalInfoRQ.phone","maskedphonenumber",true);
o.reservationModel.personalInfoRQ.phone="";
o.reservationModel.personalInfoRQ.smsOptIn=false
}else{if(N.type==="ERROR"&&N.code==="86"){b.displayServiceError("vm.reservationModel.personalInfoRQ.phone","uscan",true);
o.reservationModel.personalInfoRQ.phone="";
o.reservationModel.personalInfoRQ.smsOptIn=false
}}}}}}})
}else{b.displayServiceError("vm.reservationModel.personalInfoRQ.phone","invalid",true)
}}}}function t(L){o.country=G.country?G.countrySelect:"US";
var M=L.target.parentElement;
o.helpURL=q.getUrl(M,country)
}function r(L){if(L==C.countryCodeCA||L==C.countryCodePR||L==C.countryCodeUS||L==C.countryCodeCX||L==C.countryCodeCV||L==C.countryCodeVI){o.showCity=true
}else{o.showCity=false
}if(L==C.countryCodeAU||L==C.countryCodeCA||L==C.countryCodeUS||L==C.countryCodeNZ){o.showState=true
}else{o.showState=false
}if(L==C.countryCodeAU||L==C.countryCodeNZ){o.showSuburb=true
}else{o.showSuburb=false
}if(o.showSuburb||o.showCity){o.showZipcode=true
}else{o.showZipcode=false
}}function y(L){o.preCheckFormValidation=false;
document.getElementById("precheckout_submit_button").disabled=true;
b.validate(L).success(I).error(m)
}function I(){p.requestInProgress=true;
o.preCheckFormValidation=false;
o.preCheckPageError="";
d.submitCheckinForm(o.reservationModel,o.preCheckData.reservationSummary.confirmationNumber).then(function(M){p.requestInProgress=false;
if(angular.isDefined(M)){if(angular.isDefined(M.fieldErrors)&&M.fieldErrors.length>0){var N=[];
var L;
angular.forEach(M.fieldErrors,function(O,P){L={message:b.displayServiceError(O.field,O.classifier)}
});
if(M.fieldErrors.length>1){L={message:Dictionary.I18n.get("err.res.mutliplemsg")}
}N.push(L);
o.errors=N;
$(window).scrollTop(0);
document.getElementById("precheckout_submit_button").disabled=false
}else{if(angular.isDefined(M.errorList)&&M.errorList.length>0){M=k.processErrorMessage(M);
o.errors=M.errorList;
p.requestInProgress=false;
document.getElementById("precheckout_submit_button").disabled=false;
$(window).scrollTop(0)
}else{w.go("/pre-checkout-confirmation")
}}}},function(L){p.requestInProgress=false;
document.getElementById("precheckout_submit_button").disabled=false;
if(angular.isDefined(L.errorList)&&L.errorList.length>0){o.preCheckFormValidation=true;
$(window).scrollTop(0)
}})
}function m(L){o.preCheckFormValidation=true;
document.getElementById("precheckout_submit_button").disabled=false;
var M=L.errorCount;
if(1===M){o.preCheckPageError=f.trustAsHtml(L.MSG[0]);
o.secureCode=""
}else{if(1<M){o.preCheckPageError=Dictionary.I18n.get("err.global.multi.errorMessage");
$(window).scrollTop(0)
}}}function j(){p.requestInProgress=true;
var L=c.getTermsConditionModel(o.reservationModel);
c.getSmsTermsAndCondition(L).then(function(M){o.termsCondition=M;
$(".reservation-flow-sms .modal-body").scrollTop(0);
p.requestInProgress=false
},function(){o.termsCondition={};
p.requestInProgress=false
})
}o.pageInit()
}})();
(function(){angular.module("reservation").controller("ConfirmationExnController",a);
a.$inject=["$q","ftpService","$scope","$rootScope","$location","$state"];
function a(d,f,c,b,g,e){}})();
(function(){angular.module("reservation").controller("ExtrasExnController",a);
a.$inject=["$sce","$scope","$rootScope","$state","$window","$filter"];
function a(c,d,b,e,g,f){}})();
(function(){angular.module("reservation").controller("GlobalSummaryExnController",a);
a.$inject=["$controller","$scope","$timeout","$rootScope","$state","$window","$validation"];
function a(c,d,f,b,e,h,g){}})();
(function(){angular.module("reservation").controller("LookupExnController",a);
a.$inject=["$controller","$scope","$rootScope","$state","$window"];
function a(c,d,b,e,f){}})();
(function(){angular.module("reservation").controller("ModifyReservationExnController",a);
a.$inject=["ftpService","$scope","$rootScope","$state","$sce"];
function a(f,d,b,e,c){}})();
(function(){angular.module("reservation").controller("ReviewModifyExnController",a);
a.$inject=["$scope","$rootScope","$state","$sce"];
function a(d,b,e,c){}})();
(function(){angular.module("reservation").controller("PrintConfirmationExnController",a);
a.$inject=["$scope","$rootScope","$state","$location"];
function a(c,b,d,e){}})();
(function(){angular.module("carRental").controller("ProgressBarExnController",a);
a.$inject=["$scope","$rootScope","$state"];
function a(c,b,d){}})();
(function(){angular.module("reservation").controller("ReviewExnController",a);
a.$inject=["$controller","$scope","$filter","$rootScope","$state","$window"];
function a(c,d,f,b,e,g){}})();
(function(){angular.module("reservation").controller("SummaryExnController",a);
a.$inject=["$controller","$sce","$scope"];
function a(b,c,d){}})();
(function(){angular.module("carRental").controller("VehicleListExnController",a);
a.$inject=["$q","$scope","$sce","$rootScope","$state","$window","$filter","$validation","$timeout"];
function a(f,j,h,i,b,c,g,e,d){}})();
(function(){angular.module("carRental").controller("CampaignExnController",a);
a.$inject=["$scope","$rootScope","$state"];
function a(c,b,d){}})();
(function(){angular.module("carRental").controller("smallBizExnController",a);
a.$inject=["$controller","$scope","$filter","$sce","$rootScope","$state","$window","$validation"];
function a(c,e,h,d,b,f,i,g){}})();
(function(){angular.module("reservation").controller("BookAgainExnController",a);
a.$inject=["$controller","$sce","$scope"];
function a(b,c,d){}})();
(function(){angular.module("account").controller("SignupExnController",a);
a.$inject=["carRentalConstant","$rootScope","$window"];
function a(c,b,d){}})();
(function(){angular.module("account").controller("MyProfileExnController",a);
a.$inject=["carRentalConstant","$rootScope","$window"];
function a(c,b,d){}})();
(function(){angular.module("account").controller("CredentialExnController",a);
a.$inject=["$rootScope","$state","$controller","$scope","$window"];
function a(c,e,b,d,f){}})();